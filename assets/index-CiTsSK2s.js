const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var Kt=Object.defineProperty;var Vt=(c,t,r)=>t in c?Kt(c,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[t]=r;var ce=(c,t,r)=>Vt(c,typeof t!="symbol"?t+"":t,r);import{a as Qt,b as Xt,g as Zt,c as Ye,r as E,R as tt,u as Z,d as kt,e as es,B as ts,f as ss,h as ee}from"./vendor-CGGxujwj.js";import{r as rs,c as os,a as as}from"./gun-CJ6ok8hl.js";import{B as K,U as Nt,L as Le,E as ns,a as ls,A as ot,T as St,P as ke,H as je,b as xe,S as is,c as Ae,d as Ke,e as be,f as Ct,M as Tt,C as le,g as cs,F as ds,h as at,i as ve,j as us,k as ms,l as se,m as nt,n as lt,X as qe,o as Ge,I as At,p as hs,q as xs,r as fs,s as Ne,t as gs,u as Et,v as ys,w as Pt,x as ps,y as bs,z as _t,D as it,G as Ve,J as vs,K as js,N as Dt,O as Me,Q as Te,Z as Qe,R as ws,V as ct,W as ks,Y as Ns,_ as dt,$ as ut,a0 as Ss,a1 as Cs}from"./icons-CGm57nNV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var ze={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mt;function Ts(){if(mt)return Ce;mt=1;var c=Qt(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function n(h,l,d){var x,u={},m=null,j=null;d!==void 0&&(m=""+d),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(j=l.ref);for(x in l)a.call(l,x)&&!o.hasOwnProperty(x)&&(u[x]=l[x]);if(h&&h.defaultProps)for(x in l=h.defaultProps,l)u[x]===void 0&&(u[x]=l[x]);return{$$typeof:t,type:h,key:m,ref:j,props:u,_owner:s.current}}return Ce.Fragment=r,Ce.jsx=n,Ce.jsxs=n,Ce}var ht;function As(){return ht||(ht=1,ze.exports=Ts()),ze.exports}var e=As(),Ie={},xt;function Es(){if(xt)return Ie;xt=1;var c=Xt();return Ie.createRoot=c.createRoot,Ie.hydrateRoot=c.hydrateRoot,Ie}var Ps=Es(),_s=rs();const oe=Zt(_s);var Ue={exports:{}};Ue.exports;var ft;function Ds(){return ft||(ft=1,function(c){(function(){function t(a,s){return s?os(a):a.slice?t[o(a)]:function(n,h){a(n={exports:{}}),t[o(h)]=n.exports};function o(n){return n.split("/").slice(-1).toString().replace(".js","")}}var r=c;t(function(a){typeof self<"u"&&(a.window=self),typeof window<"u"&&(a.window=window);var s=a.window||a,o,n=s.SEA||{};(n.window=a.window)&&(n.window.SEA=n);try{o+""!=typeof r&&(r.exports=n)}catch{}a.exports=n})(t,"./root"),t(function(a){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(a){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{Ye.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Ye.btoa=function(o){return Buffer.from(o,"binary").toString("base64")},Ye.atob=function(o){return Buffer.from(o,"base64").toString("binary")}}})(t,"./base64"),t(function(a){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(o,n,h){o=o||"utf8",n=n||0;const l=this.length;if(o==="hex"){const d=new Uint8Array(this);return[...Array((h&&h+1||l)-n).keys()].map(x=>d[x+n].toString(16).padStart(2,"0")).join("")}if(o==="utf8")return Array.from({length:(h||l)-n},(d,x)=>String.fromCharCode(this[x+n])).join("");if(o==="base64")return btoa(this)},a.exports=s})(t,"./array"),t(function(a){t("./base64");var s=t("./array");function o(...n){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),o.from(...n)}o.prototype=Object.create(Array.prototype),Object.assign(o,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const n=arguments[0];let h;if(typeof n=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const x=n.match(/([\da-fA-F]{2})/g).map(u=>parseInt(u,16));if(!x||!x.length)throw new TypeError("Invalid first argument for type 'hex'.");h=s.from(x)}else if(d==="utf8"||d==="binary"){const x=n.length,u=new Uint16Array(x);Array.from({length:x},(m,j)=>u[j]=n.charCodeAt(j)),h=s.from(u)}else if(d==="base64"){const x=atob(n),u=x.length,m=new Uint8Array(u);Array.from({length:u},(j,i)=>m[i]=x.charCodeAt(i)),h=s.from(m)}else d==="binary"?h=s.from(n):console.info("SafeBuffer.from unknown encoding: "+d);return h}if(n.byteLength,n.byteLength?n.byteLength:n.length){let d;return n instanceof ArrayBuffer&&(d=new Uint8Array(n)),s.from(d||n)}},alloc(n,h=0){return s.from(new Uint8Array(Array.from({length:n},()=>h)))},allocUnsafe(n){return s.from(new Uint8Array(Array.from({length:n})))},concat(n){if(!Array.isArray(n))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(n.reduce((h,l)=>h.concat(Array.from(l)),[]))}}),o.prototype.from=o.from,o.prototype.toString=s.prototype.toString,a.exports=o})(t,"./buffer"),t(function(a){const s=t("./root"),o={Buffer:t("./buffer")};var n={},h;if(JSON.parseAsync=JSON.parseAsync||function(d,x,u){var m;try{x(m,JSON.parse(d,u))}catch(j){x(j)}},JSON.stringifyAsync=JSON.stringifyAsync||function(d,x,u,m){var j;try{x(j,JSON.stringify(d,u,m))}catch(i){x(i)}},o.parse=function(d,x){return new Promise(function(u,m){JSON.parseAsync(d,function(j,i){j?m(j):u(i)},x)})},o.stringify=function(d,x,u){return new Promise(function(m,j){JSON.stringifyAsync(d,function(i,v){i?j(i):m(v)},x,u)})},s.window&&(o.crypto=s.window.crypto||s.window.msCrypto,o.subtle=(o.crypto||n).subtle||(o.crypto||n).webkitSubtle,o.TextEncoder=s.window.TextEncoder,o.TextDecoder=s.window.TextDecoder,o.random=d=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(d))))),!o.TextDecoder){const{TextEncoder:d,TextDecoder:x}=t((h+""==typeof r?".":"")+"./lib/text-encoding",1);o.TextDecoder=x,o.TextEncoder=d}if(!o.crypto)try{var l=t("crypto",1);Object.assign(o,{crypto:l,random:x=>o.Buffer.from(l.randomBytes(x))});const{Crypto:d}=t("@peculiar/webcrypto",1);o.ossl=o.subtle=new d({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}a.exports=o})(t,"./shim"),t(function(a){var s=t("./root"),o=t("./shim"),n={};n.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},n.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},n.ecdh={name:"ECDH",namedCurve:"P-256"},n.jwk=function(h,l){h=h.split(".");var d=h[0],x=h[1],u={kty:"EC",crv:"P-256",x:d,y:x,ext:!0};return u.key_ops=l?["sign"]:["verify"],l&&(u.d=l),u},n.keyToJwk=function(h){return{kty:"oct",k:h.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},n.recall={validity:12*60*60,hook:function(h){return h}},n.check=function(h){return typeof h=="string"&&h.slice(0,4)==="SEA{"},n.parse=async function(l){try{var d=typeof l=="string";return d&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),d?await o.parse(l):l}catch{}return l},s.opt=n,a.exports=n})(t,"./settings"),t(function(a){var s=t("./shim");a.exports=async function(o,n){var h=typeof o=="string"?o:await s.stringify(o),l=await s.subtle.digest({name:n||"SHA-256"},new s.TextEncoder().encode(h));return s.Buffer.from(l)}})(t,"./sha256"),t(function(a){const s=t("./shim"),o=s.subtle,n=s.ossl?s.ossl:o,h=l=>n.digest({name:"SHA-1"},new ArrayBuffer(l));a.exports=h})(t,"./sha1"),t(function(a){var s=t("./root"),o=t("./shim"),n=t("./settings"),h=t("./sha256"),l;s.work=s.work||(async(d,x,u,m)=>{try{var j=(x||{}).epub||x;if(m=m||{},j instanceof Function&&(u=j,j=l),d=typeof d=="string"?d:await o.stringify(d),(m.name||"").toLowerCase().slice(0,3)==="sha"){var i=o.Buffer.from(await h(d,m.name),"binary").toString(m.encode||"base64");if(u)try{u(i)}catch(f){console.log(f)}return i}j=j||o.random(9);var v=await(o.ossl||o.subtle).importKey("raw",new o.TextEncoder().encode(d),{name:m.name||"PBKDF2"},!1,["deriveBits"]),g=await(o.ossl||o.subtle).deriveBits({name:m.name||"PBKDF2",iterations:m.iterations||n.pbkdf2.iter,salt:new o.TextEncoder().encode(m.salt||j),hash:m.hash||n.pbkdf2.hash},v,m.length||n.pbkdf2.ks*8);d=o.random(d.length);var A=o.Buffer.from(g,"binary").toString(m.encode||"base64");if(u)try{u(A)}catch(f){console.log(f)}return A}catch(f){if(console.log(f),s.err=f,s.throw)throw f;u&&u();return}}),a.exports=s.work})(t,"./work"),t(function(a){var s=t("./root"),o=t("./shim");t("./settings"),s.name=s.name||(async(n,h)=>{try{if(n)try{n()}catch(l){console.log(l)}return}catch(l){if(console.log(l),s.err=l,s.throw)throw l;n&&n();return}}),s.pair=s.pair||(async(n,h)=>{try{var l=o.ossl||o.subtle,d=await o.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async m=>{var j={};j.priv=(await o.subtle.exportKey("jwk",m.privateKey)).d;var i=await o.subtle.exportKey("jwk",m.publicKey);return j.pub=i.x+"."+i.y,j});try{var x=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async m=>{var j={};j.epriv=(await l.exportKey("jwk",m.privateKey)).d;var i=await l.exportKey("jwk",m.publicKey);return j.epub=i.x+"."+i.y,j})}catch(m){if(s.window)throw m;if(m=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw m}x=x||{};var u={pub:d.pub,priv:d.priv,epub:x.epub,epriv:x.epriv};if(n)try{n(u)}catch(m){console.log(m)}return u}catch(m){if(console.log(m),s.err=m,s.throw)throw m;n&&n();return}}),a.exports=s.pair})(t,"./pair"),t(function(a){var s=t("./root"),o=t("./shim"),n=t("./settings"),h=t("./sha256"),l;s.sign=s.sign||(async(d,x,u,m)=>{try{if(m=m||{},!(x||m).priv){if(!s.I)throw"No signing key.";x=await s.I(null,{what:d,how:"sign",why:m.why})}if(l===d)throw"`undefined` not allowed.";var j=await n.parse(d),i=m.check=m.check||j;if(s.verify&&(s.opt.check(i)||i&&i.s&&i.m)&&l!==await s.verify(i,x)){var p=await n.parse(i);if(m.raw||(p="SEA"+await o.stringify(p)),u)try{u(p)}catch(k){console.log(k)}return p}var v=x.pub,g=x.priv,A=n.jwk(v,g),f=await h(j),T=await(o.ossl||o.subtle).importKey("jwk",A,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(y=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},y,new Uint8Array(f))),p={m:j,s:o.Buffer.from(T,"binary").toString(m.encode||"base64")};if(m.raw||(p="SEA"+await o.stringify(p)),u)try{u(p)}catch(y){console.log(y)}return p}catch(y){if(console.log(y),s.err=y,s.throw)throw y;u&&u();return}}),a.exports=s.sign})(t,"./sign"),t(function(a){var s=t("./root"),o=t("./shim"),n=t("./settings"),h=t("./sha256"),l;s.verify=s.verify||(async(u,m,j,i)=>{try{var v=await n.parse(u);if(m===!1){var g=await n.parse(v.m);if(j)try{j(g)}catch(I){console.log(I)}return g}i=i||{};var A=m.pub||m,f=s.opt.slow_leak?await s.opt.slow_leak(A):await(o.ossl||o.subtle).importKey("jwk",n.jwk(A),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),T=await h(v.m),p,y,k,b;try{if(p=o.Buffer.from(v.s,i.encode||"base64"),y=new Uint8Array(p),k=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},f,y,new Uint8Array(T)),!k)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(u,m,j,i)}var _=k?await n.parse(v.m):l;if(j)try{j(_)}catch(I){console.log(I)}return _}catch(I){if(console.log(I),s.err=I,s.throw)throw I;j&&j();return}}),a.exports=s.verify;var d={};s.opt.slow_leak=u=>{if(d[u])return d[u];var m=n.jwk(u);return d[u]=(o.ossl||o.subtle).importKey("jwk",m,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),d[u]};var x=s.opt;s.opt.fall_verify=async function(u,m,j,i,v){if(v===s.opt.fallback)throw"Signature did not match";v=v||1;var g=u||"";u=s.opt.unpack(u)||u;var A=await n.parse(u),f=m.pub||m,T=await s.opt.slow_leak(f),p=v<=s.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},new o.TextEncoder().encode(await n.parse(A.m)))):await h(A.m),y,k,b;try{if(y=o.Buffer.from(A.s,i.encode||"base64"),k=new Uint8Array(y),b=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},T,k,new Uint8Array(p)),!b)throw"Signature did not match."}catch{try{y=o.Buffer.from(A.s,"utf8"),k=new Uint8Array(y),b=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},T,k,new Uint8Array(p))}catch{if(!b)throw"Signature did not match."}}var _=b?await n.parse(A.m):l;if(x.fall_soul=g["#"],x.fall_key=g["."],x.fall_val=u,x.fall_state=g[">"],j)try{j(_)}catch(I){console.log(I)}return _},s.opt.fallback=2})(t,"./verify"),t(function(a){var s=t("./shim"),o=t("./settings"),n=t("./sha256");const h=async(l,d,x)=>{const u=l+(d||s.random(8)).toString("utf8"),m=s.Buffer.from(await n(u),"binary"),j=o.keyToJwk(m);return await s.subtle.importKey("jwk",j,{name:"AES-GCM"},!1,["encrypt","decrypt"])};a.exports=h})(t,"./aeskey"),t(function(a){var s=t("./root"),o=t("./shim");t("./settings");var n=t("./aeskey"),h;s.encrypt=s.encrypt||(async(l,d,x,u)=>{try{u=u||{};var m=(d||u).epriv||d;if(h===l)throw"`undefined` not allowed.";if(!m){if(!s.I)throw"No encryption key.";d=await s.I(null,{what:l,how:"encrypt",why:u.why}),m=d.epriv||d}var j=typeof l=="string"?l:await o.stringify(l),i={s:o.random(9),iv:o.random(15)},v=await n(m,i.s,u).then(A=>o.subtle.encrypt({name:u.name||"AES-GCM",iv:new Uint8Array(i.iv)},A,new o.TextEncoder().encode(j))),g={ct:o.Buffer.from(v,"binary").toString(u.encode||"base64"),iv:i.iv.toString(u.encode||"base64"),s:i.s.toString(u.encode||"base64")};if(u.raw||(g="SEA"+await o.stringify(g)),x)try{x(g)}catch(A){console.log(A)}return g}catch(A){if(console.log(A),s.err=A,s.throw)throw A;x&&x();return}}),a.exports=s.encrypt})(t,"./encrypt"),t(function(a){var s=t("./root"),o=t("./shim"),n=t("./settings"),h=t("./aeskey");s.decrypt=s.decrypt||(async(l,d,x,u)=>{try{u=u||{};var m=(d||u).epriv||d;if(!m){if(!s.I)throw"No decryption key.";d=await s.I(null,{what:l,how:"decrypt",why:u.why}),m=d.epriv||d}var j=await n.parse(l),i,v,g;try{i=o.Buffer.from(j.s,u.encode||"base64"),v=o.Buffer.from(j.iv,u.encode||"base64"),g=o.Buffer.from(j.ct,u.encode||"base64");var A=await h(m,i,u).then(T=>o.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(v),tagLength:128},T,new Uint8Array(g)))}catch{if(u.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return u.encode="utf8",await s.decrypt(l,d,x,u)}var f=await n.parse(new o.TextDecoder("utf8").decode(A));if(x)try{x(f)}catch(T){console.log(T)}return f}catch(T){if(console.log(T),s.err=T,s.throw)throw T;x&&x();return}}),a.exports=s.decrypt})(t,"./decrypt"),t(function(a){var s=t("./root"),o=t("./shim");t("./settings"),s.secret=s.secret||(async(h,l,d,x)=>{try{if(x=x||{},!l||!l.epriv||!l.epub){if(!s.I)throw"No secret mix.";l=await s.I(null,{what:h,how:"secret",why:x.why})}var u=h.epub||h,m=l.epub,j=l.epriv,i=o.ossl||o.subtle,v=n(u),g=Object.assign({public:await i.importKey(...v,!0,[])},{name:"ECDH",namedCurve:"P-256"}),A=n(m,j),f=await i.importKey(...A,!1,["deriveBits"]).then(async p=>{var y=await i.deriveBits(g,p,256),k=new Uint8Array(y),b=await i.importKey("raw",k,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return i.exportKey("jwk",b).then(({k:_})=>_)}),T=f;if(d)try{d(T)}catch(p){console.log(p)}return T}catch(p){if(console.log(p),s.err=p,s.throw)throw p;d&&d();return}});var n=(h,l)=>{var[d,x]=h.split("."),u=l?{d:l}:{};return["jwk",Object.assign(u,{x:d,y:x,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};a.exports=s.secret})(t,"./secret"),t(function(a){var s=t("./root");s.certify=s.certify||(async(o,n={},h,l,d={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),o=(()=>{var T=[];if(o){if((typeof o=="string"||Array.isArray(o))&&o.indexOf("*")>-1)return"*";if(typeof o=="string")return o;if(Array.isArray(o)){if(o.length===1&&o[0])return typeof o[0]=="object"&&o[0].pub?o[0].pub:typeof o[0]=="string"?o[0]:null;o.map(p=>{typeof p=="string"?T.push(p):typeof p=="object"&&p.pub&&T.push(p.pub)})}return typeof o=="object"&&o.pub?o.pub:T.length>0?T:null}})(),!o)return console.log("No certificant found.");const u=d.expiry&&(typeof d.expiry=="number"||typeof d.expiry=="string")?parseFloat(d.expiry):null,m=(n||{}).read?n.read:null,j=(n||{}).write?n.write:typeof n=="string"||Array.isArray(n)||n["+"]||n["#"]||n["."]||n["="]||n["*"]||n[">"]||n["<"]?n:null,i=(d||{}).block||(d||{}).blacklist||(d||{}).ban||{},v=i.read&&(typeof i.read=="string"||(i.read||{})["#"])?i.read:null,g=typeof i=="string"?i:i.write&&(typeof i.write=="string"||i.write["#"])?i.write:null;if(!m&&!j)return console.log("No policy found.");const A=JSON.stringify({c:o,...u?{e:u}:{},...m?{r:m}:{},...j?{w:j}:{},...v?{rb:v}:{},...g?{wb:g}:{}});var x=await s.sign(A,h,null,{raw:1});if(d.raw||(x="SEA"+JSON.stringify(x)),l)try{l(x)}catch(T){console.log(T)}return x}catch(u){if(s.err=u,s.throw)throw u;l&&l();return}}),a.exports=s.certify})(t,"./certify"),t(function(a){var s=t("./shim"),o=t("./root");o.work=t("./work"),o.sign=t("./sign"),o.verify=t("./verify"),o.encrypt=t("./encrypt"),o.decrypt=t("./decrypt"),o.certify=t("./certify"),o.random=o.random||s.random,o.Buffer=o.Buffer||t("./buffer"),o.keyid=o.keyid||(async n=>{try{const h=s.Buffer.concat(n.replace(/-/g,"+").replace(/_/g,"/").split(".").map(u=>s.Buffer.from(u,"base64"))),l=s.Buffer.concat([s.Buffer.from([153,h.length/256,h.length%256]),h]),d=await sha1hash(l),x=s.Buffer.from(d,"binary");return x.toString("hex",x.length-8)}catch(h){throw console.log(h),h}}),((o.window||{}).GUN||{}).SEA=o,a.exports=o})(t,"./sea"),t(function(a){var s=t("./sea"),o,n;s.window?o=s.window.GUN||{chain:{}}:o=t((n+""==typeof r?".":"")+"./gun",1),s.GUN=o;function h(d){this._={$:this}}h.prototype=function(){function d(){}return d.prototype=o.chain,new d}(),h.prototype.constructor=h,o.chain.user=function(d){var x=this,m=x.back(-1),u;if(d)return d=s.opt.pub((d._||"")["#"])||d,m.get("~"+d);if(u=m.back("user"))return u;var m=m._,j=m,i=j.opt.uuid||l;return(j=(u=j.user=x.chain(new h))._).opt={},j.opt.uuid=function(v){var g=i(),A=m.user;return!A||!(A=A.is)||!(A=A.pub)||(g="~"+A+"/"+g,v&&v.call&&v(null,g)),g},u};function l(){return o.state().toString(36).replace(".","")}o.User=h,h.GUN=o,h.SEA=o.SEA=s,a.exports=h})(t,"./user"),t(function(a){var s,o=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof r?".":"")+"./gun",1);o.chain.then=function(n,h){var l=this,d=new Promise(function(x,u){l.once(x,h)});return n?d.then(n):d}})(t,"./then"),t(function(a){var s=t("./user"),o=s.SEA,n=s.GUN,h=function(){};s.prototype.create=function(...l){var d=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,x=d&&(d.pub||d.epub)?d.pub:typeof l[0]=="string"?l[0]:null,u=d&&(d.pub||d.epub)?d:x&&typeof l[1]=="string"?l[1]:null,m=l.filter(T=>typeof T=="function")[0]||null,j=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},i=this,v=i._,g=i.back(-1);if(m=m||h,j=j||{},j.check!==!1){var A;if(x||(A="No user."),(u||"").length<8&&(A="Password too short!"),A)return m({err:n.log(A)}),i}if(v.ing)return(m||h)({err:n.log("User is already being created or authenticated!"),wait:!0}),i;v.ing=!0;var f={};return f.a=function(T){if(f.pubs=T,T&&!j.already){var p={err:n.log("User already created!")};v.ing=!1,(m||h)(p),i.leave();return}f.salt=String.random(64),o.work(u,f.salt,f.b)},f.b=function(T){f.proof=T,d?f.c(d):o.pair(f.c)},f.c=function(T){var p;f.pair=T||{},(p=v.root.user)&&(p._.sea=T,p.is={pub:T.pub,epub:T.epub,alias:x}),f.data={pub:T.pub},f.d()},f.d=function(){f.data.alias=x,f.e()},f.e=function(){f.data.epub=f.pair.epub,o.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},f.proof,f.f,{raw:1})},f.f=function(T){f.data.auth=JSON.stringify({ek:T,s:f.salt}),f.g(f.data.auth)},f.g=function(T){var p;f.data.auth=f.data.auth||T,g.get(p="~"+f.pair.pub).put(f.data).on(f.h);var y={};y[p]={"#":p},g.get("~@"+x).put(y).get(p).on(f.i)},f.h=function(T,p,y,k){k.off(),f.h.ok=1,f.i()},f.i=function(T,p,y,k){k&&(f.i.ok=1,k.off()),!(!f.h.ok||!f.i.ok)&&(v.ing=!1,m({ok:0,pub:f.pair.pub}),h===m&&(d?i.auth(d):i.auth(x,u)))},g.get("~@"+x).once(f.a),i},s.prototype.leave=function(l,d){var x=this,u=x.back(-1)._.user;if(u&&(delete u.is,delete u._.is,delete u._.sea),o.window)try{var m={};m=o.window.sessionStorage,delete m.recall,delete m.pair}catch{}return x}})(t,"./create"),t(function(a){var s=t("./user"),o=s.SEA,n=s.GUN,h=function(){};s.prototype.auth=function(...d){var x=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,u=!x&&typeof d[0]=="string"?d[0]:null,m=(u||x&&!(x.priv&&x.epriv))&&typeof d[1]=="string"?d[1]:null,j=d.filter(y=>typeof y=="function")[0]||null,i=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},v=this,g=v._,A=v.back(-1);if(g.ing)return(j||h)({err:n.log("User is already being created or authenticated!"),wait:!0}),v;g.ing=!0;var f={},T,p=9;return f.a=function(y){if(!y)return f.b();if(!y.pub){var k=[];return Object.keys(y).forEach(function(b){b!="_"&&k.push(y[b])}),f.b(k)}if(f.name)return f.f(y);f.c((f.data=y).auth)},f.b=function(y){var k=(f.list=(f.list||[]).concat(y||[])).shift();if(T===k){if(f.name)return f.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(u&&p--){A.get("~@"+u).once(f.a);return}return f.err("Wrong user or password.")}A.get(k).once(f.a)},f.c=function(y){if(T===y)return f.b();if(typeof y=="string")return f.c(l(y));o.work(m,(f.auth=y).s,f.d,f.enc)},f.d=function(y){o.decrypt(f.auth.ek,y,f.e,f.enc)},f.e=function(y){if(T===y)return f.enc?(f.enc=null,f.b()):(f.enc={encode:"utf8"},f.c(f.auth));f.half=y,f.f(f.data)},f.f=function(y){var k=f.half||{},b=f.data||{};f.g(f.lol={pub:y.pub||b.pub,epub:y.epub||b.epub,priv:y.priv||k.priv,epriv:y.epriv||k.epriv})},f.g=function(y){if(!y||!y.pub||!y.epub)return f.b();f.pair=y;var k=A._.user,b=k._;b.tag;var _=b.opt;b=k._=A.get("~"+y.pub)._,b.opt=_,k.is={pub:y.pub,epub:y.epub,alias:u||y.pub},b.sea=f.pair,g.ing=!1;try{m&&T==(l(g.root.graph["~"+y.pub].auth)||"")[":"]&&(i.shuffle=i.change=m)}catch{}if(i.change?f.z():(j||h)(b),o.window&&(v.back("user")._.opt||i).remember)try{var I={};I=o.window.sessionStorage,I.recall=!0,I.pair=JSON.stringify(y)}catch{}try{A._.tag.auth?A._.on("auth",b):setTimeout(function(){A._.on("auth",b)},1)}catch(M){n.log("Your 'auth' callback crashed with:",M)}},f.h=function(y){if(!y)return f.b();if(u=y.alias,u||(u=y.alias="~"+x.pub),!y.auth)return f.g(x);x=null,f.c((f.data=y).auth)},f.z=function(){f.salt=String.random(64),o.work(i.change,f.salt,f.y)},f.y=function(y){o.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},y,f.x,{raw:1})},f.x=function(y){f.w(JSON.stringify({ek:y,s:f.salt}))},f.w=function(y){if(i.shuffle){console.log("migrate core account from UTF8 & shuffle");var k={};Object.keys(f.data).forEach(function(b){k[b]=f.data[b]}),delete k._,k.auth=y,A.get("~"+f.pair.pub).put(k)}A.get("~"+f.pair.pub).get("auth").put(y,j||h)},f.err=function(y){var k={err:n.log(y||"User cannot be found!")};g.ing=!1,(j||h)(k)},f.plugin=function(y){if(!(f.name=y))return f.err();var k=[y];y[0]!=="~"&&(k[1]="~"+y,k[2]="~@"+y),f.b(k)},x?x.priv&&x.epriv?f.g(x):A.get("~"+x.pub).once(f.h):u?A.get("~@"+u).once(f.a):!u&&!m&&o.name(f.plugin),v};function l(d){if(typeof d!="string")return d;try{d=JSON.parse(d)}catch{d={}}return d}})(t,"./auth"),t(function(a){var s=t("./user"),o=s.SEA;s.GUN,s.prototype.recall=function(n,h){var l=this,d=l.back(-1);if(n=n||{},n&&n.sessionStorage){if(o.window)try{var x={};x=o.window.sessionStorage,x&&(d._.opt.remember=!0,(l.back("user")._.opt||n).remember=!0,(x.recall||x.pair)&&d.user().auth(JSON.parse(x.pair),h))}catch{}return l}return l}})(t,"./recall"),t(function(a){var s=t("./user"),o=s.SEA,n=s.GUN,h=function(){};s.prototype.pair=function(){var l=this,d;try{d=new Proxy({DANGER:"☠"},{get:function(x,u,m){if(!(!l.is||!(l._||"").sea))return l._.sea[u]}})}catch{}return d},s.prototype.delete=async function(l,d,x){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var u=this;u.back(-1);var m=u.back("user");try{m.auth(l,d,function(j){var i=(m.is||{}).pub;m.map().once(function(){this.put(null)}),m.leave(),(x||h)({ok:0})})}catch(j){n.log("User.delete failed! Error:",j)}return u},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const x="No session!";throw n.log(x),{err:x}}},s.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),n.is(l)&&l.get("pub").get((d,x)=>{console.log(d,x)}),l.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(l,d){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var x=this,u=x.back(-1).user(),m=u._.sea,j="";return x.back(function(i){i.is||(j+=i.get||"")}),async function(){var i,v=await u.get("grant").get(m.pub).get(j).then();v=await o.decrypt(v,m),v||(v=o.random(16).toString(),i=await o.encrypt(v,m),u.get("grant").get(m.pub).get(j).put(i));var g=l.get("pub").then(),A=l.get("epub").then();g=await g,A=await A;var f=await o.secret(A,m);i=await o.encrypt(v,f),u.get("grant").get(g).get(j).put(i,d)}(),x},s.prototype.secret=function(l,d){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var x=this,u=x.back(-1).user(),m=u.pair(),j="";return x.back(function(i){i.is||(j+=i.get||"")}),async function(){var i,v=await u.get("trust").get(m.pub).get(j).then();v=await o.decrypt(v,m),v||(v=o.random(16).toString(),i=await o.encrypt(v,m),u.get("trust").get(m.pub).get(j).put(i)),i=await o.encrypt(l,v),x.put(i,d)}(),x},a.exports=s})(t,"./share"),t(function(a){var s=t("./sea"),o=t("./settings"),n,h=(s.window||"").GUN||t((""+n==typeof r?".":"")+"./gun",1);h.on("opt",function(i){i.sea||(i.sea={own:{}},i.on("put",l,i)),this.to.next(i)});function l(i){var v=this,g=v.as,A=i.put,f=A["#"],T=A["."],p=A[":"],y=A[">"],k=i["#"],b;if(!(!f||!T)){if((i._||"").faith&&(g.opt||"").faith&&typeof i._=="function"){s.opt.pack(A,function(I){s.verify(I,!1,function(M){A["="]=s.opt.unpack(M),v.to.next(i)})});return}var _=function(I){g.on("in",{"@":k,err:i.err=I})};if((i._||"").DBG&&((i._||"").DBG.c=+new Date),0<=f.indexOf("<?")&&(b=parseFloat(f.split("<?")[1]||""),b&&y<h.state()-b*1e3)){(b=i._)&&b.stun&&b.stun--;return}if(f==="~@"){l.alias(v,i,p,T,f,g,_);return}if(f.slice(0,2)==="~@"){l.pubs(v,i,p,T,f,g,_);return}if(b=s.opt.pub(f)){l.pub(v,i,p,T,f,g,_,g.user||"",b);return}if(0<=f.indexOf("#")){l.hash(v,i,p,T,f,g,_);return}l.any(v,i,p,T,f,g,_,g.user||"")}}l.hash=function(i,v,g,A,f,T,p){s.work(g,null,function(y){function k(b){let _="";for(let I=0;I<b.length;I++)_+=I-1&1?"":String.fromCharCode(parseInt(b.substring(I-1,I+1),16));return btoa(_)}if(y&&y===A.split("#").slice(-1)[0])return i.to.next(v);if(y&&y===k(A.split("#").slice(-1)[0]))return i.to.next(v);p("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(i,v,g,A,f,T,p){if(!g)return p("Data must exist!");if("~@"+A===x(g))return i.to.next(v);p("Alias not same!")},l.pubs=function(i,v,g,A,f,T,p){if(!g)return p("Alias must exist!");if(A===x(g))return i.to.next(v);p("Alias not same!")},l.pub=async function(i,v,g,A,f,T,p,y,k){var b;const _=await o.parse(g)||{},I=(M,G,P)=>{if(M.m&&M.s&&G&&k)return s.verify(M,k,B=>{if(n!==B&&n!==B.e&&v.put[">"]&&v.put[">"]>parseFloat(B.e))return p("Certificate expired.");if(n!==B&&B.c&&B.w&&(B.c===G||B.c.indexOf("*")>-1)){let w=f.indexOf("/")>-1?f.replace(f.substring(0,f.indexOf("/")+1),""):"";String.match=String.match||h.text.match;const O=Array.isArray(B.w)?B.w:typeof B.w=="object"||typeof B.w=="string"?[B.w]:[];for(const $ of O)if(String.match(w,$["#"])&&String.match(A,$["."])||!$["."]&&String.match(w,$["#"])||!$["#"]&&String.match(A,$["."])||String.match(w?w+"/"+A:A,$["#"]||$)){if($["+"]&&$["+"].indexOf("*")>-1&&w&&w.indexOf(G)==-1&&A.indexOf(G)==-1)return p(`Path "${w}" or key "${A}" must contain string "${G}".`);if(B.wb&&(typeof B.wb=="string"||(B.wb||{})["#"])){var F=i.as.root.$.back(-1);return typeof B.wb=="string"&&B.wb.slice(0,1)!=="~"&&(F=F.get("~"+k)),F.get(B.wb).get(G).once(q=>q&&(q===1||q===!0)?p(`Certificant ${G} blocked.`):P(B))}return P(B)}return p("Certificate verification fail.")}})};if(A==="pub"&&"~"+k===f)return g===k?i.to.next(v):p("Account not same!");if((b=y.is)&&b.pub&&!_["*"]&&!_["+"]&&(k===b.pub||k!==b.pub&&((v._.msg||{}).opt||{}).cert)){s.opt.pack(v.put,M=>{s.sign(M,y._.sea,async function(G){if(n===G)return p(s.err||"Signature fail.");if(v.put[":"]={":":b=s.opt.unpack(G.m),"~":G.s},v.put["="]=b,k===y.is.pub){(b=x(g))&&((T.sea.own[b]=T.sea.own[b]||{})[k]=1),JSON.stringifyAsync(v.put[":"],function(P,B){return P?p(P||"Stringify error."):(v.put[":"]=B,i.to.next(v))});return}if(k!==y.is.pub&&((v._.msg||{}).opt||{}).cert){const P=await o.parse(v._.msg.opt.cert);P&&P.m&&P.s&&I(P,y.is.pub,B=>{v.put[":"]["+"]=P,v.put[":"]["*"]=y.is.pub,JSON.stringifyAsync(v.put[":"],function(F,w){return F?p(F||"Stringify error."):(v.put[":"]=w,i.to.next(v))})})}},{raw:1})});return}s.opt.pack(v.put,M=>{s.verify(M,_["*"]||k,function(G){var P;if(G=s.opt.unpack(G),n===G)return p("Unverified data.");if((P=x(G))&&k===s.opt.pub(P)&&((T.sea.own[P]=T.sea.own[P]||{})[k]=1),_["+"]&&_["+"].m&&_["+"].s&&_["*"])I(_["+"],_["*"],B=>(v.put["="]=G,i.to.next(v)));else return v.put["="]=G,i.to.next(v)})})},l.any=function(i,v,g,A,f,T,p,y){if(T.opt.secure)return p("Soul missing public key at '"+A+"'.");T.on("secure",function(k){if(this.off(),!T.opt.secure)return i.to.next(k);p("Data cannot be changed.")}).on.on("secure",v)};var d=h.valid,x=function(i,v){return typeof(v=d(i))=="string"&&v};(h.state||"").ify;var u=/[^\w_-]/;s.opt.pub=function(i){if(i&&(i=i.split("~"),!(!i||!(i=i[1]))&&(i=i.split(u).slice(0,2),!(!i||i.length!=2)&&(i[0]||"")[0]!=="@")))return i=i.slice(0,2).join("."),i},s.opt.stringy=function(i){},s.opt.pack=function(i,v,g,A,f){var T,p;if(s.opt.check(i))return v(i);i&&i["#"]&&i["."]&&i[">"]&&(T=i[":"],p=1),JSON.parseAsync(p?T:i,function(y,k){var b=n!==(k||"")[":"]&&(k||"")["~"];if(!b){v(i);return}v({m:{"#":f||i["#"],".":g||i["."],":":(k||"")[":"],">":i[">"]||h.state.is(A,g)},s:b})})};var m=s.opt;s.opt.unpack=function(i,v,g){var A;if(n!==i){if(i&&n!==(A=i[":"]))return A;if(v=v||m.fall_key,!g&&m.fall_val&&(g={},g[v]=m.fall_val),!(!v||!g)){if(i===g[v]||!s.opt.check(g[v]))return i;var f=g&&g._&&g._["#"]||m.fall_soul,T=h.state.is(g,v)||m.fall_state;if(i&&i.length===4&&f===i[0]&&v===i[1]&&j(T)===j(i[3]))return i[2];if(T<s.opt.shuffle_attack)return i}}},s.opt.shuffle_attack=15463296e5;var j=Math.floor})(t,"./index")})()}(Ue)),Ue.exports}Ds();var gt={},yt;function Rs(){if(yt)return gt;yt=1;var c=typeof window<"u"?window.Gun:as();return c.chain.promise=function(a){var r=this,a=a||function(s){return s};return new Promise(function(s,o){r.once(function(n,h){s({put:n,get:h,gun:this})})}).then(a)},c.chain.then=function(t){var r=this,a=new Promise((s,o)=>{r.once(function(n,h){s(n,h)})});return t?a.then(t):a},gt}Rs();console.log("🔫 GunJS service file loading...");console.log("🔫 Imported Gun:",typeof oe);console.log("🔫 After importing gun/sea and gun/lib/then");console.log("🔫 Gun.SEA is available:",!!oe.SEA);oe.SEA?(console.log("🔫 ✅ Gun.SEA is properly initialized"),console.log("🔫 Gun.SEA methods:",oe.SEA?Object.keys(oe.SEA):"undefined")):(console.error("🔫 CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("🔫 Will check SEA availability after Gun instance creation..."));console.log("🔫 About to initialize Gun instance...");const te=oe({peers:["https://gun-ad4i.onrender.com/gun","https://bewildered-dulcy-amend09-294cb39e.koyeb.app/gun","https://amend09.hackclub.app/gun"]});console.log("🔫 GunJS initialized with Render peer and Nest peer");console.log("🔫 Gun instance created:",typeof te);console.log("🔫 Gun instance properties:",Object.keys(te));console.log("🔫 Checking Gun.SEA after instance creation:",!!oe.SEA);te.SEA&&(console.log("🔫 Found SEA on gun instance:",!!te.SEA),oe.SEA=te.SEA);console.log("🔫 Testing gun.user() method availability...");typeof te.user=="function"?console.log("🔫 ✅ gun.user() method is available"):(console.error("🔫 ❌ gun.user() method is NOT available"),console.error("🔫 Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(te))));te.on("hi",c=>{console.log("🔫 GunJS: Connected to peer",c)});te.on("bye",c=>{console.log("🔫 GunJS: Disconnected from peer",c)});te.on("out",c=>{c&&c.err&&console.warn("🔫 GunJS: Connection error:",c.err)});setTimeout(()=>{console.log("🔫 GunJS connection test - gun object:",te),console.log("🔫 GunJS internal state:",te._),te.get("test").put({hello:"world",timestamp:Date.now()}),console.log("🔫 GunJS: Test data written")},2e3);console.log("🔫 Creating user instance...");let me;try{me=te.user(),console.log("🔫 ✅ User instance created successfully:",typeof me),console.log("🔫 User instance properties:",Object.keys(me)),typeof me.create=="function"?console.log("🔫 ✅ user.create() method is available"):console.error("🔫 ❌ user.create() method is NOT available"),typeof me.auth=="function"?console.log("🔫 ✅ user.auth() method is available"):console.error("🔫 ❌ user.auth() method is NOT available")}catch(c){console.error("🔫 ❌ FAILED to create user instance:",c),console.error("🔫 This confirms that SEA is not properly loaded"),me={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const $e=oe.SEA;console.log("🔫 SEA reference:",typeof $e);$e&&typeof $e.encrypt=="function"?console.log("🔫 ✅ SEA.encrypt() method is available"):(console.error("🔫 ❌ SEA.encrypt() method is NOT available"),console.error("🔫 Final Gun.SEA status:",oe.SEA));class Bs{constructor(){ce(this,"gun");ce(this,"user");ce(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=te,this.user=me,this.SEA=$e,console.log("GunJS: GunService initialized")}async signUp(t,r){return console.log("🔫 GunJS: Attempting to sign up user:",t),new Promise(a=>{if(r.length<8){console.log("🔫 GunJS: Password too short"),a({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("🔫 GunJS: Sign up timed out"),a({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,r,o=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign up response:",o),o.err){console.log("🔫 GunJS: Sign up error:",o.err),a({success:!1,error:o.err});return}this.user.auth(t,r,n=>{if(!n.err){const h={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(h,()=>{console.log("🔫 GunJS: Initial profile created with original username"),this.addToPublicUsersIndex(t,t),this.user.leave()})}}),console.log("🔫 GunJS: Sign up successful"),a({success:!0})})})}async signIn(t,r){return console.log("🔫 GunJS: Attempting to sign in user:",t),new Promise(a=>{const s=setTimeout(()=>{console.log("🔫 GunJS: Sign in timed out"),a({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,r,o=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign in response:",o),o.err){console.log("🔫 GunJS: Sign in error:",o.err),a({success:!1,error:o.err});return}console.log("🔫 GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(n=>{if(!(n!=null&&n.originalUsername)){console.log("🔫 GunJS: Storing original username in profile");const h={...n,originalUsername:t,favoriteGenres:(n==null?void 0:n.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(h)}this.addToPublicUsersIndex(t,(n==null?void 0:n.displayName)||t)}),a({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}addToPublicUsersIndex(t,r){console.log("🔫 GunJS: Adding user to public index:",t,r);try{const a={originalUsername:t,displayName:r,addedAt:new Date().toISOString()};this.gun.get("publicUsers").get(t).put(a,s=>{s.err?console.error("🔫 GunJS: Error adding user to public index:",s.err):console.log("🔫 GunJS: User successfully added to public index")})}catch(a){console.error("🔫 GunJS: Exception in addToPublicUsersIndex:",a)}}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const r=setTimeout(()=>{console.log("🔫 GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(r),this.user.is?(console.log("🔫 GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(a=>{const s=(a==null?void 0:a.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("🔫 GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(r=>{if(!this.user.is){r({success:!1,error:"User not authenticated"});return}const a=setTimeout(()=>{console.log("🔫 GunJS: updateProfile timed out"),r({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("🔫 GunJS: Existing profile:",s);const o=(s==null?void 0:s.originalUsername)||this.user.is.alias,n={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:o};console.log("🔫 GunJS: Updating profile with Gun-compatible data:",n),this.user.get("profile").put(n,h=>{if(clearTimeout(a),console.log("🔫 GunJS: Profile update response:",h),h.err){console.log("🔫 GunJS: Profile update error:",h.err),r({success:!1,error:h.err});return}console.log("🔫 GunJS: Profile updated successfully"),this.user.get("profile").once(l=>{console.log("🔫 GunJS: Profile after update:",l),r({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const r=setTimeout(()=>{console.log("🔫 GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(a=>{if(clearTimeout(r),console.log("🔫 GunJS: Raw profile loaded:",a),a){const s={displayName:a.displayName||"",bio:a.bio||"",favoriteGenres:a.favoriteGenres?JSON.parse(a.favoriteGenres):[],readingGoal:a.readingGoal||12,joinedDate:a.joinedDate,lastUpdated:a.lastUpdated,originalUsername:a.originalUsername};console.log("🔫 GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(r=>{if(!this.user.is){r({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,a=>{if(a.err){r({success:!1,error:a.err});return}r({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(r=>{t({success:!0,books:r||[]})})})}async syncUserNotes(t){return new Promise(r=>{if(!this.user.is){r({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,a=>{if(a.err){r({success:!1,error:a.err});return}r({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(r=>{t({success:!0,notes:r||[]})})})}async syncUserSessions(t){return new Promise(r=>{if(!this.user.is){r({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,a=>{if(a.err){r({success:!1,error:a.err});return}r({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(r=>{t({success:!0,sessions:r||[]})})})}async syncPetData(t){return new Promise(r=>{if(!this.user.is){r({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,a=>{if(a.err){r({success:!1,error:a.err});return}r({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(r=>{t({success:!0,petData:r||null})})})}async syncPetShopData(t,r){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}const s=setTimeout(()=>{a({success:!1,error:"Sync timeout"})},5e3),o={pet:t,inventory:r,lastUpdate:new Date().toISOString()};this.user.get("petShop").put(o,n=>{clearTimeout(s),n.err?(console.error("🔫 GunJS: Error syncing pet shop data:",n.err),a({success:!1,error:n.err})):(console.log("🔫 GunJS: Pet shop data synced successfully"),a({success:!0}))})})}async getPetShopData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const r=setTimeout(()=>{t({success:!1,error:"Get timeout"})},3e3);this.user.get("petShop").once(a=>{clearTimeout(r),a&&a.pet?t({success:!0,petData:a.pet,inventory:a.inventory||[]}):t({success:!1,error:"No pet shop data found"})})})}async trackPetActivity(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const r=`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:r,userId:this.user.is.pub,username:this.user.is.alias||"Unknown User",...t,createdAt:new Date().toISOString()};return this.user.get("petActivities").get(r).put(a),(t.type==="evolved"||t.type==="died"||t.type==="revived")&&this.gun.get("publicPetActivities").get(r).put(a),{success:!0}}catch(r){return console.error("🔫 GunJS: Error tracking pet activity:",r),{success:!1,error:"Failed to track pet activity"}}}async getFriendsPetActivities(t){return new Promise(r=>{const a=[];let s=0;const o=setTimeout(()=>{r({success:!0,activities:a.sort((n,h)=>new Date(h.createdAt).getTime()-new Date(n.createdAt).getTime()).slice(0,20)})},5e3);if(t.length===0){clearTimeout(o),r({success:!0,activities:[]});return}t.forEach(n=>{this.gun.get("users").get(n).get("petActivities").once(h=>{h&&Object.values(h).forEach(l=>{l&&l.id&&l.createdAt&&a.push(l)}),s++,s===t.length&&(clearTimeout(o),r({success:!0,activities:a.sort((l,d)=>new Date(d.createdAt).getTime()-new Date(l.createdAt).getTime()).slice(0,20)}))})})})}async trackGameCompletion(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const r={...t,username:this.user.is.alias||"Unknown User",createdAt:new Date().toISOString()};return this.user.get("gameCompletions").get(t.sessionId).put(r),t.score>0&&this.gun.get("gameLeaderboard").get(t.gameId).get(t.sessionId).put({userId:t.userId,username:this.user.is.alias||"Unknown User",score:t.score,completedAt:t.completedAt}),{success:!0}}catch(r){return console.error("🔫 GunJS: Error tracking game completion:",r),{success:!1,error:"Failed to track game completion"}}}}const H=new Bs;class Is{constructor(){ce(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,r){if(H.isAuthenticated()&&this.isOnline)try{await H.syncUserData(t,r)}catch(a){console.warn("Failed to sync data to server:",a)}}async getData(t,r){if(H.isAuthenticated()&&this.isOnline)try{const s=await H.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const a=localStorage.getItem(`bookish_${t}`);return a?JSON.parse(a):r}setLocalStorage(t,r){localStorage.setItem(`bookish_${t}`,JSON.stringify(r))}async syncPendingChanges(){if(!H.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const r of t)try{const a=localStorage.getItem(`bookish_${r}`);a&&await H.syncUserData(r,JSON.parse(a))}catch(a){console.warn(`Failed to sync ${r}:`,a)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!H.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const r of t)try{const a=r.getter();a!==null&&(Array.isArray(a)?a.length>0:Object.keys(a).length>0)&&await H.syncUserData(r.key,a)}catch(a){console.warn(`Failed to migrate ${r.key}:`,a)}}}const W=new Is,Fs=Object.freeze(Object.defineProperty({__proto__:null,default:W,syncedStorage:W},Symbol.toStringTag,{value:"Module"})),Us="modulepreload",Os=function(c){return"/Bookish/"+c},pt={},Xe=function(t,r,a){let s=Promise.resolve();if(r&&r.length>0){let n=function(d){return Promise.all(d.map(x=>Promise.resolve(x).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),l=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=n(r.map(d=>{if(d=Os(d),d in pt)return;pt[d]=!0;const x=d.endsWith(".css"),u=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const m=document.createElement("link");if(m.rel=x?"stylesheet":Us,x||(m.as="script"),m.crossOrigin="",m.href=d,l&&m.setAttribute("nonce",l),document.head.appendChild(m),x)return new Promise((j,i)=>{m.addEventListener("load",j),m.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(n){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=n,window.dispatchEvent(h),!h.defaultPrevented)throw n}return s.then(n=>{for(const h of n||[])h.status==="rejected"&&o(h.reason);return t().catch(o)})},fe="https://openlibrary.org",Ls=async c=>{try{return(await(await fetch(`${fe}/search.json?q=${encodeURIComponent(c)}&limit=10`)).json()).docs.map(a=>({key:a.key,title:a.title,author_name:a.author_name,cover_i:a.cover_i,first_publish_year:a.first_publish_year,number_of_pages_median:a.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},Gs=async c=>{var t,r;try{const a=c.replace("/works/",""),o=await(await fetch(`${fe}/works/${a}.json`)).json();let n=o.number_of_pages_median;!n&&o.editions&&(n=await Ms(o.editions)),n||(n=await $s(a));let h=[];if(o.authors&&o.authors.length>0){const l=o.authors.slice(0,3).map(async x=>{try{return(await(await fetch(`${fe}${x.author.key}.json`)).json()).name}catch{return null}});h=(await Promise.all(l)).filter(x=>x!==null)}return{key:o.key,title:o.title,author_name:h,cover_i:(t=o.covers)==null?void 0:t[0],first_publish_year:o.first_publish_year,description:((r=o.description)==null?void 0:r.value)||o.description||"",number_of_pages_median:n}}catch(a){return console.error("Error fetching book details:",a),null}},Ms=async c=>{try{if(!c||!c.entries||c.entries.length===0)return;for(const t of c.entries.slice(0,3))try{const a=await(await fetch(`${fe}${t.key}.json`)).json();if(a.number_of_pages)return a.number_of_pages}catch(r){console.error("Error fetching edition:",r);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},$s=async c=>{try{const r=await(await fetch(`${fe}/works/${c}/editions.json?limit=5`)).json();if(r.entries&&r.entries.length>0){for(const a of r.entries)if(a.number_of_pages)return a.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},Js=c=>{const t=new Date().getFullYear(),r=c.first_publish_year||t;return r<1900?320:r<1950?280:r<2e3?250:220},qs=(c,t="M")=>c?`https://covers.openlibrary.org/b/id/${c}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",Hs=async c=>{var t;try{return((t=(await(await fetch(`${fe}/subjects/${encodeURIComponent(c.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var o;return{key:s.key,title:s.title,author_name:((o=s.authors)==null?void 0:o.map(n=>n.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(r){return console.error("Error searching books by subject:",r),[]}},Ys=async c=>{var t,r;try{const a=c.replace(/[-\s]/g,""),s=await fetch(`${fe}/isbn/${a}.json`);if(!s.ok)return null;const o=await s.json();return{key:o.key,title:o.title,author_name:((t=o.authors)==null?void 0:t.map(n=>n.name))||[],cover_i:(r=o.covers)==null?void 0:r[0],first_publish_year:o.publish_date?new Date(o.publish_date).getFullYear():void 0,number_of_pages_median:o.number_of_pages}}catch(a){return console.error("Error searching book by ISBN:",a),null}},zs="bookish_books",Ws="bookish_reading_sessions",Rt="bookish_stats",Ks="bookish_streak",Ze="bookish_cached_books",Se=(c,t)=>{const r=localStorage.getItem(c);return r?JSON.parse(r):t},Bt=(c,t)=>{localStorage.setItem(c,JSON.stringify(t))},Vs=()=>Se(zs,[]),It=c=>Se(Ze,{})[c]||null,bt=c=>{const t=Se(Ze,{});t[c.key]={...c,cached_at:new Date().toISOString()},Bt(Ze,t)},He=()=>Se(Ws,[]),vt=c=>He().filter(t=>t.bookId===c),Qs=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),Ee=()=>Se(Rt,Qs()),Xs=()=>{const c=He(),t=Vs(),r=c.reduce((m,j)=>m+(j.duration||0),0),a=new Date().setHours(0,0,0,0),s=c.reduce((m,j)=>new Date(j.startTime).setHours(0,0,0,0)===a?m+(j.duration||0):m,0),o=new Date;o.setDate(o.getDate()-o.getDay()),o.setHours(0,0,0,0);const n=c.reduce((m,j)=>new Date(j.startTime)>=o?m+(j.duration||0):m,0),h=c.reduce((m,j)=>{const i=(j.endPage||0)-(j.startPage||0);return m+Math.max(0,i)},0),l=new Date(new Date().getFullYear(),0,1),d=new Set;c.forEach(m=>{if(new Date(m.startTime)>=l&&m.endPage){const i=t.find(v=>v.key===m.bookId);if(i){const v=i.number_of_pages_median;if(v&&m.endPage>=v)d.add(m.bookId);else if(!v){const g=Js(i);m.endPage>=g*.9&&d.add(m.bookId)}}}}),JSON.parse(localStorage.getItem("bookish_books")||"[]").forEach(m=>{m.category==="completed"&&d.add(m.key)});const u={totalBooksRead:d.size,totalPagesRead:h,totalReadingTime:r,readingTimeToday:s,readingTimeThisWeek:n,booksFinishedThisYear:d.size};Bt(Rt,u),window.dispatchEvent(new CustomEvent("statsUpdated",{detail:u}))},Oe=async()=>{Xs();const c=Ee();try{const{default:t}=await Xe(async()=>{const{default:r}=await Promise.resolve().then(()=>Fs);return{default:r}},void 0);await t.saveStats(c)}catch(t){console.warn("Failed to sync stats to remote storage:",t)}return c},Zs=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),we=()=>Se(Ks,Zs()),ne={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet",USER_SETTINGS:"bookish-user-settings"};class he{static get(t){try{const r=localStorage.getItem(t);return r?JSON.parse(r):null}catch(r){return console.error("Error reading from localStorage:",r),null}}static set(t,r){try{return localStorage.setItem(t,JSON.stringify(r)),!0}catch(a){return console.error("Error writing to localStorage:",a),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(r){return console.error("Error removing from localStorage:",r),!1}}static clear(){try{return Object.values(ne).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(ne.GUEST_PROFILE)}static setGuestProfile(t){return this.set(ne.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(ne.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(ne.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(ne.GUEST_PET)}static setGuestPet(t){return this.set(ne.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}static getUserSettings(){return this.get(ne.USER_SETTINGS)}static saveUserSettings(t){return this.set(ne.USER_SETTINGS,{...t,lastUpdated:new Date().toISOString()})}}const Ft=E.createContext(void 0),er={isAuthenticated:!1,user:null,isLoading:!0,error:null},tr=(c,t)=>{switch(t.type){case"AUTH_START":return{...c,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...c,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...c,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...c,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...c,error:null};case"UPDATE_USER":return{...c,user:c.user?{...c.user,...t.payload}:null};default:return c}},sr=({children:c})=>{const[t,r]=E.useReducer(tr,er);E.useEffect(()=>{(async()=>{var u;try{const m=new Promise((v,g)=>setTimeout(()=>g(new Error("Authentication check timeout")),5e3)),j=H.recallUser(),i=await Promise.race([j,m]);if(i&&i.success&&i.user){const v=new Promise((g,A)=>setTimeout(()=>A(new Error("Profile load timeout")),3e3));try{const g=await Promise.race([H.getProfile(),v]),A={...i.user,username:g!=null&&g.success&&((u=g==null?void 0:g.profile)!=null&&u.originalUsername)?g.profile.originalUsername:i.user.username||"Unknown User",profile:g&&g.success?g.profile:void 0};r({type:"AUTH_SUCCESS",payload:A})}catch{const A={...i.user,username:i.user.username||"Unknown User",profile:void 0};r({type:"AUTH_SUCCESS",payload:A})}}else r({type:"AUTH_FAILURE",payload:""})}catch(m){console.log("GunJS auth check failed (servers may be down):",m),r({type:"AUTH_FAILURE",payload:""})}})()},[]);const d={...t,signIn:async(x,u)=>{r({type:"AUTH_START"});try{const m=await H.signIn(x,u);if(m.success&&m.user){const j=await H.getProfile(),i={...m.user,username:x,profile:j.success?j.profile:void 0};return r({type:"AUTH_SUCCESS",payload:i}),{success:!0}}else return r({type:"AUTH_FAILURE",payload:m.error||"Sign in failed"}),{success:!1,error:m.error}}catch{const j="An unexpected error occurred";return r({type:"AUTH_FAILURE",payload:j}),{success:!1,error:j}}},signUp:async(x,u)=>{r({type:"AUTH_START"});try{const m=await H.signUp(x,u);return m.success?(r({type:"AUTH_FAILURE",payload:""}),{success:!0}):(r({type:"AUTH_FAILURE",payload:m.error||"Sign up failed"}),{success:!1,error:m.error})}catch{const j="An unexpected error occurred";return r({type:"AUTH_FAILURE",payload:j}),{success:!1,error:j}}},signOut:()=>{H.signOut(),r({type:"SIGN_OUT"})},updateProfile:async x=>{console.log("AuthContext: updateProfile called with:",x);try{const u=await H.updateProfile(x);return console.log("AuthContext: gunService.updateProfile result:",u),u.success?(console.log("AuthContext: Updating user state with profile:",x),r({type:"UPDATE_USER",payload:{profile:x}}),{success:!0}):(console.log("AuthContext: Profile update failed:",u.error),{success:!1,error:u.error})}catch(u){return console.error("AuthContext: Profile update error:",u),{success:!1,error:"Failed to update profile"}}},clearError:()=>{r({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let x={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const u=he.getGuestProfile();u&&(x={displayName:u.displayName||"Guest User",bio:u.bio||"Browsing as a guest",favoriteGenres:u.favoriteGenres||[],readingGoal:u.readingGoal||0});const m={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:x};r({type:"AUTH_SUCCESS",payload:m})}};return e.jsx(Ft.Provider,{value:d,children:c})},de=()=>{const c=E.useContext(Ft);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},Ut=E.createContext(void 0),ge=()=>{const c=E.useContext(Ut);if(!c)throw new Error("useBooks must be used within a BookProvider");return c},rr=({children:c})=>{const{user:t}=de(),[r,a]=E.useState([]),[s,o]=E.useState(null),[n,h]=E.useState([]),[l,d]=E.useState([]);E.useEffect(()=>{(async()=>{const b=(await W.getBooks()).map(I=>{const M=It(I.key);return M?{...I,...M}:I});a(b);const _=await W.getCurrentBook();o(_)})()},[]),E.useEffect(()=>{(async()=>{if(s){const k=await W.getReadingSessions(),b=await W.getNotes();h(k.filter(_=>_.bookId===s.key)),d(b.filter(_=>_.bookId===s.key))}else h([]),d([])})()},[s]);const x=async y=>{const k=[...r],b=k.findIndex(M=>M.key===y.key),_=b>=0&&k[b].category==="completed",I=y.category==="completed";if(b>=0?k[b]=y:k.push(y),a(k),await W.saveBooks(k),!_&&I)try{await H.publishActivity({type:"book_completed",title:"Completed a book!",description:`Just finished reading "${y.title}"`,bookTitle:y.title,bookCover:y.cover_i?`https://covers.openlibrary.org/b/id/${y.cover_i}-S.jpg`:void 0,metadata:{pagesRead:y.number_of_pages_median||200}}),console.log("📚 Published book completion activity:",y.title),await u()}catch(M){console.error("Error publishing book completion activity:",M)}await Oe()},u=async()=>{try{console.log("📊 Updating public stats after book completion...");const y=JSON.parse(localStorage.getItem("bookish_books")||"[]"),k=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]");console.log("📊 Local books data:",y),console.log("📊 Local sessions data:",k);const b=y.filter(B=>B.category==="completed");console.log("📊 Completed books count:",b.length);const _=k.reduce((B,F)=>B+(F.duration||0),0),I=k.reduce((B,F)=>{const w=(F.endPage||0)-(F.startPage||0);return B+Math.max(0,w)},0),M=m(k),G={totalBooksRead:b.length,totalPagesRead:Math.max(I,b.length*200),totalReadingTime:_,currentStreak:M};console.log("📊 Calculated stats:",G);const P=await H.updatePublicStats(G);P.success?(console.log("✅ Public stats updated successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("publicStatsUpdated",{detail:{userId:t==null?void 0:t.id,stats:G}}))},1e3)):console.error("❌ Failed to update public stats:",P.error)}catch(y){console.error("❌ Error updating public stats:",y)}},m=y=>{if(!y.length)return 0;const k=y.map(M=>new Date(M.startTime).toDateString()).filter((M,G,P)=>P.indexOf(M)===G).sort((M,G)=>new Date(G).getTime()-new Date(M).getTime());let b=0;const _=new Date().toDateString(),I=new Date(Date.now()-864e5).toDateString();if(k[0]===_||k[0]===I){b=1;for(let M=1;M<k.length;M++){const G=new Date(k[M]);if((new Date(k[M-1]).getTime()-G.getTime())/(1e3*60*60*24)===1)b++;else break}}return b},j=async y=>{const k=r.filter(G=>G.key!==y);a(k),await W.saveBooks(k);const b=await W.getReadingSessions(),_=await W.getNotes(),I=b.filter(G=>G.bookId!==y),M=_.filter(G=>G.bookId!==y);await W.saveReadingSessions(I),await W.saveNotes(M),s&&s.key===y&&(o(null),await W.setCurrentBook(null)),await Oe()},i=async y=>{o(y),await W.setCurrentBook(y)},v=async y=>{const k=await W.getReadingSessions(),b=k.findIndex(_=>_.id===y.id);if(b>=0?k[b]=y:k.push(y),await W.saveReadingSessions(k),s&&y.bookId===s.key&&h(k.filter(_=>_.bookId===s.key)),await Oe(),y.duration&&y.duration>=15)try{const _=r.find(M=>M.key===y.bookId),I=y.endPage&&y.startPage?y.endPage-y.startPage:0;await H.publishActivity({type:"reading_session",title:"Had a reading session",description:`Read for ${y.duration} minutes${_?` in "${_.title}"`:""}`,bookTitle:_==null?void 0:_.title,bookCover:_!=null&&_.cover_i?`https://covers.openlibrary.org/b/id/${_.cover_i}-S.jpg`:void 0,metadata:{duration:y.duration,pagesRead:Math.max(0,I)}}),console.log("📖 Published reading session activity:",y.duration,"minutes"),await u()}catch(_){console.error("Error publishing reading session activity:",_)}},g=async y=>{const b=[...await W.getNotes(),y];await W.saveNotes(b),s&&y.bookId===s.key&&d(b.filter(_=>_.bookId===s.key))},A=async y=>{const b=(await W.getNotes()).map(_=>_.id===y.id?y:_);await W.saveNotes(b),s&&y.bookId===s.key&&d(b.filter(_=>_.bookId===s.key))},f=async y=>{const b=(await W.getNotes()).filter(_=>_.id!==y);await W.saveNotes(b),s&&d(b.filter(_=>_.bookId===s.key))},T=async()=>{try{const y=r.filter(G=>G.category==="completed"),k=n.reduce((G,P)=>G+(P.duration||0),0),b=n.reduce((G,P)=>{const B=(P.endPage||0)-(P.startPage||0);return G+Math.max(0,B)},0),I=(G=>{if(!G.length)return 0;const P=G.map(O=>new Date(O.startTime).toDateString()).filter((O,$,q)=>q.indexOf(O)===$).sort((O,$)=>new Date($).getTime()-new Date(O).getTime());let B=0;const F=new Date().toDateString(),w=new Date(Date.now()-864e5).toDateString();if(P[0]===F||P[0]===w){B=1;for(let O=1;O<P.length;O++){const $=new Date(P[O]);if((new Date(P[O-1]).getTime()-$.getTime())/(1e3*60*60*24)===1)B++;else break}}return B})(n),M={totalBooksRead:y.length,totalPagesRead:Math.max(b,y.length*200),totalReadingTime:k,currentStreak:I};await H.updatePublicStats(M)}catch(y){console.error("Error updating public stats:",y)}};E.useEffect(()=>{(r.length>0||n.length>0)&&T()},[r,n]);const p={books:r,currentBook:s,sessions:n,notes:l,addBook:x,removeBook:j,setActiveBook:i,addSession:v,addNote:g,updateNote:A,deleteNote:f,updatePublicStatsAfterBookCompletion:u};return tt.useEffect(()=>{window.debugUpdateStats=u},[]),e.jsx(Ut.Provider,{value:p,children:c})},Ot=E.createContext(void 0),ie=()=>{const c=E.useContext(Ot);if(!c)throw new Error("usePet must be used within a PetProvider");return c},et=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,coins:0,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content",isAlive:!0,sickness:0,cleanliness:100,inventory:[],unlockedItems:["basic_food","water","soap"]}),Lt=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),or=()=>{try{const c=localStorage.getItem("bookish_pet");if(c){const t=JSON.parse(c);return{...et(),...t}}}catch(c){console.error("Error loading pet from storage:",c)}return et()},ar=()=>{try{const c=localStorage.getItem("bookish_pet_stats");if(c)return JSON.parse(c)}catch(c){console.error("Error loading pet stats from storage:",c)}return Lt()},nr=c=>{localStorage.setItem("bookish_pet",JSON.stringify(c))},lr=c=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(c))},ir=({children:c})=>{const[t,r]=E.useState(or),[a,s]=E.useState(ar),o=[{id:"basic_food",name:"Pet Food",description:"Basic nutritious food for your pet",price:3,coinPrice:5,category:"food",effect:{hunger:25,happiness:5},emoji:"🍖",rarity:"common"},{id:"premium_food",name:"Premium Feast",description:"Delicious high-quality meal",price:8,coinPrice:12,category:"food",effect:{hunger:40,happiness:15,health:5},emoji:"🍗",rarity:"rare",unlockRequirement:{level:5}},{id:"energy_drink",name:"Energy Potion",description:"Restores energy and vitality",price:5,coinPrice:8,category:"food",effect:{energy:30,happiness:10},emoji:"🧪",rarity:"common"},{id:"gourmet_meal",name:"Gourmet Delicacy",description:"Fancy meal that satisfies all needs",price:15,category:"food",effect:{hunger:50,happiness:25,health:10,energy:20},emoji:"🥘",rarity:"rare",unlockRequirement:{level:10}},{id:"superfood",name:"Superfood Bowl",description:"Nutritious meal that boosts all stats",price:25,category:"food",effect:{hunger:60,happiness:30,health:20,energy:25,experience:10},emoji:"🥗",rarity:"epic",unlockRequirement:{level:15,books:20}},{id:"water",name:"Fresh Water",description:"Essential hydration for your pet",price:1,category:"food",effect:{hunger:10,health:5},emoji:"💧",rarity:"common"},{id:"vitamin_treats",name:"Vitamin Treats",description:"Healthy snacks that prevent sickness",price:12,category:"food",effect:{hunger:20,health:15,sickness:-30},emoji:"🍎",rarity:"rare",unlockRequirement:{level:8}},{id:"ball",name:"Bouncy Ball",description:"Fun toy that increases happiness",price:6,category:"toy",effect:{happiness:25,energy:-10},emoji:"⚽",rarity:"common"},{id:"puzzle",name:"Brain Puzzle",description:"Intellectual toy that boosts experience",price:12,category:"toy",effect:{happiness:20,experience:15},emoji:"🧩",rarity:"rare",unlockRequirement:{level:8}},{id:"teddy_bear",name:"Comfort Teddy",description:"Cuddly companion that reduces stress",price:10,category:"toy",effect:{happiness:30,health:10,sickness:-20},emoji:"🧸",rarity:"common"},{id:"laser_pointer",name:"Laser Pointer",description:"High-tech toy for active play",price:18,category:"toy",effect:{happiness:35,energy:-20,experience:20},emoji:"🔦",rarity:"rare",unlockRequirement:{level:12}},{id:"robot_companion",name:"Robot Companion",description:"AI-powered toy that teaches and entertains",price:40,category:"toy",effect:{happiness:50,experience:40,energy:10},emoji:"🤖",rarity:"epic",unlockRequirement:{level:20,books:15}},{id:"medicine",name:"Health Potion",description:"Cures sickness and restores health",price:10,category:"medicine",effect:{health:30,sickness:-50},emoji:"💊",rarity:"common"},{id:"super_medicine",name:"Super Cure",description:"Powerful medicine that fully heals",price:25,category:"medicine",effect:{health:50,sickness:-100,happiness:10},emoji:"💉",rarity:"epic",unlockRequirement:{level:15}},{id:"antibiotics",name:"Antibiotics",description:"Prevents and treats serious illness",price:20,category:"medicine",effect:{health:40,sickness:-80,happiness:5},emoji:"🔬",rarity:"rare",unlockRequirement:{level:12}},{id:"pain_relief",name:"Pain Relief",description:"Reduces suffering and improves mood",price:8,category:"medicine",effect:{health:20,happiness:15,sickness:-30},emoji:"🩹",rarity:"common"},{id:"immunity_boost",name:"Immunity Booster",description:"Strengthens immune system",price:30,category:"medicine",effect:{health:60,sickness:-100,happiness:20},emoji:"🛡️",rarity:"epic",unlockRequirement:{level:18,books:12}},{id:"soap",name:"Pet Soap",description:"Keeps your pet clean and fresh",price:4,category:"decoration",effect:{cleanliness:30,happiness:10},emoji:"🧼",rarity:"common"},{id:"luxury_bath",name:"Luxury Spa Treatment",description:"Ultimate cleaning experience",price:15,category:"decoration",effect:{cleanliness:50,happiness:25,health:10},emoji:"🛁",rarity:"rare",unlockRequirement:{level:10}},{id:"grooming_kit",name:"Grooming Kit",description:"Professional grooming tools",price:22,category:"decoration",effect:{cleanliness:60,happiness:30,health:15},emoji:"✂️",rarity:"rare",unlockRequirement:{level:14}},{id:"air_freshener",name:"Air Freshener",description:"Keeps the environment fresh",price:6,category:"decoration",effect:{cleanliness:20,happiness:15,health:5},emoji:"🌸",rarity:"common"},{id:"phoenix_feather",name:"Phoenix Feather",description:"Can revive a deceased pet",price:100,category:"special",effect:{health:100,happiness:50,energy:100},emoji:"🪶",rarity:"legendary",unlockRequirement:{level:20,books:25}},{id:"evolution_crystal",name:"Evolution Crystal",description:"Instantly evolves your pet to the next stage",price:50,category:"special",effect:{experience:1e3,happiness:30},emoji:"💎",rarity:"epic",unlockRequirement:{level:12,books:10}},{id:"time_crystal",name:"Time Crystal",description:"Slows down aging and decay",price:75,category:"special",effect:{health:30,happiness:20,energy:30},emoji:"⏰",rarity:"epic",unlockRequirement:{level:25,books:30}},{id:"golden_coin",name:"Golden Coin",description:"Increases reading rewards",price:80,category:"special",effect:{happiness:40,experience:50},emoji:"🪙",rarity:"epic",unlockRequirement:{level:30,books:40}},{id:"rainbow_potion",name:"Rainbow Potion",description:"Magical potion that maximizes all stats",price:150,category:"special",effect:{hunger:100,happiness:100,energy:100,health:100,cleanliness:100,sickness:-100},emoji:"🌈",rarity:"legendary",unlockRequirement:{level:35,books:50}},{id:"book_of_wisdom",name:"Book of Wisdom",description:"Ancient tome that grants massive experience",price:60,category:"special",effect:{experience:500,happiness:25},emoji:"📚",rarity:"epic",unlockRequirement:{level:22,books:35}}];E.useEffect(()=>{nr(t)},[t]),E.useEffect(()=>{lr(a)},[a]),E.useEffect(()=>{const N=setInterval(()=>{if(!t.isAlive)return;const D=new Date,S=new Date(t.lastFed),C=(D.getTime()-S.getTime())/(1e3*60*60);C>.5&&r(L=>{if(!L.isAlive)return L;const J=Math.max(1,C/2);let Y=Math.max(0,L.hunger-J*4),Q=Math.max(0,L.energy-J*3),re=Math.max(0,L.happiness-J*2),ae=L.health,X=L.sickness,Be=Math.max(0,L.cleanliness-J*2);Y<30&&(X=Math.min(100,X+J*8)),Y<15&&(X=Math.min(100,X+J*15)),Be<40&&(X=Math.min(100,X+J*5)),re<25&&(X=Math.min(100,X+J*3)),Q<20&&(X=Math.min(100,X+J*2)),X>30&&(ae=Math.max(0,ae-J*4)),X>60&&(ae=Math.max(0,ae-J*8)),X>80&&(ae=Math.max(0,ae-J*12));const Jt=Y<=0,qt=X>=100,Ht=ae<=0,Yt=Y<10&&Be<10&&re<10,st=(Jt||qt||Ht||Yt)&&L.isAlive,rt=st?!1:L.isAlive,zt=st?D.toISOString():L.deathDate,Wt=n(re,Y,Q,ae,X,Be,rt);return{...L,hunger:Y,energy:Q,happiness:re,health:ae,sickness:X,cleanliness:Be,isAlive:rt,deathDate:zt,mood:Wt}});const R=D.toDateString(),U=new Date(a.lastActiveDate).toDateString();R!==U&&s(L=>({...L,booksReadToday:0,readingTimeToday:0,lastActiveDate:D.toISOString()}))},6e4);return()=>clearInterval(N)},[t.lastFed,t.isAlive,a.lastActiveDate]);const n=(N,D,S,C,R,U,L)=>L?C<=10||R>=90?"dying":R>=50?"sick":D<20?"hungry":S<20?"sleepy":N>80&&U>70?"happy":N>60?"excited":N<30?"sad":"content":"dead",h=N=>100+N*50,l=(N,D)=>{let S=D,C=h(S);for(;N>=C;)S++,C=h(S);return{newLevel:S,newExpToNext:C}},d=N=>N<3?"egg":N<8?"baby":N<15?"child":N<25?"teen":N<40?"adult":"elder",x=()=>{if(!t.isAlive)return"💀";const N=t.evolutionStage,D=t.mood,S={egg:{happy:"🥚",content:"🥚",sad:"💔",excited:"✨",sleepy:"😴",hungry:"🥚",sick:"🤒",dying:"💀",dead:"💀"},baby:{happy:"😊",content:"🐛",sad:"😢",excited:"🤩",sleepy:"😴",hungry:"😋",sick:"🤒",dying:"💀",dead:"💀"},child:{happy:"😄",content:"🐯",sad:"😭",excited:"🤗",sleepy:"💤",hungry:"🍎",sick:"🤒",dying:"💀",dead:"💀"},teen:{happy:"😎",content:"🦊",sad:"😔",excited:"🚀",sleepy:"😪",hungry:"🍕",sick:"🤒",dying:"💀",dead:"💀"},adult:{happy:"🌟",content:"🦉",sad:"😞",excited:"🎉",sleepy:"😌",hungry:"🍽️",sick:"🤒",dying:"💀",dead:"💀"},elder:{happy:"👑",content:"🐉",sad:"😟",excited:"🎊",sleepy:"🧘",hungry:"🍱",sick:"🤒",dying:"💀",dead:"💀"}};return S[N][D]||S[N].content},u=()=>{r(N=>{if(N.points<3)return N;const D=Math.min(100,N.hunger+30),S=Math.min(100,N.happiness+10),C=N.experience+5,{newLevel:R,newExpToNext:U}=l(C,N.level);return b("fed"),{...N,hunger:D,happiness:S,experience:C,level:R,experienceToNext:U,points:N.points-3,lastFed:new Date().toISOString(),evolutionStage:d(R),mood:n(S,D,N.energy,N.health,N.sickness,N.cleanliness,N.isAlive)}})},m=()=>{r(N=>{if(N.points<5)return N;const D=Math.min(100,N.happiness+20),S=Math.max(0,N.energy-15),C=N.experience+10,{newLevel:R,newExpToNext:U}=l(C,N.level);return b("played"),{...N,happiness:D,energy:S,experience:C,level:R,experienceToNext:U,points:N.points-5,lastPlayed:new Date().toISOString(),evolutionStage:d(R),mood:n(D,N.hunger,S,N.health,N.sickness,N.cleanliness,N.isAlive)}})},j=()=>{r(N=>{const D=Math.min(100,N.energy+40),S=Math.min(100,N.health+10);return{...N,energy:D,health:S,lastSlept:new Date().toISOString(),mood:n(N.happiness,N.hunger,D,S,N.sickness,N.cleanliness,N.isAlive)}})},i=(N,D=!1)=>{const R=Math.floor(N/5)+(D?50:0);R>0&&(r(U=>{const L=U.experience+R,J=Math.min(100,U.happiness+Math.floor(N/10)),Y=U.totalReadingTime+N,{newLevel:Q,newExpToNext:re}=l(L,U.level);return{...U,experience:L,level:Q,experienceToNext:re,happiness:J,totalReadingTime:Y,evolutionStage:d(Q),mood:n(J,U.hunger,U.energy,U.health,U.sickness,U.cleanliness,U.isAlive)}}),s(U=>({...U,readingTimeToday:U.readingTimeToday+N,lastActiveDate:new Date().toISOString()})))},v=()=>{r(N=>{const D=N.experience+50,S=Math.min(100,N.happiness+25),C=N.totalBooksRead+1,R=20,{newLevel:U,newExpToNext:L}=l(D,N.level),J=[...N.badges];return C===1&&!J.includes("first-book")&&J.push("first-book"),C===10&&!J.includes("book-lover")&&J.push("book-lover"),C===50&&!J.includes("bookworm")&&J.push("bookworm"),{...N,experience:D,level:U,experienceToNext:L,happiness:S,points:N.points+R,totalBooksRead:C,badges:J,evolutionStage:d(U),mood:n(S,N.hunger,N.energy,N.health,N.sickness,N.cleanliness,N.isAlive)}}),s(N=>({...N,booksReadToday:N.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},g=()=>({happy:"Your pet is thriving! They're full of energy and love for reading!",excited:"Your pet is bouncing with excitement about your reading progress!",content:"Your pet is peacefully content, enjoying your company.",sad:"Your pet looks dejected and needs attention. Feed them or play with them!",sleepy:"Your pet is exhausted and struggling to stay awake. They need rest!",hungry:"⚠️ Your pet is starving! They desperately need food right now!",sick:"🤒 Your pet is seriously ill and suffering! Buy medicine immediately!",dying:"🚨 CRITICAL: Your pet is dying! Their health is failing rapidly - act NOW or they will die!",dead:"💔 Your beloved pet has passed away. Only a Phoenix Feather can bring them back to life."})[t.mood],A=()=>{const N=d(t.level+1),D=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:D,stage:N}},f=()=>{const N=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=N&&t.evolutionStage!==d(t.level)},T=()=>{r(N=>({...N,evolutionStage:d(N.level),happiness:100,health:100}))},p=()=>{const N=et();r(N),s(Lt())},y=N=>{r(D=>({...D,name:N}))},k=async N=>{if(H.isAuthenticated())try{await H.syncPetShopData(N,N.inventory)}catch(D){console.warn("Failed to sync pet data:",D)}},b=async N=>{if(H.isAuthenticated())try{await H.trackPetActivity({type:N,petName:t.name,petLevel:t.level,petStage:t.evolutionStage,timestamp:new Date().toISOString(),stats:{happiness:t.happiness,hunger:t.hunger,health:t.health}})}catch(D){console.warn("Failed to track pet activity:",D)}},_=N=>{r(D=>({...D,coins:D.coins+N}))},I=N=>t.coins<N?!1:(r(D=>({...D,coins:D.coins-N})),!0),M=()=>o,G=()=>o.filter(N=>{if(t.unlockedItems.includes(N.id)||!N.unlockRequirement)return!0;const D=N.unlockRequirement;return!(D.level&&t.level<D.level||D.books&&t.totalBooksRead<D.books||D.badges&&!D.badges.every(S=>t.badges.includes(S)))}),P=(N,D=!1)=>{const S=o.find(C=>C.id===N);if(!S||!G().find(C=>C.id===N))return!1;if(D){if(!S.coinPrice||t.coins<S.coinPrice)return!1}else if(t.points<S.price)return!1;return r(C=>{const U=C.inventory.find(L=>L.id===N)?C.inventory.map(L=>L.id===N?{...L,quantity:(L.quantity||1)+1}:L):[...C.inventory,{...S,quantity:1}];return{...C,points:D?C.points:C.points-S.price,coins:D?C.coins-(S.coinPrice||0):C.coins,inventory:U}}),!0},B=N=>{const D=t.inventory.find(S=>S.id===N);return!D||(D.quantity||0)<=0||!t.isAlive&&N!=="phoenix_feather"?!1:(r(S=>{let C={...S};if(D.effect.hunger&&(C.hunger=Math.min(100,C.hunger+D.effect.hunger)),D.effect.happiness&&(C.happiness=Math.min(100,C.happiness+D.effect.happiness)),D.effect.energy&&(C.energy=Math.min(100,Math.max(0,C.energy+D.effect.energy))),D.effect.health&&(C.health=Math.min(100,C.health+D.effect.health)),D.effect.cleanliness&&(C.cleanliness=Math.min(100,C.cleanliness+D.effect.cleanliness)),D.effect.sickness&&(C.sickness=Math.max(0,C.sickness+D.effect.sickness)),D.effect.experience){const R=C.experience+D.effect.experience,{newLevel:U,newExpToNext:L}=l(R,C.level);C.experience=R,C.level=U,C.experienceToNext=L,C.evolutionStage=d(U)}return N==="phoenix_feather"&&!C.isAlive&&(C.isAlive=!0,C.health=100,C.happiness=50,C.energy=100,C.hunger=50,C.sickness=0,C.cleanliness=80,delete C.deathDate),C.health<=0||C.sickness>=100?(C.isAlive=!1,C.deathDate=new Date().toISOString(),C.mood="dead"):C.mood=n(C.happiness,C.hunger,C.energy,C.health,C.sickness,C.cleanliness,C.isAlive),C.inventory=C.inventory.map(R=>R.id===N?{...R,quantity:(R.quantity||1)-1}:R).filter(R=>(R.quantity||0)>0),C}),!0)},F=()=>{t.isAlive&&r(N=>{const D=Math.min(100,N.cleanliness+25),S=Math.min(100,N.happiness+10);return{...N,cleanliness:D,happiness:S,mood:n(S,N.hunger,N.energy,N.health,N.sickness,D,N.isAlive)}})},w=()=>{!t.isAlive||t.points<15||r(N=>{const D=Math.min(100,N.health+30),S=Math.max(0,N.sickness-25),C=Math.min(100,N.happiness+15);return{...N,health:D,sickness:S,happiness:C,points:N.points-15,mood:n(C,N.hunger,N.energy,D,S,N.cleanliness,N.isAlive)}})},O=()=>{t.isAlive||t.points<100||r(N=>({...N,isAlive:!0,health:50,happiness:30,energy:60,hunger:40,sickness:0,cleanliness:60,points:N.points-100,mood:"content",deathDate:void 0}))};E.useEffect(()=>{const N=setInterval(()=>{r(D=>{if(!D.isAlive)return D;const S=new Date,C=new Date(D.lastFed),R=(S.getTime()-C.getTime())/(1e3*60*60);if(R>0){let U=D.hunger-R*10,L=D.energy-R*5,J=D.happiness-R*2,Y=D.sickness+R*2,Q=D.health-D.sickness*.1+D.cleanliness*.1;return Q=Math.min(100,Math.max(0,Q)),Q<=0||Y>=100?{...D,hunger:Math.max(0,U),energy:Math.max(0,L),happiness:Math.max(0,J),sickness:Math.min(100,Y),health:Q,isAlive:!1,deathDate:new Date().toISOString(),mood:"dead"}:{...D,hunger:Math.max(0,U),energy:Math.max(0,L),happiness:Math.max(0,J),sickness:Math.min(100,Y),health:Q,mood:n(Math.max(0,J),Math.max(0,U),Math.max(0,L),Q,Math.min(100,Y),D.cleanliness,!0)}}return D})},6e4);return()=>clearInterval(N)},[]),E.useEffect(()=>{r(N=>({...N,mood:n(N.happiness,N.hunger,N.energy,N.health,N.sickness,N.cleanliness,N.isAlive)}))},[t.happiness,t.hunger,t.energy,t.health,t.sickness,t.cleanliness,t.isAlive]),E.useEffect(()=>{k(t)},[t.level,t.health,t.isAlive,t.evolutionStage,t.inventory.length]);const $=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",q=()=>t.experience/t.experienceToNext*100;return e.jsx(Ot.Provider,{value:{pet:t,petStats:a,shopItems:o,feedPet:u,playWithPet:m,petSleep:j,cleanPet:F,healPet:w,revivePet:O,updatePetFromReading:i,updatePetFromBookCompletion:v,getPetMood:g,getPetEvolutionRequirement:A,resetPet:p,updatePetName:y,getPetEmoji:x,canEvolve:f,evolvePet:T,getPetHappinessLevel:$,getLevelProgress:q,getShopItems:M,getUnlockedItems:G,buyItem:P,useItem:B,addCoins:_,spendCoins:I},children:c})},cr={colors:{primary:"#D2691E",primaryLight:"#E89556",primaryDark:"#B8571A",secondary:"#8B7355",secondaryLight:"#A68B6B",secondaryDark:"#6B5A47",background:"#F7F5F3",surface:"#FFFFFF",surfaceElevated:"#FEFEFE",surfaceSecondary:"#F5F5F5",textPrimary:"#3A3A3A",textSecondary:"#8B7355",textTertiary:"#A0A0A0",textInverse:"#FFFFFF",border:"#E8E3DD",borderLight:"#F0EDE8",borderDark:"#D4C4B0",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",wantToRead:"#FEF3C7",wantToReadText:"#D97706",currentlyReading:"#DBEAFE",currentlyReadingText:"#2563EB",completed:"#D1FAE5",completedText:"#059669",overlay:"rgba(0, 0, 0, 0.5)",overlayLight:"rgba(0, 0, 0, 0.3)"}},dr={colors:{primary:"#E89556",primaryLight:"#F4A971",primaryDark:"#D2691E",secondary:"#A68B6B",secondaryLight:"#B89980",secondaryDark:"#8B7355",background:"#0F0F0F",surface:"#1A1A1A",surfaceElevated:"#252525",surfaceSecondary:"#1F1F1F",textPrimary:"#F5F5F5",textSecondary:"#C0C0C0",textTertiary:"#909090",textInverse:"#0F0F0F",border:"#333333",borderLight:"#2A2A2A",borderDark:"#444444",success:"#4ADE80",warning:"#FBBF24",error:"#FB7185",info:"#60A5FA",wantToRead:"#2D1B00",wantToReadText:"#FBBF24",currentlyReading:"#1E293B",currentlyReadingText:"#7DD3FC",completed:"#1B2E1B",completedText:"#4ADE80",overlay:"rgba(0, 0, 0, 0.8)",overlayLight:"rgba(0, 0, 0, 0.6)"}},Gt=E.createContext(void 0),z=()=>{const c=E.useContext(Gt);if(!c)throw new Error("useTheme must be used within a ThemeProvider");return c},ur=({children:c})=>{const{user:t,isLoading:r}=de(),a=()=>{try{const x=localStorage.getItem("bookish-theme");if(x)return x==="dark";if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(x){console.error("Error getting initial theme:",x)}return!1},[s,o]=E.useState(a);E.useEffect(()=>{if(r)return;(()=>{var u;if(t){const m=(u=he.getUserSettings())==null?void 0:u.theme;if(m){o(m==="dark");return}}o(a())})()},[t,r]),E.useEffect(()=>{if(!window.matchMedia)return;const x=window.matchMedia("(prefers-color-scheme: dark)"),u=m=>{var i;(t?!!((i=he.getUserSettings())!=null&&i.theme):!!localStorage.getItem("bookish-theme"))||o(m.matches)};return x.addEventListener("change",u),()=>x.removeEventListener("change",u)},[t]),E.useEffect(()=>{const x=document.documentElement;s?(x.classList.add("dark"),x.setAttribute("data-theme","dark")):(x.classList.remove("dark"),x.setAttribute("data-theme","light"));const u=document.querySelector('meta[name="theme-color"]');u&&u.setAttribute("content",s?"#0F0F0F":"#F7F5F3")},[s]);const n=()=>{const x=!s;o(x),l(x)},h=x=>{o(x),l(x)},l=x=>{const u=x?"dark":"light";if(t){const m=he.getUserSettings()||{reminders:[],theme:"light",petName:"Buddy"};he.saveUserSettings({...m,theme:u})}else localStorage.setItem("bookish-theme",u)},d={colors:s?dr.colors:cr.colors,isDark:s};return e.jsx(Gt.Provider,{value:{theme:d,toggleTheme:n,setTheme:h},children:c})},Mt=E.createContext(void 0),_e=()=>{const c=E.useContext(Mt);if(!c)throw new Error("useFriends must be used within a FriendsProvider");return c},mr=({children:c})=>{const{user:t,isAuthenticated:r}=de(),[a,s]=E.useState([]),[o,n]=E.useState([]),[h,l]=E.useState([]),[d,x]=E.useState([]),[u,m]=E.useState(!1),[j,i]=E.useState(null),v=E.useRef(!1),g=E.useRef(!1),[A,f]=E.useState(null);E.useEffect(()=>{r&&t&&T()},[r,t]);const T=async()=>{if(t){m(!0);try{const F=await H.getFriends();if(F.success&&F.friends){const O=await Promise.all(F.friends.map(async $=>{const q=await p($.id);return{...$,stats:q}}));s(O)}const w=await H.getFriendRequests();w.success&&w.requests&&n(w.requests)}catch(F){console.error("Error loading friends data:",F),i("Failed to load friends data")}finally{m(!1)}}},p=async F=>{try{if(F===(t==null?void 0:t.id)){const[w,O]=await Promise.all([H.getUserBooks(),H.getUserSessions()]),$=w.success?w.books||[]:[],q=O.success?O.sessions||[]:[],N=$.filter(U=>U.category==="completed"),D=q.reduce((U,L)=>U+(L.duration||0),0),S=q.reduce((U,L)=>{const J=(L.endPage||0)-(L.startPage||0);return U+Math.max(0,J)},0),C=y(q),R={totalBooksRead:N.length,totalPagesRead:Math.max(S,N.length*200),totalReadingTime:D,currentStreak:C};return H.updatePublicStats(R).catch(console.error),R}else{try{const O=await H.getPublicStats(F);if(O.success&&O.stats)return{totalBooksRead:O.stats.totalBooksRead||0,totalPagesRead:O.stats.totalPagesRead||0,totalReadingTime:O.stats.totalReadingTime||0,currentStreak:O.stats.currentStreak||0}}catch(O){console.error("Error fetching friend public stats:",O)}const w=a.find(O=>O.id===F);return w&&w.stats?w.stats:{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}}catch(w){return console.error("Error calculating user stats:",w),{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}},y=F=>{if(!F.length)return 0;const w=F.map(N=>new Date(N.startTime).toDateString()).filter((N,D,S)=>S.indexOf(N)===D).sort((N,D)=>new Date(D).getTime()-new Date(N).getTime());let O=0;const $=new Date().toDateString(),q=new Date(Date.now()-864e5).toDateString();if(w[0]===$||w[0]===q){O=1;for(let N=1;N<w.length;N++){const D=new Date(w[N]);if((new Date(w[N-1]).getTime()-D.getTime())/(1e3*60*60*24)===1)O++;else break}}return O},k=async F=>{var w;if(!t)return!1;m(!0),i(null);try{const $=(await P(F)).find(S=>S.username.toLowerCase()===F.toLowerCase());if(!$)return i("User not found"),!1;if(a.find(S=>S.id===$.id))return i("Already friends with this user"),!1;if(o.find(S=>S.fromUserId===t.id&&S.toUserId===$.id||S.fromUserId===$.id&&S.toUserId===t.id))return i("Friend request already exists"),!1;const D=await H.sendFriendRequest(t.id,t.username,((w=t.profile)==null?void 0:w.displayName)||t.username,$.id,$.username,$.displayName||$.username);return D.success?(await T(),!0):(i(D.error||"Failed to send friend request"),!1)}catch(O){return console.error("Error sending friend request:",O),i("Failed to send friend request"),!1}finally{m(!1)}},b=async F=>{if(!t)return!1;m(!0),i(null);try{const w=o.find($=>$.id===F);if(!w)return i("Friend request not found"),!1;const O=await H.acceptFriendRequest(F,w.fromUserId);return O.success?(await T(),setTimeout(()=>{M()},1e3),!0):(i(O.error||"Failed to accept friend request"),!1)}catch(w){return console.error("Error accepting friend request:",w),i("Failed to accept friend request"),!1}finally{m(!1)}},_=async F=>{if(!t)return!1;try{const w=o.find($=>$.id===F);if(!w)return i("Friend request not found"),!1;const O=await H.declineFriendRequest(F,w.fromUserId);return O.success?(await T(),!0):(i(O.error||"Failed to decline friend request"),!1)}catch(w){return console.error("Error declining friend request:",w),i("Failed to decline friend request"),!1}},I=async F=>{if(!t)return!1;try{const w=await H.removeFriend(F);return w.success?(await T(),!0):(i(w.error||"Failed to remove friend"),!1)}catch(w){return console.error("Error removing friend:",w),i("Failed to remove friend"),!1}},M=E.useCallback(async()=>{if(t){if(g.current){console.log("⚠️ Friend activity refresh already in progress, skipping...");return}g.current=!0,m(!0);try{const F=a.map(O=>O.id);if(F.length===0){l([]);return}const w=await H.getFriendActivities(F);w.success&&w.activities?(l(w.activities),console.log("✅ Friend activities loaded:",w.activities.length)):(console.log("⚠️ No friend activities found"),l([]))}catch(F){console.error("Error refreshing friend activity:",F),i("Failed to refresh friend activity")}finally{g.current=!1,m(!1)}}},[t,a]),G=E.useCallback(async(F,w)=>{var O;if(t){if(f({period:F,metric:w}),v.current){console.log("⚠️ Leaderboard refresh already in progress, skipping...");return}v.current=!0,m(!0);try{console.log("🔄 Refreshing leaderboard for period:",F,"metric:",w);const $=await H.getAllPublicStats();if(console.log("📊 All public stats result:",$),$.success&&$.allStats&&$.allStats.length>0){const D=(await Promise.all($.allStats.map(async S=>{var R,U,L;const C=await H.getPublicProfile(S.userId);return{userId:S.userId,username:C.success&&((R=C.profile)==null?void 0:R.username)||"Unknown",displayName:C.success?((U=C.profile)==null?void 0:U.displayName)||((L=C.profile)==null?void 0:L.username):"Unknown",stats:{booksRead:S.totalBooksRead||0,pagesRead:S.totalPagesRead||0,readingTime:S.totalReadingTime||0,currentStreak:S.currentStreak||0}}}))).sort((S,C)=>{switch(w){case"books_read":return C.stats.booksRead-S.stats.booksRead;case"pages_read":return C.stats.pagesRead-S.stats.pagesRead;case"reading_time":return C.stats.readingTime-S.stats.readingTime;case"streak":return C.stats.currentStreak-S.stats.currentStreak;default:return 0}}).map((S,C)=>({userId:S.userId,username:S.username,displayName:S.displayName,rank:C+1,score:S.stats[w==="books_read"?"booksRead":w==="pages_read"?"pagesRead":w==="reading_time"?"readingTime":"currentStreak"],period:F,metric:w,details:{booksRead:S.stats.booksRead,pagesRead:S.stats.pagesRead,readingTime:S.stats.readingTime,currentStreak:S.stats.currentStreak}}));x(D),console.log("✅ Leaderboard updated with",D.length,"entries")}else{console.log("⚠️ No public stats available, using fallback method");const q=await p(t.id),S=[{userId:t.id,username:t.username,displayName:((O=t.profile)==null?void 0:O.displayName)||t.username,stats:{booksRead:q.totalBooksRead,pagesRead:q.totalPagesRead,readingTime:q.totalReadingTime,currentStreak:q.currentStreak}},...a.map(C=>{var R,U,L,J;return{userId:C.id,username:C.username,displayName:C.displayName||C.username,stats:{booksRead:((R=C.stats)==null?void 0:R.totalBooksRead)||0,pagesRead:((U=C.stats)==null?void 0:U.totalPagesRead)||0,readingTime:((L=C.stats)==null?void 0:L.totalReadingTime)||0,currentStreak:((J=C.stats)==null?void 0:J.currentStreak)||0}}})].sort((C,R)=>{switch(w){case"books_read":return R.stats.booksRead-C.stats.booksRead;case"pages_read":return R.stats.pagesRead-C.stats.pagesRead;case"reading_time":return R.stats.readingTime-C.stats.readingTime;case"streak":return R.stats.currentStreak-C.stats.currentStreak;default:return 0}}).map((C,R)=>({userId:C.userId,username:C.username,displayName:C.displayName,rank:R+1,score:C.stats[w==="books_read"?"booksRead":w==="pages_read"?"pagesRead":w==="reading_time"?"readingTime":"currentStreak"],period:F,metric:w,details:{booksRead:C.stats.booksRead,pagesRead:C.stats.pagesRead,readingTime:C.stats.readingTime,currentStreak:C.stats.currentStreak}}));x(S)}}catch($){console.error("Error refreshing leaderboard:",$),i("Failed to refresh leaderboard")}finally{v.current=!1,m(!1)}}},[t,a]);E.useEffect(()=>{const F=w=>{console.log("🔄 Public stats updated, refreshing leaderboard...",w.detail),setTimeout(()=>{A&&(console.log("🔄 Re-fetching leaderboard with settings:",A),G(A.period,A.metric))},1500)};return window.addEventListener("publicStatsUpdated",F),()=>{window.removeEventListener("publicStatsUpdated",F)}},[A,G]);const P=async F=>{if(!F.trim())return[];try{console.log("🔍 Searching for users with query:",F);const w=await H.searchPublicUsers(F);return console.log("🔍 Search results:",w),w}catch(w){return console.error("Error searching users:",w),[]}},B={friends:a,friendRequests:o,friendActivity:h,leaderboard:d,loading:u,error:j,sendFriendRequest:k,acceptFriendRequest:b,declineFriendRequest:_,removeFriend:I,refreshFriendActivity:M,refreshLeaderboard:G,searchUsers:P};return e.jsx(Mt.Provider,{value:B,children:c})},hr=({onClose:c})=>{const[t,r]=E.useState(!1),[a,s]=E.useState(""),[o,n]=E.useState(""),[h,l]=E.useState(!1),[d,x]=E.useState(!1),{signIn:u,signUp:m,error:j,clearError:i,continueAsGuest:v}=de(),g={colors:{background:"#F7F5F3",surface:"#FFFFFF",borderLight:"#F0EDE8",border:"#E8E3DD",primary:"#8B7355",textPrimary:"#3A3A3A",textSecondary:"#8B7355"}},A=async p=>{if(p.preventDefault(),!(!a.trim()||!o.trim())){x(!0),i();try{let y;t?(y=await m(a.trim(),o),y.success&&(r(!1),n(""),alert("Account created successfully! Please sign in."))):(y=await u(a.trim(),o),y.success&&c&&c())}finally{x(!1)}}},f=()=>{r(!t),n(""),i()},T=()=>{v(),c&&c()};return e.jsxs("div",{className:"rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border",style:{backgroundColor:g.colors.surface,borderColor:g.colors.border},children:[e.jsxs("div",{className:"text-center mb-8",children:["        ",e.jsx("div",{className:"rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",style:{backgroundColor:g.colors.borderLight},children:e.jsx(K,{className:"w-8 h-8",style:{color:g.colors.primary}})}),e.jsx("h2",{className:"font-serif text-2xl font-medium mb-2",style:{color:g.colors.textPrimary},children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{style:{color:g.colors.textSecondary},children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),"      ",e.jsxs("form",{onSubmit:A,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",style:{color:g.colors.textPrimary},children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:g.colors.textSecondary}}),e.jsx("input",{id:"username",type:"text",value:a,onChange:p=>s(p.target.value),className:"pl-10 pr-4 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:g.colors.background,borderColor:g.colors.border,color:g.colors.textPrimary},placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",style:{color:g.colors.textPrimary},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:g.colors.textSecondary}}),"            ",e.jsx("input",{id:"password",type:h?"text":"password",value:o,onChange:p=>n(p.target.value),className:"pl-10 pr-12 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:g.colors.background,borderColor:g.colors.border,color:g.colors.textPrimary},placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:opacity-70 transition-colors",style:{color:g.colors.textSecondary},children:h?e.jsx(ns,{className:"w-5 h-5"}):e.jsx(ls,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm mt-1",style:{color:g.colors.textSecondary},children:"Password must be at least 8 characters long"})]}),"        ",j&&e.jsx("div",{className:"border px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"#FEF2F2",borderColor:"#FCA5A5",color:"#DC2626"},children:j}),e.jsx("button",{type:"submit",disabled:d,className:"w-full text-white py-3 px-4 rounded-xl font-medium hover:opacity-90 focus:ring-2 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:g.colors.primary},children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:T,className:"w-full py-3 px-4 rounded-xl font-medium focus:ring-2 focus:ring-offset-2 transition-all duration-200 border",style:{backgroundColor:g.colors.surface,color:g.colors.primary,borderColor:g.colors.border},children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center mt-2",style:{color:g.colors.textSecondary},children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{style:{color:g.colors.textSecondary},children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:f,className:"font-medium transition-colors underline hover:opacity-70",style:{color:g.colors.textPrimary},children:t?"Sign In":"Sign Up"})]})}),c&&e.jsx("button",{onClick:c,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},xr=({children:c,fallback:t})=>{const{isAuthenticated:r,isLoading:a}=de(),s={colors:{background:"#F7F5F3",surface:"#FFFFFF",border:"#E8E3DD",primary:"#8B7355",textSecondary:"#8B7355"}};return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.primary}}),e.jsx("p",{className:"font-medium",style:{color:s.colors.textSecondary},children:"Loading your reading world..."})]})}):r?e.jsx(e.Fragment,{children:c}):t||e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:s.colors.background},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(hr,{})})})},fr=()=>{const c=Z(),t=[{icon:K,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:St,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:ke,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:je,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:xe,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:is,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],r=[{icon:Ae,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:Ke,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:be,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen style={{backgroundColor: lightTheme.colors.background}} max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(K,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>c("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx(ot,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>c("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((a,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(a.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:a.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:a.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:r.map((a,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(a.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:a.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:a.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>c("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx(ot,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>c("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>c("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},gr=({className:c=""})=>{const{theme:t,toggleTheme:r}=z();return e.jsx("button",{onClick:r,className:`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 ${c}`,style:{backgroundColor:t.colors.surfaceSecondary},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.border},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},title:`Switch to ${t.isDark?"light":"dark"} mode`,"aria-label":`Switch to ${t.isDark?"light":"dark"} mode`,children:t.isDark?e.jsx(Ct,{size:16,style:{color:t.colors.warning}}):e.jsx(Tt,{size:16,style:{color:t.colors.textSecondary}})})},yr=({greeting:c})=>{var h;const t=Z(),{pet:r}=ie(),{user:a}=de(),{theme:s}=z(),o=(h=a==null?void 0:a.id)==null?void 0:h.startsWith("guest-"),n=()=>{const l=r.mood;return{happy:"😊",excited:"🤩",content:"😌",sad:"😢",sleepy:"😴",hungry:"🍎"}[l]||"😌"};return e.jsx("header",{className:"p-4 transition-colors duration-200",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:c}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gr,{}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors duration-200",style:{backgroundColor:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=s.colors.surfaceSecondary},onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:n()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.colors.textPrimary},children:r.name}),e.jsxs("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:["Lv.",r.level]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200",style:{backgroundColor:o?s.colors.wantToRead:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=o?s.colors.wantToRead:s.colors.surfaceSecondary},onClick:()=>t("/profile"),title:o?"Guest User":"Profile",children:e.jsx(Nt,{className:"w-5 h-5",style:{color:o?s.colors.wantToReadText:s.colors.textSecondary}})})]})]})})},pr=({onContinueReading:c})=>{const{currentBook:t,sessions:r,setActiveBook:a}=ge(),{theme:s}=z(),[o,n]=E.useState(!0);if(E.useEffect(()=>{if(t){const i=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(v=>v.key===t.key);n(i),i||a(null)}},[t,a]),!t||!o)return e.jsx("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed rounded-lg",style:{borderColor:s.colors.textSecondary},children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2",style:{color:s.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-1",style:{color:s.colors.textPrimary},children:"No book selected"}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Search for a book to start reading"})]})})});const h=[...r].sort((j,i)=>new Date(i.startTime).getTime()-new Date(j.startTime).getTime())[0],l=(h==null?void 0:h.endPage)||(h==null?void 0:h.startPage)||1,d=t.number_of_pages_median||0,x=d>0?Math.min(Math.round(l/d*100),100):0,u=d>0,m=u&&x>0;return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:s.colors.textPrimary},children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white p-2",style:{backgroundColor:s.colors.secondary},children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium line-clamp-2 mb-1",style:{color:s.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-2",style:{color:s.colors.textSecondary},children:["by ",t.author_name[0]]}),m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:s.colors.textSecondary},children:[e.jsxs("span",{children:[x,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 rounded-full overflow-hidden",style:{backgroundColor:s.colors.border},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${x}%`,backgroundColor:s.colors.primary}})})]}),e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",d]})]}):u?e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",d]}):e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Currently on page ",l,e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:c,className:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:s.colors.primary,color:s.colors.textInverse},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=s.colors.primaryLight},onMouseLeave:j=>{j.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(K,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},Fe=({icon:c,value:t,label:r,color:a})=>{const{theme:s}=z();return e.jsxs("div",{className:"flex flex-col items-center p-3 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full mb-1",style:{backgroundColor:a},children:c}),e.jsx("span",{className:"font-serif text-lg font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r})]})},br=()=>{const{theme:c}=z(),[t,r]=E.useState(Ee()),[a,s]=E.useState(we());E.useEffect(()=>{const n=h=>{r(h.detail),s(we())};return window.addEventListener("statsUpdated",n),r(Ee()),s(we()),()=>{window.removeEventListener("statsUpdated",n)}},[]);const o=n=>{if(n<60)return`${n} min`;const h=Math.floor(n/60),l=n%60;return l===0?`${h} hrs`:`${h}.${Math.floor(l/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Fe,{icon:e.jsx(le,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeToday),label:"Today",color:c.colors.primary}),e.jsx(Fe,{icon:e.jsx(le,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeThisWeek),label:"This Week",color:c.colors.primaryDark}),e.jsx(Fe,{icon:e.jsx(cs,{className:"w-5 h-5 text-white"}),value:t.totalBooksRead,label:"Books Read",color:c.colors.secondary}),e.jsx(Fe,{icon:e.jsx(ds,{className:"w-5 h-5 text-white"}),value:a.currentStreak,label:"Streak",color:c.colors.primaryLight})]})},ye=({icon:c,label:t,onClick:r})=>{const{theme:a}=z();return e.jsxs("button",{onClick:r,className:"flex flex-col items-center justify-center p-4 rounded-xl shadow-sm transition-colors duration-200",style:{backgroundColor:a.colors.surface},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=a.colors.surfaceSecondary},onMouseLeave:s=>{s.currentTarget.style.backgroundColor=a.colors.surface},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full mb-2",style:{backgroundColor:a.colors.background},children:e.jsx(c,{className:"w-5 h-5",style:{color:a.colors.textSecondary}})}),e.jsx("span",{className:"text-sm",style:{color:a.colors.textPrimary},children:t})]})},vr=({type:c,title:t,timestamp:r,duration:a})=>{const{theme:s}=z(),o=()=>{switch(c){case"reading":return e.jsx(le,{className:"w-4 h-4",style:{color:s.colors.primary}});case"note":return e.jsx(at,{className:"w-4 h-4",style:{color:s.colors.secondary}});case"completed":return e.jsx(at,{className:"w-4 h-4",style:{color:s.colors.success}})}},n=h=>{const l=new Date,d=new Date(h),x=Math.floor((l.getTime()-d.getTime())/(1e3*60));if(x<1)return"just now";if(x<60)return`${x} minute${x===1?"":"s"} ago`;const u=Math.floor(x/60);if(u<24)return`${u} hour${u===1?"":"s"} ago`;const m=Math.floor(u/24);return`${m} day${m===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b",style:{borderColor:s.colors.border},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.colors.surfaceSecondary},children:o()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:s.colors.textSecondary},children:[e.jsx("span",{children:n(r)}),a&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[a," min"]})]})]})]})]})},jr=()=>{const c=Z(),{theme:t}=z(),a=[...He()].sort((o,n)=>new Date(n.startTime).getTime()-new Date(o.startTime).getTime()).slice(0,5),s=()=>{const o=new Date().getHours();return o<12?"Good morning":o<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:t.colors.background},children:[e.jsx(yr,{greeting:s()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(pr,{onContinueReading:()=>c("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ye,{icon:ve,label:"Find Books",onClick:()=>c("/search")}),e.jsx(ye,{icon:ke,label:"My Notes",onClick:()=>c("/notes")}),e.jsx(ye,{icon:us,label:"My Library",onClick:()=>c("/library")}),e.jsx(ye,{icon:ms,label:"Statistics",onClick:()=>c("/stats")}),"          "]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Social"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ye,{icon:be,label:"Friends",onClick:()=>c("/friends")}),e.jsx(ye,{icon:xe,label:"Leaderboard",onClick:()=>c("/leaderboard")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Your Progress"}),e.jsx(br,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-1",style:{color:t.colors.textPrimary},children:"Recent Activity"}),a.length>0?e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden",style:{backgroundColor:t.colors.surface},children:a.map(o=>e.jsx(vr,{type:"reading",title:"Reading session completed",timestamp:o.endTime||o.startTime,duration:o.duration||0},o.id))}):e.jsx("p",{className:"text-sm p-4 rounded-xl shadow-sm",style:{color:t.colors.textSecondary,backgroundColor:t.colors.surface},children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>c("/welcome"),className:"text-sm hover:underline transition-colors underline",style:{color:t.colors.textSecondary},onMouseEnter:o=>{o.currentTarget.style.color=t.colors.textPrimary},onMouseLeave:o=>{o.currentTarget.style.color=t.colors.textSecondary},children:"Learn more about Bookish features"})})]})]})},Je=({children:c,className:t=""})=>{const{theme:r}=z();return e.jsx("div",{className:`min-h-screen transition-colors duration-200 ${t}`,style:{backgroundColor:r.colors.background},children:c})},wr=()=>{const c=Z(),{theme:t}=z(),[r,a]=E.useState(""),[s,o]=E.useState([]),[n,h]=E.useState(!1),[l,d]=E.useState("general"),[x,u]=E.useState(!1);E.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const m=async p=>{if(p.preventDefault(),!!r.trim()){h(!0);try{let y;l==="subject"?y=await Hs(r):y=await Ls(r),o(y)}catch(y){console.error("Error searching books:",y)}finally{h(!1)}}},j=async()=>{try{u(!0),setTimeout(()=>{v()},300)}catch(p){console.error("Error starting camera:",p),alert("Unable to access camera. Please check permissions."),u(!1)}},i=()=>{try{Xe(()=>import("./quagga.min-CA_kn7cW.js").then(p=>p.q),__vite__mapDeps([0,1])).then(p=>{const y=p.default;y.stop(),y.offDetected(),y.offProcessed(),console.log("Quagga stopped successfully")}).catch(p=>{console.log("Error stopping Quagga:",p)})}catch(p){console.log("Quagga cleanup error:",p)}u(!1)},v=async()=>{try{const p=document.querySelector("#barcode-scanner");if(!p){console.error("Scanner element not found");return}const k=(await Xe(()=>import("./quagga.min-CA_kn7cW.js").then(I=>I.q),__vite__mapDeps([0,1]))).default,b={inputStream:{name:"Live",type:"LiveStream",target:p,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",b),k.init(b,I=>{if(I){console.error("QuaggaJS initialization failed:",I),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),i();return}console.log("QuaggaJS initialized successfully"),k.start(),console.log("QuaggaJS started")}),k.onDetected(I=>{const M=I.codeResult.code;console.log("Barcode detected:",M);const G=A(M);console.log("Cleaned barcode:",G),g(G)?(console.log("Valid ISBN detected, searching..."),f(G),i()):console.log("Invalid ISBN format, continuing scan...")});let _=0;k.onProcessed(I=>{_++,_%30===0&&console.log("Processing frames... Count:",_),I&&I.codeResult&&I.codeResult.code&&console.log("Potential code detected:",I.codeResult.code)})}catch(p){console.error("Error loading Quagga:",p),alert("Failed to load barcode scanner. Please try again."),i()}},g=p=>{const y=p.replace(/[^0-9X]/gi,"");return y.length===10||y.length===13},A=p=>p.replace(/[^0-9X]/gi,""),f=async p=>{h(!0);try{const y=await Ys(p);y?(o([y]),a(p)):alert("No book found for this barcode")}catch(y){console.error("Error searching by ISBN:",y),alert("Error scanning barcode")}finally{h(!1)}},T=p=>{c(`/book?book=${encodeURIComponent(p.key)}`,{state:{bookData:p}})};return e.jsx(Je,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",children:[e.jsxs("header",{className:"page-header p-4 shadow-sm",style:{backgroundColor:t.colors.surfaceSecondary},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors",style:{backgroundColor:t.colors.surface},onMouseEnter:p=>{p.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},onMouseLeave:p=>{p.currentTarget.style.backgroundColor=t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsxs("form",{onSubmit:m,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:r,onChange:p=>a(p.target.value),placeholder:l==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 border rounded-lg focus:outline-none focus:ring-2 input-field",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.textPrimary}}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full text-white",style:{backgroundColor:t.colors.primary},children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:j,className:"w-10 h-10 flex items-center justify-center rounded-full text-white transition-colors",style:{backgroundColor:t.colors.primary},onMouseEnter:p=>{p.currentTarget.style.backgroundColor=t.colors.primaryLight},onMouseLeave:p=>{p.currentTarget.style.backgroundColor=t.colors.primary},children:e.jsx(nt,{className:"w-5 h-5"})})]}),"        ",e.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:t.colors.surface},children:[e.jsxs("button",{onClick:()=>d("general"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="general"?t.colors.primary:"transparent",color:l==="general"?"white":t.colors.textSecondary},children:[e.jsx(ve,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>d("subject"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="subject"?t.colors.primary:"transparent",color:l==="subject"?"white":t.colors.textSecondary},children:[e.jsx(lt,{className:"w-4 h-4"}),"Subject"]})]})]}),x&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded-lg p-4 m-4 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:e.jsx(qe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"📷"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none",style:{border:`2px solid ${t.colors.primary}`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{borderTop:`2px solid ${t.colors.primary}`}})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm mb-2",style:{color:t.colors.textSecondary},children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs mb-2",style:{color:t.colors.textSecondary},children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs italic",style:{color:t.colors.textSecondary},children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4",style:{borderTop:`1px solid ${t.colors.border}`},children:e.jsx("button",{onClick:()=>{const p=prompt("Enter ISBN manually (if barcode scan fails):");p&&(f(p.trim()),i())},className:"text-xs underline",style:{color:t.colors.primary},children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2",style:{borderTopColor:t.colors.primary,borderBottomColor:t.colors.primary}})}):s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:l==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:s.map(p=>e.jsxs("div",{onClick:()=>T(p),className:"flex gap-4 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:[p.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${p.cover_i}-M.jpg`,alt:p.title,className:"w-full h-full object-cover",onError:y=>{var b;const k=y.target;k.style.display="none",(b=k.nextElementSibling)==null||b.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${p.cover_i?"hidden":""}`,children:e.jsx(K,{className:"w-6 h-6",style:{color:t.colors.textSecondary}})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:t.colors.textPrimary},children:p.title}),p.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:t.colors.textSecondary},children:["by ",p.author_name[0]]}),p.first_publish_year&&e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:p.first_publish_year})]})]},p.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(ve,{className:"w-12 h-12 mb-4 opacity-70",style:{color:t.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Find your next great read"}),e.jsx("p",{className:"text-sm max-w-xs mb-4",style:{color:t.colors.textSecondary},children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",style:{color:t.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(nt,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lt,{className:"w-4 h-4"}),"Browse"]})]})]})})]})})},De=({isOpen:c,onClose:t,onConfirm:r,title:a,message:s,type:o="confirm",confirmText:n="Confirm",cancelText:h="Cancel"})=>{const{theme:l}=z();if(!c)return null;const d=()=>{switch(o){case"alert":return e.jsx(Ge,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(hs,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(At,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Ge,{className:"w-8 h-8",style:{color:l.colors.primary}})}},x=()=>{r&&r(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl shadow-xl w-full max-w-sm mx-auto",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:a})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(qe,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm leading-relaxed mb-6",style:{color:l.colors.textPrimary},children:s}),e.jsxs("div",{className:"flex gap-3",children:[o==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:h}),e.jsx("button",{onClick:x,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${o==="success"?"bg-green-600 text-white hover:bg-green-700":o==="alert"?"bg-red-600 text-white hover:bg-red-700":"text-white hover:opacity-80"}`,style:o==="confirm"?{backgroundColor:l.colors.primary}:{},children:o==="confirm"?n:"OK"})]})]})})})},Re=()=>{const[c,t]=E.useState(!1),[r,a]=E.useState({title:"",message:""}),[s,o]=E.useState(null);return{isOpen:c,config:r,onConfirm:s,close:()=>{t(!1),o(null)},showConfirm:(d,x,u,m)=>{a({title:d,message:x,type:"confirm",confirmText:m==null?void 0:m.confirmText,cancelText:m==null?void 0:m.cancelText}),o(()=>u),t(!0)},showAlert:(d,x,u="info")=>{a({title:d,message:x,type:u}),o(null),t(!0)}}},kr=()=>{const c=Z(),[t]=kt(),r=es(),{books:a,setActiveBook:s,sessions:o,notes:n,addBook:h,updatePublicStatsAfterBookCompletion:l}=ge(),{refreshLeaderboard:d}=_e(),{updatePetFromBookCompletion:x}=ie(),{theme:u}=z(),[m,j]=E.useState(!1),[i,v]=E.useState(null),[g,A]=E.useState(!1),[f,T]=E.useState(!1),[p,y]=E.useState(!1),k=Re(),b=t.get("book");if(E.useEffect(()=>{var R;if((R=r.state)!=null&&R.bookData)v(r.state.bookData);else{const U=a.find(L=>L.key===b);if(U)v(U);else{c("/");return}}},[b,a,r.state,c]),E.useEffect(()=>{if(i){const U=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(J=>J.key===i.key);A(U);const L=It(i.key);if(L&&L.description&&!i.description){v(J=>({...J,description:L.description,number_of_pages_median:L.number_of_pages_median||J.number_of_pages_median}));return}i.description||(j(!0),Gs(i.key).then(J=>{if(J){const Y={...i,description:J.description,number_of_pages_median:J.number_of_pages_median||i.number_of_pages_median};v(Y),bt(Y)}}).catch(J=>{console.error("Error fetching book details:",J),L&&v(Y=>({...Y,...L}))}).finally(()=>{j(!1)}))}},[i]),!i)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>c("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const _=async R=>{const U=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!U.some(L=>L.key===i.key)){const L={...i,category:R==="want-to-read"?"wishlist":"reading",dateAdded:new Date().toISOString()};await h(L),U.push(L),localStorage.setItem("bookish_books",JSON.stringify(U)),bt(L);const J=JSON.parse(localStorage.getItem("myBooks")||"[]");J.some(Y=>Y.key===i.key)||(J.push(L),localStorage.setItem("myBooks",JSON.stringify(J))),A(!0),T(!1),R==="currently-reading"&&(s(i),c("/reading"))}},I=()=>{k.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{var Q;const R={...i,category:"completed",completedAt:new Date().toISOString()};await h(R),await l();const L=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(re=>re.key===i.key?R:re);localStorage.setItem("bookish_books",JSON.stringify(L));const Y=JSON.parse(localStorage.getItem("myBooks")||"[]").map(re=>re.key===i.key?R:re);localStorage.setItem("myBooks",JSON.stringify(Y)),x(),setTimeout(()=>{d("week","books_read")},1e3),i.key===((Q=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:Q.key)&&s(null),k.showAlert("Congratulations!","🎉 You've completed the book and your pet gained experience!","success"),setTimeout(()=>{c("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},M=i.number_of_pages_median||0,G=[...o].filter(R=>R.bookId===i.key).sort((R,U)=>new Date(U.startTime).getTime()-new Date(R.startTime).getTime())[0],P=(G==null?void 0:G.endPage)||(G==null?void 0:G.startPage)||1,B=M>0?Math.min(Math.round(P/M*100),100):0,F=o.filter(R=>R.bookId===i.key).reduce((R,U)=>R+(U.duration||0),0),w=Math.floor(F/60),O=F%60,$=w>0?`${w} hr${w!==1?"s":""} ${O>0?`${O} min`:""}`:`${O} min`,q=n.filter(R=>R.bookId===i.key),D=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(R=>R.key===i.key),S=(D==null?void 0:D.category)==="completed",C=()=>{c(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:u.colors.background},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:u.colors.background},children:e.jsx("button",{onClick:C,className:"w-8 h-8 flex items-center justify-center rounded-full hover:opacity-80 transition-colors",style:{backgroundColor:u.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:u.colors.primary}})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:i.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${i.cover_i}-M.jpg`,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:u.colors.primary},children:e.jsx(K,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium mb-2 leading-tight",style:{color:u.colors.textPrimary},children:i.title}),i.author_name&&i.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-3",style:{color:u.colors.textSecondary},children:["by ",i.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[i.first_publish_year&&e.jsxs("p",{className:"text-xs",style:{color:u.colors.textSecondary},children:["First published: ",i.first_publish_year]}),M>0&&e.jsxs("p",{className:"text-xs",style:{color:u.colors.textSecondary},children:[M," pages"]})]})]})]}),"        ",g&&M>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:u.colors.textPrimary},children:[B,"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden mb-2",style:{backgroundColor:u.colors.borderLight},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${B}%`,backgroundColor:u.colors.secondary}})}),e.jsxs("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:["Page ",P," of ",M]})]}),e.jsx("div",{className:"w-px",style:{backgroundColor:u.colors.border}}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(St,{className:"w-5 h-5 mb-1",style:{color:u.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:u.colors.textPrimary},children:$}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),m?e.jsx("div",{className:"h-32 animate-pulse rounded-lg mb-6",style:{backgroundColor:u.colors.borderLight}}):i.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:u.colors.textPrimary},children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm leading-relaxed ${p?"":"line-clamp-4"}`,style:{color:u.colors.textPrimary},children:typeof i.description=="string"?i.description:"No description available."}),i.description&&i.description.length>200&&e.jsx("button",{onClick:()=>y(!p),className:"mt-2 flex items-center gap-1 text-sm font-medium hover:opacity-80 transition-colors",style:{color:u.colors.textSecondary},children:p?e.jsxs(e.Fragment,{children:["Show less",e.jsx(xs,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(fs,{className:"w-4 h-4"})]})})]})]}):null,g&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>c("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),q.length>0?e.jsx("div",{className:"space-y-2",children:q.slice(0,2).map(R=>e.jsxs("div",{className:"p-3 rounded-lg shadow-sm",style:{backgroundColor:u.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:[R.chapter?`Chapter: ${R.chapter}`:"",R.chapter&&R.page?" • ":"",R.page?`Page ${R.page}`:""]}),e.jsx("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:new Date(R.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm line-clamp-2",style:{color:u.colors.textPrimary},children:R.content})]},R.id))}):e.jsx("div",{className:"p-4 rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:u.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ke,{className:"w-6 h-6 mx-auto mb-2",style:{color:u.colors.textSecondary}}),e.jsx("p",{className:"text-sm mb-1",style:{color:u.colors.textSecondary},children:"No notes yet"}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 border-t flex gap-4 max-w-md mx-auto",style:{backgroundColor:u.colors.surface,borderColor:u.colors.border},children:g?e.jsx(e.Fragment,{children:S?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("/notes/add"),className:"flex-1 py-3 px-4 border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:u.colors.surface},children:[e.jsx(ke,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(i),c("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:I,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(Ne,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c("/library"),className:"flex-1 py-3 px-4 border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",style:{backgroundColor:u.colors.surface},children:"View Library"}),e.jsxs("button",{onClick:()=>T(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Et,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),"      ",f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:u.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:u.colors.textPrimary},children:"Add to Library"}),e.jsx("p",{className:"text-sm mb-6",style:{color:u.colors.textSecondary},children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>_("want-to-read"),className:"w-full p-4 rounded-lg text-left hover:opacity-80 transition-colors",style:{backgroundColor:u.colors.borderLight},children:[e.jsx("div",{className:"font-medium mb-1",style:{color:u.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:u.colors.textSecondary},children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>_("currently-reading"),className:"w-full p-4 text-white rounded-lg text-left hover:opacity-90 transition-colors",style:{backgroundColor:u.colors.primary},children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>T(!1),className:"w-full mt-4 py-2 text-sm hover:opacity-80 transition-colors",style:{color:u.colors.textSecondary},children:"Cancel"})]})}),e.jsx(De,{isOpen:k.isOpen,onClose:k.close,onConfirm:k.onConfirm||void 0,title:k.config.title,message:k.config.message,type:k.config.type,confirmText:k.config.confirmText,cancelText:k.config.cancelText})]})},V=[];for(let c=0;c<256;++c)V.push((c+256).toString(16).slice(1));function Nr(c,t=0){return(V[c[t+0]]+V[c[t+1]]+V[c[t+2]]+V[c[t+3]]+"-"+V[c[t+4]]+V[c[t+5]]+"-"+V[c[t+6]]+V[c[t+7]]+"-"+V[c[t+8]]+V[c[t+9]]+"-"+V[c[t+10]]+V[c[t+11]]+V[c[t+12]]+V[c[t+13]]+V[c[t+14]]+V[c[t+15]]).toLowerCase()}let We;const Sr=new Uint8Array(16);function Cr(){if(!We){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");We=crypto.getRandomValues.bind(crypto)}return We(Sr)}const Tr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),jt={randomUUID:Tr};function Pe(c,t,r){var s;if(jt.randomUUID&&!c)return jt.randomUUID();c=c||{};const a=c.random??((s=c.rng)==null?void 0:s.call(c))??Cr();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,Nr(a)}const pe="bookish_active_timer",Ar=({bookId:c,startPage:t})=>{const[r,a]=E.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=E.useRef();E.useEffect(()=>{const u=localStorage.getItem(pe);if(u)try{const m=JSON.parse(u);m.bookId===c?a(m.timerState):localStorage.removeItem(pe)}catch(m){console.error("Error loading timer state:",m),localStorage.removeItem(pe)}},[c]),E.useEffect(()=>{r.sessionId&&localStorage.setItem(pe,JSON.stringify({bookId:c,startPage:t,timerState:r}))},[r,c,t]),E.useEffect(()=>(r.isActive?s.current=setInterval(()=>{a(u=>({...u}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[r.isActive]);const o=()=>{if(!r.startTime)return 0;let u=r.totalElapsed;if(r.isActive&&r.lastPauseTime===null){const m=Date.now(),j=new Date(r.startTime).getTime();u+=Math.floor((m-j)/1e3)}return u},n=o(),h=()=>{const u=new Date().toISOString();r.sessionId?a(m=>({...m,startTime:u,lastPauseTime:null,isActive:!0})):a({sessionId:Pe(),startTime:u,totalElapsed:0,lastPauseTime:null,isActive:!0})},l=()=>{if(!r.isActive||!r.startTime)return;const u=Date.now(),m=new Date(r.startTime).getTime(),j=Math.floor((u-m)/1e3);a(i=>({...i,totalElapsed:i.totalElapsed+j,lastPauseTime:new Date().toISOString(),isActive:!1}))},d=u=>{const m=o(),j={id:r.sessionId||Pe(),bookId:c,startTime:r.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:u,duration:Math.floor(m/60)};return a({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(pe),j},x=()=>{a({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(pe)};return{isActive:r.isActive,elapsedTime:n,startTimer:h,pauseTimer:l,stopTimer:d,resetTimer:x}},Er=()=>{const c=Z(),{currentBook:t,addSession:r,addNote:a,addBook:s,updatePublicStatsAfterBookCompletion:o}=ge(),{refreshLeaderboard:n}=_e(),{updatePetFromReading:h}=ie(),{theme:l}=z(),d=Re(),[x,u]=E.useState(1),[m,j]=E.useState(1),[i,v]=E.useState(!1),[g,A]=E.useState(""),[f,T]=E.useState(""),[p,y]=E.useState(!1),[k,b]=E.useState(!1),{isActive:_,elapsedTime:I,startTimer:M,pauseTimer:G,stopTimer:P,resetTimer:B}=Ar({bookId:(t==null?void 0:t.key)||"",startPage:1});if(E.useEffect(()=>{if(t&&!k){const S=localStorage.getItem("bookish_active_timer");if(S)try{const U=JSON.parse(S);if(U.bookId===t.key){u(U.startPage),j(U.startPage),b(!0);return}}catch(U){console.error("Error parsing active timer:",U)}const R=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(U=>U.bookId===t.key);if(R.length>0){R.sort((L,J)=>new Date(J.startTime).getTime()-new Date(L.startTime).getTime());const U=R[0].endPage||R[0].startPage;u(U),j(U)}b(!0)}},[t,k]),E.useEffect(()=>{const S=C=>{_&&(C.preventDefault(),C.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",S),()=>window.removeEventListener("beforeunload",S)},[_]),!t)return c("/"),null;const F=()=>{try{if(!t){d.showAlert("Error","No book selected","alert");return}if(m<x){d.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(I<=0){d.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const S=P(m);if(!S)throw new Error("Failed to create session");if(r(S),S.duration&&h(S.duration),g.trim()){const C={id:Pe(),bookId:t.key,page:m,chapter:f.trim()||void 0,content:g.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};a(C)}c("/")}catch(S){console.error("Error finishing session:",S),d.showAlert("Error","Failed to save reading session. Please try again.","alert")}},w=S=>{const C=Math.floor(S/3600),R=Math.floor(S%3600/60),U=S%60;return C>0?`${C}:${R.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`:`${R.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`},O=t.number_of_pages_median||9999,$=t.number_of_pages_median&&t.number_of_pages_median>0,q=()=>{const S=(t==null?void 0:t.number_of_pages_median)||0;return S>0&&m>=S},N=S=>{const C=Math.max(x,Math.min(S,O));j(C),t!=null&&t.number_of_pages_median&&C>=t.number_of_pages_median&&y(!0)},D=async()=>{try{const S=P(m);if(S&&(r(S),S.duration&&h(S.duration)),g.trim()){const Y={id:Pe(),bookId:t.key,page:m,chapter:f.trim()||void 0,content:g.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};a(Y)}const C={...t,category:"completed",completedAt:new Date().toISOString()};await s(C),await o();const U=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(Y=>Y.key===t.key?C:Y);localStorage.setItem("bookish_books",JSON.stringify(U));const J=JSON.parse(localStorage.getItem("myBooks")||"[]").map(Y=>Y.key===t.key?{...Y,category:"completed",completedAt:new Date().toISOString()}:Y);localStorage.setItem("myBooks",JSON.stringify(J)),localStorage.removeItem("bookish_current_book"),h((S==null?void 0:S.duration)||0,!0),setTimeout(()=>{n("week","books_read")},1e3),d.showAlert("Congratulations!","🎉 You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{c("/library")},2e3)}catch(S){console.error("Error marking book as finished:",S),d.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",style:{backgroundColor:l.colors.background},children:[e.jsxs("header",{className:"p-4 flex items-center gap-3 shadow-sm",style:{backgroundColor:l.colors.surface},children:[e.jsx("button",{onClick:()=>{_||I>0?d.showConfirm("Leave Reading Session",_?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!_&&I>0?F():c(-1)},{confirmText:_?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):c(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:"Reading Session"}),_&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center p-4",style:{borderBottom:`1px solid ${l.colors.border}`},children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:qs(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full",style:{backgroundColor:l.colors.secondary}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium line-clamp-1",style:{color:l.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm",style:{color:l.colors.textSecondary},children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center shadow-inner",style:{backgroundColor:l.colors.borderLight},children:e.jsx("span",{className:"font-serif text-2xl font-medium",style:{color:l.colors.textPrimary},children:w(I)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:_?G:M,className:"w-16 h-16 rounded-full text-white flex items-center justify-center shadow-md transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},children:_?e.jsx(ys,{className:"w-8 h-8"}):e.jsx(Pt,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Start Page"}),e.jsx("input",{type:"number",value:x,onChange:S=>{const C=Math.max(1,Math.min(parseInt(S.target.value)||1,O));u(C),m<C&&j(C)},min:"1",max:O,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary},disabled:_||I>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"End Page"}),e.jsx("input",{type:"number",value:m,onChange:S=>N(parseInt(S.target.value)||x),min:x,max:O,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]}),q()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:D,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!$&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"📘 Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>v(!i),className:"w-full py-2 text-sm mb-2",style:{color:l.colors.primary},children:i?"Hide Note Form":"+ Add a note about this session"}),i&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 rounded-lg",style:{backgroundColor:l.colors.borderLight},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:f,onChange:S=>T(S.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Note"}),e.jsx("textarea",{value:g,onChange:S=>A(S.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 rounded-md resize-none",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 flex gap-4 max-w-md mx-auto",style:{backgroundColor:l.colors.surface,borderTop:`1px solid ${l.colors.border}`},children:[e.jsxs("button",{onClick:()=>{d.showConfirm("Cancel Session",_?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{B(),c(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:[e.jsx(qe,{className:"w-5 h-5"}),"Cancel"]}),q()?e.jsxs("button",{onClick:D,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-green-700 transition-colors",children:[e.jsx(xe,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:F,className:"flex-1 py-3 px-4 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},disabled:I<=0||m<x,children:[e.jsx(Ne,{className:"w-5 h-5"}),"Finish Session"]})]}),"      ",p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(xe,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:l.colors.textPrimary},children:"Congratulations!"}),e.jsxs("p",{className:"text-sm mb-6",style:{color:l.colors.textSecondary},children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:D,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>y(!1),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:"Continue Reading"})]})]})})}),e.jsx(De,{isOpen:d.isOpen,onClose:d.close,onConfirm:d.onConfirm||void 0,title:d.config.title,message:d.config.message,type:d.config.type,confirmText:d.config.confirmText,cancelText:d.config.cancelText})]})},Pr=()=>{const c=Z(),{books:t,addBook:r,updatePublicStatsAfterBookCompletion:a}=ge(),{refreshLeaderboard:s}=_e(),{updatePetFromBookCompletion:o}=ie(),{theme:n}=z(),h=Re(),[l,d]=E.useState(null),[x,u]=E.useState(null),[m,j]=E.useState({}),[i,v]=E.useState([]);E.useEffect(()=>{(()=>{const B=JSON.parse(localStorage.getItem("bookish_books")||"[]");v(B)})()},[]),E.useEffect(()=>{const P=()=>{d(null)};if(l)return document.addEventListener("click",P),()=>document.removeEventListener("click",P)},[l]);const g=i.length>0?i:t,A=P=>{c(`/book?book=${P.key}`,{state:{bookData:P}})},f=(P,B)=>{B.stopPropagation(),h.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const w=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(D=>D.key!==P);localStorage.setItem("bookish_books",JSON.stringify(w));const $=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(D=>D.key!==P);localStorage.setItem("myBooks",JSON.stringify($));const q=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete q[P],localStorage.setItem("bookish_cached_books",JSON.stringify(q));const N=JSON.parse(localStorage.getItem("bookish_current_book")||"null");N&&N.key===P&&localStorage.removeItem("bookish_current_book"),v(w)},{confirmText:"Remove",cancelText:"Keep Book"}),d(null)},T=async(P,B,F)=>{const w=JSON.parse(localStorage.getItem("bookish_books")||"[]"),O=w.find(S=>S.key===P);if(!O)return;const $={...O,category:B,...B==="completed"&&{completedAt:new Date().toISOString()}};await r($);const q=w.map(S=>S.key===P?$:S);localStorage.setItem("bookish_books",JSON.stringify(q));const D=JSON.parse(localStorage.getItem("myBooks")||"[]").map(S=>S.key===P?$:S);localStorage.setItem("myBooks",JSON.stringify(D)),await Oe(),v(q),u(null),d(null),B==="completed"&&await a()},p=(P,B)=>{B.stopPropagation(),h.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{await T(P,"completed"),await a(),o(),setTimeout(()=>{s("week","books_read")},1e3),setTimeout(()=>{h.showAlert("Book Completed!","🎉 Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),d(null)},y=(P,B)=>{B.stopPropagation(),d(l===P?null:P)},k=P=>{const B=vt(P);if(B.length===0)return 0;const F=B[B.length-1],w=t.find(O=>O.key===P);return!(w!=null&&w.number_of_pages_median)||!F.endPage?0:Math.min(100,Math.round(F.endPage/w.number_of_pages_median*100))},b=P=>vt(P).reduce((F,w)=>F+(w.duration||0),0),_=P=>{const B=Math.floor(P/60),F=P%60;return B>0?`${B}h ${F}m`:`${F}m`},I=()=>{const P=[],B=[],F=[];return g.forEach(w=>{const O=k(w.key),$=b(w.key);w.category==="want-to-read"?F.push(w):w.category==="completed"||O>=100?B.push(w):w.category==="currently-reading"||O>0||$>0?P.push(w):F.push(w)}),{currentlyReading:P,completed:B,wantToRead:F}},M=P=>{const B=k(P.key),F=b(P.key),w=m[P.key]||{translateX:0,isDeleting:!1},O=S=>{const C=S.touches[0];j(R=>({...R,[P.key]:{...w,startX:C.clientX,startY:C.clientY}}))},$=S=>{const C=S.touches[0],R=m[P.key];if(!(R!=null&&R.startX)||!(R!=null&&R.startY))return;const U=C.clientX-R.startX,L=C.clientY-R.startY;Math.abs(L)>Math.abs(U)||U<-20&&j(J=>({...J,[P.key]:{...R,translateX:Math.max(U,-120)}}))},q=()=>{const S=m[P.key];S&&(S.translateX<-60?j(C=>({...C,[P.key]:{...S,translateX:-120,isDeleting:!0}})):j(C=>({...C,[P.key]:{...S,translateX:0,isDeleting:!1}})))},N=()=>{h.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const C=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(L=>L.key!==P.key);localStorage.setItem("bookish_books",JSON.stringify(C));const U=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(L=>L.key!==P.key);localStorage.setItem("myBooks",JSON.stringify(U)),v(C),j(L=>{const J={...L};return delete J[P.key],J})},{confirmText:"Remove",cancelText:"Keep Book"})},D=()=>{j(S=>({...S,[P.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{backgroundColor:n.colors.surface,transform:`translateX(${w.translateX}px)`,transition:w.isDeleting||w.translateX===0?"transform 0.3s ease":"none",overflow:w.isDeleting?"hidden":"visible"},onTouchStart:O,onTouchMove:$,onTouchEnd:q,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!w.isDeleting&&A(P),children:["          ",e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 flex items-center justify-center",style:{backgroundColor:n.colors.borderLight},children:[P.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${P.cover_i}-M.jpg`,alt:P.title,className:"w-full h-full object-cover rounded",onError:S=>{var R;const C=S.target;C.style.display="none",(R=C.nextElementSibling)==null||R.classList.remove("hidden")}}):null,e.jsx(K,{className:`w-6 h-6 ${P.cover_i?"hidden":""}`,style:{color:n.colors.textSecondary}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:n.colors.textPrimary},children:P.title}),P.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:n.colors.textSecondary},children:["by ",P.author_name[0]]}),B>0&&B<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:[B,"%"]})]}),e.jsx("div",{className:"w-full rounded-full h-1.5",style:{backgroundColor:n.colors.borderLight},children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${B}%`,backgroundColor:n.colors.secondary}})})]}),B>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(Ne,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),F>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:n.colors.textSecondary},children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{children:[_(F)," read"]})]})]})]}),!w.isDeleting&&e.jsx("button",{onClick:S=>y(P.key,S),className:"absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:e.jsx(ps,{className:"w-4 h-4",style:{color:n.colors.textSecondary}})}),"        ",l===P.key&&!w.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 rounded-lg shadow-lg py-1 z-50 min-w-[180px]",style:{backgroundColor:n.colors.surface,border:`1px solid ${n.colors.border}`},children:[e.jsxs("button",{onClick:S=>{S.stopPropagation(),u(P.key),d(null)},className:"flex items-center gap-2 px-3 py-2 text-sm w-full text-left transition-colors hover:opacity-80",style:{color:n.colors.textSecondary,backgroundColor:"transparent"},onMouseEnter:S=>S.currentTarget.style.backgroundColor=n.colors.borderLight,onMouseLeave:S=>S.currentTarget.style.backgroundColor="transparent",children:[e.jsx(bs,{className:"w-4 h-4"}),"Move to category"]}),P.category!=="completed"&&e.jsxs("button",{onClick:S=>p(P.key,S),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:S=>f(P.key,S),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(_t,{className:"w-4 h-4"}),"Remove from library"]})]}),w.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:["              ",e.jsx("button",{onClick:D,className:"px-3 py-1 text-xs text-red-500 rounded",style:{backgroundColor:n.colors.surface},children:"Cancel"}),e.jsx("button",{onClick:N,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},P.key)},G=(P,B)=>B.length===0?null:e.jsxs("div",{className:"mb-8",children:["        ",e.jsxs("h2",{className:"font-serif text-lg font-medium mb-4 flex items-center gap-2",style:{color:n.colors.textPrimary},children:[P,e.jsxs("span",{className:"text-sm font-normal",style:{color:n.colors.textSecondary},children:["(",B.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:B.map(M)})]});return e.jsx(Je,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:n.colors.background,borderColor:n.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:n.colors.surfaceSecondary},children:e.jsx(se,{className:"w-5 h-5",style:{color:n.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:n.colors.textPrimary},children:"My Library"})]})}),e.jsx("main",{className:"p-4",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4",style:{color:n.colors.textSecondary}}),"            ",e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:n.colors.textPrimary},children:"No books yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>c("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:n.colors.secondary},children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:n.colors.textSecondary},children:[g.length," book",g.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:P,completed:B,wantToRead:F}=I();return e.jsxs(e.Fragment,{children:[G("Currently Reading",P),G("Want to Read",F),G("Completed",B)]})})()]})}),x&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:["          ",e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:n.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:n.colors.textPrimary},children:"Move Book"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>T(x,"want-to-read"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>T(x,"currently-reading"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Currently Reading"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>T(x,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>u(null),className:"w-full mt-4 py-2 text-sm transition-colors hover:opacity-80",style:{color:n.colors.textSecondary},children:"Cancel"}),"          "]})]}),"      ",e.jsx(De,{isOpen:h.isOpen,onClose:h.close,onConfirm:h.onConfirm||void 0,title:h.config.title,message:h.config.message,type:h.config.type,confirmText:h.config.confirmText,cancelText:h.config.cancelText})]})})},_r=()=>{const c=Z(),{books:t}=ge(),{pet:r}=ie(),{theme:a}=z(),[s,o]=E.useState(Ee()),[n,h]=E.useState(we()),l=He();E.useEffect(()=>{const i=v=>{o(v.detail),h(we())};return window.addEventListener("statsUpdated",i),o(Ee()),h(we()),()=>{window.removeEventListener("statsUpdated",i)}},[]);const d=i=>{const v=Math.floor(i/60),g=i%60;return v>0?`${v}h ${g}m`:`${g}m`},x=()=>{if(l.length===0)return 0;const i=l.reduce((v,g)=>v+(g.duration||0),0);return Math.round(i/l.length)},m=(()=>{const i=new Date,v=new Date(i.getFullYear(),i.getMonth(),1),g=l.filter(T=>new Date(T.startTime)>=v),A=g.reduce((T,p)=>T+(p.duration||0),0),f=g.reduce((T,p)=>T+((p.endPage||0)-(p.startPage||0)),0);return{time:A,pages:f,sessions:g.length}})(),j=({icon:i,title:v,value:g,subtitle:A})=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:a.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:a.colors.borderLight},children:e.jsx(i,{className:"w-4 h-4",style:{color:a.colors.textSecondary}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:a.colors.textSecondary},children:v})]}),e.jsx("p",{className:"text-2xl font-serif font-medium mb-1",style:{color:a.colors.textPrimary},children:g}),A&&e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:A})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:a.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:a.colors.background,borderBottom:`1px solid ${a.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:a.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:a.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:a.colors.textPrimary},children:"Reading Statistics"})]})}),"      ",e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:a.colors.textPrimary},children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(j,{icon:K,title:"Books Read",value:s.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(j,{icon:le,title:"Total Time",value:d(s.totalReadingTime),subtitle:"all time"}),e.jsx(j,{icon:Ae,title:"Pages Read",value:s.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(j,{icon:it,title:"Current Streak",value:`${n.currentStreak} days`,subtitle:`longest: ${n.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:a.colors.textPrimary},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:a.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ve,{className:"w-5 h-5",style:{color:a.colors.textSecondary}}),e.jsx("span",{className:"font-medium",style:{color:a.colors.textPrimary},children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:m.sessions}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:d(m.time)}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:m.pages}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"pages"})]})]})]})})]}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:a.colors.textPrimary},children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(j,{icon:le,title:"Today",value:d(s.readingTimeToday)}),e.jsx(j,{icon:Ve,title:"This Week",value:d(s.readingTimeThisWeek)}),e.jsx(j,{icon:Ae,title:"Average Session",value:d(x())}),e.jsx(j,{icon:K,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:a.colors.textPrimary},children:"Reading Companion"}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:a.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(vs,{className:"w-5 h-5",style:{color:a.colors.textSecondary}}),e.jsxs("span",{className:"font-medium",style:{color:a.colors.textPrimary},children:[r.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:r.level}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:[r.happiness,"%"]}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:a.colors.textPrimary},children:r.experience}),e.jsx("p",{className:"text-xs",style:{color:a.colors.textSecondary},children:"experience"})]})]})]})]}),l.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(it,{className:"w-16 h-16 mx-auto mb-4",style:{color:a.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:a.colors.textPrimary},children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm mb-6",style:{color:a.colors.textSecondary},children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>c("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:a.colors.secondary},children:"Find a Book to Read"})]})]})]})},Dr=()=>{const c=Z(),{notes:t,books:r,deleteNote:a}=ge(),{theme:s}=z(),o=Re(),n=d=>{o.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{a(d)},{confirmText:"Delete",cancelText:"Cancel"})},h=d=>{const x=r.find(u=>u.key===d);return x?x.title:"Unknown Book"},l=d=>new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:s.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:s.colors.background,borderBottom:`1px solid ${s.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:s.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:"My Notes"})]}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.secondary},children:e.jsx(Et,{className:"w-5 h-5 text-white"})})]})}),"      ",e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ke,{className:"w-16 h-16 mx-auto mb-4",style:{color:s.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:s.colors.textPrimary},children:"No notes yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:s.colors.textSecondary},children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:s.colors.secondary},children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(d=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4",style:{color:s.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:s.colors.textPrimary},children:h(d.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:s.colors.textSecondary},children:[d.chapter&&e.jsxs("span",{children:["Chapter: ",d.chapter]}),d.page&&e.jsxs("span",{children:["Page ",d.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),e.jsx("span",{children:l(d.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>n(d.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(_t,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",style:{color:s.colors.textPrimary},children:d.content})})]},d.id))]})}),e.jsx(De,{isOpen:o.isOpen,onClose:o.close,onConfirm:o.onConfirm||void 0,title:o.config.title,message:o.config.message,type:o.config.type,confirmText:o.config.confirmText,cancelText:o.config.cancelText})]})},Rr=()=>{const c=Z(),[t]=kt(),{books:r,currentBook:a,addNote:s,notes:o,updateNote:n}=ge(),{theme:h}=z(),l=Re(),d=t.get("edit"),[x,u]=E.useState((a==null?void 0:a.key)||""),[m,j]=E.useState(""),[i,v]=E.useState(""),[g,A]=E.useState("");E.useEffect(()=>{var p;if(d){const y=o.find(k=>k.id===d);y&&(u(y.bookId),j(y.content),v(((p=y.page)==null?void 0:p.toString())||""),A(y.chapter||""))}},[d,o]);const f=()=>{var y;if(!m.trim()){l.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const p={id:d||Pe(),bookId:x,content:m.trim(),page:i?parseInt(i):void 0,chapter:g.trim()||void 0,createdAt:d?((y=o.find(k=>k.id===d))==null?void 0:y.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};d&&n?n(p):s(p),l.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{c("/notes")},1500)},T=()=>{m.trim()||g.trim()||i.trim()?l.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{c(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):c(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:h.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:h.colors.background,borderColor:h.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:T,className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:h.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:h.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:h.colors.textPrimary},children:d?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(js,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:h.colors.textPrimary},children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:x,onChange:p=>u(p.target.value),className:"w-full p-3 pr-10 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] appearance-none",style:{backgroundColor:h.colors.surface,borderColor:h.colors.border,color:h.colors.textPrimary},children:[e.jsx("option",{value:"",children:"Choose a book..."}),r.map(p=>e.jsx("option",{value:p.key,children:p.title},p.key))]}),e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:h.colors.textSecondary}})]})]}),"        ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:h.colors.textPrimary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:g,onChange:p=>A(p.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:h.colors.surface,borderColor:h.colors.border,color:h.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:h.colors.textPrimary},children:"Page (optional)"}),e.jsx("input",{type:"number",value:i,onChange:p=>v(p.target.value),placeholder:"Page number",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:h.colors.surface,borderColor:h.colors.border,color:h.colors.textPrimary}})]})]}),"        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:h.colors.textPrimary},children:"Your Note"}),e.jsx("textarea",{value:m,onChange:p=>j(p.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] resize-none",style:{backgroundColor:h.colors.surface,borderColor:h.colors.border,color:h.colors.textPrimary}}),e.jsxs("p",{className:"text-xs mt-2",style:{color:h.colors.textSecondary},children:[m.length,"/500 characters"]})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:h.colors.surface},children:[e.jsx("h3",{className:"font-medium mb-2",style:{color:h.colors.textPrimary},children:"💡 Note-taking tips:"}),e.jsxs("ul",{className:"text-sm space-y-1",style:{color:h.colors.textSecondary},children:[e.jsx("li",{children:"• Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"• Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"• Record connections to other books or personal experiences"}),e.jsx("li",{children:"• Include your emotional reactions or reflections"})]})]})]}),e.jsx(De,{isOpen:l.isOpen,onClose:l.close,onConfirm:l.onConfirm||void 0,title:l.config.title,message:l.config.message,type:l.config.type,confirmText:l.config.confirmText,cancelText:l.config.cancelText})]})},Br=()=>{const c=Z(),{theme:t}=z(),{pet:r,petStats:a,feedPet:s,playWithPet:o,petSleep:n,getPetMood:h,getPetEvolutionRequirement:l,resetPet:d,updatePetName:x,getPetEmoji:u,canEvolve:m,evolvePet:j}=ie(),[i,v]=E.useState(!1),[g,A]=E.useState(r.name),[f,T]=E.useState(!1),p=P=>P>70?"bg-green-500":P>40?"bg-yellow-500":"bg-red-500",y=P=>`${Math.max(0,Math.min(100,P))}%`,k=()=>{g.trim()&&(x(g.trim()),v(!1))},b=()=>{d(),T(!1)},_=P=>({"first-book":"📖","book-lover":"📚",bookworm:"🐛","speed-reader":"⚡","night-owl":"🦉","early-bird":"🐦"})[P]||"🏆",I=P=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[P]||"Special achievement",M=P=>{const B=Math.floor(P/60),F=P%60;return B>0?`${B}h ${F}m`:`${F}m`},G=l();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:["      ",e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:["            ",e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surfaceSecondary},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"My Reading Pet"})]}),"          ",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c("/pet-shop"),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white font-medium hover:opacity-90 transition-opacity",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Shop"]}),e.jsxs("button",{onClick:()=>c("/minigames"),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium hover:opacity-90 transition-opacity",children:["🎮",e.jsx("span",{className:"text-sm",children:"Games"})]})]})]})}),!r.isAlive&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-300 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"💀"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"Your Pet Has Died!"}),e.jsx("p",{className:"text-red-700",children:"Visit the shop to buy a Phoenix Feather to revive them."}),r.deathDate&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Died: ",new Date(r.deathDate).toLocaleString()]})]})]})}),r.isAlive&&r.mood==="dying"&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-400 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"CRITICAL CONDITION!"}),e.jsx("p",{className:"text-red-700",children:"Your pet is dying! Take immediate action!"})]})]})}),r.isAlive&&r.hunger<15&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-orange-50 border-2 border-orange-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🍖"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-orange-800",children:"Starving!"}),e.jsx("p",{className:"text-orange-700",children:"Your pet desperately needs food!"})]})]})}),r.isAlive&&r.sickness>70&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-purple-50 border-2 border-purple-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🤒"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-purple-800",children:"Seriously Ill!"}),e.jsx("p",{className:"text-purple-700",children:"Your pet needs medicine urgently!"})]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-6 text-center",style:{backgroundColor:t.colors.surface},children:[e.jsx("div",{className:"text-8xl mb-4",children:u()}),e.jsxs("div",{className:"mb-4",children:[i?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:g,onChange:P=>A(P.target.value),className:"text-2xl font-serif font-medium rounded px-3 py-1 border text-center",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary,borderColor:t.colors.border},onBlur:k,onKeyPress:P=>P.key==="Enter"&&k(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["                ",e.jsx("h2",{className:"text-2xl font-serif font-medium",style:{color:t.colors.textPrimary},children:r.name}),e.jsx("button",{onClick:()=>v(!0),className:"p-1 rounded transition-colors hover:opacity-80",style:{color:t.colors.textSecondary,backgroundColor:t.colors.borderLight},children:e.jsx(ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg mb-2",style:{color:t.colors.textSecondary},children:[e.jsxs("span",{children:["Level ",r.level]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:r.evolutionStage})]}),m()&&e.jsxs("button",{onClick:j,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["✨ Evolve to ",G.stage,"!"]})]}),"          ",e.jsx("p",{className:"mb-4",style:{color:t.colors.textPrimary},children:h()}),"          ",e.jsxs("div",{className:"mb-4 p-3 rounded-lg grid grid-cols-2 gap-3",style:{backgroundColor:t.colors.borderLight},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold mb-1",style:{color:t.colors.primary},children:["💰 ",r.points]}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Care Points"}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"(From reading)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold mb-1",style:{color:"#FFD700"},children:["🪙 ",r.coins]}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Game Coins"}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"(From minigames)"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",style:{color:t.colors.textSecondary},children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[r.experience,"/",r.experienceToNext]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${r.experience/r.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:s,disabled:r.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${r.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Me,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"💰 3 pts"})]}),e.jsxs("button",{onClick:o,disabled:r.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${r.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(je,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"💰 5 pts"})]}),e.jsxs("button",{onClick:n,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(Te,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),"                ",e.jsxs("span",{children:[r.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${p(r.happiness)} rounded-full transition-all duration-300`,style:{width:y(r.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),"                ",e.jsxs("span",{children:[r.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${p(r.hunger)} rounded-full transition-all duration-300`,style:{width:y(r.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),"                ",e.jsxs("span",{children:[r.energy,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${p(r.energy)} rounded-full transition-all duration-300`,style:{width:y(r.energy)}})})]}),"            ",e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[r.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${p(r.health)} rounded-full transition-all duration-300`,style:{width:y(r.health)}})})]}),r.sickness>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-purple-500",children:"🤒"}),e.jsx("span",{children:"Sickness"})]}),e.jsxs("span",{className:"text-purple-600 font-medium",children:[Math.round(r.sickness),"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-purple-600 rounded-full transition-all duration-300",style:{width:y(r.sickness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-500",children:"🧼"}),e.jsx("span",{children:"Cleanliness"})]}),e.jsxs("span",{children:[Math.round(r.cleanliness),"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${p(r.cleanliness)} rounded-full transition-all duration-300`,style:{width:y(r.cleanliness)}})})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:["            ",e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:r.totalBooksRead}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:M(r.totalReadingTime)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:a.booksReadToday}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:M(a.readingTimeToday)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Time"})]})]})]}),"        ",r.badges.length>0&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.badges.map((P,B)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl",children:_(P)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize text-sm",style:{color:t.colors.textPrimary},children:P.replace("-"," ")}),e.jsx("div",{className:"text-xs",style:{color:t.colors.textSecondary},children:I(P)})]})]},B))})]}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Pet Management"}),e.jsx("p",{className:"text-sm mb-4",style:{color:t.colors.textSecondary},children:"Reset your pet to start over with a new companion. This action cannot be undone."}),f?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(ws,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},Ir=()=>{const c=Z(),{theme:t}=z(),{pet:r,getShopItems:a,getUnlockedItems:s,buyItem:o,useItem:n}=ie(),[h,l]=E.useState("all"),[d,x]=E.useState(null),[u,m]=E.useState(!1),j=a(),i=s(),v=[{id:"all",name:"All Items",emoji:"🛍️"},{id:"food",name:"Food",emoji:"🍖"},{id:"toy",name:"Toys",emoji:"⚽"},{id:"medicine",name:"Medicine",emoji:"💊"},{id:"decoration",name:"Care",emoji:"🧼"},{id:"special",name:"Special",emoji:"✨"}],g=h==="all"?i:i.filter(b=>b.category===h),A=b=>{switch(b){case"common":return"text-gray-600 bg-gray-100";case"rare":return"text-blue-600 bg-blue-100";case"epic":return"text-purple-600 bg-purple-100";case"legendary":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},f=b=>{switch(b){case"common":return"border-gray-200";case"rare":return"border-blue-200";case"epic":return"border-purple-200";case"legendary":return"border-yellow-200";default:return"border-gray-200"}},T=b=>{o(b)},p=b=>{n(b)},y=b=>{const _=[];return b.hunger&&_.push(`Hunger +${b.hunger}`),b.happiness&&_.push(`Happiness +${b.happiness}`),b.energy&&_.push(`Energy ${b.energy>0?"+":""}${b.energy}`),b.health&&_.push(`Health +${b.health}`),b.cleanliness&&_.push(`Cleanliness +${b.cleanliness}`),b.sickness&&_.push(`Sickness ${b.sickness}`),b.experience&&_.push(`Experience +${b.experience}`),_.join(", ")},k=b=>{const _=r.inventory.find(I=>I.id===b);return(_==null?void 0:_.quantity)||0};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Pet Shop"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 rounded-full",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{className:"font-medium",style:{color:t.colors.primary},children:r.points})]}),e.jsx("button",{onClick:()=>m(!u),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(ct,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})})]})]})}),!r.isAlive&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"💀"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Pet Has Passed Away"}),e.jsx("p",{className:"text-sm text-red-600",children:"You can only buy Phoenix Feather to revive your pet"})]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:v.map(b=>e.jsxs("button",{onClick:()=>l(b.id),className:`flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${h===b.id?"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,style:{...h!==b.id&&{backgroundColor:t.colors.surface,color:t.colors.textSecondary,border:`1px solid ${t.colors.border}`}},children:[e.jsx("span",{className:"mr-2",children:b.emoji}),b.name]},b.id))}),u&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Your Inventory"}),r.inventory.length===0?e.jsx("p",{className:"text-center py-8",style:{color:t.colors.textSecondary},children:"No items in inventory. Buy some items from the shop!"}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.inventory.map((b,_)=>e.jsx("div",{className:`relative p-3 rounded-lg border-2 ${f(b.rarity)}`,style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:b.emoji}),e.jsx("h4",{className:"font-medium text-sm mb-1",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${A(b.rarity)}`,children:b.rarity}),e.jsxs("span",{className:"text-sm font-medium",style:{color:t.colors.textSecondary},children:["x",b.quantity||1]})]}),e.jsx("button",{onClick:()=>p(b.id),disabled:!r.isAlive&&b.id!=="phoenix_feather",className:`w-full py-2 px-3 rounded-lg text-sm font-medium transition-colors ${r.isAlive||b.id==="phoenix_feather"?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Use"})]})},_))})]}),e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ct,{className:"w-12 h-12 mx-auto mb-4",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No items available in this category"})]}):e.jsx("div",{className:"grid gap-4",children:g.map(b=>{const _=k(b.id),I=r.points>=b.price,M=I&&(r.isAlive||b.id==="phoenix_feather");return e.jsx("div",{className:`relative p-4 rounded-xl border-2 ${f(b.rarity)} transition-all hover:shadow-md`,style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-4xl",children:b.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("span",{className:`inline-block text-xs px-2 py-1 rounded-full ${A(b.rarity)}`,children:[e.jsx(Ke,{className:"w-3 h-3 inline mr-1"}),b.rarity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-lg font-bold",style:{color:t.colors.primary},children:[e.jsx("span",{children:"💰"}),e.jsx("span",{children:b.price})]}),_>0&&e.jsxs("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:["Owned: ",_]})]})]}),e.jsx("p",{className:"text-sm mb-3",style:{color:t.colors.textSecondary},children:b.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium mb-1",style:{color:t.colors.textPrimary},children:"Effects:"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:y(b.effect)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>T(b.id),disabled:!M,className:`flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${M?"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white hover:opacity-90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(Dt,{className:"w-4 h-4 inline mr-2"}),I?!r.isAlive&&b.id!=="phoenix_feather"?"Pet must be alive":"Buy":"Not enough points"]}),e.jsx("button",{onClick:()=>x(b),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",style:{backgroundColor:t.colors.borderLight},children:e.jsx(At,{className:"w-4 h-4",style:{color:t.colors.textSecondary}})})]})]})]})},b.id)})})}),j.length>i.length&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsxs("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:[e.jsx(Le,{className:"w-5 h-5 inline mr-2"}),"Locked Items"]}),e.jsx("div",{className:"grid gap-3",children:j.filter(b=>!i.find(_=>_.id===b.id)).slice(0,3).map(b=>{var _,I;return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg opacity-60",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl grayscale",children:b.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:[((_=b.unlockRequirement)==null?void 0:_.level)&&`Requires Level ${b.unlockRequirement.level}`,((I=b.unlockRequirement)==null?void 0:I.books)&&` • ${b.unlockRequirement.books} books read`]})]}),e.jsx(Le,{className:"w-4 h-4",style:{color:t.colors.textSecondary}})]},b.id)})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-6xl mb-3",children:d.emoji}),e.jsx("h3",{className:"font-serif text-xl font-medium mb-2",style:{color:t.colors.textPrimary},children:d.name}),e.jsxs("span",{className:`inline-block text-sm px-3 py-1 rounded-full ${A(d.rarity)}`,children:[e.jsx(Ke,{className:"w-4 h-4 inline mr-1"}),d.rarity.toUpperCase()]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:d.description}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",style:{color:t.colors.textPrimary},children:"Effects:"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:y(d.effect)})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["💰 ",d.price," points"]})})]}),e.jsx("button",{onClick:()=>x(null),className:"w-full py-3 px-4 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary},children:"Close"})]})})]})};class Fr{constructor(){ce(this,"sessions",new Map);ce(this,"userStats",new Map);ce(this,"availableGames",[{id:"word_puzzle",name:"Word Puzzle",description:"Solve word puzzles to earn coins",difficulty:"easy",baseReward:10,bonusMultiplier:1.5,maxPlaysPerDay:5,gameUrl:"/Bookish/sample-minigame.html",isActive:!0},{id:"memory_match",name:"Memory Match",description:"Match pairs of book covers",difficulty:"medium",baseReward:15,bonusMultiplier:2,maxPlaysPerDay:3,unlockRequirement:{level:5},isActive:!0},{id:"speed_reading",name:"Speed Reading Challenge",description:"Read passages quickly and answer questions",difficulty:"hard",baseReward:25,bonusMultiplier:2.5,maxPlaysPerDay:2,unlockRequirement:{level:10,books:5},isActive:!0},{id:"book_trivia",name:"Book Trivia",description:"Answer questions about famous books",difficulty:"medium",baseReward:20,bonusMultiplier:1.8,maxPlaysPerDay:4,unlockRequirement:{level:8},isActive:!0},{id:"genre_sort",name:"Genre Sorting",description:"Sort books into correct genres quickly",difficulty:"easy",baseReward:12,bonusMultiplier:1.3,maxPlaysPerDay:6,unlockRequirement:{level:3},isActive:!0}])}getAvailableGames(t,r,a){return this.availableGames.filter(s=>{if(!s.isActive)return!1;if(!s.unlockRequirement)return!0;const o=s.unlockRequirement;return!(o.level&&t<o.level||o.books&&r<o.books||o.badges&&!o.badges.every(n=>a.includes(n)))})}getUserGameStats(t,r){const a=this.userStats.get(t);return a&&a.get(r)||null}canPlayGame(t,r){const a=this.availableGames.find(l=>l.id===r);if(!a)return{canPlay:!1,playsLeft:0,reason:"Game not found"};if(!a.isActive)return{canPlay:!1,playsLeft:0,reason:"Game is currently disabled"};const s=this.getUserGameStats(t,r);if(!s)return{canPlay:!0,playsLeft:a.maxPlaysPerDay};const o=new Date().toDateString(),n=new Date(s.lastPlayed).toDateString();o!==n&&(s.playsToday=0);const h=a.maxPlaysPerDay-s.playsToday;return{canPlay:h>0,playsLeft:h,reason:h<=0?"Daily play limit reached":void 0}}startGameSession(t,r){const a=this.canPlayGame(t,r);if(!a.canPlay)return{success:!1,error:a.reason};const s=`${r}_${t}_${Date.now()}`,o=this.generateValidationToken(s),n={id:s,gameId:r,userId:t,startTime:new Date().toISOString(),completed:!1,coinsAwarded:0,validationToken:o};return this.sessions.set(s,n),this.updateUserStats(t,r,"started"),{success:!0,sessionId:s}}completeGameSession(t,r,a,s){const o=this.sessions.get(t);if(!o)return{success:!1,error:"Session not found"};if(o.validationToken!==a)return{success:!1,error:"Invalid validation token"};if(o.completed)return{success:!1,error:"Session already completed"};const n=this.availableGames.find(x=>x.id===o.gameId);if(!n)return{success:!1,error:"Game not found"};const h=n.baseReward,l=Math.floor(r*n.bonusMultiplier),d=h+l;return o.endTime=new Date().toISOString(),o.score=r,o.completed=!0,o.coinsAwarded=d,this.updateUserStats(o.userId,o.gameId,"completed",r,d),s&&s(d),this.syncGameCompletion(o),{success:!0,coinsAwarded:d}}generateValidationToken(t){const r=Date.now(),a=Math.random().toString(36).substring(2,15);return btoa(`${t}_${r}_${a}`)}updateUserStats(t,r,a,s,o){this.userStats.has(t)||this.userStats.set(t,new Map);const n=this.userStats.get(t);let h=n.get(r);h||(h={gameId:r,playsToday:0,totalPlays:0,highScore:0,lastPlayed:new Date().toISOString(),totalCoinsEarned:0},n.set(r,h));const l=new Date().toDateString(),d=new Date(h.lastPlayed).toDateString();l!==d&&(h.playsToday=0),a==="started"?(h.playsToday++,h.totalPlays++,h.lastPlayed=new Date().toISOString()):a==="completed"&&s!==void 0&&o!==void 0&&(h.highScore=Math.max(h.highScore,s),h.totalCoinsEarned+=o)}async syncGameCompletion(t){if(H.isAuthenticated()&&t.userId)try{await H.trackGameCompletion({sessionId:t.id,gameId:t.gameId,userId:t.userId,score:t.score||0,coinsEarned:t.coinsAwarded,completedAt:t.endTime})}catch(r){console.warn("Failed to sync game completion:",r)}}async getGameLeaderboard(t,r=10){return[]}async getUserRank(t,r){return 0}addGame(t){return this.availableGames.find(a=>a.id===t.id)?!1:(this.availableGames.push(t),!0)}updateGame(t,r){const a=this.availableGames.findIndex(s=>s.id===t);return a===-1?!1:(this.availableGames[a]={...this.availableGames[a],...r},!0)}disableGame(t){return this.updateGame(t,{isActive:!1})}enableGame(t){return this.updateGame(t,{isActive:!0})}getAllUserStats(t){return this.userStats.get(t)}clearUserStats(t){this.userStats.delete(t)}getUserActiveSessions(t){return Array.from(this.sessions.values()).filter(r=>r.userId===t&&!r.completed)}cleanupOldSessions(){const t=Date.now(),r=24*60*60*1e3;for(const[a,s]of this.sessions.entries())t-new Date(s.startTime).getTime()>r&&this.sessions.delete(a)}}const ue=new Fr,Ur=()=>{const{pet:c,addCoins:t}=ie(),{theme:r}=z(),a=Z(),[s,o]=E.useState([]),[n,h]=E.useState(new Map),[l,d]=E.useState(null),[x,u]=E.useState(null),[m,j]=E.useState(!1),[i,v]=E.useState("");E.useEffect(()=>{const f=ue.getAvailableGames(c.level,c.totalBooksRead,c.badges);o(f);const T=ue.getAllUserStats("current_user")||new Map;h(T)},[c.level,c.totalBooksRead,c.badges]);const g=tt.useCallback((f,T)=>{if(!x)return;const p=ue.completeGameSession(x,f,T,y=>{t(y),v(`Game completed! You earned ${y} coins! 🪙`)});if(p.success){const y=ue.getAllUserStats("current_user")||new Map;h(y)}else v(p.error||"Failed to complete game");d(null),u(null)},[x,t]);E.useEffect(()=>{const f=T=>{if(T.data.source==="bookish_minigame")switch(T.data.type){case"game_ready":if(l&&x){const p=document.querySelector('iframe[title="'+l.name+'"]');p!=null&&p.contentWindow&&p.contentWindow.postMessage({type:"init_minigame",source:"bookish_parent",sessionId:x,validationToken:x,gameId:l.id},"*")}break;case"game_complete":T.data.sessionId===x&&g(T.data.score,T.data.validationToken);break;case"game_error":v(`Game error: ${T.data.error}`);break}};return window.addEventListener("message",f),()=>window.removeEventListener("message",f)},[l,x,g]);const A=async f=>{j(!0),v("");const T=ue.canPlayGame("current_user",f.id);if(!T.canPlay){v(T.reason||"Cannot play this game right now"),j(!1);return}const p=ue.startGameSession("current_user",f.id);p.success?(d(f),u(p.sessionId),v(`Game started! You have ${T.playsLeft-1} plays left today.`)):v(p.error||"Failed to start game"),j(!1)};return l&&x?e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:r.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:r.colors.background,borderColor:r.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:["            ",e.jsx("button",{onClick:()=>{d(null),u(null)},className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:r.colors.surfaceSecondary},children:e.jsx(se,{className:"w-5 h-5",style:{color:r.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:r.colors.textPrimary},children:l.name})]})}),e.jsxs("main",{className:"px-4 py-2",children:[e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden mb-4",style:{backgroundColor:r.colors.surface},children:l.gameUrl?e.jsx("iframe",{src:l.gameUrl,width:"100%",height:"600",frameBorder:"0",title:l.name,className:"w-full"}):e.jsxs("div",{className:"text-center py-20 px-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx(ks,{size:48,style:{color:r.colors.textSecondary,margin:"0 auto"}})}),e.jsx("h3",{className:"font-serif text-lg font-semibold mb-2",style:{color:r.colors.textPrimary},children:l.name}),e.jsx("p",{className:"text-sm mb-6",style:{color:r.colors.textSecondary},children:l.description}),e.jsxs("div",{className:"rounded-lg p-4 max-w-sm mx-auto",style:{backgroundColor:r.colors.background},children:[e.jsx("h4",{className:"font-medium mb-3",style:{color:r.colors.textPrimary},children:"Demo Game Interface"}),e.jsx("p",{className:"text-xs mb-4",style:{color:r.colors.textSecondary},children:"This is where your HTML minigame would be embedded."}),e.jsx("button",{onClick:()=>g(Math.floor(Math.random()*1e3)+100,x),className:"w-full px-4 py-3 rounded-lg font-medium transition-colors",style:{backgroundColor:r.colors.primary,color:r.colors.textInverse},onMouseEnter:f=>{f.currentTarget.style.backgroundColor=r.colors.primaryLight},onMouseLeave:f=>{f.currentTarget.style.backgroundColor=r.colors.primary},children:"Complete Game (Demo)"}),e.jsx("p",{className:"text-xs mt-2",style:{color:r.colors.textTertiary},children:"Click to simulate game completion and earn coins"})]})]})}),i&&e.jsx("div",{className:"p-4 rounded-xl mb-4",style:{backgroundColor:r.colors.surface,borderLeft:`4px solid ${r.colors.primary}`},children:e.jsx("p",{className:"text-sm",style:{color:r.colors.textPrimary},children:i})})]})]}):e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:r.colors.background},children:["      ",e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:r.colors.background,borderColor:r.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:["            ",e.jsx("button",{onClick:()=>a("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:r.colors.surfaceSecondary},children:e.jsx(se,{className:"w-5 h-5",style:{color:r.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:r.colors.textPrimary},children:"Minigames 🎮"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-1",style:{color:r.colors.primary},children:[e.jsx(Ns,{size:18}),c.coins]}),e.jsxs("div",{className:"text-xs",style:{color:r.colors.textSecondary},children:["Pet Level: ",c.level]})]})]})}),"      ",e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[i&&e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:r.colors.surface,borderLeft:`4px solid ${r.colors.primary}`},children:e.jsx("p",{className:"text-sm",style:{color:r.colors.textPrimary},children:i})}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:r.colors.textPrimary},children:"Available Games"}),s.length>0?e.jsx("div",{className:"space-y-3",children:s.map(f=>{const T=n.get(f.id),p=ue.canPlayGame("current_user",f.id);return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-serif font-semibold",style:{color:r.colors.textPrimary},children:f.name}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full",style:{backgroundColor:f.difficulty==="easy"?"#10B981":f.difficulty==="medium"?"#F59E0B":"#EF4444",color:"white"},children:f.difficulty.toUpperCase()})]}),e.jsx("p",{className:"text-sm mb-3",style:{color:r.colors.textSecondary},children:f.description})]})}),e.jsxs("div",{className:"flex justify-between text-xs mb-3 p-2 rounded-lg",style:{backgroundColor:r.colors.background},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold",style:{color:r.colors.primary},children:["🪙 ",f.baseReward]}),e.jsx("div",{style:{color:r.colors.textSecondary},children:"Base"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold",style:{color:r.colors.primary},children:["×",f.bonusMultiplier]}),e.jsx("div",{style:{color:r.colors.textSecondary},children:"Bonus"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",style:{color:r.colors.textPrimary},children:T?`${T.playsToday}/${f.maxPlaysPerDay}`:`0/${f.maxPlaysPerDay}`}),e.jsx("div",{style:{color:r.colors.textSecondary},children:"Plays"})]})]}),T&&e.jsxs("div",{className:"p-3 rounded-lg mb-3",style:{backgroundColor:r.colors.background},children:[e.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:r.colors.textPrimary},children:"Your Stats"}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:r.colors.textSecondary},children:"High Score: "}),e.jsx("span",{className:"font-medium",style:{color:r.colors.textPrimary},children:T.highScore})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:r.colors.textSecondary},children:"Total Coins: "}),e.jsxs("span",{className:"font-medium",style:{color:r.colors.primary},children:["🪙 ",T.totalCoinsEarned]})]})]})]}),e.jsx("button",{onClick:()=>A(f),disabled:!p.canPlay||m,className:"w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:p.canPlay&&!m?r.colors.primary:r.colors.border,color:p.canPlay&&!m?r.colors.textInverse:r.colors.textSecondary,cursor:p.canPlay&&!m?"pointer":"not-allowed"},onMouseEnter:y=>{p.canPlay&&!m&&(y.currentTarget.style.backgroundColor=r.colors.primaryLight)},onMouseLeave:y=>{p.canPlay&&!m&&(y.currentTarget.style.backgroundColor=r.colors.primary)},children:m?"Starting...":p.canPlay?e.jsxs(e.Fragment,{children:[e.jsx(Pt,{size:16}),"Play Game"]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:16}),p.reason]})}),p.canPlay&&p.playsLeft<=1&&e.jsx("p",{className:"text-xs mt-2 text-center",style:{color:r.colors.warning},children:"⚠️ Last play for today!"})]},f.id)})}):e.jsxs("div",{className:"text-center py-12 rounded-xl shadow-sm",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎮"}),e.jsx("h3",{className:"font-serif text-lg font-semibold mb-2",style:{color:r.colors.textPrimary},children:"No Games Available"}),e.jsx("p",{className:"text-sm",style:{color:r.colors.textSecondary},children:"Keep reading and leveling up your pet to unlock more minigames!"})]})]}),e.jsxs("section",{className:"p-4 rounded-xl border",style:{backgroundColor:r.colors.surface,borderColor:r.colors.warning,borderLeftWidth:"4px",borderLeftColor:r.colors.warning},children:[e.jsx("h3",{className:"font-medium text-sm mb-2",style:{color:r.colors.warning},children:"🔧 For Developers"}),e.jsxs("div",{className:"text-xs space-y-1",style:{color:r.colors.textSecondary},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"API Integration:"})," Use minigamesAPI for session management"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Validation:"})," Include validation tokens for security"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Scoring:"})," Higher scores = more bonus coins"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Communication:"})," Use postMessage for iframe communication"]})]})]})]})]})},$t=({message:c,type:t,onClose:r})=>{const a={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"✓",error:"✕",info:"ℹ"}[t];return tt.useEffect(()=>{const o=setTimeout(()=>{r()},3e3);return()=>clearTimeout(o)},[r]),e.jsxs("div",{className:`fixed top-4 right-4 ${a} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:c}),e.jsx("button",{onClick:r,className:"ml-2 text-white hover:text-gray-200",children:"✕"})]})},wt=({className:c="",showLabel:t=!0})=>{const{theme:r,toggleTheme:a}=z();return e.jsxs("div",{className:`flex items-center gap-3 ${c}`,children:[t&&e.jsx("span",{className:"text-sm font-medium",style:{color:r.colors.textPrimary},children:"Theme"}),e.jsx("button",{onClick:a,className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:r.colors.surface,border:`1px solid ${r.colors.border}`,color:r.colors.textPrimary},"aria-label":`Switch to ${r.isDark?"light":"dark"} mode`,children:e.jsx("div",{className:"flex items-center gap-2",children:r.isDark?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{size:16,style:{color:r.colors.warning}}),t&&e.jsx("span",{className:"text-sm",children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{size:16,style:{color:r.colors.textSecondary}}),t&&e.jsx("span",{className:"text-sm",children:"Dark"})]})})})]})},Or=()=>{var y;const{user:c,signOut:t,updateProfile:r}=de(),{theme:a}=z(),s=Z(),[o,n]=E.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[h,l]=E.useState(!1),[d,x]=E.useState(!1),[u,m]=E.useState(""),[j,i]=E.useState(null),v=(y=c==null?void 0:c.id)==null?void 0:y.startsWith("guest-");E.useEffect(()=>{c&&g()},[c]),E.useEffect(()=>{c!=null&&c.profile&&!v&&n({displayName:c.profile.displayName||"",bio:c.profile.bio||"",favoriteGenres:c.profile.favoriteGenres||[],readingGoal:c.profile.readingGoal||12,joinedDate:c.profile.joinedDate||c.createdAt})},[c==null?void 0:c.profile,v]);const g=async()=>{console.log("ProfilePage: Loading profile for user:",c==null?void 0:c.id,"isGuest:",v);try{if(v){const b=he.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",b),b){n({displayName:b.displayName||"Guest User",bio:b.bio||"Browsing as a guest",favoriteGenres:b.favoriteGenres||[],readingGoal:b.readingGoal||12,joinedDate:b.joinedDate||(c==null?void 0:c.createdAt)});return}c!=null&&c.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),n({displayName:c.profile.displayName||"Guest User",bio:c.profile.bio||"Browsing as a guest",favoriteGenres:c.profile.favoriteGenres||[],readingGoal:c.profile.readingGoal||12,joinedDate:c.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const k=await H.getProfile();if(console.log("ProfilePage: Gun service profile result:",k),k.success&&k.profile){const b={displayName:k.profile.displayName||"",bio:k.profile.bio||"",favoriteGenres:k.profile.favoriteGenres||[],readingGoal:k.profile.readingGoal||12,joinedDate:k.profile.joinedDate||k.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",b),n(b)}else console.log("ProfilePage: No profile found or error loading profile")}catch(k){console.error("Error loading profile:",k)}},A=async()=>{if(c){console.log("ProfilePage: Saving profile:",o),x(!0);try{if(v){he.setGuestProfile(o),l(!1),console.log("Guest profile saved to localStorage:",o),i({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",o);const k=await r(o);console.log("ProfilePage: updateProfile result:",k),k.success?(l(!1),console.log("Profile saved successfully"),i({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await g()):(console.error("Error saving profile:",k.error),i({message:`Failed to save profile: ${k.error||"Unknown error"}`,type:"error"}))}catch(k){console.error("Error saving profile:",k),i({message:"Failed to save profile. Please try again.",type:"error"})}finally{x(!1)}}},f=()=>{u.trim()&&!o.favoriteGenres.includes(u.trim())&&(n(k=>({...k,favoriteGenres:[...k.favoriteGenres,u.trim()]})),m(""))},T=k=>{n(b=>({...b,favoriteGenres:b.favoriteGenres.filter(_=>_!==k)}))},p=()=>{t()};return c?e.jsxs(Je,{children:[e.jsxs("div",{className:"min-h-screen py-8 transition-colors duration-200",style:{backgroundColor:a.colors.background},children:[v&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"border px-4 py-3 rounded-lg",style:{backgroundColor:a.colors.wantToRead,borderColor:a.colors.border,color:a.colors.wantToReadText},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl overflow-hidden transition-colors duration-200",style:{backgroundColor:a.colors.surface},children:["            ",e.jsxs("div",{className:"px-8 py-12 text-white relative",style:{background:`linear-gradient(to right, ${a.colors.primary}, ${a.colors.primaryLight})`},children:[e.jsx("button",{onClick:()=>s(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:o.displayName||(c==null?void 0:c.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:o.bio||"A passionate reader exploring new worlds through books"}),o.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(o.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>l(!h),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),h?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:p,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),h?e.jsx("input",{type:"text",value:o.displayName,onChange:k=>n(b=>({...b,displayName:k.target.value})),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent input-field",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.textPrimary},placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:o.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),h?e.jsx("textarea",{value:o.bio,onChange:k=>n(b=>({...b,bio:k.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:o.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),h?e.jsx("input",{type:"number",min:"1",max:"365",value:o.readingGoal,onChange:k=>n(b=>({...b,readingGoal:parseInt(k.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[o.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),h&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:k=>m(k.target.value),onKeyPress:k=>k.key==="Enter"&&f(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.favoriteGenres.map((k,b)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[k,h&&e.jsx("button",{onClick:()=>T(k),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},b)),"                    ",o.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:a.colors.primary},children:"App Settings"}),e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border},children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:a.colors.textPrimary},children:"Appearance"}),e.jsx("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Choose your preferred theme for the app"})]}),e.jsx(wt,{})]})})})]}),"                  ",e.jsxs("div",{className:"mt-8 p-6 rounded-xl",style:{background:`linear-gradient(to right, ${a.colors.surfaceSecondary}, ${a.colors.surfaceElevated})`},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:a.colors.primary},children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:a.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:a.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Pages Read"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:a.colors.textPrimary},children:"Preferences"}),e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:a.colors.surface},children:e.jsx(wt,{})})]})]})]}),h&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:A,disabled:d,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),j&&e.jsx($t,{message:j.message,type:j.type,onClose:()=>i(null)})]}):e.jsx(Je,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},Lr=()=>{const c=Z(),{theme:t}=z(),{friends:r,friendRequests:a,friendActivity:s,loading:o,sendFriendRequest:n,acceptFriendRequest:h,declineFriendRequest:l,removeFriend:d,refreshFriendActivity:x,searchUsers:u}=_e(),[m,j]=E.useState("activity"),[i,v]=E.useState(""),[g,A]=E.useState([]),[f,T]=E.useState(!1),[p,y]=E.useState(null),[k,b]=E.useState(null),[_,I]=E.useState(null);E.useEffect(()=>{x()},[]),E.useEffect(()=>{i.length>2?u(i).then(A):A([])},[i,u]);const M=async w=>{y(w);try{await n(w)?(v(""),A([]),T(!1),I({message:`Friend request sent to ${w}!`,type:"success"})):I({message:"Failed to send friend request",type:"error"})}finally{y(null)}},G=async(w,O)=>{b(w);try{const $=await h(w);I($?{message:`You're now friends with ${O}!`,type:"success"}:{message:"Failed to accept friend request",type:"error"})}finally{b(null)}},P=async w=>{const O=await l(w);I(O?{message:"Friend request declined",type:"info"}:{message:"Failed to decline friend request",type:"error"})},B=w=>{const O=new Date,$=new Date(w),q=Math.floor((O.getTime()-$.getTime())/(1e3*60));return q<60?`${q}m ago`:q<1440?`${Math.floor(q/60)}h ago`:`${Math.floor(q/1440)}d ago`},F=w=>{switch(w){case"book_completed":return e.jsx(K,{className:"w-4 h-4"});case"reading_session":return e.jsx(le,{className:"w-4 h-4"});case"achievement_unlocked":return e.jsx(xe,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Friends"})]}),e.jsx("button",{onClick:()=>T(!f),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.primary},children:e.jsx(dt,{className:"w-5 h-5 text-white"})})]})}),f&&e.jsxs("div",{className:"p-4 border-b",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:t.colors.textSecondary}}),e.jsx("input",{type:"text",placeholder:"Search for users...",value:i,onChange:w=>v(w.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-opacity-50",style:{backgroundColor:t.colors.background,borderColor:t.colors.border,color:t.colors.textPrimary}})]}),g.length>0&&e.jsx("div",{className:"space-y-2",children:g.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg",style:{backgroundColor:t.colors.background},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.username]})]}),"                  ",e.jsx("button",{onClick:()=>M(w.username),className:"px-3 py-1 rounded-lg text-sm font-medium text-white",style:{backgroundColor:t.colors.primary},disabled:o||p===w.username,children:p===w.username?"Sending...":"Add"})]},w.id))})]}),e.jsx("div",{className:"flex border-b",style:{borderColor:t.colors.border},children:[{id:"activity",label:"Activity",count:s.length},{id:"friends",label:"Friends",count:r.length},{id:"requests",label:"Requests",count:a.length}].map(w=>e.jsxs("button",{onClick:()=>j(w.id),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${m===w.id?"border-opacity-100":"border-transparent"}`,style:{color:m===w.id?t.colors.primary:t.colors.textSecondary,borderColor:m===w.id?t.colors.primary:"transparent"},children:[w.label,w.count>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:w.count})]},w.id))}),e.jsxs("div",{className:"p-4",children:[m==="activity"&&e.jsx("div",{className:"space-y-3",children:s.length>0?s.map(w=>e.jsx("div",{className:"p-3 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:F(w.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:B(w.timestamp)})]}),e.jsx("p",{className:"text-sm mb-1",style:{color:t.colors.textPrimary},children:w.description}),w.metadata&&e.jsxs("div",{className:"flex gap-4 text-xs",style:{color:t.colors.textSecondary},children:[w.metadata.pagesRead&&e.jsxs("span",{children:[w.metadata.pagesRead," pages"]}),w.metadata.duration&&e.jsxs("span",{children:[w.metadata.duration," min"]})]})]})]})},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend activity yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Friend activity will appear here when your friends complete books or reading sessions"})]})}),m==="friends"&&e.jsx("div",{className:"space-y-3",children:r.length>0?r.map(w=>e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(be,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.username]})]})]}),e.jsx("button",{onClick:()=>d(w.id),className:"px-3 py-1 rounded-lg text-sm",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:"Remove"})]}),w.stats&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:w.stats.totalBooksRead}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:w.stats.currentStreak}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Day Streak"})]})]})]},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friends yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Start by searching for users to add as friends!"})]})}),m==="requests"&&e.jsx("div",{className:"space-y-3",children:a.length>0?a.map(w=>e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(be,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.fromDisplayName||w.fromUsername}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.fromUsername]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>G(w.id,w.fromUsername),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:k===w.id?"#6B7280":"#10B981"},disabled:o||k===w.id,children:k===w.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ne,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>P(w.id),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#EF4444"},disabled:o||k===w.id,children:e.jsx(qe,{className:"w-4 h-4 text-white"})})]})]})},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(dt,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend requests"}),"              "]})})]}),_&&e.jsx($t,{message:_.message,type:_.type,onClose:()=>I(null)})]})},Gr=()=>{const c=Z(),{theme:t}=z(),{user:r}=de(),{leaderboard:a,loading:s,refreshLeaderboard:o}=_e(),[n,h]=E.useState("week"),[l,d]=E.useState("books_read");E.useEffect(()=>{o(n,l)},[n,l,o]);const x=g=>{switch(g){case 1:return e.jsx(Ss,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(ut,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(ut,{className:"w-5 h-5 text-yellow-600"});default:return e.jsxs("span",{className:"font-bold text-lg",style:{color:t.colors.textSecondary},children:["#",g]})}},u=g=>{switch(g){case"books_read":return e.jsx(K,{className:"w-4 h-4"});case"pages_read":return e.jsx(Ae,{className:"w-4 h-4"});case"reading_time":return e.jsx(le,{className:"w-4 h-4"});case"streak":return e.jsx(Qe,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}},m=(g,A)=>{switch(A){case"books_read":return`${g} books`;case"pages_read":return`${g.toLocaleString()} pages`;case"reading_time":const f=Math.floor(g/60),T=g%60;return f>0?`${f}h ${T}m`:`${T}m`;case"streak":return`${g} days`;default:return g.toString()}},j=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"year",label:"This Year"},{id:"alltime",label:"All Time"}],i=[{id:"books_read",label:"Books Read",icon:K},{id:"pages_read",label:"Pages Read",icon:Ae},{id:"reading_time",label:"Reading Time",icon:le},{id:"streak",label:"Reading Streak",icon:Qe}],v=a.find(g=>g.userId===(r==null?void 0:r.id));return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Leaderboard"})]})}),v&&e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.primary+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:x(v.rank)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:"Your Rank"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:m(v.score,l)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["#",v.rank]}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:["out of ",a.length]})]})]})})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"flex gap-2",children:j.map(g=>e.jsx("button",{onClick:()=>h(g.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===g.id?"text-white":""}`,style:{backgroundColor:n===g.id?t.colors.primary:t.colors.surface,color:n===g.id?"white":t.colors.textSecondary},children:g.label},g.id))})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(g=>{const A=g.icon;return e.jsxs("button",{onClick:()=>d(g.id),className:`p-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l===g.id?"text-white":""}`,style:{backgroundColor:l===g.id?t.colors.primary:t.colors.surface,color:l===g.id?"white":t.colors.textSecondary},children:[e.jsx(A,{className:"w-4 h-4"}),g.label]},g.id)})})}),e.jsxs("div",{className:"p-4",children:[s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((g,A)=>e.jsx("div",{className:"p-4 rounded-xl animate-pulse",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:t.colors.borderLight}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:t.colors.borderLight}}),e.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:t.colors.borderLight}})]})]})},A))}):e.jsxs("div",{className:"space-y-3",children:["            ",a.map(g=>e.jsx("div",{className:`p-4 rounded-xl transition-all ${g.userId===(r==null?void 0:r.id)?"ring-2":""}`,style:{backgroundColor:t.colors.surface,...g.userId===(r==null?void 0:r.id)&&{boxShadow:`0 0 0 2px ${t.colors.primary}`}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:x(g.rank)}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:[g.displayName||g.username,g.userId===(r==null?void 0:r.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:"You"})]}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",g.username]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[u(l),e.jsx("span",{className:"font-bold",style:{color:t.colors.primary},children:m(g.score,l)})]}),g.details&&e.jsxs("div",{className:"text-xs mt-1",style:{color:t.colors.textSecondary},children:[l!=="books_read"&&g.details.booksRead&&e.jsxs("span",{children:[g.details.booksRead," books • "]}),l!=="streak"&&g.details.currentStreak&&e.jsxs("span",{children:[g.details.currentStreak," day streak"]})]})]})]})},g.userId))]}),!s&&a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No leaderboard data yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Add friends to compete on the leaderboard!"})]})]})]})},Mr=()=>{const{pet:c}=ie(),[t,r]=E.useState([]);E.useEffect(()=>{const s=[],o=Date.now();c.isAlive?(c.mood==="dying"&&s.push({id:"dying",type:"critical",title:"Critical Condition!",message:"Your pet is dying! Take immediate action to save them!",icon:Ge,timestamp:o}),c.hunger<15?s.push({id:"hunger",type:"critical",title:"Starving!",message:"Your pet is starving and needs food immediately!",icon:Me,timestamp:o}):c.hunger<30&&s.push({id:"hunger-low",type:"warning",title:"Getting Hungry",message:"Your pet is getting hungry. Consider feeding them soon.",icon:Me,timestamp:o}),c.health<20?s.push({id:"health",type:"critical",title:"Very Poor Health!",message:"Your pet's health is critically low! Buy medicine now!",icon:je,timestamp:o}):c.health<40&&s.push({id:"health-low",type:"warning",title:"Poor Health",message:"Your pet's health is declining. Consider buying medicine.",icon:je,timestamp:o}),c.sickness>80?s.push({id:"sickness",type:"critical",title:"Seriously Ill!",message:"Your pet is very sick and needs immediate medical attention!",icon:Te,timestamp:o}):c.sickness>50&&s.push({id:"sickness-moderate",type:"warning",title:"Feeling Unwell",message:"Your pet is getting sick. Consider buying medicine.",icon:Te,timestamp:o}),c.energy<10&&s.push({id:"energy",type:"warning",title:"Exhausted",message:"Your pet is exhausted and needs rest or an energy boost.",icon:Te,timestamp:o}),c.happiness<20&&s.push({id:"happiness",type:"warning",title:"Very Sad",message:"Your pet is very unhappy. Play with them or buy toys!",icon:je,timestamp:o})):s.push({id:"death",type:"death",title:"Pet Has Died",message:"Your pet has passed away! Buy a Phoenix Feather from the shop to revive them.",icon:Cs,timestamp:o}),r(s)},[c.isAlive,c.mood,c.hunger,c.health,c.sickness,c.energy,c.happiness]);const a=s=>{r(o=>o.filter(n=>n.id!==s))};return t.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:t.map(s=>{const o=s.icon,n=s.type==="death"?"bg-black":s.type==="critical"?"bg-red-500":"bg-orange-500";return e.jsx("div",{className:`${n} text-white p-4 rounded-lg shadow-lg animate-slide-in-right`,style:{backgroundColor:s.type==="death"?"#000":void 0},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-sm opacity-90",children:s.message})]}),e.jsx("button",{onClick:()=>a(s.id),className:"text-white/70 hover:text-white text-lg leading-none",children:"×"})]})},s.id)})})},$r=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"📚"}),e.jsx("span",{children:"Bookish"})]})}),"      ",e.jsx(sr,{children:e.jsx(ur,{children:e.jsx(mr,{children:e.jsx(ir,{children:e.jsxs(rr,{children:["                ",e.jsx(ts,{basename:"/Bookish",children:e.jsxs(xr,{children:[e.jsx(Mr,{}),e.jsxs(ss,{children:[e.jsx(ee,{path:"/",element:e.jsx(jr,{})}),e.jsx(ee,{path:"/welcome",element:e.jsx(fr,{})}),e.jsx(ee,{path:"/search",element:e.jsx(wr,{})}),e.jsx(ee,{path:"/library",element:e.jsx(Pr,{})}),e.jsx(ee,{path:"/book",element:e.jsx(kr,{})}),e.jsx(ee,{path:"/reading",element:e.jsx(Er,{})}),e.jsx(ee,{path:"/notes",element:e.jsx(Dr,{})}),"                      ",e.jsx(ee,{path:"/notes/add",element:e.jsx(Rr,{})}),e.jsx(ee,{path:"/pet",element:e.jsx(Br,{})}),e.jsx(ee,{path:"/pet-shop",element:e.jsx(Ir,{})}),e.jsx(ee,{path:"/minigames",element:e.jsx(Ur,{})}),e.jsx(ee,{path:"/stats",element:e.jsx(_r,{})}),e.jsx(ee,{path:"/profile",element:e.jsx(Or,{})}),e.jsx(ee,{path:"/friends",element:e.jsx(Lr,{})}),e.jsx(ee,{path:"/leaderboard",element:e.jsx(Gr,{})})]}),"                  "]})})]})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});Ps.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx($r,{})}));
