const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var Ht=Object.defineProperty;var Yt=(c,t,a)=>t in c?Ht(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a;var we=(c,t,a)=>Yt(c,typeof t!="symbol"?t+"":t,a);import{a as zt,b as Wt,g as Kt,c as $e,r as E,R as bt,u as Z,d as vt,e as Vt,B as Qt,f as Xt,h as ee}from"./vendor-CGGxujwj.js";import{r as Zt,c as es,a as ts}from"./gun-CJ6ok8hl.js";import{B as V,U as jt,L as He,E as ss,a as rs,A as et,T as wt,P as be,H as pe,b as de,S as os,c as Se,d as Ye,e as xe,f as kt,M as Nt,C as ae,g as as,F as ns,h as tt,i as ge,j as ls,k as is,l as se,m as st,n as rt,X as Me,o as Fe,I as St,p as cs,q as ds,r as us,s as ve,t as ms,u as Ct,v as hs,w as fs,x as xs,y as gs,z as Tt,D as ot,G as ze,J as ps,K as ys,N as At,O as Ue,Q as Ne,Z as We,R as bs,V as at,W as nt,Y as lt,_ as vs,$ as js}from"./icons-B8YkmGJp.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();var Je={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var it;function ws(){if(it)return ke;it=1;var c=zt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(f,i,d){var h,u={},m=null,k=null;d!==void 0&&(m=""+d),i.key!==void 0&&(m=""+i.key),i.ref!==void 0&&(k=i.ref);for(h in i)o.call(i,h)&&!r.hasOwnProperty(h)&&(u[h]=i[h]);if(f&&f.defaultProps)for(h in i=f.defaultProps,i)u[h]===void 0&&(u[h]=i[h]);return{$$typeof:t,type:f,key:m,ref:k,props:u,_owner:s.current}}return ke.Fragment=a,ke.jsx=n,ke.jsxs=n,ke}var ct;function ks(){return ct||(ct=1,Je.exports=ws()),Je.exports}var e=ks(),De={},dt;function Ns(){if(dt)return De;dt=1;var c=Wt();return De.createRoot=c.createRoot,De.hydrateRoot=c.hydrateRoot,De}var Ss=Ns(),Cs=Zt();const re=Kt(Cs);var Re={exports:{}};Re.exports;var ut;function Ts(){return ut||(ut=1,function(c){(function(){function t(o,s){return s?es(o):o.slice?t[r(o)]:function(n,f){o(n={exports:{}}),t[r(f)]=n.exports};function r(n){return n.split("/").slice(-1).toString().replace(".js","")}}var a=c;t(function(o){typeof self<"u"&&(o.window=self),typeof window<"u"&&(o.window=window);var s=o.window||o,r,n=s.SEA||{};(n.window=o.window)&&(n.window.SEA=n);try{r+""!=typeof a&&(a.exports=n)}catch{}o.exports=n})(t,"./root"),t(function(o){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(o){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{$e.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}$e.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},$e.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(t,"./base64"),t(function(o){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(r,n,f){r=r||"utf8",n=n||0;const i=this.length;if(r==="hex"){const d=new Uint8Array(this);return[...Array((f&&f+1||i)-n).keys()].map(h=>d[h+n].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(f||i)-n},(d,h)=>String.fromCharCode(this[h+n])).join("");if(r==="base64")return btoa(this)},o.exports=s})(t,"./array"),t(function(o){t("./base64");var s=t("./array");function r(...n){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...n)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const n=arguments[0];let f;if(typeof n=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const h=n.match(/([\da-fA-F]{2})/g).map(u=>parseInt(u,16));if(!h||!h.length)throw new TypeError("Invalid first argument for type 'hex'.");f=s.from(h)}else if(d==="utf8"||d==="binary"){const h=n.length,u=new Uint16Array(h);Array.from({length:h},(m,k)=>u[k]=n.charCodeAt(k)),f=s.from(u)}else if(d==="base64"){const h=atob(n),u=h.length,m=new Uint8Array(u);Array.from({length:u},(k,l)=>m[l]=h.charCodeAt(l)),f=s.from(m)}else d==="binary"?f=s.from(n):console.info("SafeBuffer.from unknown encoding: "+d);return f}if(n.byteLength,n.byteLength?n.byteLength:n.length){let d;return n instanceof ArrayBuffer&&(d=new Uint8Array(n)),s.from(d||n)}},alloc(n,f=0){return s.from(new Uint8Array(Array.from({length:n},()=>f)))},allocUnsafe(n){return s.from(new Uint8Array(Array.from({length:n})))},concat(n){if(!Array.isArray(n))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(n.reduce((f,i)=>f.concat(Array.from(i)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,o.exports=r})(t,"./buffer"),t(function(o){const s=t("./root"),r={Buffer:t("./buffer")};var n={},f;if(JSON.parseAsync=JSON.parseAsync||function(d,h,u){var m;try{h(m,JSON.parse(d,u))}catch(k){h(k)}},JSON.stringifyAsync=JSON.stringifyAsync||function(d,h,u,m){var k;try{h(k,JSON.stringify(d,u,m))}catch(l){h(l)}},r.parse=function(d,h){return new Promise(function(u,m){JSON.parseAsync(d,function(k,l){k?m(k):u(l)},h)})},r.stringify=function(d,h,u){return new Promise(function(m,k){JSON.stringifyAsync(d,function(l,j){l?k(l):m(j)},h,u)})},s.window&&(r.crypto=s.window.crypto||s.window.msCrypto,r.subtle=(r.crypto||n).subtle||(r.crypto||n).webkitSubtle,r.TextEncoder=s.window.TextEncoder,r.TextDecoder=s.window.TextDecoder,r.random=d=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(d))))),!r.TextDecoder){const{TextEncoder:d,TextDecoder:h}=t((f+""==typeof a?".":"")+"./lib/text-encoding",1);r.TextDecoder=h,r.TextEncoder=d}if(!r.crypto)try{var i=t("crypto",1);Object.assign(r,{crypto:i,random:h=>r.Buffer.from(i.randomBytes(h))});const{Crypto:d}=t("@peculiar/webcrypto",1);r.ossl=r.subtle=new d({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}o.exports=r})(t,"./shim"),t(function(o){var s=t("./root"),r=t("./shim"),n={};n.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},n.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},n.ecdh={name:"ECDH",namedCurve:"P-256"},n.jwk=function(f,i){f=f.split(".");var d=f[0],h=f[1],u={kty:"EC",crv:"P-256",x:d,y:h,ext:!0};return u.key_ops=i?["sign"]:["verify"],i&&(u.d=i),u},n.keyToJwk=function(f){return{kty:"oct",k:f.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},n.recall={validity:12*60*60,hook:function(f){return f}},n.check=function(f){return typeof f=="string"&&f.slice(0,4)==="SEA{"},n.parse=async function(i){try{var d=typeof i=="string";return d&&i.slice(0,4)==="SEA{"&&(i=i.slice(3)),d?await r.parse(i):i}catch{}return i},s.opt=n,o.exports=n})(t,"./settings"),t(function(o){var s=t("./shim");o.exports=async function(r,n){var f=typeof r=="string"?r:await s.stringify(r),i=await s.subtle.digest({name:n||"SHA-256"},new s.TextEncoder().encode(f));return s.Buffer.from(i)}})(t,"./sha256"),t(function(o){const s=t("./shim"),r=s.subtle,n=s.ossl?s.ossl:r,f=i=>n.digest({name:"SHA-1"},new ArrayBuffer(i));o.exports=f})(t,"./sha1"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),f=t("./sha256"),i;s.work=s.work||(async(d,h,u,m)=>{try{var k=(h||{}).epub||h;if(m=m||{},k instanceof Function&&(u=k,k=i),d=typeof d=="string"?d:await r.stringify(d),(m.name||"").toLowerCase().slice(0,3)==="sha"){var l=r.Buffer.from(await f(d,m.name),"binary").toString(m.encode||"base64");if(u)try{u(l)}catch(p){console.log(p)}return l}k=k||r.random(9);var j=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(d),{name:m.name||"PBKDF2"},!1,["deriveBits"]),x=await(r.ossl||r.subtle).deriveBits({name:m.name||"PBKDF2",iterations:m.iterations||n.pbkdf2.iter,salt:new r.TextEncoder().encode(m.salt||k),hash:m.hash||n.pbkdf2.hash},j,m.length||n.pbkdf2.ks*8);d=r.random(d.length);var C=r.Buffer.from(x,"binary").toString(m.encode||"base64");if(u)try{u(C)}catch(p){console.log(p)}return C}catch(p){if(console.log(p),s.err=p,s.throw)throw p;u&&u();return}}),o.exports=s.work})(t,"./work"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.name=s.name||(async(n,f)=>{try{if(n)try{n()}catch(i){console.log(i)}return}catch(i){if(console.log(i),s.err=i,s.throw)throw i;n&&n();return}}),s.pair=s.pair||(async(n,f)=>{try{var i=r.ossl||r.subtle,d=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async m=>{var k={};k.priv=(await r.subtle.exportKey("jwk",m.privateKey)).d;var l=await r.subtle.exportKey("jwk",m.publicKey);return k.pub=l.x+"."+l.y,k});try{var h=await i.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async m=>{var k={};k.epriv=(await i.exportKey("jwk",m.privateKey)).d;var l=await i.exportKey("jwk",m.publicKey);return k.epub=l.x+"."+l.y,k})}catch(m){if(s.window)throw m;if(m=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw m}h=h||{};var u={pub:d.pub,priv:d.priv,epub:h.epub,epriv:h.epriv};if(n)try{n(u)}catch(m){console.log(m)}return u}catch(m){if(console.log(m),s.err=m,s.throw)throw m;n&&n();return}}),o.exports=s.pair})(t,"./pair"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),f=t("./sha256"),i;s.sign=s.sign||(async(d,h,u,m)=>{try{if(m=m||{},!(h||m).priv){if(!s.I)throw"No signing key.";h=await s.I(null,{what:d,how:"sign",why:m.why})}if(i===d)throw"`undefined` not allowed.";var k=await n.parse(d),l=m.check=m.check||k;if(s.verify&&(s.opt.check(l)||l&&l.s&&l.m)&&i!==await s.verify(l,h)){var v=await n.parse(l);if(m.raw||(v="SEA"+await r.stringify(v)),u)try{u(v)}catch(N){console.log(N)}return v}var j=h.pub,x=h.priv,C=n.jwk(j,x),p=await f(k),_=await(r.ossl||r.subtle).importKey("jwk",C,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(g=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},g,new Uint8Array(p))),v={m:k,s:r.Buffer.from(_,"binary").toString(m.encode||"base64")};if(m.raw||(v="SEA"+await r.stringify(v)),u)try{u(v)}catch(g){console.log(g)}return v}catch(g){if(console.log(g),s.err=g,s.throw)throw g;u&&u();return}}),o.exports=s.sign})(t,"./sign"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),f=t("./sha256"),i;s.verify=s.verify||(async(u,m,k,l)=>{try{var j=await n.parse(u);if(m===!1){var x=await n.parse(j.m);if(k)try{k(x)}catch(F){console.log(F)}return x}l=l||{};var C=m.pub||m,p=s.opt.slow_leak?await s.opt.slow_leak(C):await(r.ossl||r.subtle).importKey("jwk",n.jwk(C),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),_=await f(j.m),v,g,N,b;try{if(v=r.Buffer.from(j.s,l.encode||"base64"),g=new Uint8Array(v),N=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},p,g,new Uint8Array(_)),!N)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(u,m,k,l)}var A=N?await n.parse(j.m):i;if(k)try{k(A)}catch(F){console.log(F)}return A}catch(F){if(console.log(F),s.err=F,s.throw)throw F;k&&k();return}}),o.exports=s.verify;var d={};s.opt.slow_leak=u=>{if(d[u])return d[u];var m=n.jwk(u);return d[u]=(r.ossl||r.subtle).importKey("jwk",m,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),d[u]};var h=s.opt;s.opt.fall_verify=async function(u,m,k,l,j){if(j===s.opt.fallback)throw"Signature did not match";j=j||1;var x=u||"";u=s.opt.unpack(u)||u;var C=await n.parse(u),p=m.pub||m,_=await s.opt.slow_leak(p),v=j<=s.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await n.parse(C.m)))):await f(C.m),g,N,b;try{if(g=r.Buffer.from(C.s,l.encode||"base64"),N=new Uint8Array(g),b=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},_,N,new Uint8Array(v)),!b)throw"Signature did not match."}catch{try{g=r.Buffer.from(C.s,"utf8"),N=new Uint8Array(g),b=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},_,N,new Uint8Array(v))}catch{if(!b)throw"Signature did not match."}}var A=b?await n.parse(C.m):i;if(h.fall_soul=x["#"],h.fall_key=x["."],h.fall_val=u,h.fall_state=x[">"],k)try{k(A)}catch(F){console.log(F)}return A},s.opt.fallback=2})(t,"./verify"),t(function(o){var s=t("./shim"),r=t("./settings"),n=t("./sha256");const f=async(i,d,h)=>{const u=i+(d||s.random(8)).toString("utf8"),m=s.Buffer.from(await n(u),"binary"),k=r.keyToJwk(m);return await s.subtle.importKey("jwk",k,{name:"AES-GCM"},!1,["encrypt","decrypt"])};o.exports=f})(t,"./aeskey"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings");var n=t("./aeskey"),f;s.encrypt=s.encrypt||(async(i,d,h,u)=>{try{u=u||{};var m=(d||u).epriv||d;if(f===i)throw"`undefined` not allowed.";if(!m){if(!s.I)throw"No encryption key.";d=await s.I(null,{what:i,how:"encrypt",why:u.why}),m=d.epriv||d}var k=typeof i=="string"?i:await r.stringify(i),l={s:r.random(9),iv:r.random(15)},j=await n(m,l.s,u).then(C=>r.subtle.encrypt({name:u.name||"AES-GCM",iv:new Uint8Array(l.iv)},C,new r.TextEncoder().encode(k))),x={ct:r.Buffer.from(j,"binary").toString(u.encode||"base64"),iv:l.iv.toString(u.encode||"base64"),s:l.s.toString(u.encode||"base64")};if(u.raw||(x="SEA"+await r.stringify(x)),h)try{h(x)}catch(C){console.log(C)}return x}catch(C){if(console.log(C),s.err=C,s.throw)throw C;h&&h();return}}),o.exports=s.encrypt})(t,"./encrypt"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),f=t("./aeskey");s.decrypt=s.decrypt||(async(i,d,h,u)=>{try{u=u||{};var m=(d||u).epriv||d;if(!m){if(!s.I)throw"No decryption key.";d=await s.I(null,{what:i,how:"decrypt",why:u.why}),m=d.epriv||d}var k=await n.parse(i),l,j,x;try{l=r.Buffer.from(k.s,u.encode||"base64"),j=r.Buffer.from(k.iv,u.encode||"base64"),x=r.Buffer.from(k.ct,u.encode||"base64");var C=await f(m,l,u).then(_=>r.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(j),tagLength:128},_,new Uint8Array(x)))}catch{if(u.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return u.encode="utf8",await s.decrypt(i,d,h,u)}var p=await n.parse(new r.TextDecoder("utf8").decode(C));if(h)try{h(p)}catch(_){console.log(_)}return p}catch(_){if(console.log(_),s.err=_,s.throw)throw _;h&&h();return}}),o.exports=s.decrypt})(t,"./decrypt"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.secret=s.secret||(async(f,i,d,h)=>{try{if(h=h||{},!i||!i.epriv||!i.epub){if(!s.I)throw"No secret mix.";i=await s.I(null,{what:f,how:"secret",why:h.why})}var u=f.epub||f,m=i.epub,k=i.epriv,l=r.ossl||r.subtle,j=n(u),x=Object.assign({public:await l.importKey(...j,!0,[])},{name:"ECDH",namedCurve:"P-256"}),C=n(m,k),p=await l.importKey(...C,!1,["deriveBits"]).then(async v=>{var g=await l.deriveBits(x,v,256),N=new Uint8Array(g),b=await l.importKey("raw",N,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return l.exportKey("jwk",b).then(({k:A})=>A)}),_=p;if(d)try{d(_)}catch(v){console.log(v)}return _}catch(v){if(console.log(v),s.err=v,s.throw)throw v;d&&d();return}});var n=(f,i)=>{var[d,h]=f.split("."),u=i?{d:i}:{};return["jwk",Object.assign(u,{x:d,y:h,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};o.exports=s.secret})(t,"./secret"),t(function(o){var s=t("./root");s.certify=s.certify||(async(r,n={},f,i,d={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),r=(()=>{var _=[];if(r){if((typeof r=="string"||Array.isArray(r))&&r.indexOf("*")>-1)return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(v=>{typeof v=="string"?_.push(v):typeof v=="object"&&v.pub&&_.push(v.pub)})}return typeof r=="object"&&r.pub?r.pub:_.length>0?_:null}})(),!r)return console.log("No certificant found.");const u=d.expiry&&(typeof d.expiry=="number"||typeof d.expiry=="string")?parseFloat(d.expiry):null,m=(n||{}).read?n.read:null,k=(n||{}).write?n.write:typeof n=="string"||Array.isArray(n)||n["+"]||n["#"]||n["."]||n["="]||n["*"]||n[">"]||n["<"]?n:null,l=(d||{}).block||(d||{}).blacklist||(d||{}).ban||{},j=l.read&&(typeof l.read=="string"||(l.read||{})["#"])?l.read:null,x=typeof l=="string"?l:l.write&&(typeof l.write=="string"||l.write["#"])?l.write:null;if(!m&&!k)return console.log("No policy found.");const C=JSON.stringify({c:r,...u?{e:u}:{},...m?{r:m}:{},...k?{w:k}:{},...j?{rb:j}:{},...x?{wb:x}:{}});var h=await s.sign(C,f,null,{raw:1});if(d.raw||(h="SEA"+JSON.stringify(h)),i)try{i(h)}catch(_){console.log(_)}return h}catch(u){if(s.err=u,s.throw)throw u;i&&i();return}}),o.exports=s.certify})(t,"./certify"),t(function(o){var s=t("./shim"),r=t("./root");r.work=t("./work"),r.sign=t("./sign"),r.verify=t("./verify"),r.encrypt=t("./encrypt"),r.decrypt=t("./decrypt"),r.certify=t("./certify"),r.random=r.random||s.random,r.Buffer=r.Buffer||t("./buffer"),r.keyid=r.keyid||(async n=>{try{const f=s.Buffer.concat(n.replace(/-/g,"+").replace(/_/g,"/").split(".").map(u=>s.Buffer.from(u,"base64"))),i=s.Buffer.concat([s.Buffer.from([153,f.length/256,f.length%256]),f]),d=await sha1hash(i),h=s.Buffer.from(d,"binary");return h.toString("hex",h.length-8)}catch(f){throw console.log(f),f}}),((r.window||{}).GUN||{}).SEA=r,o.exports=r})(t,"./sea"),t(function(o){var s=t("./sea"),r,n;s.window?r=s.window.GUN||{chain:{}}:r=t((n+""==typeof a?".":"")+"./gun",1),s.GUN=r;function f(d){this._={$:this}}f.prototype=function(){function d(){}return d.prototype=r.chain,new d}(),f.prototype.constructor=f,r.chain.user=function(d){var h=this,m=h.back(-1),u;if(d)return d=s.opt.pub((d._||"")["#"])||d,m.get("~"+d);if(u=m.back("user"))return u;var m=m._,k=m,l=k.opt.uuid||i;return(k=(u=k.user=h.chain(new f))._).opt={},k.opt.uuid=function(j){var x=l(),C=m.user;return!C||!(C=C.is)||!(C=C.pub)||(x="~"+C+"/"+x,j&&j.call&&j(null,x)),x},u};function i(){return r.state().toString(36).replace(".","")}r.User=f,f.GUN=r,f.SEA=r.SEA=s,o.exports=f})(t,"./user"),t(function(o){var s,r=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof a?".":"")+"./gun",1);r.chain.then=function(n,f){var i=this,d=new Promise(function(h,u){i.once(h,f)});return n?d.then(n):d}})(t,"./then"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,f=function(){};s.prototype.create=function(...i){var d=typeof i[0]=="object"&&(i[0].pub||i[0].epub)?i[0]:typeof i[1]=="object"&&(i[1].pub||i[1].epub)?i[1]:null,h=d&&(d.pub||d.epub)?d.pub:typeof i[0]=="string"?i[0]:null,u=d&&(d.pub||d.epub)?d:h&&typeof i[1]=="string"?i[1]:null,m=i.filter(_=>typeof _=="function")[0]||null,k=i&&i.length>1&&typeof i[i.length-1]=="object"?i[i.length-1]:{},l=this,j=l._,x=l.back(-1);if(m=m||f,k=k||{},k.check!==!1){var C;if(h||(C="No user."),(u||"").length<8&&(C="Password too short!"),C)return m({err:n.log(C)}),l}if(j.ing)return(m||f)({err:n.log("User is already being created or authenticated!"),wait:!0}),l;j.ing=!0;var p={};return p.a=function(_){if(p.pubs=_,_&&!k.already){var v={err:n.log("User already created!")};j.ing=!1,(m||f)(v),l.leave();return}p.salt=String.random(64),r.work(u,p.salt,p.b)},p.b=function(_){p.proof=_,d?p.c(d):r.pair(p.c)},p.c=function(_){var v;p.pair=_||{},(v=j.root.user)&&(v._.sea=_,v.is={pub:_.pub,epub:_.epub,alias:h}),p.data={pub:_.pub},p.d()},p.d=function(){p.data.alias=h,p.e()},p.e=function(){p.data.epub=p.pair.epub,r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},p.proof,p.f,{raw:1})},p.f=function(_){p.data.auth=JSON.stringify({ek:_,s:p.salt}),p.g(p.data.auth)},p.g=function(_){var v;p.data.auth=p.data.auth||_,x.get(v="~"+p.pair.pub).put(p.data).on(p.h);var g={};g[v]={"#":v},x.get("~@"+h).put(g).get(v).on(p.i)},p.h=function(_,v,g,N){N.off(),p.h.ok=1,p.i()},p.i=function(_,v,g,N){N&&(p.i.ok=1,N.off()),!(!p.h.ok||!p.i.ok)&&(j.ing=!1,m({ok:0,pub:p.pair.pub}),f===m&&(d?l.auth(d):l.auth(h,u)))},x.get("~@"+h).once(p.a),l},s.prototype.leave=function(i,d){var h=this,u=h.back(-1)._.user;if(u&&(delete u.is,delete u._.is,delete u._.sea),r.window)try{var m={};m=r.window.sessionStorage,delete m.recall,delete m.pair}catch{}return h}})(t,"./create"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,f=function(){};s.prototype.auth=function(...d){var h=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,u=!h&&typeof d[0]=="string"?d[0]:null,m=(u||h&&!(h.priv&&h.epriv))&&typeof d[1]=="string"?d[1]:null,k=d.filter(g=>typeof g=="function")[0]||null,l=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},j=this,x=j._,C=j.back(-1);if(x.ing)return(k||f)({err:n.log("User is already being created or authenticated!"),wait:!0}),j;x.ing=!0;var p={},_,v=9;return p.a=function(g){if(!g)return p.b();if(!g.pub){var N=[];return Object.keys(g).forEach(function(b){b!="_"&&N.push(g[b])}),p.b(N)}if(p.name)return p.f(g);p.c((p.data=g).auth)},p.b=function(g){var N=(p.list=(p.list||[]).concat(g||[])).shift();if(_===N){if(p.name)return p.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(u&&v--){C.get("~@"+u).once(p.a);return}return p.err("Wrong user or password.")}C.get(N).once(p.a)},p.c=function(g){if(_===g)return p.b();if(typeof g=="string")return p.c(i(g));r.work(m,(p.auth=g).s,p.d,p.enc)},p.d=function(g){r.decrypt(p.auth.ek,g,p.e,p.enc)},p.e=function(g){if(_===g)return p.enc?(p.enc=null,p.b()):(p.enc={encode:"utf8"},p.c(p.auth));p.half=g,p.f(p.data)},p.f=function(g){var N=p.half||{},b=p.data||{};p.g(p.lol={pub:g.pub||b.pub,epub:g.epub||b.epub,priv:g.priv||N.priv,epriv:g.epriv||N.epriv})},p.g=function(g){if(!g||!g.pub||!g.epub)return p.b();p.pair=g;var N=C._.user,b=N._;b.tag;var A=b.opt;b=N._=C.get("~"+g.pub)._,b.opt=A,N.is={pub:g.pub,epub:g.epub,alias:u||g.pub},b.sea=p.pair,x.ing=!1;try{m&&_==(i(x.root.graph["~"+g.pub].auth)||"")[":"]&&(l.shuffle=l.change=m)}catch{}if(l.change?p.z():(k||f)(b),r.window&&(j.back("user")._.opt||l).remember)try{var F={};F=r.window.sessionStorage,F.recall=!0,F.pair=JSON.stringify(g)}catch{}try{C._.tag.auth?C._.on("auth",b):setTimeout(function(){C._.on("auth",b)},1)}catch($){n.log("Your 'auth' callback crashed with:",$)}},p.h=function(g){if(!g)return p.b();if(u=g.alias,u||(u=g.alias="~"+h.pub),!g.auth)return p.g(h);h=null,p.c((p.data=g).auth)},p.z=function(){p.salt=String.random(64),r.work(l.change,p.salt,p.y)},p.y=function(g){r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},g,p.x,{raw:1})},p.x=function(g){p.w(JSON.stringify({ek:g,s:p.salt}))},p.w=function(g){if(l.shuffle){console.log("migrate core account from UTF8 & shuffle");var N={};Object.keys(p.data).forEach(function(b){N[b]=p.data[b]}),delete N._,N.auth=g,C.get("~"+p.pair.pub).put(N)}C.get("~"+p.pair.pub).get("auth").put(g,k||f)},p.err=function(g){var N={err:n.log(g||"User cannot be found!")};x.ing=!1,(k||f)(N)},p.plugin=function(g){if(!(p.name=g))return p.err();var N=[g];g[0]!=="~"&&(N[1]="~"+g,N[2]="~@"+g),p.b(N)},h?h.priv&&h.epriv?p.g(h):C.get("~"+h.pub).once(p.h):u?C.get("~@"+u).once(p.a):!u&&!m&&r.name(p.plugin),j};function i(d){if(typeof d!="string")return d;try{d=JSON.parse(d)}catch{d={}}return d}})(t,"./auth"),t(function(o){var s=t("./user"),r=s.SEA;s.GUN,s.prototype.recall=function(n,f){var i=this,d=i.back(-1);if(n=n||{},n&&n.sessionStorage){if(r.window)try{var h={};h=r.window.sessionStorage,h&&(d._.opt.remember=!0,(i.back("user")._.opt||n).remember=!0,(h.recall||h.pair)&&d.user().auth(JSON.parse(h.pair),f))}catch{}return i}return i}})(t,"./recall"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,f=function(){};s.prototype.pair=function(){var i=this,d;try{d=new Proxy({DANGER:"☠"},{get:function(h,u,m){if(!(!i.is||!(i._||"").sea))return i._.sea[u]}})}catch{}return d},s.prototype.delete=async function(i,d,h){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var u=this;u.back(-1);var m=u.back("user");try{m.auth(i,d,function(k){var l=(m.is||{}).pub;m.map().once(function(){this.put(null)}),m.leave(),(h||f)({ok:0})})}catch(k){n.log("User.delete failed! Error:",k)}return u},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const i=this.back(-1);try{return await authRecall(i),i._.user._}catch{const h="No session!";throw n.log(h),{err:h}}},s.prototype.trust=async function(i){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),n.is(i)&&i.get("pub").get((d,h)=>{console.log(d,h)}),i.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(i,d){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,u=h.back(-1).user(),m=u._.sea,k="";return h.back(function(l){l.is||(k+=l.get||"")}),async function(){var l,j=await u.get("grant").get(m.pub).get(k).then();j=await r.decrypt(j,m),j||(j=r.random(16).toString(),l=await r.encrypt(j,m),u.get("grant").get(m.pub).get(k).put(l));var x=i.get("pub").then(),C=i.get("epub").then();x=await x,C=await C;var p=await r.secret(C,m);l=await r.encrypt(j,p),u.get("grant").get(x).get(k).put(l,d)}(),h},s.prototype.secret=function(i,d){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,u=h.back(-1).user(),m=u.pair(),k="";return h.back(function(l){l.is||(k+=l.get||"")}),async function(){var l,j=await u.get("trust").get(m.pub).get(k).then();j=await r.decrypt(j,m),j||(j=r.random(16).toString(),l=await r.encrypt(j,m),u.get("trust").get(m.pub).get(k).put(l)),l=await r.encrypt(i,j),h.put(l,d)}(),h},o.exports=s})(t,"./share"),t(function(o){var s=t("./sea"),r=t("./settings"),n,f=(s.window||"").GUN||t((""+n==typeof a?".":"")+"./gun",1);f.on("opt",function(l){l.sea||(l.sea={own:{}},l.on("put",i,l)),this.to.next(l)});function i(l){var j=this,x=j.as,C=l.put,p=C["#"],_=C["."],v=C[":"],g=C[">"],N=l["#"],b;if(!(!p||!_)){if((l._||"").faith&&(x.opt||"").faith&&typeof l._=="function"){s.opt.pack(C,function(F){s.verify(F,!1,function($){C["="]=s.opt.unpack($),j.to.next(l)})});return}var A=function(F){x.on("in",{"@":N,err:l.err=F})};if((l._||"").DBG&&((l._||"").DBG.c=+new Date),0<=p.indexOf("<?")&&(b=parseFloat(p.split("<?")[1]||""),b&&g<f.state()-b*1e3)){(b=l._)&&b.stun&&b.stun--;return}if(p==="~@"){i.alias(j,l,v,_,p,x,A);return}if(p.slice(0,2)==="~@"){i.pubs(j,l,v,_,p,x,A);return}if(b=s.opt.pub(p)){i.pub(j,l,v,_,p,x,A,x.user||"",b);return}if(0<=p.indexOf("#")){i.hash(j,l,v,_,p,x,A);return}i.any(j,l,v,_,p,x,A,x.user||"")}}i.hash=function(l,j,x,C,p,_,v){s.work(x,null,function(g){function N(b){let A="";for(let F=0;F<b.length;F++)A+=F-1&1?"":String.fromCharCode(parseInt(b.substring(F-1,F+1),16));return btoa(A)}if(g&&g===C.split("#").slice(-1)[0])return l.to.next(j);if(g&&g===N(C.split("#").slice(-1)[0]))return l.to.next(j);v("Data hash not same as hash!")},{name:"SHA-256"})},i.alias=function(l,j,x,C,p,_,v){if(!x)return v("Data must exist!");if("~@"+C===h(x))return l.to.next(j);v("Alias not same!")},i.pubs=function(l,j,x,C,p,_,v){if(!x)return v("Alias must exist!");if(C===h(x))return l.to.next(j);v("Alias not same!")},i.pub=async function(l,j,x,C,p,_,v,g,N){var b;const A=await r.parse(x)||{},F=($,G,T)=>{if($.m&&$.s&&G&&N)return s.verify($,N,I=>{if(n!==I&&n!==I.e&&j.put[">"]&&j.put[">"]>parseFloat(I.e))return v("Certificate expired.");if(n!==I&&I.c&&I.w&&(I.c===G||I.c.indexOf("*")>-1)){let w=p.indexOf("/")>-1?p.replace(p.substring(0,p.indexOf("/")+1),""):"";String.match=String.match||f.text.match;const O=Array.isArray(I.w)?I.w:typeof I.w=="object"||typeof I.w=="string"?[I.w]:[];for(const y of O)if(String.match(w,y["#"])&&String.match(C,y["."])||!y["."]&&String.match(w,y["#"])||!y["#"]&&String.match(C,y["."])||String.match(w?w+"/"+C:C,y["#"]||y)){if(y["+"]&&y["+"].indexOf("*")>-1&&w&&w.indexOf(G)==-1&&C.indexOf(G)==-1)return v(`Path "${w}" or key "${C}" must contain string "${G}".`);if(I.wb&&(typeof I.wb=="string"||(I.wb||{})["#"])){var U=l.as.root.$.back(-1);return typeof I.wb=="string"&&I.wb.slice(0,1)!=="~"&&(U=U.get("~"+N)),U.get(I.wb).get(G).once(P=>P&&(P===1||P===!0)?v(`Certificant ${G} blocked.`):T(I))}return T(I)}return v("Certificate verification fail.")}})};if(C==="pub"&&"~"+N===p)return x===N?l.to.next(j):v("Account not same!");if((b=g.is)&&b.pub&&!A["*"]&&!A["+"]&&(N===b.pub||N!==b.pub&&((j._.msg||{}).opt||{}).cert)){s.opt.pack(j.put,$=>{s.sign($,g._.sea,async function(G){if(n===G)return v(s.err||"Signature fail.");if(j.put[":"]={":":b=s.opt.unpack(G.m),"~":G.s},j.put["="]=b,N===g.is.pub){(b=h(x))&&((_.sea.own[b]=_.sea.own[b]||{})[N]=1),JSON.stringifyAsync(j.put[":"],function(T,I){return T?v(T||"Stringify error."):(j.put[":"]=I,l.to.next(j))});return}if(N!==g.is.pub&&((j._.msg||{}).opt||{}).cert){const T=await r.parse(j._.msg.opt.cert);T&&T.m&&T.s&&F(T,g.is.pub,I=>{j.put[":"]["+"]=T,j.put[":"]["*"]=g.is.pub,JSON.stringifyAsync(j.put[":"],function(U,w){return U?v(U||"Stringify error."):(j.put[":"]=w,l.to.next(j))})})}},{raw:1})});return}s.opt.pack(j.put,$=>{s.verify($,A["*"]||N,function(G){var T;if(G=s.opt.unpack(G),n===G)return v("Unverified data.");if((T=h(G))&&N===s.opt.pub(T)&&((_.sea.own[T]=_.sea.own[T]||{})[N]=1),A["+"]&&A["+"].m&&A["+"].s&&A["*"])F(A["+"],A["*"],I=>(j.put["="]=G,l.to.next(j)));else return j.put["="]=G,l.to.next(j)})})},i.any=function(l,j,x,C,p,_,v,g){if(_.opt.secure)return v("Soul missing public key at '"+C+"'.");_.on("secure",function(N){if(this.off(),!_.opt.secure)return l.to.next(N);v("Data cannot be changed.")}).on.on("secure",j)};var d=f.valid,h=function(l,j){return typeof(j=d(l))=="string"&&j};(f.state||"").ify;var u=/[^\w_-]/;s.opt.pub=function(l){if(l&&(l=l.split("~"),!(!l||!(l=l[1]))&&(l=l.split(u).slice(0,2),!(!l||l.length!=2)&&(l[0]||"")[0]!=="@")))return l=l.slice(0,2).join("."),l},s.opt.stringy=function(l){},s.opt.pack=function(l,j,x,C,p){var _,v;if(s.opt.check(l))return j(l);l&&l["#"]&&l["."]&&l[">"]&&(_=l[":"],v=1),JSON.parseAsync(v?_:l,function(g,N){var b=n!==(N||"")[":"]&&(N||"")["~"];if(!b){j(l);return}j({m:{"#":p||l["#"],".":x||l["."],":":(N||"")[":"],">":l[">"]||f.state.is(C,x)},s:b})})};var m=s.opt;s.opt.unpack=function(l,j,x){var C;if(n!==l){if(l&&n!==(C=l[":"]))return C;if(j=j||m.fall_key,!x&&m.fall_val&&(x={},x[j]=m.fall_val),!(!j||!x)){if(l===x[j]||!s.opt.check(x[j]))return l;var p=x&&x._&&x._["#"]||m.fall_soul,_=f.state.is(x,j)||m.fall_state;if(l&&l.length===4&&p===l[0]&&j===l[1]&&k(_)===k(l[3]))return l[2];if(_<s.opt.shuffle_attack)return l}}},s.opt.shuffle_attack=15463296e5;var k=Math.floor})(t,"./index")})()}(Re)),Re.exports}Ts();var mt={},ht;function As(){if(ht)return mt;ht=1;var c=typeof window<"u"?window.Gun:ts();return c.chain.promise=function(o){var a=this,o=o||function(s){return s};return new Promise(function(s,r){a.once(function(n,f){s({put:n,get:f,gun:this})})}).then(o)},c.chain.then=function(t){var a=this,o=new Promise((s,r)=>{a.once(function(n,f){s(n,f)})});return t?o.then(t):o},mt}As();console.log("🔫 GunJS service file loading...");console.log("🔫 Imported Gun:",typeof re);console.log("🔫 After importing gun/sea and gun/lib/then");console.log("🔫 Gun.SEA is available:",!!re.SEA);re.SEA?(console.log("🔫 ✅ Gun.SEA is properly initialized"),console.log("🔫 Gun.SEA methods:",re.SEA?Object.keys(re.SEA):"undefined")):(console.error("🔫 CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("🔫 Will check SEA availability after Gun instance creation..."));console.log("🔫 About to initialize Gun instance...");const X=re({peers:["https://gun-ad4i.onrender.com/gun","https://bewildered-dulcy-amend09-294cb39e.koyeb.app/gun","https://amend09.hackclub.app/gun"]});console.log("🔫 GunJS initialized with Render peer and Nest peer");console.log("🔫 Gun instance created:",typeof X);console.log("🔫 Gun instance properties:",Object.keys(X));console.log("🔫 Checking Gun.SEA after instance creation:",!!re.SEA);X.SEA&&(console.log("🔫 Found SEA on gun instance:",!!X.SEA),re.SEA=X.SEA);console.log("🔫 Testing gun.user() method availability...");typeof X.user=="function"?console.log("🔫 ✅ gun.user() method is available"):(console.error("🔫 ❌ gun.user() method is NOT available"),console.error("🔫 Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(X))));X.on("hi",c=>{console.log("🔫 GunJS: Connected to peer",c)});X.on("bye",c=>{console.log("🔫 GunJS: Disconnected from peer",c)});X.on("out",c=>{c&&c.err&&console.warn("🔫 GunJS: Connection error:",c.err)});setTimeout(()=>{console.log("🔫 GunJS connection test - gun object:",X),console.log("🔫 GunJS internal state:",X._),X.get("test").put({hello:"world",timestamp:Date.now()}),console.log("🔫 GunJS: Test data written")},2e3);console.log("🔫 Creating user instance...");let ie;try{ie=X.user(),console.log("🔫 ✅ User instance created successfully:",typeof ie),console.log("🔫 User instance properties:",Object.keys(ie)),typeof ie.create=="function"?console.log("🔫 ✅ user.create() method is available"):console.error("🔫 ❌ user.create() method is NOT available"),typeof ie.auth=="function"?console.log("🔫 ✅ user.auth() method is available"):console.error("🔫 ❌ user.auth() method is NOT available")}catch(c){console.error("🔫 ❌ FAILED to create user instance:",c),console.error("🔫 This confirms that SEA is not properly loaded"),ie={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const Oe=re.SEA;console.log("🔫 SEA reference:",typeof Oe);Oe&&typeof Oe.encrypt=="function"?console.log("🔫 ✅ SEA.encrypt() method is available"):(console.error("🔫 ❌ SEA.encrypt() method is NOT available"),console.error("🔫 Final Gun.SEA status:",re.SEA));class Es{constructor(){we(this,"gun");we(this,"user");we(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=X,this.user=ie,this.SEA=Oe,console.log("GunJS: GunService initialized")}async signUp(t,a){return console.log("🔫 GunJS: Attempting to sign up user:",t),new Promise(o=>{if(a.length<8){console.log("🔫 GunJS: Password too short"),o({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("🔫 GunJS: Sign up timed out"),o({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,a,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign up response:",r),r.err){console.log("🔫 GunJS: Sign up error:",r.err),o({success:!1,error:r.err});return}this.user.auth(t,a,n=>{if(!n.err){const f={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(f,()=>{console.log("🔫 GunJS: Initial profile created with original username"),this.addToPublicUsersIndex(t,t),this.user.leave()})}}),console.log("🔫 GunJS: Sign up successful"),o({success:!0})})})}async signIn(t,a){return console.log("🔫 GunJS: Attempting to sign in user:",t),new Promise(o=>{const s=setTimeout(()=>{console.log("🔫 GunJS: Sign in timed out"),o({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,a,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign in response:",r),r.err){console.log("🔫 GunJS: Sign in error:",r.err),o({success:!1,error:r.err});return}console.log("🔫 GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(n=>{if(!(n!=null&&n.originalUsername)){console.log("🔫 GunJS: Storing original username in profile");const f={...n,originalUsername:t,favoriteGenres:(n==null?void 0:n.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(f)}this.addToPublicUsersIndex(t,(n==null?void 0:n.displayName)||t)}),o({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}addToPublicUsersIndex(t,a){console.log("🔫 GunJS: Adding user to public index:",t,a);try{const o={originalUsername:t,displayName:a,addedAt:new Date().toISOString()};this.gun.get("publicUsers").get(t).put(o,s=>{s.err?console.error("🔫 GunJS: Error adding user to public index:",s.err):console.log("🔫 GunJS: User successfully added to public index")})}catch(o){console.error("🔫 GunJS: Exception in addToPublicUsersIndex:",o)}}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const a=setTimeout(()=>{console.log("🔫 GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(a),this.user.is?(console.log("🔫 GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(o=>{const s=(o==null?void 0:o.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("🔫 GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}const o=setTimeout(()=>{console.log("🔫 GunJS: updateProfile timed out"),a({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("🔫 GunJS: Existing profile:",s);const r=(s==null?void 0:s.originalUsername)||this.user.is.alias,n={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:r};console.log("🔫 GunJS: Updating profile with Gun-compatible data:",n),this.user.get("profile").put(n,f=>{if(clearTimeout(o),console.log("🔫 GunJS: Profile update response:",f),f.err){console.log("🔫 GunJS: Profile update error:",f.err),a({success:!1,error:f.err});return}console.log("🔫 GunJS: Profile updated successfully"),this.user.get("profile").once(i=>{console.log("🔫 GunJS: Profile after update:",i),a({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=setTimeout(()=>{console.log("🔫 GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(o=>{if(clearTimeout(a),console.log("🔫 GunJS: Raw profile loaded:",o),o){const s={displayName:o.displayName||"",bio:o.bio||"",favoriteGenres:o.favoriteGenres?JSON.parse(o.favoriteGenres):[],readingGoal:o.readingGoal||12,joinedDate:o.joinedDate,lastUpdated:o.lastUpdated,originalUsername:o.originalUsername};console.log("🔫 GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(a=>{t({success:!0,books:a||[]})})})}async syncUserNotes(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(a=>{t({success:!0,notes:a||[]})})})}async syncUserSessions(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(a=>{t({success:!0,sessions:a||[]})})})}async syncPetData(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(a=>{t({success:!0,petData:a||null})})})}async syncPetShopData(t,a){return new Promise(o=>{if(!this.user.is){o({success:!1,error:"User not authenticated"});return}const s=setTimeout(()=>{o({success:!1,error:"Sync timeout"})},5e3),r={pet:t,inventory:a,lastUpdate:new Date().toISOString()};this.user.get("petShop").put(r,n=>{clearTimeout(s),n.err?(console.error("🔫 GunJS: Error syncing pet shop data:",n.err),o({success:!1,error:n.err})):(console.log("🔫 GunJS: Pet shop data synced successfully"),o({success:!0}))})})}async getPetShopData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=setTimeout(()=>{t({success:!1,error:"Get timeout"})},3e3);this.user.get("petShop").once(o=>{clearTimeout(a),o&&o.pet?t({success:!0,petData:o.pet,inventory:o.inventory||[]}):t({success:!1,error:"No pet shop data found"})})})}async trackPetActivity(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const a=`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:a,userId:this.user.is.pub,username:this.user.is.alias||"Unknown User",...t,createdAt:new Date().toISOString()};return this.user.get("petActivities").get(a).put(o),(t.type==="evolved"||t.type==="died"||t.type==="revived")&&this.gun.get("publicPetActivities").get(a).put(o),{success:!0}}catch(a){return console.error("🔫 GunJS: Error tracking pet activity:",a),{success:!1,error:"Failed to track pet activity"}}}async getFriendsPetActivities(t){return new Promise(a=>{const o=[];let s=0;const r=setTimeout(()=>{a({success:!0,activities:o.sort((n,f)=>new Date(f.createdAt).getTime()-new Date(n.createdAt).getTime()).slice(0,20)})},5e3);if(t.length===0){clearTimeout(r),a({success:!0,activities:[]});return}t.forEach(n=>{this.gun.get("users").get(n).get("petActivities").once(f=>{f&&Object.values(f).forEach(i=>{i&&i.id&&i.createdAt&&o.push(i)}),s++,s===t.length&&(clearTimeout(r),a({success:!0,activities:o.sort((i,d)=>new Date(d.createdAt).getTime()-new Date(i.createdAt).getTime()).slice(0,20)}))})})})}}const H=new Es;class Ps{constructor(){we(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,a){if(H.isAuthenticated()&&this.isOnline)try{await H.syncUserData(t,a)}catch(o){console.warn("Failed to sync data to server:",o)}}async getData(t,a){if(H.isAuthenticated()&&this.isOnline)try{const s=await H.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const o=localStorage.getItem(`bookish_${t}`);return o?JSON.parse(o):a}setLocalStorage(t,a){localStorage.setItem(`bookish_${t}`,JSON.stringify(a))}async syncPendingChanges(){if(!H.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const a of t)try{const o=localStorage.getItem(`bookish_${a}`);o&&await H.syncUserData(a,JSON.parse(o))}catch(o){console.warn(`Failed to sync ${a}:`,o)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!H.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const a of t)try{const o=a.getter();o!==null&&(Array.isArray(o)?o.length>0:Object.keys(o).length>0)&&await H.syncUserData(a.key,o)}catch(o){console.warn(`Failed to migrate ${a.key}:`,o)}}}const K=new Ps,_s=Object.freeze(Object.defineProperty({__proto__:null,default:K,syncedStorage:K},Symbol.toStringTag,{value:"Module"})),Ds="modulepreload",Bs=function(c){return"/Bookish/"+c},ft={},Ke=function(t,a,o){let s=Promise.resolve();if(a&&a.length>0){let n=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),i=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=n(a.map(d=>{if(d=Bs(d),d in ft)return;ft[d]=!0;const h=d.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":Ds,h||(m.as="script"),m.crossOrigin="",m.href=d,i&&m.setAttribute("nonce",i),document.head.appendChild(m),h)return new Promise((k,l)=>{m.addEventListener("load",k),m.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(n){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=n,window.dispatchEvent(f),!f.defaultPrevented)throw n}return s.then(n=>{for(const f of n||[])f.status==="rejected"&&r(f.reason);return t().catch(r)})},ue="https://openlibrary.org",Rs=async c=>{try{return(await(await fetch(`${ue}/search.json?q=${encodeURIComponent(c)}&limit=10`)).json()).docs.map(o=>({key:o.key,title:o.title,author_name:o.author_name,cover_i:o.cover_i,first_publish_year:o.first_publish_year,number_of_pages_median:o.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},Is=async c=>{var t,a;try{const o=c.replace("/works/",""),r=await(await fetch(`${ue}/works/${o}.json`)).json();let n=r.number_of_pages_median;!n&&r.editions&&(n=await Fs(r.editions)),n||(n=await Us(o));let f=[];if(r.authors&&r.authors.length>0){const i=r.authors.slice(0,3).map(async h=>{try{return(await(await fetch(`${ue}${h.author.key}.json`)).json()).name}catch{return null}});f=(await Promise.all(i)).filter(h=>h!==null)}return{key:r.key,title:r.title,author_name:f,cover_i:(t=r.covers)==null?void 0:t[0],first_publish_year:r.first_publish_year,description:((a=r.description)==null?void 0:a.value)||r.description||"",number_of_pages_median:n}}catch(o){return console.error("Error fetching book details:",o),null}},Fs=async c=>{try{if(!c||!c.entries||c.entries.length===0)return;for(const t of c.entries.slice(0,3))try{const o=await(await fetch(`${ue}${t.key}.json`)).json();if(o.number_of_pages)return o.number_of_pages}catch(a){console.error("Error fetching edition:",a);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},Us=async c=>{try{const a=await(await fetch(`${ue}/works/${c}/editions.json?limit=5`)).json();if(a.entries&&a.entries.length>0){for(const o of a.entries)if(o.number_of_pages)return o.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},Os=c=>{const t=new Date().getFullYear(),a=c.first_publish_year||t;return a<1900?320:a<1950?280:a<2e3?250:220},Ls=(c,t="M")=>c?`https://covers.openlibrary.org/b/id/${c}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",Ms=async c=>{var t;try{return((t=(await(await fetch(`${ue}/subjects/${encodeURIComponent(c.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var r;return{key:s.key,title:s.title,author_name:((r=s.authors)==null?void 0:r.map(n=>n.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(a){return console.error("Error searching books by subject:",a),[]}},Gs=async c=>{var t,a;try{const o=c.replace(/[-\s]/g,""),s=await fetch(`${ue}/isbn/${o}.json`);if(!s.ok)return null;const r=await s.json();return{key:r.key,title:r.title,author_name:((t=r.authors)==null?void 0:t.map(n=>n.name))||[],cover_i:(a=r.covers)==null?void 0:a[0],first_publish_year:r.publish_date?new Date(r.publish_date).getFullYear():void 0,number_of_pages_median:r.number_of_pages}}catch(o){return console.error("Error searching book by ISBN:",o),null}},$s="bookish_books",Js="bookish_reading_sessions",Et="bookish_stats",qs="bookish_streak",Ve="bookish_cached_books",je=(c,t)=>{const a=localStorage.getItem(c);return a?JSON.parse(a):t},Pt=(c,t)=>{localStorage.setItem(c,JSON.stringify(t))},Hs=()=>je($s,[]),_t=c=>je(Ve,{})[c]||null,xt=c=>{const t=je(Ve,{});t[c.key]={...c,cached_at:new Date().toISOString()},Pt(Ve,t)},Ge=()=>je(Js,[]),gt=c=>Ge().filter(t=>t.bookId===c),Ys=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),Ce=()=>je(Et,Ys()),zs=()=>{const c=Ge(),t=Hs(),a=c.reduce((m,k)=>m+(k.duration||0),0),o=new Date().setHours(0,0,0,0),s=c.reduce((m,k)=>new Date(k.startTime).setHours(0,0,0,0)===o?m+(k.duration||0):m,0),r=new Date;r.setDate(r.getDate()-r.getDay()),r.setHours(0,0,0,0);const n=c.reduce((m,k)=>new Date(k.startTime)>=r?m+(k.duration||0):m,0),f=c.reduce((m,k)=>{const l=(k.endPage||0)-(k.startPage||0);return m+Math.max(0,l)},0),i=new Date(new Date().getFullYear(),0,1),d=new Set;c.forEach(m=>{if(new Date(m.startTime)>=i&&m.endPage){const l=t.find(j=>j.key===m.bookId);if(l){const j=l.number_of_pages_median;if(j&&m.endPage>=j)d.add(m.bookId);else if(!j){const x=Os(l);m.endPage>=x*.9&&d.add(m.bookId)}}}}),JSON.parse(localStorage.getItem("bookish_books")||"[]").forEach(m=>{m.category==="completed"&&d.add(m.key)});const u={totalBooksRead:d.size,totalPagesRead:f,totalReadingTime:a,readingTimeToday:s,readingTimeThisWeek:n,booksFinishedThisYear:d.size};Pt(Et,u),window.dispatchEvent(new CustomEvent("statsUpdated",{detail:u}))},Ie=async()=>{zs();const c=Ce();try{const{default:t}=await Ke(async()=>{const{default:a}=await Promise.resolve().then(()=>_s);return{default:a}},void 0);await t.saveStats(c)}catch(t){console.warn("Failed to sync stats to remote storage:",t)}return c},Ws=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),ye=()=>je(qs,Ws()),oe={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet",USER_SETTINGS:"bookish-user-settings"};class ce{static get(t){try{const a=localStorage.getItem(t);return a?JSON.parse(a):null}catch(a){return console.error("Error reading from localStorage:",a),null}}static set(t,a){try{return localStorage.setItem(t,JSON.stringify(a)),!0}catch(o){return console.error("Error writing to localStorage:",o),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(a){return console.error("Error removing from localStorage:",a),!1}}static clear(){try{return Object.values(oe).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(oe.GUEST_PROFILE)}static setGuestProfile(t){return this.set(oe.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(oe.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(oe.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(oe.GUEST_PET)}static setGuestPet(t){return this.set(oe.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}static getUserSettings(){return this.get(oe.USER_SETTINGS)}static saveUserSettings(t){return this.set(oe.USER_SETTINGS,{...t,lastUpdated:new Date().toISOString()})}}const Dt=E.createContext(void 0),Ks={isAuthenticated:!1,user:null,isLoading:!0,error:null},Vs=(c,t)=>{switch(t.type){case"AUTH_START":return{...c,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...c,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...c,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...c,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...c,error:null};case"UPDATE_USER":return{...c,user:c.user?{...c.user,...t.payload}:null};default:return c}},Qs=({children:c})=>{const[t,a]=E.useReducer(Vs,Ks);E.useEffect(()=>{(async()=>{var u;try{const m=new Promise((j,x)=>setTimeout(()=>x(new Error("Authentication check timeout")),5e3)),k=H.recallUser(),l=await Promise.race([k,m]);if(l&&l.success&&l.user){const j=new Promise((x,C)=>setTimeout(()=>C(new Error("Profile load timeout")),3e3));try{const x=await Promise.race([H.getProfile(),j]),C={...l.user,username:x!=null&&x.success&&((u=x==null?void 0:x.profile)!=null&&u.originalUsername)?x.profile.originalUsername:l.user.username||"Unknown User",profile:x&&x.success?x.profile:void 0};a({type:"AUTH_SUCCESS",payload:C})}catch{const C={...l.user,username:l.user.username||"Unknown User",profile:void 0};a({type:"AUTH_SUCCESS",payload:C})}}else a({type:"AUTH_FAILURE",payload:""})}catch(m){console.log("GunJS auth check failed (servers may be down):",m),a({type:"AUTH_FAILURE",payload:""})}})()},[]);const d={...t,signIn:async(h,u)=>{a({type:"AUTH_START"});try{const m=await H.signIn(h,u);if(m.success&&m.user){const k=await H.getProfile(),l={...m.user,username:h,profile:k.success?k.profile:void 0};return a({type:"AUTH_SUCCESS",payload:l}),{success:!0}}else return a({type:"AUTH_FAILURE",payload:m.error||"Sign in failed"}),{success:!1,error:m.error}}catch{const k="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:k}),{success:!1,error:k}}},signUp:async(h,u)=>{a({type:"AUTH_START"});try{const m=await H.signUp(h,u);return m.success?(a({type:"AUTH_FAILURE",payload:""}),{success:!0}):(a({type:"AUTH_FAILURE",payload:m.error||"Sign up failed"}),{success:!1,error:m.error})}catch{const k="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:k}),{success:!1,error:k}}},signOut:()=>{H.signOut(),a({type:"SIGN_OUT"})},updateProfile:async h=>{console.log("AuthContext: updateProfile called with:",h);try{const u=await H.updateProfile(h);return console.log("AuthContext: gunService.updateProfile result:",u),u.success?(console.log("AuthContext: Updating user state with profile:",h),a({type:"UPDATE_USER",payload:{profile:h}}),{success:!0}):(console.log("AuthContext: Profile update failed:",u.error),{success:!1,error:u.error})}catch(u){return console.error("AuthContext: Profile update error:",u),{success:!1,error:"Failed to update profile"}}},clearError:()=>{a({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let h={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const u=ce.getGuestProfile();u&&(h={displayName:u.displayName||"Guest User",bio:u.bio||"Browsing as a guest",favoriteGenres:u.favoriteGenres||[],readingGoal:u.readingGoal||0});const m={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:h};a({type:"AUTH_SUCCESS",payload:m})}};return e.jsx(Dt.Provider,{value:d,children:c})},ne=()=>{const c=E.useContext(Dt);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},Bt=E.createContext(void 0),me=()=>{const c=E.useContext(Bt);if(!c)throw new Error("useBooks must be used within a BookProvider");return c},Xs=({children:c})=>{const{user:t}=ne(),[a,o]=E.useState([]),[s,r]=E.useState(null),[n,f]=E.useState([]),[i,d]=E.useState([]);E.useEffect(()=>{(async()=>{const b=(await K.getBooks()).map(F=>{const $=_t(F.key);return $?{...F,...$}:F});o(b);const A=await K.getCurrentBook();r(A)})()},[]),E.useEffect(()=>{(async()=>{if(s){const N=await K.getReadingSessions(),b=await K.getNotes();f(N.filter(A=>A.bookId===s.key)),d(b.filter(A=>A.bookId===s.key))}else f([]),d([])})()},[s]);const h=async g=>{const N=[...a],b=N.findIndex($=>$.key===g.key),A=b>=0&&N[b].category==="completed",F=g.category==="completed";if(b>=0?N[b]=g:N.push(g),o(N),await K.saveBooks(N),!A&&F)try{await H.publishActivity({type:"book_completed",title:"Completed a book!",description:`Just finished reading "${g.title}"`,bookTitle:g.title,bookCover:g.cover_i?`https://covers.openlibrary.org/b/id/${g.cover_i}-S.jpg`:void 0,metadata:{pagesRead:g.number_of_pages_median||200}}),console.log("📚 Published book completion activity:",g.title),await u()}catch($){console.error("Error publishing book completion activity:",$)}await Ie()},u=async()=>{try{console.log("📊 Updating public stats after book completion...");const g=JSON.parse(localStorage.getItem("bookish_books")||"[]"),N=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]");console.log("📊 Local books data:",g),console.log("📊 Local sessions data:",N);const b=g.filter(I=>I.category==="completed");console.log("📊 Completed books count:",b.length);const A=N.reduce((I,U)=>I+(U.duration||0),0),F=N.reduce((I,U)=>{const w=(U.endPage||0)-(U.startPage||0);return I+Math.max(0,w)},0),$=m(N),G={totalBooksRead:b.length,totalPagesRead:Math.max(F,b.length*200),totalReadingTime:A,currentStreak:$};console.log("📊 Calculated stats:",G);const T=await H.updatePublicStats(G);T.success?(console.log("✅ Public stats updated successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("publicStatsUpdated",{detail:{userId:t==null?void 0:t.id,stats:G}}))},1e3)):console.error("❌ Failed to update public stats:",T.error)}catch(g){console.error("❌ Error updating public stats:",g)}},m=g=>{if(!g.length)return 0;const N=g.map($=>new Date($.startTime).toDateString()).filter(($,G,T)=>T.indexOf($)===G).sort(($,G)=>new Date(G).getTime()-new Date($).getTime());let b=0;const A=new Date().toDateString(),F=new Date(Date.now()-864e5).toDateString();if(N[0]===A||N[0]===F){b=1;for(let $=1;$<N.length;$++){const G=new Date(N[$]);if((new Date(N[$-1]).getTime()-G.getTime())/(1e3*60*60*24)===1)b++;else break}}return b},k=async g=>{const N=a.filter(G=>G.key!==g);o(N),await K.saveBooks(N);const b=await K.getReadingSessions(),A=await K.getNotes(),F=b.filter(G=>G.bookId!==g),$=A.filter(G=>G.bookId!==g);await K.saveReadingSessions(F),await K.saveNotes($),s&&s.key===g&&(r(null),await K.setCurrentBook(null)),await Ie()},l=async g=>{r(g),await K.setCurrentBook(g)},j=async g=>{const N=await K.getReadingSessions(),b=N.findIndex(A=>A.id===g.id);if(b>=0?N[b]=g:N.push(g),await K.saveReadingSessions(N),s&&g.bookId===s.key&&f(N.filter(A=>A.bookId===s.key)),await Ie(),g.duration&&g.duration>=15)try{const A=a.find($=>$.key===g.bookId),F=g.endPage&&g.startPage?g.endPage-g.startPage:0;await H.publishActivity({type:"reading_session",title:"Had a reading session",description:`Read for ${g.duration} minutes${A?` in "${A.title}"`:""}`,bookTitle:A==null?void 0:A.title,bookCover:A!=null&&A.cover_i?`https://covers.openlibrary.org/b/id/${A.cover_i}-S.jpg`:void 0,metadata:{duration:g.duration,pagesRead:Math.max(0,F)}}),console.log("📖 Published reading session activity:",g.duration,"minutes"),await u()}catch(A){console.error("Error publishing reading session activity:",A)}},x=async g=>{const b=[...await K.getNotes(),g];await K.saveNotes(b),s&&g.bookId===s.key&&d(b.filter(A=>A.bookId===s.key))},C=async g=>{const b=(await K.getNotes()).map(A=>A.id===g.id?g:A);await K.saveNotes(b),s&&g.bookId===s.key&&d(b.filter(A=>A.bookId===s.key))},p=async g=>{const b=(await K.getNotes()).filter(A=>A.id!==g);await K.saveNotes(b),s&&d(b.filter(A=>A.bookId===s.key))},_=async()=>{try{const g=a.filter(G=>G.category==="completed"),N=n.reduce((G,T)=>G+(T.duration||0),0),b=n.reduce((G,T)=>{const I=(T.endPage||0)-(T.startPage||0);return G+Math.max(0,I)},0),F=(G=>{if(!G.length)return 0;const T=G.map(O=>new Date(O.startTime).toDateString()).filter((O,y,P)=>P.indexOf(O)===y).sort((O,y)=>new Date(y).getTime()-new Date(O).getTime());let I=0;const U=new Date().toDateString(),w=new Date(Date.now()-864e5).toDateString();if(T[0]===U||T[0]===w){I=1;for(let O=1;O<T.length;O++){const y=new Date(T[O]);if((new Date(T[O-1]).getTime()-y.getTime())/(1e3*60*60*24)===1)I++;else break}}return I})(n),$={totalBooksRead:g.length,totalPagesRead:Math.max(b,g.length*200),totalReadingTime:N,currentStreak:F};await H.updatePublicStats($)}catch(g){console.error("Error updating public stats:",g)}};E.useEffect(()=>{(a.length>0||n.length>0)&&_()},[a,n]);const v={books:a,currentBook:s,sessions:n,notes:i,addBook:h,removeBook:k,setActiveBook:l,addSession:j,addNote:x,updateNote:C,deleteNote:p,updatePublicStatsAfterBookCompletion:u};return bt.useEffect(()=>{window.debugUpdateStats=u},[]),e.jsx(Bt.Provider,{value:v,children:c})},Rt=E.createContext(void 0),le=()=>{const c=E.useContext(Rt);if(!c)throw new Error("usePet must be used within a PetProvider");return c},Qe=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content",isAlive:!0,sickness:0,cleanliness:100,inventory:[],unlockedItems:["basic_food","water","soap"]}),It=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),Zs=()=>{try{const c=localStorage.getItem("bookish_pet");if(c){const t=JSON.parse(c);return{...Qe(),...t}}}catch(c){console.error("Error loading pet from storage:",c)}return Qe()},er=()=>{try{const c=localStorage.getItem("bookish_pet_stats");if(c)return JSON.parse(c)}catch(c){console.error("Error loading pet stats from storage:",c)}return It()},tr=c=>{localStorage.setItem("bookish_pet",JSON.stringify(c))},sr=c=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(c))},rr=({children:c})=>{const[t,a]=E.useState(Zs),[o,s]=E.useState(er),r=[{id:"basic_food",name:"Pet Food",description:"Basic nutritious food for your pet",price:3,category:"food",effect:{hunger:25,happiness:5},emoji:"🍖",rarity:"common"},{id:"premium_food",name:"Premium Feast",description:"Delicious high-quality meal",price:8,category:"food",effect:{hunger:40,happiness:15,health:5},emoji:"🍗",rarity:"rare",unlockRequirement:{level:5}},{id:"energy_drink",name:"Energy Potion",description:"Restores energy and vitality",price:5,category:"food",effect:{energy:30,happiness:10},emoji:"🧪",rarity:"common"},{id:"gourmet_meal",name:"Gourmet Delicacy",description:"Fancy meal that satisfies all needs",price:15,category:"food",effect:{hunger:50,happiness:25,health:10,energy:20},emoji:"🥘",rarity:"rare",unlockRequirement:{level:10}},{id:"superfood",name:"Superfood Bowl",description:"Nutritious meal that boosts all stats",price:25,category:"food",effect:{hunger:60,happiness:30,health:20,energy:25,experience:10},emoji:"🥗",rarity:"epic",unlockRequirement:{level:15,books:20}},{id:"water",name:"Fresh Water",description:"Essential hydration for your pet",price:1,category:"food",effect:{hunger:10,health:5},emoji:"💧",rarity:"common"},{id:"vitamin_treats",name:"Vitamin Treats",description:"Healthy snacks that prevent sickness",price:12,category:"food",effect:{hunger:20,health:15,sickness:-30},emoji:"🍎",rarity:"rare",unlockRequirement:{level:8}},{id:"ball",name:"Bouncy Ball",description:"Fun toy that increases happiness",price:6,category:"toy",effect:{happiness:25,energy:-10},emoji:"⚽",rarity:"common"},{id:"puzzle",name:"Brain Puzzle",description:"Intellectual toy that boosts experience",price:12,category:"toy",effect:{happiness:20,experience:15},emoji:"🧩",rarity:"rare",unlockRequirement:{level:8}},{id:"teddy_bear",name:"Comfort Teddy",description:"Cuddly companion that reduces stress",price:10,category:"toy",effect:{happiness:30,health:10,sickness:-20},emoji:"🧸",rarity:"common"},{id:"laser_pointer",name:"Laser Pointer",description:"High-tech toy for active play",price:18,category:"toy",effect:{happiness:35,energy:-20,experience:20},emoji:"🔦",rarity:"rare",unlockRequirement:{level:12}},{id:"robot_companion",name:"Robot Companion",description:"AI-powered toy that teaches and entertains",price:40,category:"toy",effect:{happiness:50,experience:40,energy:10},emoji:"🤖",rarity:"epic",unlockRequirement:{level:20,books:15}},{id:"medicine",name:"Health Potion",description:"Cures sickness and restores health",price:10,category:"medicine",effect:{health:30,sickness:-50},emoji:"💊",rarity:"common"},{id:"super_medicine",name:"Super Cure",description:"Powerful medicine that fully heals",price:25,category:"medicine",effect:{health:50,sickness:-100,happiness:10},emoji:"💉",rarity:"epic",unlockRequirement:{level:15}},{id:"antibiotics",name:"Antibiotics",description:"Prevents and treats serious illness",price:20,category:"medicine",effect:{health:40,sickness:-80,happiness:5},emoji:"🔬",rarity:"rare",unlockRequirement:{level:12}},{id:"pain_relief",name:"Pain Relief",description:"Reduces suffering and improves mood",price:8,category:"medicine",effect:{health:20,happiness:15,sickness:-30},emoji:"🩹",rarity:"common"},{id:"immunity_boost",name:"Immunity Booster",description:"Strengthens immune system",price:30,category:"medicine",effect:{health:60,sickness:-100,happiness:20},emoji:"🛡️",rarity:"epic",unlockRequirement:{level:18,books:12}},{id:"soap",name:"Pet Soap",description:"Keeps your pet clean and fresh",price:4,category:"decoration",effect:{cleanliness:30,happiness:10},emoji:"🧼",rarity:"common"},{id:"luxury_bath",name:"Luxury Spa Treatment",description:"Ultimate cleaning experience",price:15,category:"decoration",effect:{cleanliness:50,happiness:25,health:10},emoji:"🛁",rarity:"rare",unlockRequirement:{level:10}},{id:"grooming_kit",name:"Grooming Kit",description:"Professional grooming tools",price:22,category:"decoration",effect:{cleanliness:60,happiness:30,health:15},emoji:"✂️",rarity:"rare",unlockRequirement:{level:14}},{id:"air_freshener",name:"Air Freshener",description:"Keeps the environment fresh",price:6,category:"decoration",effect:{cleanliness:20,happiness:15,health:5},emoji:"🌸",rarity:"common"},{id:"phoenix_feather",name:"Phoenix Feather",description:"Can revive a deceased pet",price:100,category:"special",effect:{health:100,happiness:50,energy:100},emoji:"🪶",rarity:"legendary",unlockRequirement:{level:20,books:25}},{id:"evolution_crystal",name:"Evolution Crystal",description:"Instantly evolves your pet to the next stage",price:50,category:"special",effect:{experience:1e3,happiness:30},emoji:"💎",rarity:"epic",unlockRequirement:{level:12,books:10}},{id:"time_crystal",name:"Time Crystal",description:"Slows down aging and decay",price:75,category:"special",effect:{health:30,happiness:20,energy:30},emoji:"⏰",rarity:"epic",unlockRequirement:{level:25,books:30}},{id:"golden_coin",name:"Golden Coin",description:"Increases reading rewards",price:80,category:"special",effect:{happiness:40,experience:50},emoji:"🪙",rarity:"epic",unlockRequirement:{level:30,books:40}},{id:"rainbow_potion",name:"Rainbow Potion",description:"Magical potion that maximizes all stats",price:150,category:"special",effect:{hunger:100,happiness:100,energy:100,health:100,cleanliness:100,sickness:-100},emoji:"🌈",rarity:"legendary",unlockRequirement:{level:35,books:50}},{id:"book_of_wisdom",name:"Book of Wisdom",description:"Ancient tome that grants massive experience",price:60,category:"special",effect:{experience:500,happiness:25},emoji:"📚",rarity:"epic",unlockRequirement:{level:22,books:35}}];E.useEffect(()=>{tr(t)},[t]),E.useEffect(()=>{sr(o)},[o]),E.useEffect(()=>{const y=setInterval(()=>{if(!t.isAlive)return;const P=new Date,L=new Date(t.lastFed),B=(P.getTime()-L.getTime())/(1e3*60*60);B>.5&&a(R=>{if(!R.isAlive)return R;const M=Math.max(1,B/2);let J=Math.max(0,R.hunger-M*4),q=Math.max(0,R.energy-M*3),Y=Math.max(0,R.happiness-M*2),te=R.health,W=R.sickness,_e=Math.max(0,R.cleanliness-M*2);J<30&&(W=Math.min(100,W+M*8)),J<15&&(W=Math.min(100,W+M*15)),_e<40&&(W=Math.min(100,W+M*5)),Y<25&&(W=Math.min(100,W+M*3)),q<20&&(W=Math.min(100,W+M*2)),W>30&&(te=Math.max(0,te-M*4)),W>60&&(te=Math.max(0,te-M*8)),W>80&&(te=Math.max(0,te-M*12));const Lt=J<=0,Mt=W>=100,Gt=te<=0,$t=J<10&&_e<10&&Y<10,Xe=(Lt||Mt||Gt||$t)&&R.isAlive,Ze=Xe?!1:R.isAlive,Jt=Xe?P.toISOString():R.deathDate,qt=n(Y,J,q,te,W,_e,Ze);return{...R,hunger:J,energy:q,happiness:Y,health:te,sickness:W,cleanliness:_e,isAlive:Ze,deathDate:Jt,mood:qt}});const S=P.toDateString(),D=new Date(o.lastActiveDate).toDateString();S!==D&&s(R=>({...R,booksReadToday:0,readingTimeToday:0,lastActiveDate:P.toISOString()}))},6e4);return()=>clearInterval(y)},[t.lastFed,t.isAlive,o.lastActiveDate]);const n=(y,P,L,B,S,D,R)=>R?B<=10||S>=90?"dying":S>=50?"sick":P<20?"hungry":L<20?"sleepy":y>80&&D>70?"happy":y>60?"excited":y<30?"sad":"content":"dead",f=y=>100+y*50,i=(y,P)=>{let L=P,B=f(L);for(;y>=B;)L++,B=f(L);return{newLevel:L,newExpToNext:B}},d=y=>y<3?"egg":y<8?"baby":y<15?"child":y<25?"teen":y<40?"adult":"elder",h=()=>{if(!t.isAlive)return"💀";const y=t.evolutionStage,P=t.mood,L={egg:{happy:"🥚",content:"🥚",sad:"💔",excited:"✨",sleepy:"😴",hungry:"🥚",sick:"🤒",dying:"💀",dead:"💀"},baby:{happy:"😊",content:"🐛",sad:"😢",excited:"🤩",sleepy:"😴",hungry:"😋",sick:"🤒",dying:"💀",dead:"💀"},child:{happy:"😄",content:"🐯",sad:"😭",excited:"🤗",sleepy:"💤",hungry:"🍎",sick:"🤒",dying:"💀",dead:"💀"},teen:{happy:"😎",content:"🦊",sad:"😔",excited:"🚀",sleepy:"😪",hungry:"🍕",sick:"🤒",dying:"💀",dead:"💀"},adult:{happy:"🌟",content:"🦉",sad:"😞",excited:"🎉",sleepy:"😌",hungry:"🍽️",sick:"🤒",dying:"💀",dead:"💀"},elder:{happy:"👑",content:"🐉",sad:"😟",excited:"🎊",sleepy:"🧘",hungry:"🍱",sick:"🤒",dying:"💀",dead:"💀"}};return L[y][P]||L[y].content},u=()=>{a(y=>{if(y.points<3)return y;const P=Math.min(100,y.hunger+30),L=Math.min(100,y.happiness+10),B=y.experience+5,{newLevel:S,newExpToNext:D}=i(B,y.level);return b("fed"),{...y,hunger:P,happiness:L,experience:B,level:S,experienceToNext:D,points:y.points-3,lastFed:new Date().toISOString(),evolutionStage:d(S),mood:n(L,P,y.energy,y.health,y.sickness,y.cleanliness,y.isAlive)}})},m=()=>{a(y=>{if(y.points<5)return y;const P=Math.min(100,y.happiness+20),L=Math.max(0,y.energy-15),B=y.experience+10,{newLevel:S,newExpToNext:D}=i(B,y.level);return b("played"),{...y,happiness:P,energy:L,experience:B,level:S,experienceToNext:D,points:y.points-5,lastPlayed:new Date().toISOString(),evolutionStage:d(S),mood:n(P,y.hunger,L,y.health,y.sickness,y.cleanliness,y.isAlive)}})},k=()=>{a(y=>{const P=Math.min(100,y.energy+40),L=Math.min(100,y.health+10);return{...y,energy:P,health:L,lastSlept:new Date().toISOString(),mood:n(y.happiness,y.hunger,P,L,y.sickness,y.cleanliness,y.isAlive)}})},l=(y,P=!1)=>{const S=Math.floor(y/5)+(P?50:0);S>0&&(a(D=>{const R=D.experience+S,M=Math.min(100,D.happiness+Math.floor(y/10)),J=D.totalReadingTime+y,{newLevel:q,newExpToNext:Y}=i(R,D.level);return{...D,experience:R,level:q,experienceToNext:Y,happiness:M,totalReadingTime:J,evolutionStage:d(q),mood:n(M,D.hunger,D.energy,D.health,D.sickness,D.cleanliness,D.isAlive)}}),s(D=>({...D,readingTimeToday:D.readingTimeToday+y,lastActiveDate:new Date().toISOString()})))},j=()=>{a(y=>{const P=y.experience+50,L=Math.min(100,y.happiness+25),B=y.totalBooksRead+1,S=20,{newLevel:D,newExpToNext:R}=i(P,y.level),M=[...y.badges];return B===1&&!M.includes("first-book")&&M.push("first-book"),B===10&&!M.includes("book-lover")&&M.push("book-lover"),B===50&&!M.includes("bookworm")&&M.push("bookworm"),{...y,experience:P,level:D,experienceToNext:R,happiness:L,points:y.points+S,totalBooksRead:B,badges:M,evolutionStage:d(D),mood:n(L,y.hunger,y.energy,y.health,y.sickness,y.cleanliness,y.isAlive)}}),s(y=>({...y,booksReadToday:y.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},x=()=>({happy:"Your pet is thriving! They're full of energy and love for reading!",excited:"Your pet is bouncing with excitement about your reading progress!",content:"Your pet is peacefully content, enjoying your company.",sad:"Your pet looks dejected and needs attention. Feed them or play with them!",sleepy:"Your pet is exhausted and struggling to stay awake. They need rest!",hungry:"⚠️ Your pet is starving! They desperately need food right now!",sick:"🤒 Your pet is seriously ill and suffering! Buy medicine immediately!",dying:"🚨 CRITICAL: Your pet is dying! Their health is failing rapidly - act NOW or they will die!",dead:"💔 Your beloved pet has passed away. Only a Phoenix Feather can bring them back to life."})[t.mood],C=()=>{const y=d(t.level+1),P=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:P,stage:y}},p=()=>{const y=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=y&&t.evolutionStage!==d(t.level)},_=()=>{a(y=>({...y,evolutionStage:d(y.level),happiness:100,health:100}))},v=()=>{const y=Qe();a(y),s(It())},g=y=>{a(P=>({...P,name:y}))},N=async y=>{if(H.isAuthenticated())try{await H.syncPetShopData(y,y.inventory)}catch(P){console.warn("Failed to sync pet data:",P)}},b=async y=>{if(H.isAuthenticated())try{await H.trackPetActivity({type:y,petName:t.name,petLevel:t.level,petStage:t.evolutionStage,timestamp:new Date().toISOString(),stats:{happiness:t.happiness,hunger:t.hunger,health:t.health}})}catch(P){console.warn("Failed to track pet activity:",P)}},A=()=>r,F=()=>r.filter(y=>{if(t.unlockedItems.includes(y.id)||!y.unlockRequirement)return!0;const P=y.unlockRequirement;return!(P.level&&t.level<P.level||P.books&&t.totalBooksRead<P.books||P.badges&&!P.badges.every(L=>t.badges.includes(L)))}),$=y=>{const P=r.find(L=>L.id===y);return!P||t.points<P.price||!F().find(L=>L.id===y)?!1:(a(L=>{const S=L.inventory.find(D=>D.id===y)?L.inventory.map(D=>D.id===y?{...D,quantity:(D.quantity||1)+1}:D):[...L.inventory,{...P,quantity:1}];return{...L,points:L.points-P.price,inventory:S}}),!0)},G=y=>{const P=t.inventory.find(L=>L.id===y);return!P||(P.quantity||0)<=0||!t.isAlive&&y!=="phoenix_feather"?!1:(a(L=>{let B={...L};if(P.effect.hunger&&(B.hunger=Math.min(100,B.hunger+P.effect.hunger)),P.effect.happiness&&(B.happiness=Math.min(100,B.happiness+P.effect.happiness)),P.effect.energy&&(B.energy=Math.min(100,Math.max(0,B.energy+P.effect.energy))),P.effect.health&&(B.health=Math.min(100,B.health+P.effect.health)),P.effect.cleanliness&&(B.cleanliness=Math.min(100,B.cleanliness+P.effect.cleanliness)),P.effect.sickness&&(B.sickness=Math.max(0,B.sickness+P.effect.sickness)),P.effect.experience){const S=B.experience+P.effect.experience,{newLevel:D,newExpToNext:R}=i(S,B.level);B.experience=S,B.level=D,B.experienceToNext=R,B.evolutionStage=d(D)}return y==="phoenix_feather"&&!B.isAlive&&(B.isAlive=!0,B.health=100,B.happiness=50,B.energy=100,B.hunger=50,B.sickness=0,B.cleanliness=80,delete B.deathDate),B.health<=0||B.sickness>=100?(B.isAlive=!1,B.deathDate=new Date().toISOString(),B.mood="dead"):B.mood=n(B.happiness,B.hunger,B.energy,B.health,B.sickness,B.cleanliness,B.isAlive),B.inventory=B.inventory.map(S=>S.id===y?{...S,quantity:(S.quantity||1)-1}:S).filter(S=>(S.quantity||0)>0),B}),!0)},T=()=>{t.isAlive&&a(y=>{const P=Math.min(100,y.cleanliness+25),L=Math.min(100,y.happiness+10);return{...y,cleanliness:P,happiness:L,mood:n(L,y.hunger,y.energy,y.health,y.sickness,P,y.isAlive)}})},I=()=>{!t.isAlive||t.points<15||a(y=>{const P=Math.min(100,y.health+30),L=Math.max(0,y.sickness-25),B=Math.min(100,y.happiness+15);return{...y,health:P,sickness:L,happiness:B,points:y.points-15,mood:n(B,y.hunger,y.energy,P,L,y.cleanliness,y.isAlive)}})},U=()=>{t.isAlive||t.points<100||a(y=>({...y,isAlive:!0,health:50,happiness:30,energy:60,hunger:40,sickness:0,cleanliness:60,points:y.points-100,mood:"content",deathDate:void 0}))};E.useEffect(()=>{const y=setInterval(()=>{a(P=>{if(!P.isAlive)return P;const L=new Date,B=new Date(P.lastFed),S=(L.getTime()-B.getTime())/(1e3*60*60);if(S>0){let D=P.hunger-S*10,R=P.energy-S*5,M=P.happiness-S*2,J=P.sickness+S*2,q=P.health-P.sickness*.1+P.cleanliness*.1;return q=Math.min(100,Math.max(0,q)),q<=0||J>=100?{...P,hunger:Math.max(0,D),energy:Math.max(0,R),happiness:Math.max(0,M),sickness:Math.min(100,J),health:q,isAlive:!1,deathDate:new Date().toISOString(),mood:"dead"}:{...P,hunger:Math.max(0,D),energy:Math.max(0,R),happiness:Math.max(0,M),sickness:Math.min(100,J),health:q,mood:n(Math.max(0,M),Math.max(0,D),Math.max(0,R),q,Math.min(100,J),P.cleanliness,!0)}}return P})},6e4);return()=>clearInterval(y)},[]),E.useEffect(()=>{a(y=>({...y,mood:n(y.happiness,y.hunger,y.energy,y.health,y.sickness,y.cleanliness,y.isAlive)}))},[t.happiness,t.hunger,t.energy,t.health,t.sickness,t.cleanliness,t.isAlive]),E.useEffect(()=>{N(t)},[t.level,t.health,t.isAlive,t.evolutionStage,t.inventory.length]);const w=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",O=()=>t.experience/t.experienceToNext*100;return e.jsx(Rt.Provider,{value:{pet:t,petStats:o,shopItems:r,feedPet:u,playWithPet:m,petSleep:k,cleanPet:T,healPet:I,revivePet:U,updatePetFromReading:l,updatePetFromBookCompletion:j,getPetMood:x,getPetEvolutionRequirement:C,resetPet:v,updatePetName:g,getPetEmoji:h,canEvolve:p,evolvePet:_,getPetHappinessLevel:w,getLevelProgress:O,getShopItems:A,getUnlockedItems:F,buyItem:$,useItem:G},children:c})},or={colors:{primary:"#D2691E",primaryLight:"#E89556",primaryDark:"#B8571A",secondary:"#8B7355",secondaryLight:"#A68B6B",secondaryDark:"#6B5A47",background:"#F7F5F3",surface:"#FFFFFF",surfaceElevated:"#FEFEFE",surfaceSecondary:"#F5F5F5",textPrimary:"#3A3A3A",textSecondary:"#8B7355",textTertiary:"#A0A0A0",textInverse:"#FFFFFF",border:"#E8E3DD",borderLight:"#F0EDE8",borderDark:"#D4C4B0",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",wantToRead:"#FEF3C7",wantToReadText:"#D97706",currentlyReading:"#DBEAFE",currentlyReadingText:"#2563EB",completed:"#D1FAE5",completedText:"#059669",overlay:"rgba(0, 0, 0, 0.5)",overlayLight:"rgba(0, 0, 0, 0.3)"}},ar={colors:{primary:"#E89556",primaryLight:"#F4A971",primaryDark:"#D2691E",secondary:"#A68B6B",secondaryLight:"#B89980",secondaryDark:"#8B7355",background:"#0F0F0F",surface:"#1A1A1A",surfaceElevated:"#252525",surfaceSecondary:"#1F1F1F",textPrimary:"#F5F5F5",textSecondary:"#C0C0C0",textTertiary:"#909090",textInverse:"#0F0F0F",border:"#333333",borderLight:"#2A2A2A",borderDark:"#444444",success:"#4ADE80",warning:"#FBBF24",error:"#FB7185",info:"#60A5FA",wantToRead:"#2D1B00",wantToReadText:"#FBBF24",currentlyReading:"#1E293B",currentlyReadingText:"#7DD3FC",completed:"#1B2E1B",completedText:"#4ADE80",overlay:"rgba(0, 0, 0, 0.8)",overlayLight:"rgba(0, 0, 0, 0.6)"}},Ft=E.createContext(void 0),z=()=>{const c=E.useContext(Ft);if(!c)throw new Error("useTheme must be used within a ThemeProvider");return c},nr=({children:c})=>{const{user:t,isLoading:a}=ne(),o=()=>{try{const h=localStorage.getItem("bookish-theme");if(h)return h==="dark";if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(h){console.error("Error getting initial theme:",h)}return!1},[s,r]=E.useState(o);E.useEffect(()=>{if(a)return;(()=>{var u;if(t){const m=(u=ce.getUserSettings())==null?void 0:u.theme;if(m){r(m==="dark");return}}r(o())})()},[t,a]),E.useEffect(()=>{if(!window.matchMedia)return;const h=window.matchMedia("(prefers-color-scheme: dark)"),u=m=>{var l;(t?!!((l=ce.getUserSettings())!=null&&l.theme):!!localStorage.getItem("bookish-theme"))||r(m.matches)};return h.addEventListener("change",u),()=>h.removeEventListener("change",u)},[t]),E.useEffect(()=>{const h=document.documentElement;s?(h.classList.add("dark"),h.setAttribute("data-theme","dark")):(h.classList.remove("dark"),h.setAttribute("data-theme","light"));const u=document.querySelector('meta[name="theme-color"]');u&&u.setAttribute("content",s?"#0F0F0F":"#F7F5F3")},[s]);const n=()=>{const h=!s;r(h),i(h)},f=h=>{r(h),i(h)},i=h=>{const u=h?"dark":"light";if(t){const m=ce.getUserSettings()||{reminders:[],theme:"light",petName:"Buddy"};ce.saveUserSettings({...m,theme:u})}else localStorage.setItem("bookish-theme",u)},d={colors:s?ar.colors:or.colors,isDark:s};return e.jsx(Ft.Provider,{value:{theme:d,toggleTheme:n,setTheme:f},children:c})},Ut=E.createContext(void 0),Ae=()=>{const c=E.useContext(Ut);if(!c)throw new Error("useFriends must be used within a FriendsProvider");return c},lr=({children:c})=>{const{user:t,isAuthenticated:a}=ne(),[o,s]=E.useState([]),[r,n]=E.useState([]),[f,i]=E.useState([]),[d,h]=E.useState([]),[u,m]=E.useState(!1),[k,l]=E.useState(null),j=E.useRef(!1),x=E.useRef(!1),[C,p]=E.useState(null);E.useEffect(()=>{a&&t&&_()},[a,t]);const _=async()=>{if(t){m(!0);try{const U=await H.getFriends();if(U.success&&U.friends){const O=await Promise.all(U.friends.map(async y=>{const P=await v(y.id);return{...y,stats:P}}));s(O)}const w=await H.getFriendRequests();w.success&&w.requests&&n(w.requests)}catch(U){console.error("Error loading friends data:",U),l("Failed to load friends data")}finally{m(!1)}}},v=async U=>{try{if(U===(t==null?void 0:t.id)){const[w,O]=await Promise.all([H.getUserBooks(),H.getUserSessions()]),y=w.success?w.books||[]:[],P=O.success?O.sessions||[]:[],L=y.filter(M=>M.category==="completed"),B=P.reduce((M,J)=>M+(J.duration||0),0),S=P.reduce((M,J)=>{const q=(J.endPage||0)-(J.startPage||0);return M+Math.max(0,q)},0),D=g(P),R={totalBooksRead:L.length,totalPagesRead:Math.max(S,L.length*200),totalReadingTime:B,currentStreak:D};return H.updatePublicStats(R).catch(console.error),R}else{try{const O=await H.getPublicStats(U);if(O.success&&O.stats)return{totalBooksRead:O.stats.totalBooksRead||0,totalPagesRead:O.stats.totalPagesRead||0,totalReadingTime:O.stats.totalReadingTime||0,currentStreak:O.stats.currentStreak||0}}catch(O){console.error("Error fetching friend public stats:",O)}const w=o.find(O=>O.id===U);return w&&w.stats?w.stats:{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}}catch(w){return console.error("Error calculating user stats:",w),{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}},g=U=>{if(!U.length)return 0;const w=U.map(L=>new Date(L.startTime).toDateString()).filter((L,B,S)=>S.indexOf(L)===B).sort((L,B)=>new Date(B).getTime()-new Date(L).getTime());let O=0;const y=new Date().toDateString(),P=new Date(Date.now()-864e5).toDateString();if(w[0]===y||w[0]===P){O=1;for(let L=1;L<w.length;L++){const B=new Date(w[L]);if((new Date(w[L-1]).getTime()-B.getTime())/(1e3*60*60*24)===1)O++;else break}}return O},N=async U=>{var w;if(!t)return!1;m(!0),l(null);try{const y=(await T(U)).find(S=>S.username.toLowerCase()===U.toLowerCase());if(!y)return l("User not found"),!1;if(o.find(S=>S.id===y.id))return l("Already friends with this user"),!1;if(r.find(S=>S.fromUserId===t.id&&S.toUserId===y.id||S.fromUserId===y.id&&S.toUserId===t.id))return l("Friend request already exists"),!1;const B=await H.sendFriendRequest(t.id,t.username,((w=t.profile)==null?void 0:w.displayName)||t.username,y.id,y.username,y.displayName||y.username);return B.success?(await _(),!0):(l(B.error||"Failed to send friend request"),!1)}catch(O){return console.error("Error sending friend request:",O),l("Failed to send friend request"),!1}finally{m(!1)}},b=async U=>{if(!t)return!1;m(!0),l(null);try{const w=r.find(y=>y.id===U);if(!w)return l("Friend request not found"),!1;const O=await H.acceptFriendRequest(U,w.fromUserId);return O.success?(await _(),setTimeout(()=>{$()},1e3),!0):(l(O.error||"Failed to accept friend request"),!1)}catch(w){return console.error("Error accepting friend request:",w),l("Failed to accept friend request"),!1}finally{m(!1)}},A=async U=>{if(!t)return!1;try{const w=r.find(y=>y.id===U);if(!w)return l("Friend request not found"),!1;const O=await H.declineFriendRequest(U,w.fromUserId);return O.success?(await _(),!0):(l(O.error||"Failed to decline friend request"),!1)}catch(w){return console.error("Error declining friend request:",w),l("Failed to decline friend request"),!1}},F=async U=>{if(!t)return!1;try{const w=await H.removeFriend(U);return w.success?(await _(),!0):(l(w.error||"Failed to remove friend"),!1)}catch(w){return console.error("Error removing friend:",w),l("Failed to remove friend"),!1}},$=E.useCallback(async()=>{if(t){if(x.current){console.log("⚠️ Friend activity refresh already in progress, skipping...");return}x.current=!0,m(!0);try{const U=o.map(O=>O.id);if(U.length===0){i([]);return}const w=await H.getFriendActivities(U);w.success&&w.activities?(i(w.activities),console.log("✅ Friend activities loaded:",w.activities.length)):(console.log("⚠️ No friend activities found"),i([]))}catch(U){console.error("Error refreshing friend activity:",U),l("Failed to refresh friend activity")}finally{x.current=!1,m(!1)}}},[t,o]),G=E.useCallback(async(U,w)=>{var O;if(t){if(p({period:U,metric:w}),j.current){console.log("⚠️ Leaderboard refresh already in progress, skipping...");return}j.current=!0,m(!0);try{console.log("🔄 Refreshing leaderboard for period:",U,"metric:",w);const y=await H.getAllPublicStats();if(console.log("📊 All public stats result:",y),y.success&&y.allStats&&y.allStats.length>0){const B=(await Promise.all(y.allStats.map(async S=>{var R,M,J;const D=await H.getPublicProfile(S.userId);return{userId:S.userId,username:D.success&&((R=D.profile)==null?void 0:R.username)||"Unknown",displayName:D.success?((M=D.profile)==null?void 0:M.displayName)||((J=D.profile)==null?void 0:J.username):"Unknown",stats:{booksRead:S.totalBooksRead||0,pagesRead:S.totalPagesRead||0,readingTime:S.totalReadingTime||0,currentStreak:S.currentStreak||0}}}))).sort((S,D)=>{switch(w){case"books_read":return D.stats.booksRead-S.stats.booksRead;case"pages_read":return D.stats.pagesRead-S.stats.pagesRead;case"reading_time":return D.stats.readingTime-S.stats.readingTime;case"streak":return D.stats.currentStreak-S.stats.currentStreak;default:return 0}}).map((S,D)=>({userId:S.userId,username:S.username,displayName:S.displayName,rank:D+1,score:S.stats[w==="books_read"?"booksRead":w==="pages_read"?"pagesRead":w==="reading_time"?"readingTime":"currentStreak"],period:U,metric:w,details:{booksRead:S.stats.booksRead,pagesRead:S.stats.pagesRead,readingTime:S.stats.readingTime,currentStreak:S.stats.currentStreak}}));h(B),console.log("✅ Leaderboard updated with",B.length,"entries")}else{console.log("⚠️ No public stats available, using fallback method");const P=await v(t.id),S=[{userId:t.id,username:t.username,displayName:((O=t.profile)==null?void 0:O.displayName)||t.username,stats:{booksRead:P.totalBooksRead,pagesRead:P.totalPagesRead,readingTime:P.totalReadingTime,currentStreak:P.currentStreak}},...o.map(D=>{var R,M,J,q;return{userId:D.id,username:D.username,displayName:D.displayName||D.username,stats:{booksRead:((R=D.stats)==null?void 0:R.totalBooksRead)||0,pagesRead:((M=D.stats)==null?void 0:M.totalPagesRead)||0,readingTime:((J=D.stats)==null?void 0:J.totalReadingTime)||0,currentStreak:((q=D.stats)==null?void 0:q.currentStreak)||0}}})].sort((D,R)=>{switch(w){case"books_read":return R.stats.booksRead-D.stats.booksRead;case"pages_read":return R.stats.pagesRead-D.stats.pagesRead;case"reading_time":return R.stats.readingTime-D.stats.readingTime;case"streak":return R.stats.currentStreak-D.stats.currentStreak;default:return 0}}).map((D,R)=>({userId:D.userId,username:D.username,displayName:D.displayName,rank:R+1,score:D.stats[w==="books_read"?"booksRead":w==="pages_read"?"pagesRead":w==="reading_time"?"readingTime":"currentStreak"],period:U,metric:w,details:{booksRead:D.stats.booksRead,pagesRead:D.stats.pagesRead,readingTime:D.stats.readingTime,currentStreak:D.stats.currentStreak}}));h(S)}}catch(y){console.error("Error refreshing leaderboard:",y),l("Failed to refresh leaderboard")}finally{j.current=!1,m(!1)}}},[t,o]);E.useEffect(()=>{const U=w=>{console.log("🔄 Public stats updated, refreshing leaderboard...",w.detail),setTimeout(()=>{C&&(console.log("🔄 Re-fetching leaderboard with settings:",C),G(C.period,C.metric))},1500)};return window.addEventListener("publicStatsUpdated",U),()=>{window.removeEventListener("publicStatsUpdated",U)}},[C,G]);const T=async U=>{if(!U.trim())return[];try{console.log("🔍 Searching for users with query:",U);const w=await H.searchPublicUsers(U);return console.log("🔍 Search results:",w),w}catch(w){return console.error("Error searching users:",w),[]}},I={friends:o,friendRequests:r,friendActivity:f,leaderboard:d,loading:u,error:k,sendFriendRequest:N,acceptFriendRequest:b,declineFriendRequest:A,removeFriend:F,refreshFriendActivity:$,refreshLeaderboard:G,searchUsers:T};return e.jsx(Ut.Provider,{value:I,children:c})},ir=({onClose:c})=>{const[t,a]=E.useState(!1),[o,s]=E.useState(""),[r,n]=E.useState(""),[f,i]=E.useState(!1),[d,h]=E.useState(!1),{signIn:u,signUp:m,error:k,clearError:l,continueAsGuest:j}=ne(),x={colors:{background:"#F7F5F3",surface:"#FFFFFF",borderLight:"#F0EDE8",border:"#E8E3DD",primary:"#8B7355",textPrimary:"#3A3A3A",textSecondary:"#8B7355"}},C=async v=>{if(v.preventDefault(),!(!o.trim()||!r.trim())){h(!0),l();try{let g;t?(g=await m(o.trim(),r),g.success&&(a(!1),n(""),alert("Account created successfully! Please sign in."))):(g=await u(o.trim(),r),g.success&&c&&c())}finally{h(!1)}}},p=()=>{a(!t),n(""),l()},_=()=>{j(),c&&c()};return e.jsxs("div",{className:"rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border},children:[e.jsxs("div",{className:"text-center mb-8",children:["        ",e.jsx("div",{className:"rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",style:{backgroundColor:x.colors.borderLight},children:e.jsx(V,{className:"w-8 h-8",style:{color:x.colors.primary}})}),e.jsx("h2",{className:"font-serif text-2xl font-medium mb-2",style:{color:x.colors.textPrimary},children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{style:{color:x.colors.textSecondary},children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),"      ",e.jsxs("form",{onSubmit:C,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",style:{color:x.colors.textPrimary},children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:x.colors.textSecondary}}),e.jsx("input",{id:"username",type:"text",value:o,onChange:v=>s(v.target.value),className:"pl-10 pr-4 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:x.colors.background,borderColor:x.colors.border,color:x.colors.textPrimary},placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",style:{color:x.colors.textPrimary},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:x.colors.textSecondary}}),"            ",e.jsx("input",{id:"password",type:f?"text":"password",value:r,onChange:v=>n(v.target.value),className:"pl-10 pr-12 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:x.colors.background,borderColor:x.colors.border,color:x.colors.textPrimary},placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:opacity-70 transition-colors",style:{color:x.colors.textSecondary},children:f?e.jsx(ss,{className:"w-5 h-5"}):e.jsx(rs,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm mt-1",style:{color:x.colors.textSecondary},children:"Password must be at least 8 characters long"})]}),"        ",k&&e.jsx("div",{className:"border px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"#FEF2F2",borderColor:"#FCA5A5",color:"#DC2626"},children:k}),e.jsx("button",{type:"submit",disabled:d,className:"w-full text-white py-3 px-4 rounded-xl font-medium hover:opacity-90 focus:ring-2 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:x.colors.primary},children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:_,className:"w-full py-3 px-4 rounded-xl font-medium focus:ring-2 focus:ring-offset-2 transition-all duration-200 border",style:{backgroundColor:x.colors.surface,color:x.colors.primary,borderColor:x.colors.border},children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center mt-2",style:{color:x.colors.textSecondary},children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{style:{color:x.colors.textSecondary},children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:p,className:"font-medium transition-colors underline hover:opacity-70",style:{color:x.colors.textPrimary},children:t?"Sign In":"Sign Up"})]})}),c&&e.jsx("button",{onClick:c,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},cr=({children:c,fallback:t})=>{const{isAuthenticated:a,isLoading:o}=ne(),s={colors:{background:"#F7F5F3",surface:"#FFFFFF",border:"#E8E3DD",primary:"#8B7355",textSecondary:"#8B7355"}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.primary}}),e.jsx("p",{className:"font-medium",style:{color:s.colors.textSecondary},children:"Loading your reading world..."})]})}):a?e.jsx(e.Fragment,{children:c}):t||e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:s.colors.background},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(ir,{})})})},dr=()=>{const c=Z(),t=[{icon:V,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:wt,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:be,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:pe,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:de,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:os,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],a=[{icon:Se,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:Ye,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:xe,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen style={{backgroundColor: lightTheme.colors.background}} max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(V,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>c("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx(et,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>c("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((o,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(o.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:a.map((o,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(o.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>c("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx(et,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>c("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>c("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},ur=({className:c=""})=>{const{theme:t,toggleTheme:a}=z();return e.jsx("button",{onClick:a,className:`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 ${c}`,style:{backgroundColor:t.colors.surfaceSecondary},onMouseEnter:o=>{o.currentTarget.style.backgroundColor=t.colors.border},onMouseLeave:o=>{o.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},title:`Switch to ${t.isDark?"light":"dark"} mode`,"aria-label":`Switch to ${t.isDark?"light":"dark"} mode`,children:t.isDark?e.jsx(kt,{size:16,style:{color:t.colors.warning}}):e.jsx(Nt,{size:16,style:{color:t.colors.textSecondary}})})},mr=({greeting:c})=>{var f;const t=Z(),{pet:a}=le(),{user:o}=ne(),{theme:s}=z(),r=(f=o==null?void 0:o.id)==null?void 0:f.startsWith("guest-"),n=()=>{const i=a.mood;return{happy:"😊",excited:"🤩",content:"😌",sad:"😢",sleepy:"😴",hungry:"🍎"}[i]||"😌"};return e.jsx("header",{className:"p-4 transition-colors duration-200",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:c}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ur,{}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors duration-200",style:{backgroundColor:s.colors.surfaceSecondary},onMouseEnter:i=>{i.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:i=>{i.currentTarget.style.backgroundColor=s.colors.surfaceSecondary},onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:n()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.colors.textPrimary},children:a.name}),e.jsxs("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:["Lv.",a.level]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200",style:{backgroundColor:r?s.colors.wantToRead:s.colors.surfaceSecondary},onMouseEnter:i=>{i.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:i=>{i.currentTarget.style.backgroundColor=r?s.colors.wantToRead:s.colors.surfaceSecondary},onClick:()=>t("/profile"),title:r?"Guest User":"Profile",children:e.jsx(jt,{className:"w-5 h-5",style:{color:r?s.colors.wantToReadText:s.colors.textSecondary}})})]})]})})},hr=({onContinueReading:c})=>{const{currentBook:t,sessions:a,setActiveBook:o}=me(),{theme:s}=z(),[r,n]=E.useState(!0);if(E.useEffect(()=>{if(t){const l=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(j=>j.key===t.key);n(l),l||o(null)}},[t,o]),!t||!r)return e.jsx("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed rounded-lg",style:{borderColor:s.colors.textSecondary},children:e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-2",style:{color:s.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-1",style:{color:s.colors.textPrimary},children:"No book selected"}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Search for a book to start reading"})]})})});const f=[...a].sort((k,l)=>new Date(l.startTime).getTime()-new Date(k.startTime).getTime())[0],i=(f==null?void 0:f.endPage)||(f==null?void 0:f.startPage)||1,d=t.number_of_pages_median||0,h=d>0?Math.min(Math.round(i/d*100),100):0,u=d>0,m=u&&h>0;return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:s.colors.textPrimary},children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white p-2",style:{backgroundColor:s.colors.secondary},children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium line-clamp-2 mb-1",style:{color:s.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-2",style:{color:s.colors.textSecondary},children:["by ",t.author_name[0]]}),m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:s.colors.textSecondary},children:[e.jsxs("span",{children:[h,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 rounded-full overflow-hidden",style:{backgroundColor:s.colors.border},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${h}%`,backgroundColor:s.colors.primary}})})]}),e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",i," of ",d]})]}):u?e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",i," of ",d]}):e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Currently on page ",i,e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:c,className:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:s.colors.primary,color:s.colors.textInverse},onMouseEnter:k=>{k.currentTarget.style.backgroundColor=s.colors.primaryLight},onMouseLeave:k=>{k.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(V,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},Be=({icon:c,value:t,label:a,color:o})=>{const{theme:s}=z();return e.jsxs("div",{className:"flex flex-col items-center p-3 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full mb-1",style:{backgroundColor:o},children:c}),e.jsx("span",{className:"font-serif text-lg font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:a})]})},fr=()=>{const{theme:c}=z(),[t,a]=E.useState(Ce()),[o,s]=E.useState(ye());E.useEffect(()=>{const n=f=>{a(f.detail),s(ye())};return window.addEventListener("statsUpdated",n),a(Ce()),s(ye()),()=>{window.removeEventListener("statsUpdated",n)}},[]);const r=n=>{if(n<60)return`${n} min`;const f=Math.floor(n/60),i=n%60;return i===0?`${f} hrs`:`${f}.${Math.floor(i/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Be,{icon:e.jsx(ae,{className:"w-5 h-5 text-white"}),value:r(t.readingTimeToday),label:"Today",color:c.colors.primary}),e.jsx(Be,{icon:e.jsx(ae,{className:"w-5 h-5 text-white"}),value:r(t.readingTimeThisWeek),label:"This Week",color:c.colors.primaryDark}),e.jsx(Be,{icon:e.jsx(as,{className:"w-5 h-5 text-white"}),value:t.totalBooksRead,label:"Books Read",color:c.colors.secondary}),e.jsx(Be,{icon:e.jsx(ns,{className:"w-5 h-5 text-white"}),value:o.currentStreak,label:"Streak",color:c.colors.primaryLight})]})},he=({icon:c,label:t,onClick:a})=>{const{theme:o}=z();return e.jsxs("button",{onClick:a,className:"flex flex-col items-center justify-center p-4 rounded-xl shadow-sm transition-colors duration-200",style:{backgroundColor:o.colors.surface},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=o.colors.surfaceSecondary},onMouseLeave:s=>{s.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full mb-2",style:{backgroundColor:o.colors.background},children:e.jsx(c,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm",style:{color:o.colors.textPrimary},children:t})]})},xr=({type:c,title:t,timestamp:a,duration:o})=>{const{theme:s}=z(),r=()=>{switch(c){case"reading":return e.jsx(ae,{className:"w-4 h-4",style:{color:s.colors.primary}});case"note":return e.jsx(tt,{className:"w-4 h-4",style:{color:s.colors.secondary}});case"completed":return e.jsx(tt,{className:"w-4 h-4",style:{color:s.colors.success}})}},n=f=>{const i=new Date,d=new Date(f),h=Math.floor((i.getTime()-d.getTime())/(1e3*60));if(h<1)return"just now";if(h<60)return`${h} minute${h===1?"":"s"} ago`;const u=Math.floor(h/60);if(u<24)return`${u} hour${u===1?"":"s"} ago`;const m=Math.floor(u/24);return`${m} day${m===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b",style:{borderColor:s.colors.border},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.colors.surfaceSecondary},children:r()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:s.colors.textSecondary},children:[e.jsx("span",{children:n(a)}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[o," min"]})]})]})]})]})},gr=()=>{const c=Z(),{theme:t}=z(),o=[...Ge()].sort((r,n)=>new Date(n.startTime).getTime()-new Date(r.startTime).getTime()).slice(0,5),s=()=>{const r=new Date().getHours();return r<12?"Good morning":r<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:t.colors.background},children:[e.jsx(mr,{greeting:s()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(hr,{onContinueReading:()=>c("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(he,{icon:ge,label:"Find Books",onClick:()=>c("/search")}),e.jsx(he,{icon:be,label:"My Notes",onClick:()=>c("/notes")}),e.jsx(he,{icon:ls,label:"My Library",onClick:()=>c("/library")}),e.jsx(he,{icon:is,label:"Statistics",onClick:()=>c("/stats")}),"          "]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Social"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(he,{icon:xe,label:"Friends",onClick:()=>c("/friends")}),e.jsx(he,{icon:de,label:"Leaderboard",onClick:()=>c("/leaderboard")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Your Progress"}),e.jsx(fr,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-1",style:{color:t.colors.textPrimary},children:"Recent Activity"}),o.length>0?e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden",style:{backgroundColor:t.colors.surface},children:o.map(r=>e.jsx(xr,{type:"reading",title:"Reading session completed",timestamp:r.endTime||r.startTime,duration:r.duration||0},r.id))}):e.jsx("p",{className:"text-sm p-4 rounded-xl shadow-sm",style:{color:t.colors.textSecondary,backgroundColor:t.colors.surface},children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>c("/welcome"),className:"text-sm hover:underline transition-colors underline",style:{color:t.colors.textSecondary},onMouseEnter:r=>{r.currentTarget.style.color=t.colors.textPrimary},onMouseLeave:r=>{r.currentTarget.style.color=t.colors.textSecondary},children:"Learn more about Bookish features"})})]})]})},Le=({children:c,className:t=""})=>{const{theme:a}=z();return e.jsx("div",{className:`min-h-screen transition-colors duration-200 ${t}`,style:{backgroundColor:a.colors.background},children:c})},pr=()=>{const c=Z(),{theme:t}=z(),[a,o]=E.useState(""),[s,r]=E.useState([]),[n,f]=E.useState(!1),[i,d]=E.useState("general"),[h,u]=E.useState(!1);E.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const m=async v=>{if(v.preventDefault(),!!a.trim()){f(!0);try{let g;i==="subject"?g=await Ms(a):g=await Rs(a),r(g)}catch(g){console.error("Error searching books:",g)}finally{f(!1)}}},k=async()=>{try{u(!0),setTimeout(()=>{j()},300)}catch(v){console.error("Error starting camera:",v),alert("Unable to access camera. Please check permissions."),u(!1)}},l=()=>{try{Ke(()=>import("./quagga.min-CA_kn7cW.js").then(v=>v.q),__vite__mapDeps([0,1])).then(v=>{const g=v.default;g.stop(),g.offDetected(),g.offProcessed(),console.log("Quagga stopped successfully")}).catch(v=>{console.log("Error stopping Quagga:",v)})}catch(v){console.log("Quagga cleanup error:",v)}u(!1)},j=async()=>{try{const v=document.querySelector("#barcode-scanner");if(!v){console.error("Scanner element not found");return}const N=(await Ke(()=>import("./quagga.min-CA_kn7cW.js").then(F=>F.q),__vite__mapDeps([0,1]))).default,b={inputStream:{name:"Live",type:"LiveStream",target:v,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",b),N.init(b,F=>{if(F){console.error("QuaggaJS initialization failed:",F),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),l();return}console.log("QuaggaJS initialized successfully"),N.start(),console.log("QuaggaJS started")}),N.onDetected(F=>{const $=F.codeResult.code;console.log("Barcode detected:",$);const G=C($);console.log("Cleaned barcode:",G),x(G)?(console.log("Valid ISBN detected, searching..."),p(G),l()):console.log("Invalid ISBN format, continuing scan...")});let A=0;N.onProcessed(F=>{A++,A%30===0&&console.log("Processing frames... Count:",A),F&&F.codeResult&&F.codeResult.code&&console.log("Potential code detected:",F.codeResult.code)})}catch(v){console.error("Error loading Quagga:",v),alert("Failed to load barcode scanner. Please try again."),l()}},x=v=>{const g=v.replace(/[^0-9X]/gi,"");return g.length===10||g.length===13},C=v=>v.replace(/[^0-9X]/gi,""),p=async v=>{f(!0);try{const g=await Gs(v);g?(r([g]),o(v)):alert("No book found for this barcode")}catch(g){console.error("Error searching by ISBN:",g),alert("Error scanning barcode")}finally{f(!1)}},_=v=>{c(`/book?book=${encodeURIComponent(v.key)}`,{state:{bookData:v}})};return e.jsx(Le,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",children:[e.jsxs("header",{className:"page-header p-4 shadow-sm",style:{backgroundColor:t.colors.surfaceSecondary},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors",style:{backgroundColor:t.colors.surface},onMouseEnter:v=>{v.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsxs("form",{onSubmit:m,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:v=>o(v.target.value),placeholder:i==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 border rounded-lg focus:outline-none focus:ring-2 input-field",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.textPrimary}}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full text-white",style:{backgroundColor:t.colors.primary},children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center rounded-full text-white transition-colors",style:{backgroundColor:t.colors.primary},onMouseEnter:v=>{v.currentTarget.style.backgroundColor=t.colors.primaryLight},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=t.colors.primary},children:e.jsx(st,{className:"w-5 h-5"})})]}),"        ",e.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:t.colors.surface},children:[e.jsxs("button",{onClick:()=>d("general"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:i==="general"?t.colors.primary:"transparent",color:i==="general"?"white":t.colors.textSecondary},children:[e.jsx(ge,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>d("subject"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:i==="subject"?t.colors.primary:"transparent",color:i==="subject"?"white":t.colors.textSecondary},children:[e.jsx(rt,{className:"w-4 h-4"}),"Subject"]})]})]}),h&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded-lg p-4 m-4 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:l,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"📷"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none",style:{border:`2px solid ${t.colors.primary}`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{borderTop:`2px solid ${t.colors.primary}`}})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm mb-2",style:{color:t.colors.textSecondary},children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs mb-2",style:{color:t.colors.textSecondary},children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs italic",style:{color:t.colors.textSecondary},children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4",style:{borderTop:`1px solid ${t.colors.border}`},children:e.jsx("button",{onClick:()=>{const v=prompt("Enter ISBN manually (if barcode scan fails):");v&&(p(v.trim()),l())},className:"text-xs underline",style:{color:t.colors.primary},children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2",style:{borderTopColor:t.colors.primary,borderBottomColor:t.colors.primary}})}):s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:i==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:s.map(v=>e.jsxs("div",{onClick:()=>_(v),className:"flex gap-4 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:[v.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${v.cover_i}-M.jpg`,alt:v.title,className:"w-full h-full object-cover",onError:g=>{var b;const N=g.target;N.style.display="none",(b=N.nextElementSibling)==null||b.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${v.cover_i?"hidden":""}`,children:e.jsx(V,{className:"w-6 h-6",style:{color:t.colors.textSecondary}})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:t.colors.textPrimary},children:v.title}),v.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:t.colors.textSecondary},children:["by ",v.author_name[0]]}),v.first_publish_year&&e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:v.first_publish_year})]})]},v.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(ge,{className:"w-12 h-12 mb-4 opacity-70",style:{color:t.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Find your next great read"}),e.jsx("p",{className:"text-sm max-w-xs mb-4",style:{color:t.colors.textSecondary},children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",style:{color:t.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(rt,{className:"w-4 h-4"}),"Browse"]})]})]})})]})})},Ee=({isOpen:c,onClose:t,onConfirm:a,title:o,message:s,type:r="confirm",confirmText:n="Confirm",cancelText:f="Cancel"})=>{const{theme:i}=z();if(!c)return null;const d=()=>{switch(r){case"alert":return e.jsx(Fe,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(cs,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(St,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Fe,{className:"w-8 h-8",style:{color:i.colors.primary}})}},h=()=>{a&&a(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl shadow-xl w-full max-w-sm mx-auto",style:{backgroundColor:i.colors.surface},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:i.colors.textPrimary},children:o})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:i.colors.borderLight,color:i.colors.textSecondary},children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm leading-relaxed mb-6",style:{color:i.colors.textPrimary},children:s}),e.jsxs("div",{className:"flex gap-3",children:[r==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:i.colors.borderLight,color:i.colors.textSecondary},children:f}),e.jsx("button",{onClick:h,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${r==="success"?"bg-green-600 text-white hover:bg-green-700":r==="alert"?"bg-red-600 text-white hover:bg-red-700":"text-white hover:opacity-80"}`,style:r==="confirm"?{backgroundColor:i.colors.primary}:{},children:r==="confirm"?n:"OK"})]})]})})})},Pe=()=>{const[c,t]=E.useState(!1),[a,o]=E.useState({title:"",message:""}),[s,r]=E.useState(null);return{isOpen:c,config:a,onConfirm:s,close:()=>{t(!1),r(null)},showConfirm:(d,h,u,m)=>{o({title:d,message:h,type:"confirm",confirmText:m==null?void 0:m.confirmText,cancelText:m==null?void 0:m.cancelText}),r(()=>u),t(!0)},showAlert:(d,h,u="info")=>{o({title:d,message:h,type:u}),r(null),t(!0)}}},yr=()=>{const c=Z(),[t]=vt(),a=Vt(),{books:o,setActiveBook:s,sessions:r,notes:n,addBook:f,updatePublicStatsAfterBookCompletion:i}=me(),{refreshLeaderboard:d}=Ae(),{updatePetFromBookCompletion:h}=le(),{theme:u}=z(),[m,k]=E.useState(!1),[l,j]=E.useState(null),[x,C]=E.useState(!1),[p,_]=E.useState(!1),[v,g]=E.useState(!1),N=Pe(),b=t.get("book");if(E.useEffect(()=>{var R;if((R=a.state)!=null&&R.bookData)j(a.state.bookData);else{const M=o.find(J=>J.key===b);if(M)j(M);else{c("/");return}}},[b,o,a.state,c]),E.useEffect(()=>{if(l){const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(q=>q.key===l.key);C(M);const J=_t(l.key);if(J&&J.description&&!l.description){j(q=>({...q,description:J.description,number_of_pages_median:J.number_of_pages_median||q.number_of_pages_median}));return}l.description||(k(!0),Is(l.key).then(q=>{if(q){const Y={...l,description:q.description,number_of_pages_median:q.number_of_pages_median||l.number_of_pages_median};j(Y),xt(Y)}}).catch(q=>{console.error("Error fetching book details:",q),J&&j(Y=>({...Y,...J}))}).finally(()=>{k(!1)}))}},[l]),!l)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>c("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const A=async R=>{const M=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!M.some(J=>J.key===l.key)){const J={...l,category:R==="want-to-read"?"wishlist":"reading",dateAdded:new Date().toISOString()};await f(J),M.push(J),localStorage.setItem("bookish_books",JSON.stringify(M)),xt(J);const q=JSON.parse(localStorage.getItem("myBooks")||"[]");q.some(Y=>Y.key===l.key)||(q.push(J),localStorage.setItem("myBooks",JSON.stringify(q))),C(!0),_(!1),R==="currently-reading"&&(s(l),c("/reading"))}},F=()=>{N.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{var te;const R={...l,category:"completed",completedAt:new Date().toISOString()};await f(R),await i();const J=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(W=>W.key===l.key?R:W);localStorage.setItem("bookish_books",JSON.stringify(J));const Y=JSON.parse(localStorage.getItem("myBooks")||"[]").map(W=>W.key===l.key?R:W);localStorage.setItem("myBooks",JSON.stringify(Y)),h(),setTimeout(()=>{d("week","books_read")},1e3),l.key===((te=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:te.key)&&s(null),N.showAlert("Congratulations!","🎉 You've completed the book and your pet gained experience!","success"),setTimeout(()=>{c("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},$=l.number_of_pages_median||0,G=[...r].filter(R=>R.bookId===l.key).sort((R,M)=>new Date(M.startTime).getTime()-new Date(R.startTime).getTime())[0],T=(G==null?void 0:G.endPage)||(G==null?void 0:G.startPage)||1,I=$>0?Math.min(Math.round(T/$*100),100):0,U=r.filter(R=>R.bookId===l.key).reduce((R,M)=>R+(M.duration||0),0),w=Math.floor(U/60),O=U%60,y=w>0?`${w} hr${w!==1?"s":""} ${O>0?`${O} min`:""}`:`${O} min`,P=n.filter(R=>R.bookId===l.key),B=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(R=>R.key===l.key),S=(B==null?void 0:B.category)==="completed",D=()=>{c(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:u.colors.background},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:u.colors.background},children:e.jsx("button",{onClick:D,className:"w-8 h-8 flex items-center justify-center rounded-full hover:opacity-80 transition-colors",style:{backgroundColor:u.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:u.colors.primary}})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:l.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${l.cover_i}-M.jpg`,alt:l.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:u.colors.primary},children:e.jsx(V,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium mb-2 leading-tight",style:{color:u.colors.textPrimary},children:l.title}),l.author_name&&l.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-3",style:{color:u.colors.textSecondary},children:["by ",l.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[l.first_publish_year&&e.jsxs("p",{className:"text-xs",style:{color:u.colors.textSecondary},children:["First published: ",l.first_publish_year]}),$>0&&e.jsxs("p",{className:"text-xs",style:{color:u.colors.textSecondary},children:[$," pages"]})]})]})]}),"        ",x&&$>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:u.colors.textPrimary},children:[I,"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden mb-2",style:{backgroundColor:u.colors.borderLight},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${I}%`,backgroundColor:u.colors.secondary}})}),e.jsxs("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:["Page ",T," of ",$]})]}),e.jsx("div",{className:"w-px",style:{backgroundColor:u.colors.border}}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(wt,{className:"w-5 h-5 mb-1",style:{color:u.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:u.colors.textPrimary},children:y}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),m?e.jsx("div",{className:"h-32 animate-pulse rounded-lg mb-6",style:{backgroundColor:u.colors.borderLight}}):l.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:u.colors.textPrimary},children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm leading-relaxed ${v?"":"line-clamp-4"}`,style:{color:u.colors.textPrimary},children:typeof l.description=="string"?l.description:"No description available."}),l.description&&l.description.length>200&&e.jsx("button",{onClick:()=>g(!v),className:"mt-2 flex items-center gap-1 text-sm font-medium hover:opacity-80 transition-colors",style:{color:u.colors.textSecondary},children:v?e.jsxs(e.Fragment,{children:["Show less",e.jsx(ds,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(us,{className:"w-4 h-4"})]})})]})]}):null,x&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>c("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),P.length>0?e.jsx("div",{className:"space-y-2",children:P.slice(0,2).map(R=>e.jsxs("div",{className:"p-3 rounded-lg shadow-sm",style:{backgroundColor:u.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:[R.chapter?`Chapter: ${R.chapter}`:"",R.chapter&&R.page?" • ":"",R.page?`Page ${R.page}`:""]}),e.jsx("span",{className:"text-xs",style:{color:u.colors.textSecondary},children:new Date(R.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm line-clamp-2",style:{color:u.colors.textPrimary},children:R.content})]},R.id))}):e.jsx("div",{className:"p-4 rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:u.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-6 h-6 mx-auto mb-2",style:{color:u.colors.textSecondary}}),e.jsx("p",{className:"text-sm mb-1",style:{color:u.colors.textSecondary},children:"No notes yet"}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 border-t flex gap-4 max-w-md mx-auto",style:{backgroundColor:u.colors.surface,borderColor:u.colors.border},children:x?e.jsx(e.Fragment,{children:S?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("/notes/add"),className:"flex-1 py-3 px-4 border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:u.colors.surface},children:[e.jsx(be,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(l),c("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:F,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(ve,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c("/library"),className:"flex-1 py-3 px-4 border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",style:{backgroundColor:u.colors.surface},children:"View Library"}),e.jsxs("button",{onClick:()=>_(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Ct,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),"      ",p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:u.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:u.colors.textPrimary},children:"Add to Library"}),e.jsx("p",{className:"text-sm mb-6",style:{color:u.colors.textSecondary},children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>A("want-to-read"),className:"w-full p-4 rounded-lg text-left hover:opacity-80 transition-colors",style:{backgroundColor:u.colors.borderLight},children:[e.jsx("div",{className:"font-medium mb-1",style:{color:u.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:u.colors.textSecondary},children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>A("currently-reading"),className:"w-full p-4 text-white rounded-lg text-left hover:opacity-90 transition-colors",style:{backgroundColor:u.colors.primary},children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>_(!1),className:"w-full mt-4 py-2 text-sm hover:opacity-80 transition-colors",style:{color:u.colors.textSecondary},children:"Cancel"})]})}),e.jsx(Ee,{isOpen:N.isOpen,onClose:N.close,onConfirm:N.onConfirm||void 0,title:N.config.title,message:N.config.message,type:N.config.type,confirmText:N.config.confirmText,cancelText:N.config.cancelText})]})},Q=[];for(let c=0;c<256;++c)Q.push((c+256).toString(16).slice(1));function br(c,t=0){return(Q[c[t+0]]+Q[c[t+1]]+Q[c[t+2]]+Q[c[t+3]]+"-"+Q[c[t+4]]+Q[c[t+5]]+"-"+Q[c[t+6]]+Q[c[t+7]]+"-"+Q[c[t+8]]+Q[c[t+9]]+"-"+Q[c[t+10]]+Q[c[t+11]]+Q[c[t+12]]+Q[c[t+13]]+Q[c[t+14]]+Q[c[t+15]]).toLowerCase()}let qe;const vr=new Uint8Array(16);function jr(){if(!qe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");qe=crypto.getRandomValues.bind(crypto)}return qe(vr)}const wr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),pt={randomUUID:wr};function Te(c,t,a){var s;if(pt.randomUUID&&!c)return pt.randomUUID();c=c||{};const o=c.random??((s=c.rng)==null?void 0:s.call(c))??jr();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,br(o)}const fe="bookish_active_timer",kr=({bookId:c,startPage:t})=>{const[a,o]=E.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=E.useRef();E.useEffect(()=>{const u=localStorage.getItem(fe);if(u)try{const m=JSON.parse(u);m.bookId===c?o(m.timerState):localStorage.removeItem(fe)}catch(m){console.error("Error loading timer state:",m),localStorage.removeItem(fe)}},[c]),E.useEffect(()=>{a.sessionId&&localStorage.setItem(fe,JSON.stringify({bookId:c,startPage:t,timerState:a}))},[a,c,t]),E.useEffect(()=>(a.isActive?s.current=setInterval(()=>{o(u=>({...u}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[a.isActive]);const r=()=>{if(!a.startTime)return 0;let u=a.totalElapsed;if(a.isActive&&a.lastPauseTime===null){const m=Date.now(),k=new Date(a.startTime).getTime();u+=Math.floor((m-k)/1e3)}return u},n=r(),f=()=>{const u=new Date().toISOString();a.sessionId?o(m=>({...m,startTime:u,lastPauseTime:null,isActive:!0})):o({sessionId:Te(),startTime:u,totalElapsed:0,lastPauseTime:null,isActive:!0})},i=()=>{if(!a.isActive||!a.startTime)return;const u=Date.now(),m=new Date(a.startTime).getTime(),k=Math.floor((u-m)/1e3);o(l=>({...l,totalElapsed:l.totalElapsed+k,lastPauseTime:new Date().toISOString(),isActive:!1}))},d=u=>{const m=r(),k={id:a.sessionId||Te(),bookId:c,startTime:a.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:u,duration:Math.floor(m/60)};return o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(fe),k},h=()=>{o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(fe)};return{isActive:a.isActive,elapsedTime:n,startTimer:f,pauseTimer:i,stopTimer:d,resetTimer:h}},Nr=()=>{const c=Z(),{currentBook:t,addSession:a,addNote:o,addBook:s,updatePublicStatsAfterBookCompletion:r}=me(),{refreshLeaderboard:n}=Ae(),{updatePetFromReading:f}=le(),{theme:i}=z(),d=Pe(),[h,u]=E.useState(1),[m,k]=E.useState(1),[l,j]=E.useState(!1),[x,C]=E.useState(""),[p,_]=E.useState(""),[v,g]=E.useState(!1),[N,b]=E.useState(!1),{isActive:A,elapsedTime:F,startTimer:$,pauseTimer:G,stopTimer:T,resetTimer:I}=kr({bookId:(t==null?void 0:t.key)||"",startPage:1});if(E.useEffect(()=>{if(t&&!N){const S=localStorage.getItem("bookish_active_timer");if(S)try{const M=JSON.parse(S);if(M.bookId===t.key){u(M.startPage),k(M.startPage),b(!0);return}}catch(M){console.error("Error parsing active timer:",M)}const R=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(M=>M.bookId===t.key);if(R.length>0){R.sort((J,q)=>new Date(q.startTime).getTime()-new Date(J.startTime).getTime());const M=R[0].endPage||R[0].startPage;u(M),k(M)}b(!0)}},[t,N]),E.useEffect(()=>{const S=D=>{A&&(D.preventDefault(),D.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",S),()=>window.removeEventListener("beforeunload",S)},[A]),!t)return c("/"),null;const U=()=>{try{if(!t){d.showAlert("Error","No book selected","alert");return}if(m<h){d.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(F<=0){d.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const S=T(m);if(!S)throw new Error("Failed to create session");if(a(S),S.duration&&f(S.duration),x.trim()){const D={id:Te(),bookId:t.key,page:m,chapter:p.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(D)}c("/")}catch(S){console.error("Error finishing session:",S),d.showAlert("Error","Failed to save reading session. Please try again.","alert")}},w=S=>{const D=Math.floor(S/3600),R=Math.floor(S%3600/60),M=S%60;return D>0?`${D}:${R.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`:`${R.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`},O=t.number_of_pages_median||9999,y=t.number_of_pages_median&&t.number_of_pages_median>0,P=()=>{const S=(t==null?void 0:t.number_of_pages_median)||0;return S>0&&m>=S},L=S=>{const D=Math.max(h,Math.min(S,O));k(D),t!=null&&t.number_of_pages_median&&D>=t.number_of_pages_median&&g(!0)},B=async()=>{try{const S=T(m);if(S&&(a(S),S.duration&&f(S.duration)),x.trim()){const Y={id:Te(),bookId:t.key,page:m,chapter:p.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(Y)}const D={...t,category:"completed",completedAt:new Date().toISOString()};await s(D),await r();const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(Y=>Y.key===t.key?D:Y);localStorage.setItem("bookish_books",JSON.stringify(M));const q=JSON.parse(localStorage.getItem("myBooks")||"[]").map(Y=>Y.key===t.key?{...Y,category:"completed",completedAt:new Date().toISOString()}:Y);localStorage.setItem("myBooks",JSON.stringify(q)),localStorage.removeItem("bookish_current_book"),f((S==null?void 0:S.duration)||0,!0),setTimeout(()=>{n("week","books_read")},1e3),d.showAlert("Congratulations!","🎉 You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{c("/library")},2e3)}catch(S){console.error("Error marking book as finished:",S),d.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",style:{backgroundColor:i.colors.background},children:[e.jsxs("header",{className:"p-4 flex items-center gap-3 shadow-sm",style:{backgroundColor:i.colors.surface},children:[e.jsx("button",{onClick:()=>{A||F>0?d.showConfirm("Leave Reading Session",A?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!A&&F>0?U():c(-1)},{confirmText:A?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):c(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:i.colors.borderLight,color:i.colors.textSecondary},children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-serif text-lg font-medium",style:{color:i.colors.textPrimary},children:"Reading Session"}),A&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",style:{backgroundColor:i.colors.surface},children:[e.jsxs("div",{className:"flex items-center p-4",style:{borderBottom:`1px solid ${i.colors.border}`},children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:Ls(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full",style:{backgroundColor:i.colors.secondary}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium line-clamp-1",style:{color:i.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm",style:{color:i.colors.textSecondary},children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center shadow-inner",style:{backgroundColor:i.colors.borderLight},children:e.jsx("span",{className:"font-serif text-2xl font-medium",style:{color:i.colors.textPrimary},children:w(F)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:A?G:$,className:"w-16 h-16 rounded-full text-white flex items-center justify-center shadow-md transition-colors hover:opacity-90",style:{backgroundColor:i.colors.primary},children:A?e.jsx(hs,{className:"w-8 h-8"}):e.jsx(fs,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:i.colors.textSecondary},children:"Start Page"}),e.jsx("input",{type:"number",value:h,onChange:S=>{const D=Math.max(1,Math.min(parseInt(S.target.value)||1,O));u(D),m<D&&k(D)},min:"1",max:O,className:"w-full p-2 rounded-md",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.textPrimary},disabled:A||F>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:i.colors.textSecondary},children:"End Page"}),e.jsx("input",{type:"number",value:m,onChange:S=>L(parseInt(S.target.value)||h),min:h,max:O,className:"w-full p-2 rounded-md",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.textPrimary}})]})]}),P()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:B,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!y&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"📘 Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>j(!l),className:"w-full py-2 text-sm mb-2",style:{color:i.colors.primary},children:l?"Hide Note Form":"+ Add a note about this session"}),l&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 rounded-lg",style:{backgroundColor:i.colors.borderLight},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:i.colors.textSecondary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:p,onChange:S=>_(S.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 rounded-md",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:i.colors.textSecondary},children:"Note"}),e.jsx("textarea",{value:x,onChange:S=>C(S.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 rounded-md resize-none",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.textPrimary}})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 flex gap-4 max-w-md mx-auto",style:{backgroundColor:i.colors.surface,borderTop:`1px solid ${i.colors.border}`},children:[e.jsxs("button",{onClick:()=>{d.showConfirm("Cancel Session",A?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{I(),c(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors hover:opacity-80",style:{backgroundColor:i.colors.surface,border:`1px solid ${i.colors.border}`,color:i.colors.textSecondary},children:[e.jsx(Me,{className:"w-5 h-5"}),"Cancel"]}),P()?e.jsxs("button",{onClick:B,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-green-700 transition-colors",children:[e.jsx(de,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:U,className:"flex-1 py-3 px-4 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors hover:opacity-90",style:{backgroundColor:i.colors.primary},disabled:F<=0||m<h,children:[e.jsx(ve,{className:"w-5 h-5"}),"Finish Session"]})]}),"      ",v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:i.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(de,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:i.colors.textPrimary},children:"Congratulations!"}),e.jsxs("p",{className:"text-sm mb-6",style:{color:i.colors.textSecondary},children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:B,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>g(!1),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:i.colors.surface,border:`1px solid ${i.colors.border}`,color:i.colors.textSecondary},children:"Continue Reading"})]})]})})}),e.jsx(Ee,{isOpen:d.isOpen,onClose:d.close,onConfirm:d.onConfirm||void 0,title:d.config.title,message:d.config.message,type:d.config.type,confirmText:d.config.confirmText,cancelText:d.config.cancelText})]})},Sr=()=>{const c=Z(),{books:t,addBook:a,updatePublicStatsAfterBookCompletion:o}=me(),{refreshLeaderboard:s}=Ae(),{updatePetFromBookCompletion:r}=le(),{theme:n}=z(),f=Pe(),[i,d]=E.useState(null),[h,u]=E.useState(null),[m,k]=E.useState({}),[l,j]=E.useState([]);E.useEffect(()=>{(()=>{const I=JSON.parse(localStorage.getItem("bookish_books")||"[]");j(I)})()},[]),E.useEffect(()=>{const T=()=>{d(null)};if(i)return document.addEventListener("click",T),()=>document.removeEventListener("click",T)},[i]);const x=l.length>0?l:t,C=T=>{c(`/book?book=${T.key}`,{state:{bookData:T}})},p=(T,I)=>{I.stopPropagation(),f.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const w=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(B=>B.key!==T);localStorage.setItem("bookish_books",JSON.stringify(w));const y=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(B=>B.key!==T);localStorage.setItem("myBooks",JSON.stringify(y));const P=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete P[T],localStorage.setItem("bookish_cached_books",JSON.stringify(P));const L=JSON.parse(localStorage.getItem("bookish_current_book")||"null");L&&L.key===T&&localStorage.removeItem("bookish_current_book"),j(w)},{confirmText:"Remove",cancelText:"Keep Book"}),d(null)},_=async(T,I,U)=>{const w=JSON.parse(localStorage.getItem("bookish_books")||"[]"),O=w.find(S=>S.key===T);if(!O)return;const y={...O,category:I,...I==="completed"&&{completedAt:new Date().toISOString()}};await a(y);const P=w.map(S=>S.key===T?y:S);localStorage.setItem("bookish_books",JSON.stringify(P));const B=JSON.parse(localStorage.getItem("myBooks")||"[]").map(S=>S.key===T?y:S);localStorage.setItem("myBooks",JSON.stringify(B)),await Ie(),j(P),u(null),d(null),I==="completed"&&await o()},v=(T,I)=>{I.stopPropagation(),f.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{await _(T,"completed"),await o(),r(),setTimeout(()=>{s("week","books_read")},1e3),setTimeout(()=>{f.showAlert("Book Completed!","🎉 Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),d(null)},g=(T,I)=>{I.stopPropagation(),d(i===T?null:T)},N=T=>{const I=gt(T);if(I.length===0)return 0;const U=I[I.length-1],w=t.find(O=>O.key===T);return!(w!=null&&w.number_of_pages_median)||!U.endPage?0:Math.min(100,Math.round(U.endPage/w.number_of_pages_median*100))},b=T=>gt(T).reduce((U,w)=>U+(w.duration||0),0),A=T=>{const I=Math.floor(T/60),U=T%60;return I>0?`${I}h ${U}m`:`${U}m`},F=()=>{const T=[],I=[],U=[];return x.forEach(w=>{const O=N(w.key),y=b(w.key);w.category==="want-to-read"?U.push(w):w.category==="completed"||O>=100?I.push(w):w.category==="currently-reading"||O>0||y>0?T.push(w):U.push(w)}),{currentlyReading:T,completed:I,wantToRead:U}},$=T=>{const I=N(T.key),U=b(T.key),w=m[T.key]||{translateX:0,isDeleting:!1},O=S=>{const D=S.touches[0];k(R=>({...R,[T.key]:{...w,startX:D.clientX,startY:D.clientY}}))},y=S=>{const D=S.touches[0],R=m[T.key];if(!(R!=null&&R.startX)||!(R!=null&&R.startY))return;const M=D.clientX-R.startX,J=D.clientY-R.startY;Math.abs(J)>Math.abs(M)||M<-20&&k(q=>({...q,[T.key]:{...R,translateX:Math.max(M,-120)}}))},P=()=>{const S=m[T.key];S&&(S.translateX<-60?k(D=>({...D,[T.key]:{...S,translateX:-120,isDeleting:!0}})):k(D=>({...D,[T.key]:{...S,translateX:0,isDeleting:!1}})))},L=()=>{f.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const D=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(J=>J.key!==T.key);localStorage.setItem("bookish_books",JSON.stringify(D));const M=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(J=>J.key!==T.key);localStorage.setItem("myBooks",JSON.stringify(M)),j(D),k(J=>{const q={...J};return delete q[T.key],q})},{confirmText:"Remove",cancelText:"Keep Book"})},B=()=>{k(S=>({...S,[T.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{backgroundColor:n.colors.surface,transform:`translateX(${w.translateX}px)`,transition:w.isDeleting||w.translateX===0?"transform 0.3s ease":"none",overflow:w.isDeleting?"hidden":"visible"},onTouchStart:O,onTouchMove:y,onTouchEnd:P,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!w.isDeleting&&C(T),children:["          ",e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 flex items-center justify-center",style:{backgroundColor:n.colors.borderLight},children:[T.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${T.cover_i}-M.jpg`,alt:T.title,className:"w-full h-full object-cover rounded",onError:S=>{var R;const D=S.target;D.style.display="none",(R=D.nextElementSibling)==null||R.classList.remove("hidden")}}):null,e.jsx(V,{className:`w-6 h-6 ${T.cover_i?"hidden":""}`,style:{color:n.colors.textSecondary}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:n.colors.textPrimary},children:T.title}),T.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:n.colors.textSecondary},children:["by ",T.author_name[0]]}),I>0&&I<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:[I,"%"]})]}),e.jsx("div",{className:"w-full rounded-full h-1.5",style:{backgroundColor:n.colors.borderLight},children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${I}%`,backgroundColor:n.colors.secondary}})})]}),I>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),U>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:n.colors.textSecondary},children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsxs("span",{children:[A(U)," read"]})]})]})]}),!w.isDeleting&&e.jsx("button",{onClick:S=>g(T.key,S),className:"absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:e.jsx(xs,{className:"w-4 h-4",style:{color:n.colors.textSecondary}})}),"        ",i===T.key&&!w.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 rounded-lg shadow-lg py-1 z-50 min-w-[180px]",style:{backgroundColor:n.colors.surface,border:`1px solid ${n.colors.border}`},children:[e.jsxs("button",{onClick:S=>{S.stopPropagation(),u(T.key),d(null)},className:"flex items-center gap-2 px-3 py-2 text-sm w-full text-left transition-colors hover:opacity-80",style:{color:n.colors.textSecondary,backgroundColor:"transparent"},onMouseEnter:S=>S.currentTarget.style.backgroundColor=n.colors.borderLight,onMouseLeave:S=>S.currentTarget.style.backgroundColor="transparent",children:[e.jsx(gs,{className:"w-4 h-4"}),"Move to category"]}),T.category!=="completed"&&e.jsxs("button",{onClick:S=>v(T.key,S),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(ve,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:S=>p(T.key,S),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Remove from library"]})]}),w.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:["              ",e.jsx("button",{onClick:B,className:"px-3 py-1 text-xs text-red-500 rounded",style:{backgroundColor:n.colors.surface},children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},T.key)},G=(T,I)=>I.length===0?null:e.jsxs("div",{className:"mb-8",children:["        ",e.jsxs("h2",{className:"font-serif text-lg font-medium mb-4 flex items-center gap-2",style:{color:n.colors.textPrimary},children:[T,e.jsxs("span",{className:"text-sm font-normal",style:{color:n.colors.textSecondary},children:["(",I.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:I.map($)})]});return e.jsx(Le,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:n.colors.background,borderColor:n.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:n.colors.surfaceSecondary},children:e.jsx(se,{className:"w-5 h-5",style:{color:n.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:n.colors.textPrimary},children:"My Library"})]})}),e.jsx("main",{className:"p-4",children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 mx-auto mb-4",style:{color:n.colors.textSecondary}}),"            ",e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:n.colors.textPrimary},children:"No books yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>c("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:n.colors.secondary},children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:n.colors.textSecondary},children:[x.length," book",x.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:T,completed:I,wantToRead:U}=F();return e.jsxs(e.Fragment,{children:[G("Currently Reading",T),G("Want to Read",U),G("Completed",I)]})})()]})}),h&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:["          ",e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:n.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:n.colors.textPrimary},children:"Move Book"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>_(h,"want-to-read"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>_(h,"currently-reading"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Currently Reading"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>_(h,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>u(null),className:"w-full mt-4 py-2 text-sm transition-colors hover:opacity-80",style:{color:n.colors.textSecondary},children:"Cancel"}),"          "]})]}),"      ",e.jsx(Ee,{isOpen:f.isOpen,onClose:f.close,onConfirm:f.onConfirm||void 0,title:f.config.title,message:f.config.message,type:f.config.type,confirmText:f.config.confirmText,cancelText:f.config.cancelText})]})})},Cr=()=>{const c=Z(),{books:t}=me(),{pet:a}=le(),{theme:o}=z(),[s,r]=E.useState(Ce()),[n,f]=E.useState(ye()),i=Ge();E.useEffect(()=>{const l=j=>{r(j.detail),f(ye())};return window.addEventListener("statsUpdated",l),r(Ce()),f(ye()),()=>{window.removeEventListener("statsUpdated",l)}},[]);const d=l=>{const j=Math.floor(l/60),x=l%60;return j>0?`${j}h ${x}m`:`${x}m`},h=()=>{if(i.length===0)return 0;const l=i.reduce((j,x)=>j+(x.duration||0),0);return Math.round(l/i.length)},m=(()=>{const l=new Date,j=new Date(l.getFullYear(),l.getMonth(),1),x=i.filter(_=>new Date(_.startTime)>=j),C=x.reduce((_,v)=>_+(v.duration||0),0),p=x.reduce((_,v)=>_+((v.endPage||0)-(v.startPage||0)),0);return{time:C,pages:p,sessions:x.length}})(),k=({icon:l,title:j,value:x,subtitle:C})=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(l,{className:"w-4 h-4",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:j})]}),e.jsx("p",{className:"text-2xl font-serif font-medium mb-1",style:{color:o.colors.textPrimary},children:x}),C&&e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:C})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:o.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:o.colors.background,borderBottom:`1px solid ${o.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:o.colors.textPrimary},children:"Reading Statistics"})]})}),"      ",e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(k,{icon:V,title:"Books Read",value:s.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(k,{icon:ae,title:"Total Time",value:d(s.totalReadingTime),subtitle:"all time"}),e.jsx(k,{icon:Se,title:"Pages Read",value:s.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(k,{icon:ot,title:"Current Streak",value:`${n.currentStreak} days`,subtitle:`longest: ${n.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ze,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsx("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:m.sessions}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:d(m.time)}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:m.pages}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"pages"})]})]})]})})]}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(k,{icon:ae,title:"Today",value:d(s.readingTimeToday)}),e.jsx(k,{icon:ze,title:"This Week",value:d(s.readingTimeThisWeek)}),e.jsx(k,{icon:Se,title:"Average Session",value:d(h())}),e.jsx(k,{icon:V,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Reading Companion"}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ps,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:[a.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.level}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:[a.happiness,"%"]}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.experience}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"experience"})]})]})]})]}),i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ot,{className:"w-16 h-16 mx-auto mb-4",style:{color:o.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:o.colors.textPrimary},children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm mb-6",style:{color:o.colors.textSecondary},children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>c("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:o.colors.secondary},children:"Find a Book to Read"})]})]})]})},Tr=()=>{const c=Z(),{notes:t,books:a,deleteNote:o}=me(),{theme:s}=z(),r=Pe(),n=d=>{r.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{o(d)},{confirmText:"Delete",cancelText:"Cancel"})},f=d=>{const h=a.find(u=>u.key===d);return h?h.title:"Unknown Book"},i=d=>new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:s.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:s.colors.background,borderBottom:`1px solid ${s.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:s.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:"My Notes"})]}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.secondary},children:e.jsx(Ct,{className:"w-5 h-5 text-white"})})]})}),"      ",e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4",style:{color:s.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:s.colors.textPrimary},children:"No notes yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:s.colors.textSecondary},children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>c("/notes/add"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:s.colors.secondary},children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(d=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4",style:{color:s.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:s.colors.textPrimary},children:f(d.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:s.colors.textSecondary},children:[d.chapter&&e.jsxs("span",{children:["Chapter: ",d.chapter]}),d.page&&e.jsxs("span",{children:["Page ",d.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsx("span",{children:i(d.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>n(d.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(Tt,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",style:{color:s.colors.textPrimary},children:d.content})})]},d.id))]})}),e.jsx(Ee,{isOpen:r.isOpen,onClose:r.close,onConfirm:r.onConfirm||void 0,title:r.config.title,message:r.config.message,type:r.config.type,confirmText:r.config.confirmText,cancelText:r.config.cancelText})]})},Ar=()=>{const c=Z(),[t]=vt(),{books:a,currentBook:o,addNote:s,notes:r,updateNote:n}=me(),{theme:f}=z(),i=Pe(),d=t.get("edit"),[h,u]=E.useState((o==null?void 0:o.key)||""),[m,k]=E.useState(""),[l,j]=E.useState(""),[x,C]=E.useState("");E.useEffect(()=>{var v;if(d){const g=r.find(N=>N.id===d);g&&(u(g.bookId),k(g.content),j(((v=g.page)==null?void 0:v.toString())||""),C(g.chapter||""))}},[d,r]);const p=()=>{var g;if(!m.trim()){i.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const v={id:d||Te(),bookId:h,content:m.trim(),page:l?parseInt(l):void 0,chapter:x.trim()||void 0,createdAt:d?((g=r.find(N=>N.id===d))==null?void 0:g.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};d&&n?n(v):s(v),i.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{c("/notes")},1500)},_=()=>{m.trim()||x.trim()||l.trim()?i.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{c(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):c(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:f.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:f.colors.background,borderColor:f.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:_,className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:f.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:f.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:f.colors.textPrimary},children:d?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(ys,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:f.colors.textPrimary},children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:h,onChange:v=>u(v.target.value),className:"w-full p-3 pr-10 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] appearance-none",style:{backgroundColor:f.colors.surface,borderColor:f.colors.border,color:f.colors.textPrimary},children:[e.jsx("option",{value:"",children:"Choose a book..."}),a.map(v=>e.jsx("option",{value:v.key,children:v.title},v.key))]}),e.jsx(V,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:f.colors.textSecondary}})]})]}),"        ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:f.colors.textPrimary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:x,onChange:v=>C(v.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:f.colors.surface,borderColor:f.colors.border,color:f.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:f.colors.textPrimary},children:"Page (optional)"}),e.jsx("input",{type:"number",value:l,onChange:v=>j(v.target.value),placeholder:"Page number",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:f.colors.surface,borderColor:f.colors.border,color:f.colors.textPrimary}})]})]}),"        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:f.colors.textPrimary},children:"Your Note"}),e.jsx("textarea",{value:m,onChange:v=>k(v.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] resize-none",style:{backgroundColor:f.colors.surface,borderColor:f.colors.border,color:f.colors.textPrimary}}),e.jsxs("p",{className:"text-xs mt-2",style:{color:f.colors.textSecondary},children:[m.length,"/500 characters"]})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:f.colors.surface},children:[e.jsx("h3",{className:"font-medium mb-2",style:{color:f.colors.textPrimary},children:"💡 Note-taking tips:"}),e.jsxs("ul",{className:"text-sm space-y-1",style:{color:f.colors.textSecondary},children:[e.jsx("li",{children:"• Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"• Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"• Record connections to other books or personal experiences"}),e.jsx("li",{children:"• Include your emotional reactions or reflections"})]})]})]}),e.jsx(Ee,{isOpen:i.isOpen,onClose:i.close,onConfirm:i.onConfirm||void 0,title:i.config.title,message:i.config.message,type:i.config.type,confirmText:i.config.confirmText,cancelText:i.config.cancelText})]})},Er=()=>{const c=Z(),{theme:t}=z(),{pet:a,petStats:o,feedPet:s,playWithPet:r,petSleep:n,getPetMood:f,getPetEvolutionRequirement:i,resetPet:d,updatePetName:h,getPetEmoji:u,canEvolve:m,evolvePet:k}=le(),[l,j]=E.useState(!1),[x,C]=E.useState(a.name),[p,_]=E.useState(!1),v=T=>T>70?"bg-green-500":T>40?"bg-yellow-500":"bg-red-500",g=T=>`${Math.max(0,Math.min(100,T))}%`,N=()=>{x.trim()&&(h(x.trim()),j(!1))},b=()=>{d(),_(!1)},A=T=>({"first-book":"📖","book-lover":"📚",bookworm:"🐛","speed-reader":"⚡","night-owl":"🦉","early-bird":"🐦"})[T]||"🏆",F=T=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[T]||"Special achievement",$=T=>{const I=Math.floor(T/60),U=T%60;return I>0?`${I}h ${U}m`:`${U}m`},G=i();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:["      ",e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"My Reading Pet"})]}),e.jsxs("button",{onClick:()=>c("/pet-shop"),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white font-medium hover:opacity-90 transition-opacity",children:[e.jsx(At,{className:"w-4 h-4"}),"Shop"]})]})}),!a.isAlive&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-300 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"💀"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"Your Pet Has Died!"}),e.jsx("p",{className:"text-red-700",children:"Visit the shop to buy a Phoenix Feather to revive them."}),a.deathDate&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Died: ",new Date(a.deathDate).toLocaleString()]})]})]})}),a.isAlive&&a.mood==="dying"&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-400 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"CRITICAL CONDITION!"}),e.jsx("p",{className:"text-red-700",children:"Your pet is dying! Take immediate action!"})]})]})}),a.isAlive&&a.hunger<15&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-orange-50 border-2 border-orange-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🍖"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-orange-800",children:"Starving!"}),e.jsx("p",{className:"text-orange-700",children:"Your pet desperately needs food!"})]})]})}),a.isAlive&&a.sickness>70&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-purple-50 border-2 border-purple-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🤒"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-purple-800",children:"Seriously Ill!"}),e.jsx("p",{className:"text-purple-700",children:"Your pet needs medicine urgently!"})]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-6 text-center",style:{backgroundColor:t.colors.surface},children:[e.jsx("div",{className:"text-8xl mb-4",children:u()}),e.jsxs("div",{className:"mb-4",children:[l?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:x,onChange:T=>C(T.target.value),className:"text-2xl font-serif font-medium rounded px-3 py-1 border text-center",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary,borderColor:t.colors.border},onBlur:N,onKeyPress:T=>T.key==="Enter"&&N(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["                ",e.jsx("h2",{className:"text-2xl font-serif font-medium",style:{color:t.colors.textPrimary},children:a.name}),e.jsx("button",{onClick:()=>j(!0),className:"p-1 rounded transition-colors hover:opacity-80",style:{color:t.colors.textSecondary,backgroundColor:t.colors.borderLight},children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg mb-2",style:{color:t.colors.textSecondary},children:[e.jsxs("span",{children:["Level ",a.level]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:a.evolutionStage})]}),m()&&e.jsxs("button",{onClick:k,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["✨ Evolve to ",G.stage,"!"]})]}),"          ",e.jsx("p",{className:"mb-4",style:{color:t.colors.textPrimary},children:f()}),e.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold mb-1",style:{color:t.colors.primary},children:["💰 ",a.points]}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Care Points (Earned from reading)"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",style:{color:t.colors.textSecondary},children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[a.experience,"/",a.experienceToNext]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${a.experience/a.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:s,disabled:a.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ue,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"💰 3 pts"})]}),e.jsxs("button",{onClick:r,disabled:a.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"💰 5 pts"})]}),e.jsxs("button",{onClick:n,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(Ne,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),"                ",e.jsxs("span",{children:[a.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${v(a.happiness)} rounded-full transition-all duration-300`,style:{width:g(a.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),"                ",e.jsxs("span",{children:[a.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${v(a.hunger)} rounded-full transition-all duration-300`,style:{width:g(a.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),"                ",e.jsxs("span",{children:[a.energy,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${v(a.energy)} rounded-full transition-all duration-300`,style:{width:g(a.energy)}})})]}),"            ",e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[a.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${v(a.health)} rounded-full transition-all duration-300`,style:{width:g(a.health)}})})]}),a.sickness>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-purple-500",children:"🤒"}),e.jsx("span",{children:"Sickness"})]}),e.jsxs("span",{className:"text-purple-600 font-medium",children:[Math.round(a.sickness),"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-purple-600 rounded-full transition-all duration-300",style:{width:g(a.sickness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-500",children:"🧼"}),e.jsx("span",{children:"Cleanliness"})]}),e.jsxs("span",{children:[Math.round(a.cleanliness),"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${v(a.cleanliness)} rounded-full transition-all duration-300`,style:{width:g(a.cleanliness)}})})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:["            ",e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:a.totalBooksRead}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:$(a.totalReadingTime)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:o.booksReadToday}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:$(o.readingTimeToday)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Time"})]})]})]}),"        ",a.badges.length>0&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.badges.map((T,I)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl",children:A(T)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize text-sm",style:{color:t.colors.textPrimary},children:T.replace("-"," ")}),e.jsx("div",{className:"text-xs",style:{color:t.colors.textSecondary},children:F(T)})]})]},I))})]}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Pet Management"}),e.jsx("p",{className:"text-sm mb-4",style:{color:t.colors.textSecondary},children:"Reset your pet to start over with a new companion. This action cannot be undone."}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(bs,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},Pr=()=>{const c=Z(),{theme:t}=z(),{pet:a,getShopItems:o,getUnlockedItems:s,buyItem:r,useItem:n}=le(),[f,i]=E.useState("all"),[d,h]=E.useState(null),[u,m]=E.useState(!1),k=o(),l=s(),j=[{id:"all",name:"All Items",emoji:"🛍️"},{id:"food",name:"Food",emoji:"🍖"},{id:"toy",name:"Toys",emoji:"⚽"},{id:"medicine",name:"Medicine",emoji:"💊"},{id:"decoration",name:"Care",emoji:"🧼"},{id:"special",name:"Special",emoji:"✨"}],x=f==="all"?l:l.filter(b=>b.category===f),C=b=>{switch(b){case"common":return"text-gray-600 bg-gray-100";case"rare":return"text-blue-600 bg-blue-100";case"epic":return"text-purple-600 bg-purple-100";case"legendary":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},p=b=>{switch(b){case"common":return"border-gray-200";case"rare":return"border-blue-200";case"epic":return"border-purple-200";case"legendary":return"border-yellow-200";default:return"border-gray-200"}},_=b=>{r(b)},v=b=>{n(b)},g=b=>{const A=[];return b.hunger&&A.push(`Hunger +${b.hunger}`),b.happiness&&A.push(`Happiness +${b.happiness}`),b.energy&&A.push(`Energy ${b.energy>0?"+":""}${b.energy}`),b.health&&A.push(`Health +${b.health}`),b.cleanliness&&A.push(`Cleanliness +${b.cleanliness}`),b.sickness&&A.push(`Sickness ${b.sickness}`),b.experience&&A.push(`Experience +${b.experience}`),A.join(", ")},N=b=>{const A=a.inventory.find(F=>F.id===b);return(A==null?void 0:A.quantity)||0};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Pet Shop"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 rounded-full",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{className:"font-medium",style:{color:t.colors.primary},children:a.points})]}),e.jsx("button",{onClick:()=>m(!u),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(at,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})})]})]})}),!a.isAlive&&e.jsx("div",{className:"mx-4 mt-4 p-4 rounded-lg bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"💀"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Pet Has Passed Away"}),e.jsx("p",{className:"text-sm text-red-600",children:"You can only buy Phoenix Feather to revive your pet"})]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:j.map(b=>e.jsxs("button",{onClick:()=>i(b.id),className:`flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${f===b.id?"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,style:{...f!==b.id&&{backgroundColor:t.colors.surface,color:t.colors.textSecondary,border:`1px solid ${t.colors.border}`}},children:[e.jsx("span",{className:"mr-2",children:b.emoji}),b.name]},b.id))}),u&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Your Inventory"}),a.inventory.length===0?e.jsx("p",{className:"text-center py-8",style:{color:t.colors.textSecondary},children:"No items in inventory. Buy some items from the shop!"}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.inventory.map((b,A)=>e.jsx("div",{className:`relative p-3 rounded-lg border-2 ${p(b.rarity)}`,style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:b.emoji}),e.jsx("h4",{className:"font-medium text-sm mb-1",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${C(b.rarity)}`,children:b.rarity}),e.jsxs("span",{className:"text-sm font-medium",style:{color:t.colors.textSecondary},children:["x",b.quantity||1]})]}),e.jsx("button",{onClick:()=>v(b.id),disabled:!a.isAlive&&b.id!=="phoenix_feather",className:`w-full py-2 px-3 rounded-lg text-sm font-medium transition-colors ${a.isAlive||b.id==="phoenix_feather"?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Use"})]})},A))})]}),e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(at,{className:"w-12 h-12 mx-auto mb-4",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No items available in this category"})]}):e.jsx("div",{className:"grid gap-4",children:x.map(b=>{const A=N(b.id),F=a.points>=b.price,$=F&&(a.isAlive||b.id==="phoenix_feather");return e.jsx("div",{className:`relative p-4 rounded-xl border-2 ${p(b.rarity)} transition-all hover:shadow-md`,style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-4xl",children:b.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("span",{className:`inline-block text-xs px-2 py-1 rounded-full ${C(b.rarity)}`,children:[e.jsx(Ye,{className:"w-3 h-3 inline mr-1"}),b.rarity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-lg font-bold",style:{color:t.colors.primary},children:[e.jsx("span",{children:"💰"}),e.jsx("span",{children:b.price})]}),A>0&&e.jsxs("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:["Owned: ",A]})]})]}),e.jsx("p",{className:"text-sm mb-3",style:{color:t.colors.textSecondary},children:b.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium mb-1",style:{color:t.colors.textPrimary},children:"Effects:"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:g(b.effect)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>_(b.id),disabled:!$,className:`flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${$?"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white hover:opacity-90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"}),F?!a.isAlive&&b.id!=="phoenix_feather"?"Pet must be alive":"Buy":"Not enough points"]}),e.jsx("button",{onClick:()=>h(b),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",style:{backgroundColor:t.colors.borderLight},children:e.jsx(St,{className:"w-4 h-4",style:{color:t.colors.textSecondary}})})]})]})]})},b.id)})})}),k.length>l.length&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsxs("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:[e.jsx(He,{className:"w-5 h-5 inline mr-2"}),"Locked Items"]}),e.jsx("div",{className:"grid gap-3",children:k.filter(b=>!l.find(A=>A.id===b.id)).slice(0,3).map(b=>{var A,F;return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg opacity-60",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl grayscale",children:b.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:t.colors.textPrimary},children:b.name}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:[((A=b.unlockRequirement)==null?void 0:A.level)&&`Requires Level ${b.unlockRequirement.level}`,((F=b.unlockRequirement)==null?void 0:F.books)&&` • ${b.unlockRequirement.books} books read`]})]}),e.jsx(He,{className:"w-4 h-4",style:{color:t.colors.textSecondary}})]},b.id)})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-6xl mb-3",children:d.emoji}),e.jsx("h3",{className:"font-serif text-xl font-medium mb-2",style:{color:t.colors.textPrimary},children:d.name}),e.jsxs("span",{className:`inline-block text-sm px-3 py-1 rounded-full ${C(d.rarity)}`,children:[e.jsx(Ye,{className:"w-4 h-4 inline mr-1"}),d.rarity.toUpperCase()]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:d.description}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",style:{color:t.colors.textPrimary},children:"Effects:"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:g(d.effect)})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["💰 ",d.price," points"]})})]}),e.jsx("button",{onClick:()=>h(null),className:"w-full py-3 px-4 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary},children:"Close"})]})})]})},Ot=({message:c,type:t,onClose:a})=>{const o={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"✓",error:"✕",info:"ℹ"}[t];return bt.useEffect(()=>{const r=setTimeout(()=>{a()},3e3);return()=>clearTimeout(r)},[a]),e.jsxs("div",{className:`fixed top-4 right-4 ${o} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:c}),e.jsx("button",{onClick:a,className:"ml-2 text-white hover:text-gray-200",children:"✕"})]})},yt=({className:c="",showLabel:t=!0})=>{const{theme:a,toggleTheme:o}=z();return e.jsxs("div",{className:`flex items-center gap-3 ${c}`,children:[t&&e.jsx("span",{className:"text-sm font-medium",style:{color:a.colors.textPrimary},children:"Theme"}),e.jsx("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`,color:a.colors.textPrimary},"aria-label":`Switch to ${a.isDark?"light":"dark"} mode`,children:e.jsx("div",{className:"flex items-center gap-2",children:a.isDark?e.jsxs(e.Fragment,{children:[e.jsx(kt,{size:16,style:{color:a.colors.warning}}),t&&e.jsx("span",{className:"text-sm",children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{size:16,style:{color:a.colors.textSecondary}}),t&&e.jsx("span",{className:"text-sm",children:"Dark"})]})})})]})},_r=()=>{var g;const{user:c,signOut:t,updateProfile:a}=ne(),{theme:o}=z(),s=Z(),[r,n]=E.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[f,i]=E.useState(!1),[d,h]=E.useState(!1),[u,m]=E.useState(""),[k,l]=E.useState(null),j=(g=c==null?void 0:c.id)==null?void 0:g.startsWith("guest-");E.useEffect(()=>{c&&x()},[c]),E.useEffect(()=>{c!=null&&c.profile&&!j&&n({displayName:c.profile.displayName||"",bio:c.profile.bio||"",favoriteGenres:c.profile.favoriteGenres||[],readingGoal:c.profile.readingGoal||12,joinedDate:c.profile.joinedDate||c.createdAt})},[c==null?void 0:c.profile,j]);const x=async()=>{console.log("ProfilePage: Loading profile for user:",c==null?void 0:c.id,"isGuest:",j);try{if(j){const b=ce.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",b),b){n({displayName:b.displayName||"Guest User",bio:b.bio||"Browsing as a guest",favoriteGenres:b.favoriteGenres||[],readingGoal:b.readingGoal||12,joinedDate:b.joinedDate||(c==null?void 0:c.createdAt)});return}c!=null&&c.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),n({displayName:c.profile.displayName||"Guest User",bio:c.profile.bio||"Browsing as a guest",favoriteGenres:c.profile.favoriteGenres||[],readingGoal:c.profile.readingGoal||12,joinedDate:c.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const N=await H.getProfile();if(console.log("ProfilePage: Gun service profile result:",N),N.success&&N.profile){const b={displayName:N.profile.displayName||"",bio:N.profile.bio||"",favoriteGenres:N.profile.favoriteGenres||[],readingGoal:N.profile.readingGoal||12,joinedDate:N.profile.joinedDate||N.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",b),n(b)}else console.log("ProfilePage: No profile found or error loading profile")}catch(N){console.error("Error loading profile:",N)}},C=async()=>{if(c){console.log("ProfilePage: Saving profile:",r),h(!0);try{if(j){ce.setGuestProfile(r),i(!1),console.log("Guest profile saved to localStorage:",r),l({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",r);const N=await a(r);console.log("ProfilePage: updateProfile result:",N),N.success?(i(!1),console.log("Profile saved successfully"),l({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await x()):(console.error("Error saving profile:",N.error),l({message:`Failed to save profile: ${N.error||"Unknown error"}`,type:"error"}))}catch(N){console.error("Error saving profile:",N),l({message:"Failed to save profile. Please try again.",type:"error"})}finally{h(!1)}}},p=()=>{u.trim()&&!r.favoriteGenres.includes(u.trim())&&(n(N=>({...N,favoriteGenres:[...N.favoriteGenres,u.trim()]})),m(""))},_=N=>{n(b=>({...b,favoriteGenres:b.favoriteGenres.filter(A=>A!==N)}))},v=()=>{t()};return c?e.jsxs(Le,{children:[e.jsxs("div",{className:"min-h-screen py-8 transition-colors duration-200",style:{backgroundColor:o.colors.background},children:[j&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"border px-4 py-3 rounded-lg",style:{backgroundColor:o.colors.wantToRead,borderColor:o.colors.border,color:o.colors.wantToReadText},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl overflow-hidden transition-colors duration-200",style:{backgroundColor:o.colors.surface},children:["            ",e.jsxs("div",{className:"px-8 py-12 text-white relative",style:{background:`linear-gradient(to right, ${o.colors.primary}, ${o.colors.primaryLight})`},children:[e.jsx("button",{onClick:()=>s(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:r.displayName||(c==null?void 0:c.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:r.bio||"A passionate reader exploring new worlds through books"}),r.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(r.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>i(!f),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),f?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:v,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),f?e.jsx("input",{type:"text",value:r.displayName,onChange:N=>n(b=>({...b,displayName:N.target.value})),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent input-field",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.textPrimary},placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:r.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),f?e.jsx("textarea",{value:r.bio,onChange:N=>n(b=>({...b,bio:N.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:r.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),f?e.jsx("input",{type:"number",min:"1",max:"365",value:r.readingGoal,onChange:N=>n(b=>({...b,readingGoal:parseInt(N.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[r.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),f&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:N=>m(N.target.value),onKeyPress:N=>N.key==="Enter"&&p(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.favoriteGenres.map((N,b)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[N,f&&e.jsx("button",{onClick:()=>_(N),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},b)),"                    ",r.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:o.colors.primary},children:"App Settings"}),e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border},children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:o.colors.textPrimary},children:"Appearance"}),e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Choose your preferred theme for the app"})]}),e.jsx(yt,{})]})})})]}),"                  ",e.jsxs("div",{className:"mt-8 p-6 rounded-xl",style:{background:`linear-gradient(to right, ${o.colors.surfaceSecondary}, ${o.colors.surfaceElevated})`},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.primary},children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Pages Read"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.textPrimary},children:"Preferences"}),e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:o.colors.surface},children:e.jsx(yt,{})})]})]})]}),f&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:C,disabled:d,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),k&&e.jsx(Ot,{message:k.message,type:k.type,onClose:()=>l(null)})]}):e.jsx(Le,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},Dr=()=>{const c=Z(),{theme:t}=z(),{friends:a,friendRequests:o,friendActivity:s,loading:r,sendFriendRequest:n,acceptFriendRequest:f,declineFriendRequest:i,removeFriend:d,refreshFriendActivity:h,searchUsers:u}=Ae(),[m,k]=E.useState("activity"),[l,j]=E.useState(""),[x,C]=E.useState([]),[p,_]=E.useState(!1),[v,g]=E.useState(null),[N,b]=E.useState(null),[A,F]=E.useState(null);E.useEffect(()=>{h()},[]),E.useEffect(()=>{l.length>2?u(l).then(C):C([])},[l,u]);const $=async w=>{g(w);try{await n(w)?(j(""),C([]),_(!1),F({message:`Friend request sent to ${w}!`,type:"success"})):F({message:"Failed to send friend request",type:"error"})}finally{g(null)}},G=async(w,O)=>{b(w);try{const y=await f(w);F(y?{message:`You're now friends with ${O}!`,type:"success"}:{message:"Failed to accept friend request",type:"error"})}finally{b(null)}},T=async w=>{const O=await i(w);F(O?{message:"Friend request declined",type:"info"}:{message:"Failed to decline friend request",type:"error"})},I=w=>{const O=new Date,y=new Date(w),P=Math.floor((O.getTime()-y.getTime())/(1e3*60));return P<60?`${P}m ago`:P<1440?`${Math.floor(P/60)}h ago`:`${Math.floor(P/1440)}d ago`},U=w=>{switch(w){case"book_completed":return e.jsx(V,{className:"w-4 h-4"});case"reading_session":return e.jsx(ae,{className:"w-4 h-4"});case"achievement_unlocked":return e.jsx(de,{className:"w-4 h-4"});default:return e.jsx(V,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Friends"})]}),e.jsx("button",{onClick:()=>_(!p),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.primary},children:e.jsx(nt,{className:"w-5 h-5 text-white"})})]})}),p&&e.jsxs("div",{className:"p-4 border-b",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:t.colors.textSecondary}}),e.jsx("input",{type:"text",placeholder:"Search for users...",value:l,onChange:w=>j(w.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-opacity-50",style:{backgroundColor:t.colors.background,borderColor:t.colors.border,color:t.colors.textPrimary}})]}),x.length>0&&e.jsx("div",{className:"space-y-2",children:x.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg",style:{backgroundColor:t.colors.background},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.username]})]}),"                  ",e.jsx("button",{onClick:()=>$(w.username),className:"px-3 py-1 rounded-lg text-sm font-medium text-white",style:{backgroundColor:t.colors.primary},disabled:r||v===w.username,children:v===w.username?"Sending...":"Add"})]},w.id))})]}),e.jsx("div",{className:"flex border-b",style:{borderColor:t.colors.border},children:[{id:"activity",label:"Activity",count:s.length},{id:"friends",label:"Friends",count:a.length},{id:"requests",label:"Requests",count:o.length}].map(w=>e.jsxs("button",{onClick:()=>k(w.id),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${m===w.id?"border-opacity-100":"border-transparent"}`,style:{color:m===w.id?t.colors.primary:t.colors.textSecondary,borderColor:m===w.id?t.colors.primary:"transparent"},children:[w.label,w.count>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:w.count})]},w.id))}),e.jsxs("div",{className:"p-4",children:[m==="activity"&&e.jsx("div",{className:"space-y-3",children:s.length>0?s.map(w=>e.jsx("div",{className:"p-3 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:U(w.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:I(w.timestamp)})]}),e.jsx("p",{className:"text-sm mb-1",style:{color:t.colors.textPrimary},children:w.description}),w.metadata&&e.jsxs("div",{className:"flex gap-4 text-xs",style:{color:t.colors.textSecondary},children:[w.metadata.pagesRead&&e.jsxs("span",{children:[w.metadata.pagesRead," pages"]}),w.metadata.duration&&e.jsxs("span",{children:[w.metadata.duration," min"]})]})]})]})},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend activity yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Friend activity will appear here when your friends complete books or reading sessions"})]})}),m==="friends"&&e.jsx("div",{className:"space-y-3",children:a.length>0?a.map(w=>e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(xe,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.displayName||w.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.username]})]})]}),e.jsx("button",{onClick:()=>d(w.id),className:"px-3 py-1 rounded-lg text-sm",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:"Remove"})]}),w.stats&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:w.stats.totalBooksRead}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:w.stats.currentStreak}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Day Streak"})]})]})]},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friends yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Start by searching for users to add as friends!"})]})}),m==="requests"&&e.jsx("div",{className:"space-y-3",children:o.length>0?o.map(w=>e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(xe,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:w.fromDisplayName||w.fromUsername}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",w.fromUsername]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>G(w.id,w.fromUsername),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:N===w.id?"#6B7280":"#10B981"},disabled:r||N===w.id,children:N===w.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ve,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>T(w.id),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#EF4444"},disabled:r||N===w.id,children:e.jsx(Me,{className:"w-4 h-4 text-white"})})]})]})},w.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(nt,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend requests"}),"              "]})})]}),A&&e.jsx(Ot,{message:A.message,type:A.type,onClose:()=>F(null)})]})},Br=()=>{const c=Z(),{theme:t}=z(),{user:a}=ne(),{leaderboard:o,loading:s,refreshLeaderboard:r}=Ae(),[n,f]=E.useState("week"),[i,d]=E.useState("books_read");E.useEffect(()=>{r(n,i)},[n,i,r]);const h=x=>{switch(x){case 1:return e.jsx(vs,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(lt,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(lt,{className:"w-5 h-5 text-yellow-600"});default:return e.jsxs("span",{className:"font-bold text-lg",style:{color:t.colors.textSecondary},children:["#",x]})}},u=x=>{switch(x){case"books_read":return e.jsx(V,{className:"w-4 h-4"});case"pages_read":return e.jsx(Se,{className:"w-4 h-4"});case"reading_time":return e.jsx(ae,{className:"w-4 h-4"});case"streak":return e.jsx(We,{className:"w-4 h-4"});default:return e.jsx(V,{className:"w-4 h-4"})}},m=(x,C)=>{switch(C){case"books_read":return`${x} books`;case"pages_read":return`${x.toLocaleString()} pages`;case"reading_time":const p=Math.floor(x/60),_=x%60;return p>0?`${p}h ${_}m`:`${_}m`;case"streak":return`${x} days`;default:return x.toString()}},k=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"year",label:"This Year"},{id:"alltime",label:"All Time"}],l=[{id:"books_read",label:"Books Read",icon:V},{id:"pages_read",label:"Pages Read",icon:Se},{id:"reading_time",label:"Reading Time",icon:ae},{id:"streak",label:"Reading Streak",icon:We}],j=o.find(x=>x.userId===(a==null?void 0:a.id));return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(se,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Leaderboard"})]})}),j&&e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.primary+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(j.rank)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:"Your Rank"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:m(j.score,i)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["#",j.rank]}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:["out of ",o.length]})]})]})})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"flex gap-2",children:k.map(x=>e.jsx("button",{onClick:()=>f(x.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===x.id?"text-white":""}`,style:{backgroundColor:n===x.id?t.colors.primary:t.colors.surface,color:n===x.id?"white":t.colors.textSecondary},children:x.label},x.id))})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map(x=>{const C=x.icon;return e.jsxs("button",{onClick:()=>d(x.id),className:`p-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${i===x.id?"text-white":""}`,style:{backgroundColor:i===x.id?t.colors.primary:t.colors.surface,color:i===x.id?"white":t.colors.textSecondary},children:[e.jsx(C,{className:"w-4 h-4"}),x.label]},x.id)})})}),e.jsxs("div",{className:"p-4",children:[s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((x,C)=>e.jsx("div",{className:"p-4 rounded-xl animate-pulse",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:t.colors.borderLight}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:t.colors.borderLight}}),e.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:t.colors.borderLight}})]})]})},C))}):e.jsxs("div",{className:"space-y-3",children:["            ",o.map(x=>e.jsx("div",{className:`p-4 rounded-xl transition-all ${x.userId===(a==null?void 0:a.id)?"ring-2":""}`,style:{backgroundColor:t.colors.surface,...x.userId===(a==null?void 0:a.id)&&{boxShadow:`0 0 0 2px ${t.colors.primary}`}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(x.rank)}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:[x.displayName||x.username,x.userId===(a==null?void 0:a.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:"You"})]}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",x.username]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[u(i),e.jsx("span",{className:"font-bold",style:{color:t.colors.primary},children:m(x.score,i)})]}),x.details&&e.jsxs("div",{className:"text-xs mt-1",style:{color:t.colors.textSecondary},children:[i!=="books_read"&&x.details.booksRead&&e.jsxs("span",{children:[x.details.booksRead," books • "]}),i!=="streak"&&x.details.currentStreak&&e.jsxs("span",{children:[x.details.currentStreak," day streak"]})]})]})]})},x.userId))]}),!s&&o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No leaderboard data yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Add friends to compete on the leaderboard!"})]})]})]})},Rr=()=>{const{pet:c}=le(),[t,a]=E.useState([]);E.useEffect(()=>{const s=[],r=Date.now();c.isAlive?(c.mood==="dying"&&s.push({id:"dying",type:"critical",title:"Critical Condition!",message:"Your pet is dying! Take immediate action to save them!",icon:Fe,timestamp:r}),c.hunger<15?s.push({id:"hunger",type:"critical",title:"Starving!",message:"Your pet is starving and needs food immediately!",icon:Ue,timestamp:r}):c.hunger<30&&s.push({id:"hunger-low",type:"warning",title:"Getting Hungry",message:"Your pet is getting hungry. Consider feeding them soon.",icon:Ue,timestamp:r}),c.health<20?s.push({id:"health",type:"critical",title:"Very Poor Health!",message:"Your pet's health is critically low! Buy medicine now!",icon:pe,timestamp:r}):c.health<40&&s.push({id:"health-low",type:"warning",title:"Poor Health",message:"Your pet's health is declining. Consider buying medicine.",icon:pe,timestamp:r}),c.sickness>80?s.push({id:"sickness",type:"critical",title:"Seriously Ill!",message:"Your pet is very sick and needs immediate medical attention!",icon:Ne,timestamp:r}):c.sickness>50&&s.push({id:"sickness-moderate",type:"warning",title:"Feeling Unwell",message:"Your pet is getting sick. Consider buying medicine.",icon:Ne,timestamp:r}),c.energy<10&&s.push({id:"energy",type:"warning",title:"Exhausted",message:"Your pet is exhausted and needs rest or an energy boost.",icon:Ne,timestamp:r}),c.happiness<20&&s.push({id:"happiness",type:"warning",title:"Very Sad",message:"Your pet is very unhappy. Play with them or buy toys!",icon:pe,timestamp:r})):s.push({id:"death",type:"death",title:"Pet Has Died",message:"Your pet has passed away! Buy a Phoenix Feather from the shop to revive them.",icon:js,timestamp:r}),a(s)},[c.isAlive,c.mood,c.hunger,c.health,c.sickness,c.energy,c.happiness]);const o=s=>{a(r=>r.filter(n=>n.id!==s))};return t.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:t.map(s=>{const r=s.icon,n=s.type==="death"?"bg-black":s.type==="critical"?"bg-red-500":"bg-orange-500";return e.jsx("div",{className:`${n} text-white p-4 rounded-lg shadow-lg animate-slide-in-right`,style:{backgroundColor:s.type==="death"?"#000":void 0},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(r,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-sm opacity-90",children:s.message})]}),e.jsx("button",{onClick:()=>o(s.id),className:"text-white/70 hover:text-white text-lg leading-none",children:"×"})]})},s.id)})})},Ir=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"📚"}),e.jsx("span",{children:"Bookish"})]})}),"      ",e.jsx(Qs,{children:e.jsx(nr,{children:e.jsx(lr,{children:e.jsx(rr,{children:e.jsxs(Xs,{children:["                ",e.jsx(Qt,{basename:"/Bookish",children:e.jsxs(cr,{children:[e.jsx(Rr,{}),e.jsxs(Xt,{children:[e.jsx(ee,{path:"/",element:e.jsx(gr,{})}),e.jsx(ee,{path:"/welcome",element:e.jsx(dr,{})}),e.jsx(ee,{path:"/search",element:e.jsx(pr,{})}),e.jsx(ee,{path:"/library",element:e.jsx(Sr,{})}),e.jsx(ee,{path:"/book",element:e.jsx(yr,{})}),e.jsx(ee,{path:"/reading",element:e.jsx(Nr,{})}),e.jsx(ee,{path:"/notes",element:e.jsx(Tr,{})}),"                      ",e.jsx(ee,{path:"/notes/add",element:e.jsx(Ar,{})}),e.jsx(ee,{path:"/pet",element:e.jsx(Er,{})}),e.jsx(ee,{path:"/pet-shop",element:e.jsx(Pr,{})}),e.jsx(ee,{path:"/stats",element:e.jsx(Cr,{})}),e.jsx(ee,{path:"/profile",element:e.jsx(_r,{})}),e.jsx(ee,{path:"/friends",element:e.jsx(Dr,{})}),e.jsx(ee,{path:"/leaderboard",element:e.jsx(Br,{})})]}),"                  "]})})]})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});Ss.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(Ir,{})}));
