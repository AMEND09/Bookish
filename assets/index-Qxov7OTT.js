const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var At=Object.defineProperty;var Pt=(m,t,n)=>t in m?At(m,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[t]=n;var ye=(m,t,n)=>Pt(m,typeof t!="symbol"?t+"":t,n);import{a as Et,b as _t,g as Rt,c as Re,r as E,R as Le,u as X,d as ut,e as Bt,B as Dt,f as It,h as Z}from"./vendor-CGGxujwj.js";import{r as Ft,c as Ut,a as Ot}from"./gun-CJ6ok8hl.js";import{B as K,U as mt,L as Gt,E as Lt,a as Mt,A as $e,T as ht,P as ge,H as Ie,b as ne,S as Jt,c as we,d as $t,e as me,f as gt,M as ft,C as re,g as qt,F as Ht,h as qe,i as he,j as Yt,k as Wt,l as ee,m as He,n as Ye,X as _e,o as We,I as Kt,p as zt,q as Vt,r as Qt,s as fe,t as Xt,u as xt,v as Zt,w as es,x as ts,y as ss,z as pt,D as Ke,G as Fe,J as rs,K as os,N as ze,O as Ve,Z as Ue,R as as,Q as Qe,V as Xe,W as ns}from"./icons-wR8Y5JGC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var Be={exports:{}},be={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze;function ls(){if(Ze)return be;Ze=1;var m=Et(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function a(d,l,u){var h,c={},g=null,j=null;u!==void 0&&(g=""+u),l.key!==void 0&&(g=""+l.key),l.ref!==void 0&&(j=l.ref);for(h in l)o.call(l,h)&&!r.hasOwnProperty(h)&&(c[h]=l[h]);if(d&&d.defaultProps)for(h in l=d.defaultProps,l)c[h]===void 0&&(c[h]=l[h]);return{$$typeof:t,type:d,key:g,ref:j,props:c,_owner:s.current}}return be.Fragment=n,be.jsx=a,be.jsxs=a,be}var et;function is(){return et||(et=1,Be.exports=ls()),Be.exports}var e=is(),Ce={},tt;function cs(){if(tt)return Ce;tt=1;var m=_t();return Ce.createRoot=m.createRoot,Ce.hydrateRoot=m.hydrateRoot,Ce}var ds=cs(),us=Ft();const te=Rt(us);var Ae={exports:{}};Ae.exports;var st;function ms(){return st||(st=1,function(m){(function(){function t(o,s){return s?Ut(o):o.slice?t[r(o)]:function(a,d){o(a={exports:{}}),t[r(d)]=a.exports};function r(a){return a.split("/").slice(-1).toString().replace(".js","")}}var n=m;t(function(o){typeof self<"u"&&(o.window=self),typeof window<"u"&&(o.window=window);var s=o.window||o,r,a=s.SEA||{};(a.window=o.window)&&(a.window.SEA=a);try{r+""!=typeof n&&(n.exports=a)}catch{}o.exports=a})(t,"./root"),t(function(o){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(o){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{Re.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Re.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},Re.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(t,"./base64"),t(function(o){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(r,a,d){r=r||"utf8",a=a||0;const l=this.length;if(r==="hex"){const u=new Uint8Array(this);return[...Array((d&&d+1||l)-a).keys()].map(h=>u[h+a].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(d||l)-a},(u,h)=>String.fromCharCode(this[h+a])).join("");if(r==="base64")return btoa(this)},o.exports=s})(t,"./array"),t(function(o){t("./base64");var s=t("./array");function r(...a){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...a)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const a=arguments[0];let d;if(typeof a=="string"){const u=arguments[1]||"utf8";if(u==="hex"){const h=a.match(/([\da-fA-F]{2})/g).map(c=>parseInt(c,16));if(!h||!h.length)throw new TypeError("Invalid first argument for type 'hex'.");d=s.from(h)}else if(u==="utf8"||u==="binary"){const h=a.length,c=new Uint16Array(h);Array.from({length:h},(g,j)=>c[j]=a.charCodeAt(j)),d=s.from(c)}else if(u==="base64"){const h=atob(a),c=h.length,g=new Uint8Array(c);Array.from({length:c},(j,i)=>g[i]=h.charCodeAt(i)),d=s.from(g)}else u==="binary"?d=s.from(a):console.info("SafeBuffer.from unknown encoding: "+u);return d}if(a.byteLength,a.byteLength?a.byteLength:a.length){let u;return a instanceof ArrayBuffer&&(u=new Uint8Array(a)),s.from(u||a)}},alloc(a,d=0){return s.from(new Uint8Array(Array.from({length:a},()=>d)))},allocUnsafe(a){return s.from(new Uint8Array(Array.from({length:a})))},concat(a){if(!Array.isArray(a))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(a.reduce((d,l)=>d.concat(Array.from(l)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,o.exports=r})(t,"./buffer"),t(function(o){const s=t("./root"),r={Buffer:t("./buffer")};var a={},d;if(JSON.parseAsync=JSON.parseAsync||function(u,h,c){var g;try{h(g,JSON.parse(u,c))}catch(j){h(j)}},JSON.stringifyAsync=JSON.stringifyAsync||function(u,h,c,g){var j;try{h(j,JSON.stringify(u,c,g))}catch(i){h(i)}},r.parse=function(u,h){return new Promise(function(c,g){JSON.parseAsync(u,function(j,i){j?g(j):c(i)},h)})},r.stringify=function(u,h,c){return new Promise(function(g,j){JSON.stringifyAsync(u,function(i,v){i?j(i):g(v)},h,c)})},s.window&&(r.crypto=s.window.crypto||s.window.msCrypto,r.subtle=(r.crypto||a).subtle||(r.crypto||a).webkitSubtle,r.TextEncoder=s.window.TextEncoder,r.TextDecoder=s.window.TextDecoder,r.random=u=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(u))))),!r.TextDecoder){const{TextEncoder:u,TextDecoder:h}=t((d+""==typeof n?".":"")+"./lib/text-encoding",1);r.TextDecoder=h,r.TextEncoder=u}if(!r.crypto)try{var l=t("crypto",1);Object.assign(r,{crypto:l,random:h=>r.Buffer.from(l.randomBytes(h))});const{Crypto:u}=t("@peculiar/webcrypto",1);r.ossl=r.subtle=new u({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}o.exports=r})(t,"./shim"),t(function(o){var s=t("./root"),r=t("./shim"),a={};a.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},a.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},a.ecdh={name:"ECDH",namedCurve:"P-256"},a.jwk=function(d,l){d=d.split(".");var u=d[0],h=d[1],c={kty:"EC",crv:"P-256",x:u,y:h,ext:!0};return c.key_ops=l?["sign"]:["verify"],l&&(c.d=l),c},a.keyToJwk=function(d){return{kty:"oct",k:d.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},a.recall={validity:12*60*60,hook:function(d){return d}},a.check=function(d){return typeof d=="string"&&d.slice(0,4)==="SEA{"},a.parse=async function(l){try{var u=typeof l=="string";return u&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),u?await r.parse(l):l}catch{}return l},s.opt=a,o.exports=a})(t,"./settings"),t(function(o){var s=t("./shim");o.exports=async function(r,a){var d=typeof r=="string"?r:await s.stringify(r),l=await s.subtle.digest({name:a||"SHA-256"},new s.TextEncoder().encode(d));return s.Buffer.from(l)}})(t,"./sha256"),t(function(o){const s=t("./shim"),r=s.subtle,a=s.ossl?s.ossl:r,d=l=>a.digest({name:"SHA-1"},new ArrayBuffer(l));o.exports=d})(t,"./sha1"),t(function(o){var s=t("./root"),r=t("./shim"),a=t("./settings"),d=t("./sha256"),l;s.work=s.work||(async(u,h,c,g)=>{try{var j=(h||{}).epub||h;if(g=g||{},j instanceof Function&&(c=j,j=l),u=typeof u=="string"?u:await r.stringify(u),(g.name||"").toLowerCase().slice(0,3)==="sha"){var i=r.Buffer.from(await d(u,g.name),"binary").toString(g.encode||"base64");if(c)try{c(i)}catch(p){console.log(p)}return i}j=j||r.random(9);var v=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(u),{name:g.name||"PBKDF2"},!1,["deriveBits"]),x=await(r.ossl||r.subtle).deriveBits({name:g.name||"PBKDF2",iterations:g.iterations||a.pbkdf2.iter,salt:new r.TextEncoder().encode(g.salt||j),hash:g.hash||a.pbkdf2.hash},v,g.length||a.pbkdf2.ks*8);u=r.random(u.length);var T=r.Buffer.from(x,"binary").toString(g.encode||"base64");if(c)try{c(T)}catch(p){console.log(p)}return T}catch(p){if(console.log(p),s.err=p,s.throw)throw p;c&&c();return}}),o.exports=s.work})(t,"./work"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.name=s.name||(async(a,d)=>{try{if(a)try{a()}catch(l){console.log(l)}return}catch(l){if(console.log(l),s.err=l,s.throw)throw l;a&&a();return}}),s.pair=s.pair||(async(a,d)=>{try{var l=r.ossl||r.subtle,u=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async g=>{var j={};j.priv=(await r.subtle.exportKey("jwk",g.privateKey)).d;var i=await r.subtle.exportKey("jwk",g.publicKey);return j.pub=i.x+"."+i.y,j});try{var h=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async g=>{var j={};j.epriv=(await l.exportKey("jwk",g.privateKey)).d;var i=await l.exportKey("jwk",g.publicKey);return j.epub=i.x+"."+i.y,j})}catch(g){if(s.window)throw g;if(g=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw g}h=h||{};var c={pub:u.pub,priv:u.priv,epub:h.epub,epriv:h.epriv};if(a)try{a(c)}catch(g){console.log(g)}return c}catch(g){if(console.log(g),s.err=g,s.throw)throw g;a&&a();return}}),o.exports=s.pair})(t,"./pair"),t(function(o){var s=t("./root"),r=t("./shim"),a=t("./settings"),d=t("./sha256"),l;s.sign=s.sign||(async(u,h,c,g)=>{try{if(g=g||{},!(h||g).priv){if(!s.I)throw"No signing key.";h=await s.I(null,{what:u,how:"sign",why:g.why})}if(l===u)throw"`undefined` not allowed.";var j=await a.parse(u),i=g.check=g.check||j;if(s.verify&&(s.opt.check(i)||i&&i.s&&i.m)&&l!==await s.verify(i,h)){var w=await a.parse(i);if(g.raw||(w="SEA"+await r.stringify(w)),c)try{c(w)}catch(k){console.log(k)}return w}var v=h.pub,x=h.priv,T=a.jwk(v,x),p=await d(j),_=await(r.ossl||r.subtle).importKey("jwk",T,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(N=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},N,new Uint8Array(p))),w={m:j,s:r.Buffer.from(_,"binary").toString(g.encode||"base64")};if(g.raw||(w="SEA"+await r.stringify(w)),c)try{c(w)}catch(N){console.log(N)}return w}catch(N){if(console.log(N),s.err=N,s.throw)throw N;c&&c();return}}),o.exports=s.sign})(t,"./sign"),t(function(o){var s=t("./root"),r=t("./shim"),a=t("./settings"),d=t("./sha256"),l;s.verify=s.verify||(async(c,g,j,i)=>{try{var v=await a.parse(c);if(g===!1){var x=await a.parse(v.m);if(j)try{j(x)}catch(A){console.log(A)}return x}i=i||{};var T=g.pub||g,p=s.opt.slow_leak?await s.opt.slow_leak(T):await(r.ossl||r.subtle).importKey("jwk",a.jwk(T),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),_=await d(v.m),w,N,k,f;try{if(w=r.Buffer.from(v.s,i.encode||"base64"),N=new Uint8Array(w),k=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},p,N,new Uint8Array(_)),!k)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(c,g,j,i)}var C=k?await a.parse(v.m):l;if(j)try{j(C)}catch(A){console.log(A)}return C}catch(A){if(console.log(A),s.err=A,s.throw)throw A;j&&j();return}}),o.exports=s.verify;var u={};s.opt.slow_leak=c=>{if(u[c])return u[c];var g=a.jwk(c);return u[c]=(r.ossl||r.subtle).importKey("jwk",g,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u[c]};var h=s.opt;s.opt.fall_verify=async function(c,g,j,i,v){if(v===s.opt.fallback)throw"Signature did not match";v=v||1;var x=c||"";c=s.opt.unpack(c)||c;var T=await a.parse(c),p=g.pub||g,_=await s.opt.slow_leak(p),w=v<=s.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await a.parse(T.m)))):await d(T.m),N,k,f;try{if(N=r.Buffer.from(T.s,i.encode||"base64"),k=new Uint8Array(N),f=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},_,k,new Uint8Array(w)),!f)throw"Signature did not match."}catch{try{N=r.Buffer.from(T.s,"utf8"),k=new Uint8Array(N),f=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},_,k,new Uint8Array(w))}catch{if(!f)throw"Signature did not match."}}var C=f?await a.parse(T.m):l;if(h.fall_soul=x["#"],h.fall_key=x["."],h.fall_val=c,h.fall_state=x[">"],j)try{j(C)}catch(A){console.log(A)}return C},s.opt.fallback=2})(t,"./verify"),t(function(o){var s=t("./shim"),r=t("./settings"),a=t("./sha256");const d=async(l,u,h)=>{const c=l+(u||s.random(8)).toString("utf8"),g=s.Buffer.from(await a(c),"binary"),j=r.keyToJwk(g);return await s.subtle.importKey("jwk",j,{name:"AES-GCM"},!1,["encrypt","decrypt"])};o.exports=d})(t,"./aeskey"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings");var a=t("./aeskey"),d;s.encrypt=s.encrypt||(async(l,u,h,c)=>{try{c=c||{};var g=(u||c).epriv||u;if(d===l)throw"`undefined` not allowed.";if(!g){if(!s.I)throw"No encryption key.";u=await s.I(null,{what:l,how:"encrypt",why:c.why}),g=u.epriv||u}var j=typeof l=="string"?l:await r.stringify(l),i={s:r.random(9),iv:r.random(15)},v=await a(g,i.s,c).then(T=>r.subtle.encrypt({name:c.name||"AES-GCM",iv:new Uint8Array(i.iv)},T,new r.TextEncoder().encode(j))),x={ct:r.Buffer.from(v,"binary").toString(c.encode||"base64"),iv:i.iv.toString(c.encode||"base64"),s:i.s.toString(c.encode||"base64")};if(c.raw||(x="SEA"+await r.stringify(x)),h)try{h(x)}catch(T){console.log(T)}return x}catch(T){if(console.log(T),s.err=T,s.throw)throw T;h&&h();return}}),o.exports=s.encrypt})(t,"./encrypt"),t(function(o){var s=t("./root"),r=t("./shim"),a=t("./settings"),d=t("./aeskey");s.decrypt=s.decrypt||(async(l,u,h,c)=>{try{c=c||{};var g=(u||c).epriv||u;if(!g){if(!s.I)throw"No decryption key.";u=await s.I(null,{what:l,how:"decrypt",why:c.why}),g=u.epriv||u}var j=await a.parse(l),i,v,x;try{i=r.Buffer.from(j.s,c.encode||"base64"),v=r.Buffer.from(j.iv,c.encode||"base64"),x=r.Buffer.from(j.ct,c.encode||"base64");var T=await d(g,i,c).then(_=>r.subtle.decrypt({name:c.name||"AES-GCM",iv:new Uint8Array(v),tagLength:128},_,new Uint8Array(x)))}catch{if(c.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return c.encode="utf8",await s.decrypt(l,u,h,c)}var p=await a.parse(new r.TextDecoder("utf8").decode(T));if(h)try{h(p)}catch(_){console.log(_)}return p}catch(_){if(console.log(_),s.err=_,s.throw)throw _;h&&h();return}}),o.exports=s.decrypt})(t,"./decrypt"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.secret=s.secret||(async(d,l,u,h)=>{try{if(h=h||{},!l||!l.epriv||!l.epub){if(!s.I)throw"No secret mix.";l=await s.I(null,{what:d,how:"secret",why:h.why})}var c=d.epub||d,g=l.epub,j=l.epriv,i=r.ossl||r.subtle,v=a(c),x=Object.assign({public:await i.importKey(...v,!0,[])},{name:"ECDH",namedCurve:"P-256"}),T=a(g,j),p=await i.importKey(...T,!1,["deriveBits"]).then(async w=>{var N=await i.deriveBits(x,w,256),k=new Uint8Array(N),f=await i.importKey("raw",k,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return i.exportKey("jwk",f).then(({k:C})=>C)}),_=p;if(u)try{u(_)}catch(w){console.log(w)}return _}catch(w){if(console.log(w),s.err=w,s.throw)throw w;u&&u();return}});var a=(d,l)=>{var[u,h]=d.split("."),c=l?{d:l}:{};return["jwk",Object.assign(c,{x:u,y:h,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};o.exports=s.secret})(t,"./secret"),t(function(o){var s=t("./root");s.certify=s.certify||(async(r,a={},d,l,u={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),r=(()=>{var _=[];if(r){if((typeof r=="string"||Array.isArray(r))&&r.indexOf("*")>-1)return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(w=>{typeof w=="string"?_.push(w):typeof w=="object"&&w.pub&&_.push(w.pub)})}return typeof r=="object"&&r.pub?r.pub:_.length>0?_:null}})(),!r)return console.log("No certificant found.");const c=u.expiry&&(typeof u.expiry=="number"||typeof u.expiry=="string")?parseFloat(u.expiry):null,g=(a||{}).read?a.read:null,j=(a||{}).write?a.write:typeof a=="string"||Array.isArray(a)||a["+"]||a["#"]||a["."]||a["="]||a["*"]||a[">"]||a["<"]?a:null,i=(u||{}).block||(u||{}).blacklist||(u||{}).ban||{},v=i.read&&(typeof i.read=="string"||(i.read||{})["#"])?i.read:null,x=typeof i=="string"?i:i.write&&(typeof i.write=="string"||i.write["#"])?i.write:null;if(!g&&!j)return console.log("No policy found.");const T=JSON.stringify({c:r,...c?{e:c}:{},...g?{r:g}:{},...j?{w:j}:{},...v?{rb:v}:{},...x?{wb:x}:{}});var h=await s.sign(T,d,null,{raw:1});if(u.raw||(h="SEA"+JSON.stringify(h)),l)try{l(h)}catch(_){console.log(_)}return h}catch(c){if(s.err=c,s.throw)throw c;l&&l();return}}),o.exports=s.certify})(t,"./certify"),t(function(o){var s=t("./shim"),r=t("./root");r.work=t("./work"),r.sign=t("./sign"),r.verify=t("./verify"),r.encrypt=t("./encrypt"),r.decrypt=t("./decrypt"),r.certify=t("./certify"),r.random=r.random||s.random,r.Buffer=r.Buffer||t("./buffer"),r.keyid=r.keyid||(async a=>{try{const d=s.Buffer.concat(a.replace(/-/g,"+").replace(/_/g,"/").split(".").map(c=>s.Buffer.from(c,"base64"))),l=s.Buffer.concat([s.Buffer.from([153,d.length/256,d.length%256]),d]),u=await sha1hash(l),h=s.Buffer.from(u,"binary");return h.toString("hex",h.length-8)}catch(d){throw console.log(d),d}}),((r.window||{}).GUN||{}).SEA=r,o.exports=r})(t,"./sea"),t(function(o){var s=t("./sea"),r,a;s.window?r=s.window.GUN||{chain:{}}:r=t((a+""==typeof n?".":"")+"./gun",1),s.GUN=r;function d(u){this._={$:this}}d.prototype=function(){function u(){}return u.prototype=r.chain,new u}(),d.prototype.constructor=d,r.chain.user=function(u){var h=this,g=h.back(-1),c;if(u)return u=s.opt.pub((u._||"")["#"])||u,g.get("~"+u);if(c=g.back("user"))return c;var g=g._,j=g,i=j.opt.uuid||l;return(j=(c=j.user=h.chain(new d))._).opt={},j.opt.uuid=function(v){var x=i(),T=g.user;return!T||!(T=T.is)||!(T=T.pub)||(x="~"+T+"/"+x,v&&v.call&&v(null,x)),x},c};function l(){return r.state().toString(36).replace(".","")}r.User=d,d.GUN=r,d.SEA=r.SEA=s,o.exports=d})(t,"./user"),t(function(o){var s,r=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof n?".":"")+"./gun",1);r.chain.then=function(a,d){var l=this,u=new Promise(function(h,c){l.once(h,d)});return a?u.then(a):u}})(t,"./then"),t(function(o){var s=t("./user"),r=s.SEA,a=s.GUN,d=function(){};s.prototype.create=function(...l){var u=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,h=u&&(u.pub||u.epub)?u.pub:typeof l[0]=="string"?l[0]:null,c=u&&(u.pub||u.epub)?u:h&&typeof l[1]=="string"?l[1]:null,g=l.filter(_=>typeof _=="function")[0]||null,j=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},i=this,v=i._,x=i.back(-1);if(g=g||d,j=j||{},j.check!==!1){var T;if(h||(T="No user."),(c||"").length<8&&(T="Password too short!"),T)return g({err:a.log(T)}),i}if(v.ing)return(g||d)({err:a.log("User is already being created or authenticated!"),wait:!0}),i;v.ing=!0;var p={};return p.a=function(_){if(p.pubs=_,_&&!j.already){var w={err:a.log("User already created!")};v.ing=!1,(g||d)(w),i.leave();return}p.salt=String.random(64),r.work(c,p.salt,p.b)},p.b=function(_){p.proof=_,u?p.c(u):r.pair(p.c)},p.c=function(_){var w;p.pair=_||{},(w=v.root.user)&&(w._.sea=_,w.is={pub:_.pub,epub:_.epub,alias:h}),p.data={pub:_.pub},p.d()},p.d=function(){p.data.alias=h,p.e()},p.e=function(){p.data.epub=p.pair.epub,r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},p.proof,p.f,{raw:1})},p.f=function(_){p.data.auth=JSON.stringify({ek:_,s:p.salt}),p.g(p.data.auth)},p.g=function(_){var w;p.data.auth=p.data.auth||_,x.get(w="~"+p.pair.pub).put(p.data).on(p.h);var N={};N[w]={"#":w},x.get("~@"+h).put(N).get(w).on(p.i)},p.h=function(_,w,N,k){k.off(),p.h.ok=1,p.i()},p.i=function(_,w,N,k){k&&(p.i.ok=1,k.off()),!(!p.h.ok||!p.i.ok)&&(v.ing=!1,g({ok:0,pub:p.pair.pub}),d===g&&(u?i.auth(u):i.auth(h,c)))},x.get("~@"+h).once(p.a),i},s.prototype.leave=function(l,u){var h=this,c=h.back(-1)._.user;if(c&&(delete c.is,delete c._.is,delete c._.sea),r.window)try{var g={};g=r.window.sessionStorage,delete g.recall,delete g.pair}catch{}return h}})(t,"./create"),t(function(o){var s=t("./user"),r=s.SEA,a=s.GUN,d=function(){};s.prototype.auth=function(...u){var h=typeof u[0]=="object"&&(u[0].pub||u[0].epub)?u[0]:typeof u[1]=="object"&&(u[1].pub||u[1].epub)?u[1]:null,c=!h&&typeof u[0]=="string"?u[0]:null,g=(c||h&&!(h.priv&&h.epriv))&&typeof u[1]=="string"?u[1]:null,j=u.filter(N=>typeof N=="function")[0]||null,i=u&&u.length>1&&typeof u[u.length-1]=="object"?u[u.length-1]:{},v=this,x=v._,T=v.back(-1);if(x.ing)return(j||d)({err:a.log("User is already being created or authenticated!"),wait:!0}),v;x.ing=!0;var p={},_,w=9;return p.a=function(N){if(!N)return p.b();if(!N.pub){var k=[];return Object.keys(N).forEach(function(f){f!="_"&&k.push(N[f])}),p.b(k)}if(p.name)return p.f(N);p.c((p.data=N).auth)},p.b=function(N){var k=(p.list=(p.list||[]).concat(N||[])).shift();if(_===k){if(p.name)return p.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(c&&w--){T.get("~@"+c).once(p.a);return}return p.err("Wrong user or password.")}T.get(k).once(p.a)},p.c=function(N){if(_===N)return p.b();if(typeof N=="string")return p.c(l(N));r.work(g,(p.auth=N).s,p.d,p.enc)},p.d=function(N){r.decrypt(p.auth.ek,N,p.e,p.enc)},p.e=function(N){if(_===N)return p.enc?(p.enc=null,p.b()):(p.enc={encode:"utf8"},p.c(p.auth));p.half=N,p.f(p.data)},p.f=function(N){var k=p.half||{},f=p.data||{};p.g(p.lol={pub:N.pub||f.pub,epub:N.epub||f.epub,priv:N.priv||k.priv,epriv:N.epriv||k.epriv})},p.g=function(N){if(!N||!N.pub||!N.epub)return p.b();p.pair=N;var k=T._.user,f=k._;f.tag;var C=f.opt;f=k._=T.get("~"+N.pub)._,f.opt=C,k.is={pub:N.pub,epub:N.epub,alias:c||N.pub},f.sea=p.pair,x.ing=!1;try{g&&_==(l(x.root.graph["~"+N.pub].auth)||"")[":"]&&(i.shuffle=i.change=g)}catch{}if(i.change?p.z():(j||d)(f),r.window&&(v.back("user")._.opt||i).remember)try{var A={};A=r.window.sessionStorage,A.recall=!0,A.pair=JSON.stringify(N)}catch{}try{T._.tag.auth?T._.on("auth",f):setTimeout(function(){T._.on("auth",f)},1)}catch(R){a.log("Your 'auth' callback crashed with:",R)}},p.h=function(N){if(!N)return p.b();if(c=N.alias,c||(c=N.alias="~"+h.pub),!N.auth)return p.g(h);h=null,p.c((p.data=N).auth)},p.z=function(){p.salt=String.random(64),r.work(i.change,p.salt,p.y)},p.y=function(N){r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},N,p.x,{raw:1})},p.x=function(N){p.w(JSON.stringify({ek:N,s:p.salt}))},p.w=function(N){if(i.shuffle){console.log("migrate core account from UTF8 & shuffle");var k={};Object.keys(p.data).forEach(function(f){k[f]=p.data[f]}),delete k._,k.auth=N,T.get("~"+p.pair.pub).put(k)}T.get("~"+p.pair.pub).get("auth").put(N,j||d)},p.err=function(N){var k={err:a.log(N||"User cannot be found!")};x.ing=!1,(j||d)(k)},p.plugin=function(N){if(!(p.name=N))return p.err();var k=[N];N[0]!=="~"&&(k[1]="~"+N,k[2]="~@"+N),p.b(k)},h?h.priv&&h.epriv?p.g(h):T.get("~"+h.pub).once(p.h):c?T.get("~@"+c).once(p.a):!c&&!g&&r.name(p.plugin),v};function l(u){if(typeof u!="string")return u;try{u=JSON.parse(u)}catch{u={}}return u}})(t,"./auth"),t(function(o){var s=t("./user"),r=s.SEA;s.GUN,s.prototype.recall=function(a,d){var l=this,u=l.back(-1);if(a=a||{},a&&a.sessionStorage){if(r.window)try{var h={};h=r.window.sessionStorage,h&&(u._.opt.remember=!0,(l.back("user")._.opt||a).remember=!0,(h.recall||h.pair)&&u.user().auth(JSON.parse(h.pair),d))}catch{}return l}return l}})(t,"./recall"),t(function(o){var s=t("./user"),r=s.SEA,a=s.GUN,d=function(){};s.prototype.pair=function(){var l=this,u;try{u=new Proxy({DANGER:"â˜ "},{get:function(h,c,g){if(!(!l.is||!(l._||"").sea))return l._.sea[c]}})}catch{}return u},s.prototype.delete=async function(l,u,h){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var c=this;c.back(-1);var g=c.back("user");try{g.auth(l,u,function(j){var i=(g.is||{}).pub;g.map().once(function(){this.put(null)}),g.leave(),(h||d)({ok:0})})}catch(j){a.log("User.delete failed! Error:",j)}return c},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const h="No session!";throw a.log(h),{err:h}}},s.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),a.is(l)&&l.get("pub").get((u,h)=>{console.log(u,h)}),l.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(l,u){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,c=h.back(-1).user(),g=c._.sea,j="";return h.back(function(i){i.is||(j+=i.get||"")}),async function(){var i,v=await c.get("grant").get(g.pub).get(j).then();v=await r.decrypt(v,g),v||(v=r.random(16).toString(),i=await r.encrypt(v,g),c.get("grant").get(g.pub).get(j).put(i));var x=l.get("pub").then(),T=l.get("epub").then();x=await x,T=await T;var p=await r.secret(T,g);i=await r.encrypt(v,p),c.get("grant").get(x).get(j).put(i,u)}(),h},s.prototype.secret=function(l,u){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,c=h.back(-1).user(),g=c.pair(),j="";return h.back(function(i){i.is||(j+=i.get||"")}),async function(){var i,v=await c.get("trust").get(g.pub).get(j).then();v=await r.decrypt(v,g),v||(v=r.random(16).toString(),i=await r.encrypt(v,g),c.get("trust").get(g.pub).get(j).put(i)),i=await r.encrypt(l,v),h.put(i,u)}(),h},o.exports=s})(t,"./share"),t(function(o){var s=t("./sea"),r=t("./settings"),a,d=(s.window||"").GUN||t((""+a==typeof n?".":"")+"./gun",1);d.on("opt",function(i){i.sea||(i.sea={own:{}},i.on("put",l,i)),this.to.next(i)});function l(i){var v=this,x=v.as,T=i.put,p=T["#"],_=T["."],w=T[":"],N=T[">"],k=i["#"],f;if(!(!p||!_)){if((i._||"").faith&&(x.opt||"").faith&&typeof i._=="function"){s.opt.pack(T,function(A){s.verify(A,!1,function(R){T["="]=s.opt.unpack(R),v.to.next(i)})});return}var C=function(A){x.on("in",{"@":k,err:i.err=A})};if((i._||"").DBG&&((i._||"").DBG.c=+new Date),0<=p.indexOf("<?")&&(f=parseFloat(p.split("<?")[1]||""),f&&N<d.state()-f*1e3)){(f=i._)&&f.stun&&f.stun--;return}if(p==="~@"){l.alias(v,i,w,_,p,x,C);return}if(p.slice(0,2)==="~@"){l.pubs(v,i,w,_,p,x,C);return}if(f=s.opt.pub(p)){l.pub(v,i,w,_,p,x,C,x.user||"",f);return}if(0<=p.indexOf("#")){l.hash(v,i,w,_,p,x,C);return}l.any(v,i,w,_,p,x,C,x.user||"")}}l.hash=function(i,v,x,T,p,_,w){s.work(x,null,function(N){function k(f){let C="";for(let A=0;A<f.length;A++)C+=A-1&1?"":String.fromCharCode(parseInt(f.substring(A-1,A+1),16));return btoa(C)}if(N&&N===T.split("#").slice(-1)[0])return i.to.next(v);if(N&&N===k(T.split("#").slice(-1)[0]))return i.to.next(v);w("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(i,v,x,T,p,_,w){if(!x)return w("Data must exist!");if("~@"+T===h(x))return i.to.next(v);w("Alias not same!")},l.pubs=function(i,v,x,T,p,_,w){if(!x)return w("Alias must exist!");if(T===h(x))return i.to.next(v);w("Alias not same!")},l.pub=async function(i,v,x,T,p,_,w,N,k){var f;const C=await r.parse(x)||{},A=(R,D,y)=>{if(R.m&&R.s&&D&&k)return s.verify(R,k,b=>{if(a!==b&&a!==b.e&&v.put[">"]&&v.put[">"]>parseFloat(b.e))return w("Certificate expired.");if(a!==b&&b.c&&b.w&&(b.c===D||b.c.indexOf("*")>-1)){let S=p.indexOf("/")>-1?p.replace(p.substring(0,p.indexOf("/")+1),""):"";String.match=String.match||d.text.match;const U=Array.isArray(b.w)?b.w:typeof b.w=="object"||typeof b.w=="string"?[b.w]:[];for(const F of U)if(String.match(S,F["#"])&&String.match(T,F["."])||!F["."]&&String.match(S,F["#"])||!F["#"]&&String.match(T,F["."])||String.match(S?S+"/"+T:T,F["#"]||F)){if(F["+"]&&F["+"].indexOf("*")>-1&&S&&S.indexOf(D)==-1&&T.indexOf(D)==-1)return w(`Path "${S}" or key "${T}" must contain string "${D}".`);if(b.wb&&(typeof b.wb=="string"||(b.wb||{})["#"])){var P=i.as.root.$.back(-1);return typeof b.wb=="string"&&b.wb.slice(0,1)!=="~"&&(P=P.get("~"+k)),P.get(b.wb).get(D).once(G=>G&&(G===1||G===!0)?w(`Certificant ${D} blocked.`):y(b))}return y(b)}return w("Certificate verification fail.")}})};if(T==="pub"&&"~"+k===p)return x===k?i.to.next(v):w("Account not same!");if((f=N.is)&&f.pub&&!C["*"]&&!C["+"]&&(k===f.pub||k!==f.pub&&((v._.msg||{}).opt||{}).cert)){s.opt.pack(v.put,R=>{s.sign(R,N._.sea,async function(D){if(a===D)return w(s.err||"Signature fail.");if(v.put[":"]={":":f=s.opt.unpack(D.m),"~":D.s},v.put["="]=f,k===N.is.pub){(f=h(x))&&((_.sea.own[f]=_.sea.own[f]||{})[k]=1),JSON.stringifyAsync(v.put[":"],function(y,b){return y?w(y||"Stringify error."):(v.put[":"]=b,i.to.next(v))});return}if(k!==N.is.pub&&((v._.msg||{}).opt||{}).cert){const y=await r.parse(v._.msg.opt.cert);y&&y.m&&y.s&&A(y,N.is.pub,b=>{v.put[":"]["+"]=y,v.put[":"]["*"]=N.is.pub,JSON.stringifyAsync(v.put[":"],function(P,S){return P?w(P||"Stringify error."):(v.put[":"]=S,i.to.next(v))})})}},{raw:1})});return}s.opt.pack(v.put,R=>{s.verify(R,C["*"]||k,function(D){var y;if(D=s.opt.unpack(D),a===D)return w("Unverified data.");if((y=h(D))&&k===s.opt.pub(y)&&((_.sea.own[y]=_.sea.own[y]||{})[k]=1),C["+"]&&C["+"].m&&C["+"].s&&C["*"])A(C["+"],C["*"],b=>(v.put["="]=D,i.to.next(v)));else return v.put["="]=D,i.to.next(v)})})},l.any=function(i,v,x,T,p,_,w,N){if(_.opt.secure)return w("Soul missing public key at '"+T+"'.");_.on("secure",function(k){if(this.off(),!_.opt.secure)return i.to.next(k);w("Data cannot be changed.")}).on.on("secure",v)};var u=d.valid,h=function(i,v){return typeof(v=u(i))=="string"&&v};(d.state||"").ify;var c=/[^\w_-]/;s.opt.pub=function(i){if(i&&(i=i.split("~"),!(!i||!(i=i[1]))&&(i=i.split(c).slice(0,2),!(!i||i.length!=2)&&(i[0]||"")[0]!=="@")))return i=i.slice(0,2).join("."),i},s.opt.stringy=function(i){},s.opt.pack=function(i,v,x,T,p){var _,w;if(s.opt.check(i))return v(i);i&&i["#"]&&i["."]&&i[">"]&&(_=i[":"],w=1),JSON.parseAsync(w?_:i,function(N,k){var f=a!==(k||"")[":"]&&(k||"")["~"];if(!f){v(i);return}v({m:{"#":p||i["#"],".":x||i["."],":":(k||"")[":"],">":i[">"]||d.state.is(T,x)},s:f})})};var g=s.opt;s.opt.unpack=function(i,v,x){var T;if(a!==i){if(i&&a!==(T=i[":"]))return T;if(v=v||g.fall_key,!x&&g.fall_val&&(x={},x[v]=g.fall_val),!(!v||!x)){if(i===x[v]||!s.opt.check(x[v]))return i;var p=x&&x._&&x._["#"]||g.fall_soul,_=d.state.is(x,v)||g.fall_state;if(i&&i.length===4&&p===i[0]&&v===i[1]&&j(_)===j(i[3]))return i[2];if(_<s.opt.shuffle_attack)return i}}},s.opt.shuffle_attack=15463296e5;var j=Math.floor})(t,"./index")})()}(Ae)),Ae.exports}ms();var rt={},ot;function hs(){if(ot)return rt;ot=1;var m=typeof window<"u"?window.Gun:Ot();return m.chain.promise=function(o){var n=this,o=o||function(s){return s};return new Promise(function(s,r){n.once(function(a,d){s({put:a,get:d,gun:this})})}).then(o)},m.chain.then=function(t){var n=this,o=new Promise((s,r)=>{n.once(function(a,d){s(a,d)})});return t?o.then(t):o},rt}hs();console.log("ðŸ”« GunJS service file loading...");console.log("ðŸ”« Imported Gun:",typeof te);console.log("ðŸ”« After importing gun/sea and gun/lib/then");console.log("ðŸ”« Gun.SEA is available:",!!te.SEA);te.SEA?(console.log("ðŸ”« âœ… Gun.SEA is properly initialized"),console.log("ðŸ”« Gun.SEA methods:",te.SEA?Object.keys(te.SEA):"undefined")):(console.error("ðŸ”« CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("ðŸ”« Will check SEA availability after Gun instance creation..."));console.log("ðŸ”« About to initialize Gun instance...");const Q=te({peers:["https://gun-ad4i.onrender.com/gun"]});console.log("ðŸ”« GunJS initialized with Render peer");console.log("ðŸ”« Gun instance created:",typeof Q);console.log("ðŸ”« Gun instance properties:",Object.keys(Q));console.log("ðŸ”« Checking Gun.SEA after instance creation:",!!te.SEA);Q.SEA&&(console.log("ðŸ”« Found SEA on gun instance:",!!Q.SEA),te.SEA=Q.SEA);console.log("ðŸ”« Testing gun.user() method availability...");typeof Q.user=="function"?console.log("ðŸ”« âœ… gun.user() method is available"):(console.error("ðŸ”« âŒ gun.user() method is NOT available"),console.error("ðŸ”« Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(Q))));Q.on("hi",m=>{console.log("ðŸ”« GunJS: Connected to peer",m)});Q.on("bye",m=>{console.log("ðŸ”« GunJS: Disconnected from peer",m)});Q.on("out",m=>{m&&m.err&&console.warn("ðŸ”« GunJS: Connection error:",m.err)});setTimeout(()=>{console.log("ðŸ”« GunJS connection test - gun object:",Q),console.log("ðŸ”« GunJS internal state:",Q._),Q.get("test").put({hello:"world",timestamp:Date.now()}),console.log("ðŸ”« GunJS: Test data written")},2e3);console.log("ðŸ”« Creating user instance...");let oe;try{oe=Q.user(),console.log("ðŸ”« âœ… User instance created successfully:",typeof oe),console.log("ðŸ”« User instance properties:",Object.keys(oe)),typeof oe.create=="function"?console.log("ðŸ”« âœ… user.create() method is available"):console.error("ðŸ”« âŒ user.create() method is NOT available"),typeof oe.auth=="function"?console.log("ðŸ”« âœ… user.auth() method is available"):console.error("ðŸ”« âŒ user.auth() method is NOT available")}catch(m){console.error("ðŸ”« âŒ FAILED to create user instance:",m),console.error("ðŸ”« This confirms that SEA is not properly loaded"),oe={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const Pe=te.SEA;console.log("ðŸ”« SEA reference:",typeof Pe);Pe&&typeof Pe.encrypt=="function"?console.log("ðŸ”« âœ… SEA.encrypt() method is available"):(console.error("ðŸ”« âŒ SEA.encrypt() method is NOT available"),console.error("ðŸ”« Final Gun.SEA status:",te.SEA));class gs{constructor(){ye(this,"gun");ye(this,"user");ye(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=Q,this.user=oe,this.SEA=Pe,console.log("GunJS: GunService initialized")}async signUp(t,n){return console.log("ðŸ”« GunJS: Attempting to sign up user:",t),new Promise(o=>{if(n.length<8){console.log("ðŸ”« GunJS: Password too short"),o({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("ðŸ”« GunJS: Sign up timed out"),o({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,n,r=>{if(clearTimeout(s),console.log("ðŸ”« GunJS: Sign up response:",r),r.err){console.log("ðŸ”« GunJS: Sign up error:",r.err),o({success:!1,error:r.err});return}this.user.auth(t,n,a=>{if(!a.err){const d={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(d,()=>{console.log("ðŸ”« GunJS: Initial profile created with original username"),this.addToPublicUsersIndex(t,t),this.user.leave()})}}),console.log("ðŸ”« GunJS: Sign up successful"),o({success:!0})})})}async signIn(t,n){return console.log("ðŸ”« GunJS: Attempting to sign in user:",t),new Promise(o=>{const s=setTimeout(()=>{console.log("ðŸ”« GunJS: Sign in timed out"),o({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,n,r=>{if(clearTimeout(s),console.log("ðŸ”« GunJS: Sign in response:",r),r.err){console.log("ðŸ”« GunJS: Sign in error:",r.err),o({success:!1,error:r.err});return}console.log("ðŸ”« GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(a=>{if(!(a!=null&&a.originalUsername)){console.log("ðŸ”« GunJS: Storing original username in profile");const d={...a,originalUsername:t,favoriteGenres:(a==null?void 0:a.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(d)}this.addToPublicUsersIndex(t,(a==null?void 0:a.displayName)||t)}),o({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const n=setTimeout(()=>{console.log("ðŸ”« GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(n),this.user.is?(console.log("ðŸ”« GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(o=>{const s=(o==null?void 0:o.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("ðŸ”« GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}const o=setTimeout(()=>{console.log("ðŸ”« GunJS: updateProfile timed out"),n({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("ðŸ”« GunJS: Existing profile:",s);const r=(s==null?void 0:s.originalUsername)||this.user.is.alias,a={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:r};console.log("ðŸ”« GunJS: Updating profile with Gun-compatible data:",a),this.user.get("profile").put(a,d=>{if(clearTimeout(o),console.log("ðŸ”« GunJS: Profile update response:",d),d.err){console.log("ðŸ”« GunJS: Profile update error:",d.err),n({success:!1,error:d.err});return}console.log("ðŸ”« GunJS: Profile updated successfully"),this.user.get("profile").once(l=>{console.log("ðŸ”« GunJS: Profile after update:",l),n({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const n=setTimeout(()=>{console.log("ðŸ”« GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(o=>{if(clearTimeout(n),console.log("ðŸ”« GunJS: Raw profile loaded:",o),o){const s={displayName:o.displayName||"",bio:o.bio||"",favoriteGenres:o.favoriteGenres?JSON.parse(o.favoriteGenres):[],readingGoal:o.readingGoal||12,joinedDate:o.joinedDate,lastUpdated:o.lastUpdated,originalUsername:o.originalUsername};console.log("ðŸ”« GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,o=>{if(o.err){n({success:!1,error:o.err});return}n({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(n=>{t({success:!0,books:n||[]})})})}async syncUserNotes(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,o=>{if(o.err){n({success:!1,error:o.err});return}n({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(n=>{t({success:!0,notes:n||[]})})})}async syncUserSessions(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,o=>{if(o.err){n({success:!1,error:o.err});return}n({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(n=>{t({success:!0,sessions:n||[]})})})}async syncPetData(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,o=>{if(o.err){n({success:!1,error:o.err});return}n({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(n=>{t({success:!0,petData:n||null})})})}async syncUserData(t,n){return new Promise(o=>{if(!this.user.is){o({success:!1,error:"User not authenticated"});return}this.user.get(t).put(n,s=>{if(s.err){o({success:!1,error:s.err});return}o({success:!0})})})}async getUserData(t){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get(t).once(o=>{n({success:!0,data:o||{}})})})}subscribeToUserData(t,n){this.user.is&&this.user.get(t).on(n)}unsubscribeFromUserData(t){this.user.is&&this.user.get(t).off()}async addToPublicUsersIndex(t,n){try{if(!this.user.is)return;const o={id:this.user.is.pub,username:t,displayName:n||t,joinedAt:new Date().toISOString()};this.gun.get("publicUsers").get(this.user.is.pub).put(o),console.log("ðŸ”« GunJS: Added user to public index:",o)}catch(o){console.error("ðŸ”« GunJS: Error adding user to public index:",o)}}async searchPublicUsers(t){return new Promise(n=>{if(!t.trim()){n([]);return}const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: User search timed out"),n(o)},5e3);try{this.gun.get("publicUsers").map().on(r=>{var a;r&&r.username&&r.id&&(r.username.toLowerCase().includes(t.toLowerCase())||r.displayName&&r.displayName.toLowerCase().includes(t.toLowerCase()))&&r.id!==((a=this.user.is)==null?void 0:a.pub)&&o.findIndex(u=>u.id===r.id)===-1&&o.push({id:r.id,username:r.username,displayName:r.displayName})}),setTimeout(()=>{clearTimeout(s),n(o)},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error searching users:",r),n([])}})}async getPublicProfile(t){return new Promise(n=>{const o=setTimeout(()=>{n({success:!1,error:"Profile request timed out"})},3e3);try{this.gun.get("publicUsers").get(t).once(s=>{clearTimeout(o),n(s?{success:!0,profile:s}:{success:!1,error:"User not found"})})}catch{clearTimeout(o),n({success:!1,error:"Error fetching profile"})}})}async sendFriendRequest(t,n,o,s,r,a){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const d=`req_${Date.now()}_${t}_${s}`,l={id:d,fromUserId:t,fromUsername:n,fromDisplayName:o,toUserId:s,toUsername:r,toDisplayName:a,status:"pending",createdAt:new Date().toISOString()};return this.gun.get("friendRequests").get(s).get(d).put(l),this.gun.get("sentRequests").get(t).get(d).put(l),{success:!0}}catch(d){return console.error("ðŸ”« GunJS: Error sending friend request:",d),{success:!1,error:"Failed to send friend request"}}}async getFriendRequests(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const n=[],o=setTimeout(()=>{t({success:!0,requests:n})},3e3);try{this.gun.get("friendRequests").get(this.user.is.pub).map().on(s=>{s&&s.id&&s.status==="pending"&&n.findIndex(a=>a.id===s.id)===-1&&n.push(s)}),setTimeout(()=>{clearTimeout(o),t({success:!0,requests:n})},2e3)}catch{clearTimeout(o),t({success:!1,error:"Error fetching friend requests"})}})}async acceptFriendRequest(t,n){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};console.log("ðŸ”« GunJS: Accepting friend request:",t,"from:",n);const o={status:"accepted",respondedAt:new Date().toISOString()};this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(n).get(t).put(o);const s=[this.user.is.pub,n].sort().join("_"),r={id:s,user1:this.user.is.pub,user2:n,createdAt:new Date().toISOString(),status:"active"};return console.log("ðŸ”« GunJS: Creating friendship:",s),this.gun.get("friendships").get(s).put(r),this.gun.get("userFriends").get(this.user.is.pub).get(n).put({friendId:n,since:new Date().toISOString()}),this.gun.get("userFriends").get(n).get(this.user.is.pub).put({friendId:this.user.is.pub,since:new Date().toISOString()}),console.log("ðŸ”« GunJS: Friend request accepted successfully"),{success:!0}}catch(o){return console.error("ðŸ”« GunJS: Error accepting friend request:",o),{success:!1,error:"Failed to accept friend request"}}}async declineFriendRequest(t,n){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const o={status:"declined",respondedAt:new Date().toISOString()};return this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(n).get(t).put(o),{success:!0}}catch(o){return console.error("ðŸ”« GunJS: Error declining friend request:",o),{success:!1,error:"Failed to decline friend request"}}}async getFriends(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const n=[],o=new Set;let s=0;const r=setTimeout(()=>{console.log("ðŸ”« GunJS: getFriends timeout, returning",n.length,"friends"),t({success:!0,friends:n})},4e3);try{this.gun.get("friendships").map().on((a,d)=>{if(!(!a||!d||o.has(d))&&(a.user1===this.user.is.pub||a.user2===this.user.is.pub)){o.add(d),s++;const l=a.user1===this.user.is.pub?a.user2:a.user1;this.gun.get("publicUsers").get(l).once(u=>{s--,u&&!n.find(h=>h.id===l)&&(n.push({id:l,username:u.username,displayName:u.displayName,status:"accepted",addedAt:a.createdAt}),console.log("ðŸ”« GunJS: Added friend:",u.username)),s===0&&setTimeout(()=>{clearTimeout(r),t({success:!0,friends:n})},500)})}}),setTimeout(()=>{s===0&&(clearTimeout(r),t({success:!0,friends:n}))},2e3)}catch{clearTimeout(r),t({success:!1,error:"Error fetching friends"})}})}async removeFriend(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const n=[this.user.is.pub,t].sort().join("_");return this.gun.get("friendships").get(n).put(null),{success:!0}}catch(n){return console.error("ðŸ”« GunJS: Error removing friend:",n),{success:!1,error:"Failed to remove friend"}}}async updatePublicStats(t){try{if(!this.user.is)return console.error("ðŸ”« GunJS: Cannot update public stats - user not authenticated"),{success:!1,error:"User not authenticated"};if(!t||typeof t!="object")return console.error("ðŸ”« GunJS: Invalid stats data provided"),{success:!1,error:"Invalid stats data"};const n={userId:this.user.is.pub,username:this.user.is.alias||"Unknown",totalBooksRead:Math.max(0,Number(t.totalBooksRead)||0),totalPagesRead:Math.max(0,Number(t.totalPagesRead)||0),totalReadingTime:Math.max(0,Number(t.totalReadingTime)||0),currentStreak:Math.max(0,Number(t.currentStreak)||0),lastUpdated:new Date().toISOString(),timestamp:Date.now()};return console.log("ðŸ”« GunJS: Updating public stats for user:",this.user.is.pub),console.log("ðŸ”« GunJS: Stats being updated:",n),new Promise(o=>{let s=!1;const r=a=>{s||(s=!0,o(a))};try{this.gun.get("publicStats").get(this.user.is.pub).put(n,d=>{d.err?console.error("ðŸ”« GunJS: âŒ Error storing public stats (strategy 1):",d.err):(console.log("ðŸ”« GunJS: âœ… Public stats updated successfully (strategy 1)"),r({success:!0}))}),this.gun.get("userStats").get(this.user.is.pub).put(n),this.user.get("publicStats").put(n),this.gun.get("allPublicStats").set(n),setTimeout(()=>{console.log("ðŸ”« GunJS: âš ï¸ Public stats update timeout, assuming success"),r({success:!0})},3e3)}catch(a){console.error("ðŸ”« GunJS: âŒ Error in stats update promise:",a),r({success:!1,error:"Promise execution failed"})}})}catch(n){return console.error("ðŸ”« GunJS: âŒ Error updating public stats:",n),{success:!1,error:"Failed to update public stats"}}}async getPublicStats(t){return new Promise(n=>{const o=setTimeout(()=>{n({success:!1,error:"Stats request timed out"})},3e3);try{this.gun.get("publicStats").get(t).once(s=>{clearTimeout(o),n(s?{success:!0,stats:s}:{success:!1,error:"Stats not found"})})}catch{clearTimeout(o),n({success:!1,error:"Error fetching stats"})}})}async getAllPublicStats(){return new Promise(t=>{const n=[],o=new Set;let s;const r=()=>{s&&clearTimeout(s);const a=n.filter(d=>o.has(d.userId)?!1:(o.add(d.userId),!0));console.log("ðŸ”« GunJS: Returning",a.length,"unique public stats"),t({success:!0,allStats:a})};s=setTimeout(()=>{console.log("ðŸ”« GunJS: getAllPublicStats timeout, returning",n.length,"stats"),r()},5e3);try{console.log("ðŸ”« GunJS: Starting to fetch all public stats from multiple sources..."),this.gun.get("publicStats").map().on((a,d)=>{a&&d&&typeof a=="object"&&!o.has(d)&&(console.log("ðŸ”« GunJS: Found public stats (source 1) for user:",d,a),n.push({...a,userId:d,source:"publicStats"}))}),this.gun.get("userStats").map().on((a,d)=>{a&&d&&typeof a=="object"&&!o.has(d)&&(console.log("ðŸ”« GunJS: Found user stats (source 2) for user:",d,a),n.push({...a,userId:d,source:"userStats"}))}),this.gun.get("allPublicStats").map().on((a,d)=>{a&&a.userId&&typeof a=="object"&&!o.has(a.userId)&&(console.log("ðŸ”« GunJS: Found stats (source 3) for user:",a.userId,a),n.push({...a,source:"allPublicStats"}))}),setTimeout(()=>{r()},3e3)}catch(a){s&&clearTimeout(s),console.error("ðŸ”« GunJS: Error fetching all public stats:",a),t({success:!1,error:"Failed to fetch public stats"})}})}async publishActivity(t){var n,o;try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const s=this.getCurrentUser(),r=await this.getProfile(),a=r.success?((n=r.profile)==null?void 0:n.displayName)||((o=r.profile)==null?void 0:o.username)||(s==null?void 0:s.username):(s==null?void 0:s.username)||"Unknown",d={id:`activity_${Date.now()}_${this.user.is.pub}`,userId:this.user.is.pub,username:(s==null?void 0:s.username)||"Unknown",displayName:a,type:t.type,title:t.title,description:t.description,timestamp:new Date().toISOString(),bookTitle:t.bookTitle,bookCover:t.bookCover,metadata:t.metadata};return this.gun.get("publicActivity").get(d.id).put(d),this.gun.get("userActivity").get(this.user.is.pub).set(d),console.log("ðŸ”« GunJS: Published activity:",d),{success:!0}}catch(s){return console.error("ðŸ”« GunJS: Error publishing activity:",s),{success:!1,error:"Failed to publish activity"}}}async getFriendActivities(t){return new Promise(n=>{const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: getFriendActivities timeout, returning",o.length,"activities"),n({success:!0,activities:o})},4e3);try{if(console.log("ðŸ”« GunJS: Fetching activities for friends:",t),t.length===0){clearTimeout(s),n({success:!0,activities:[]});return}const r=a=>{this.gun.get("userActivity").get(a).map().once(d=>{if(d&&d.id&&d.timestamp){const l=new Date(d.timestamp),u=new Date(Date.now()-30*24*60*60*1e3);l>u&&!o.find(h=>h.id===d.id)&&o.push(d)}})};t.forEach(r),this.gun.get("publicActivity").map().on(a=>{if(a&&a.userId&&t.includes(a.userId)){const d=new Date(a.timestamp),l=new Date(Date.now()-30*24*60*60*1e3);d>l&&!o.find(u=>u.id===a.id)&&o.push(a)}}),setTimeout(()=>{clearTimeout(s);const a=o.sort((d,l)=>new Date(l.timestamp).getTime()-new Date(d.timestamp).getTime()).slice(0,20);console.log("ðŸ”« GunJS: Returning",a.length,"friend activities"),n({success:!0,activities:a})},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error fetching friend activities:",r),n({success:!1,error:"Failed to fetch activities"})}})}async getRecentPublicActivity(t=50){return new Promise(n=>{const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: getRecentPublicActivity timeout, returning",o.length,"activities"),n({success:!0,activities:o})},3e3);try{this.gun.get("publicActivity").map().on(r=>{if(r&&r.id&&r.timestamp){const a=new Date(r.timestamp),d=new Date(Date.now()-7*24*60*60*1e3);a>d&&!o.find(l=>l.id===r.id)&&o.push(r)}}),setTimeout(()=>{clearTimeout(s);const r=o.sort((a,d)=>new Date(d.timestamp).getTime()-new Date(a.timestamp).getTime()).slice(0,t);n({success:!0,activities:r})},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error fetching recent public activity:",r),n({success:!1,error:"Failed to fetch public activity"})}})}async verifyStatsSync(){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const t=JSON.parse(localStorage.getItem("bookish_books")||"[]"),n=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]"),o={totalBooksRead:t.filter(r=>r.category==="completed").length,totalReadingTime:n.reduce((r,a)=>r+(a.duration||0),0),totalPagesRead:n.reduce((r,a)=>{const d=(a.endPage||0)-(a.startPage||0);return r+Math.max(0,d)},0)},s=await this.getPublicStats(this.user.is.pub);return console.log("ðŸ” Stats verification:"),console.log("ðŸ“Š Local stats:",o),console.log("ðŸ”« GunJS stats:",s.success?s.stats:"Not found"),{success:!0,localStats:o,gunStats:s.success?s.stats:null}}catch(t){return console.error("âŒ Error verifying stats sync:",t),{success:!1,error:"Verification failed"}}}}const $=new gs;class fs{constructor(){ye(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,n){if($.isAuthenticated()&&this.isOnline)try{await $.syncUserData(t,n)}catch(o){console.warn("Failed to sync data to server:",o)}}async getData(t,n){if($.isAuthenticated()&&this.isOnline)try{const s=await $.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const o=localStorage.getItem(`bookish_${t}`);return o?JSON.parse(o):n}setLocalStorage(t,n){localStorage.setItem(`bookish_${t}`,JSON.stringify(n))}async syncPendingChanges(){if(!$.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const n of t)try{const o=localStorage.getItem(`bookish_${n}`);o&&await $.syncUserData(n,JSON.parse(o))}catch(o){console.warn(`Failed to sync ${n}:`,o)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!$.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const n of t)try{const o=n.getter();o!==null&&(Array.isArray(o)?o.length>0:Object.keys(o).length>0)&&await $.syncUserData(n.key,o)}catch(o){console.warn(`Failed to migrate ${n.key}:`,o)}}}const Y=new fs,le="https://openlibrary.org",xs=async m=>{try{return(await(await fetch(`${le}/search.json?q=${encodeURIComponent(m)}&limit=10`)).json()).docs.map(o=>({key:o.key,title:o.title,author_name:o.author_name,cover_i:o.cover_i,first_publish_year:o.first_publish_year,number_of_pages_median:o.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},ps=async m=>{var t,n;try{const o=m.replace("/works/",""),r=await(await fetch(`${le}/works/${o}.json`)).json();let a=r.number_of_pages_median;!a&&r.editions&&(a=await ys(r.editions)),a||(a=await bs(o));let d=[];if(r.authors&&r.authors.length>0){const l=r.authors.slice(0,3).map(async h=>{try{return(await(await fetch(`${le}${h.author.key}.json`)).json()).name}catch{return null}});d=(await Promise.all(l)).filter(h=>h!==null)}return{key:r.key,title:r.title,author_name:d,cover_i:(t=r.covers)==null?void 0:t[0],first_publish_year:r.first_publish_year,description:((n=r.description)==null?void 0:n.value)||r.description||"",number_of_pages_median:a}}catch(o){return console.error("Error fetching book details:",o),null}},ys=async m=>{try{if(!m||!m.entries||m.entries.length===0)return;for(const t of m.entries.slice(0,3))try{const o=await(await fetch(`${le}${t.key}.json`)).json();if(o.number_of_pages)return o.number_of_pages}catch(n){console.error("Error fetching edition:",n);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},bs=async m=>{try{const n=await(await fetch(`${le}/works/${m}/editions.json?limit=5`)).json();if(n.entries&&n.entries.length>0){for(const o of n.entries)if(o.number_of_pages)return o.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},ws=(m,t="M")=>m?`https://covers.openlibrary.org/b/id/${m}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",vs=async m=>{var t;try{return((t=(await(await fetch(`${le}/subjects/${encodeURIComponent(m.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var r;return{key:s.key,title:s.title,author_name:((r=s.authors)==null?void 0:r.map(a=>a.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(n){return console.error("Error searching books by subject:",n),[]}},js=async m=>{var t,n;try{const o=m.replace(/[-\s]/g,""),s=await fetch(`${le}/isbn/${o}.json`);if(!s.ok)return null;const r=await s.json();return{key:r.key,title:r.title,author_name:((t=r.authors)==null?void 0:t.map(a=>a.name))||[],cover_i:(n=r.covers)==null?void 0:n[0],first_publish_year:r.publish_date?new Date(r.publish_date).getFullYear():void 0,number_of_pages_median:r.number_of_pages}}catch(o){return console.error("Error searching book by ISBN:",o),null}},Ss="bookish_reading_sessions",Ns="bookish_stats",ks="bookish_streak",Oe="bookish_cached_books",je=(m,t)=>{const n=localStorage.getItem(m);return n?JSON.parse(n):t},Cs=(m,t)=>{localStorage.setItem(m,JSON.stringify(t))},yt=m=>je(Oe,{})[m]||null,at=m=>{const t=je(Oe,{});t[m.key]={...m,cached_at:new Date().toISOString()},Cs(Oe,t)},Me=()=>je(Ss,[]),nt=m=>Me().filter(t=>t.bookId===m),Ts=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),bt=()=>je(Ns,Ts()),As=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),wt=()=>je(ks,As()),vt=E.createContext(void 0),ie=()=>{const m=E.useContext(vt);if(!m)throw new Error("useBooks must be used within a BookProvider");return m},Ps=({children:m})=>{const[t,n]=E.useState([]),[o,s]=E.useState(null),[r,a]=E.useState([]),[d,l]=E.useState([]);E.useEffect(()=>{(async()=>{const A=(await Y.getBooks()).map(D=>{const y=yt(D.key);return y?{...D,...y}:D});n(A);const R=await Y.getCurrentBook();s(R)})()},[]),E.useEffect(()=>{(async()=>{if(o){const C=await Y.getReadingSessions(),A=await Y.getNotes();a(C.filter(R=>R.bookId===o.key)),l(A.filter(R=>R.bookId===o.key))}else a([]),l([])})()},[o]);const u=async f=>{const C=[...t],A=C.findIndex(y=>y.key===f.key),R=A>=0&&C[A].category==="completed",D=f.category==="completed";if(A>=0?C[A]=f:C.push(f),n(C),await Y.saveBooks(C),localStorage.setItem("bookish_books",JSON.stringify(C)),!R&&D)try{console.log("ðŸ“š Book marked as completed, triggering all sync mechanisms..."),await $.publishActivity({type:"book_completed",title:"Completed a book!",description:`Just finished reading "${f.title}"`,bookTitle:f.title,bookCover:f.cover_i?`https://covers.openlibrary.org/b/id/${f.cover_i}-S.jpg`:void 0,metadata:{pagesRead:f.number_of_pages_median||200}}),console.log("âœ… Published book completion activity:",f.title),await new Promise(b=>setTimeout(b,100)),await N()||await h(),console.log("âœ… All book completion sync mechanisms completed")}catch(y){console.error("âŒ Error in book completion sync:",y);try{await h()}catch(b){console.error("âŒ Fallback stats update also failed:",b)}}},h=async()=>{try{console.log("ðŸ“Š Updating public stats after book completion...");const f=JSON.parse(localStorage.getItem("bookish_books")||"[]"),C=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]");console.log("ðŸ“Š Local books data:",f.length,"books"),console.log("ðŸ“Š Local sessions data:",C.length,"sessions");const A=f.filter(F=>F.category==="completed");console.log("ðŸ“Š Completed books count:",A.length);const R=C.reduce((F,G)=>F+(G.duration||0),0),D=C.reduce((F,G)=>{const L=(G.endPage||0)-(G.startPage||0);return F+Math.max(0,L)},0),y=c(C),b={totalBooksRead:Math.max(A.length,0),totalPagesRead:Math.max(D,A.length*200),totalReadingTime:Math.max(R,0),currentStreak:Math.max(y,0)};if(console.log("ðŸ“Š Final calculated stats:",b),!(await $.getCurrentUser()).success){console.error("âŒ User not authenticated, cannot update public stats");return}let S=0;const U=3;for(;S<U;){const F=await $.updatePublicStats(b);if(F.success){console.log("âœ… Public stats updated successfully");break}else S++,console.error(`âŒ Failed to update public stats (attempt ${S}/${U}):`,F.error),S<U&&await new Promise(G=>setTimeout(G,1e3*S))}}catch(f){console.error("âŒ Error updating public stats:",f)}},c=f=>{if(!f.length)return 0;const C=f.map(y=>new Date(y.startTime).toDateString()).filter((y,b,P)=>P.indexOf(y)===b).sort((y,b)=>new Date(b).getTime()-new Date(y).getTime());let A=0;const R=new Date().toDateString(),D=new Date(Date.now()-864e5).toDateString();if(C[0]===R||C[0]===D){A=1;for(let y=1;y<C.length;y++){const b=new Date(C[y]);if((new Date(C[y-1]).getTime()-b.getTime())/(1e3*60*60*24)===1)A++;else break}}return A},g=async f=>{const C=t.filter(b=>b.key!==f);n(C),await Y.saveBooks(C);const A=await Y.getReadingSessions(),R=await Y.getNotes(),D=A.filter(b=>b.bookId!==f),y=R.filter(b=>b.bookId!==f);await Y.saveReadingSessions(D),await Y.saveNotes(y),o&&o.key===f&&(s(null),await Y.setCurrentBook(null))},j=async f=>{s(f),await Y.setCurrentBook(f)},i=async f=>{const C=await Y.getReadingSessions(),A=C.findIndex(R=>R.id===f.id);if(A>=0?C[A]=f:C.push(f),await Y.saveReadingSessions(C),o&&f.bookId===o.key&&a(C.filter(R=>R.bookId===o.key)),f.duration&&f.duration>=15)try{const R=t.find(y=>y.key===f.bookId),D=f.endPage&&f.startPage?f.endPage-f.startPage:0;await $.publishActivity({type:"reading_session",title:"Had a reading session",description:`Read for ${f.duration} minutes${R?` in "${R.title}"`:""}`,bookTitle:R==null?void 0:R.title,bookCover:R!=null&&R.cover_i?`https://covers.openlibrary.org/b/id/${R.cover_i}-S.jpg`:void 0,metadata:{duration:f.duration,pagesRead:Math.max(0,D)}}),console.log("ðŸ“– Published reading session activity:",f.duration,"minutes"),await h()}catch(R){console.error("Error publishing reading session activity:",R)}},v=async f=>{const A=[...await Y.getNotes(),f];await Y.saveNotes(A),o&&f.bookId===o.key&&l(A.filter(R=>R.bookId===o.key))},x=async f=>{const A=(await Y.getNotes()).map(R=>R.id===f.id?f:R);await Y.saveNotes(A),o&&f.bookId===o.key&&l(A.filter(R=>R.bookId===o.key))},T=async f=>{const A=(await Y.getNotes()).filter(R=>R.id!==f);await Y.saveNotes(A),o&&l(A.filter(R=>R.bookId===o.key))},p=async()=>{try{const f=t.filter(b=>b.category==="completed"),C=r.reduce((b,P)=>b+(P.duration||0),0),A=r.reduce((b,P)=>{const S=(P.endPage||0)-(P.startPage||0);return b+Math.max(0,S)},0),D=(b=>{if(!b.length)return 0;const P=b.map(G=>new Date(G.startTime).toDateString()).filter((G,L,O)=>O.indexOf(G)===L).sort((G,L)=>new Date(L).getTime()-new Date(G).getTime());let S=0;const U=new Date().toDateString(),F=new Date(Date.now()-864e5).toDateString();if(P[0]===U||P[0]===F){S=1;for(let G=1;G<P.length;G++){const L=new Date(P[G]);if((new Date(P[G-1]).getTime()-L.getTime())/(1e3*60*60*24)===1)S++;else break}}return S})(r),y={totalBooksRead:f.length,totalPagesRead:Math.max(A,f.length*200),totalReadingTime:C,currentStreak:D};await $.updatePublicStats(y)}catch(f){console.error("Error updating public stats:",f)}},_=async()=>{console.log("ðŸ” DEBUG: Starting comprehensive stats debug...");const f=JSON.parse(localStorage.getItem("bookish_books")||"[]"),C=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]"),A=await Y.getBooks(),R=await Y.getReadingSessions();console.log("ðŸ“š Local books:",f.length,f),console.log("ðŸ“– Local sessions:",C.length,C),console.log("ðŸ”„ Synced books:",A.length,A),console.log("ðŸ”„ Synced sessions:",R.length,R);const D=await $.getCurrentUser();console.log("ðŸ” Auth status:",D),await h(),console.log("ðŸ“Š Testing leaderboard fetch...");const y=await $.getAllPublicStats();return console.log("ðŸ“Š All public stats:",y),{localBooks:f.length,localSessions:C.length,syncedBooks:A.length,syncedSessions:R.length,authStatus:D,allStats:y}},w=async()=>{console.log("ðŸ§ª Testing book completion flow...");const f={key:`test-book-${Date.now()}`,title:`Test Book ${Date.now()}`,author_name:["Test Author"],category:"completed",status:"read",cover_i:void 0,number_of_pages_median:250,progress:100,dateCompleted:new Date().toISOString()};try{return await u(f),console.log("âœ… Test book added successfully"),await h(),console.log("âœ… Stats updated after test book completion"),f}catch(C){throw console.error("âŒ Error in test book completion:",C),C}},N=async()=>{try{console.log("ðŸ”„ Force syncing local stats to GunJS...");const f=JSON.parse(localStorage.getItem("bookish_books")||"[]"),C=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]"),A=f.filter(P=>P.category==="completed"),R=C.reduce((P,S)=>P+(S.duration||0),0),D=C.reduce((P,S)=>{const U=(S.endPage||0)-(S.startPage||0);return P+Math.max(0,U)},0),y=c(C),b={totalBooksRead:A.length,totalPagesRead:Math.max(D,A.length*200),totalReadingTime:R,currentStreak:y};console.log("ðŸ”„ Syncing stats to GunJS:",b);for(let P=1;P<=3;P++){const S=await $.updatePublicStats(b);if(S.success)return console.log("âœ… Stats successfully synced to GunJS"),!0;console.warn(`âš ï¸ Sync attempt ${P} failed:`,S.error),P<3&&await new Promise(U=>setTimeout(U,1e3*P))}return console.error("âŒ Failed to sync stats to GunJS after 3 attempts"),!1}catch(f){return console.error("âŒ Error in force sync:",f),!1}};E.useEffect(()=>{(t.length>0||r.length>0)&&p()},[t,r]);const k={books:t,currentBook:o,sessions:r,notes:d,addBook:u,removeBook:g,setActiveBook:j,addSession:i,addNote:v,updateNote:x,deleteNote:T,updatePublicStatsAfterBookCompletion:h};return Le.useEffect(()=>{window.debugUpdateStats=h,window.debugStatsAndUpdate=_,window.debugTestBookCompletion=w,window.debugForceSyncStats=N,window.debugVerifyStatsSync=async()=>{const f=await $.verifyStatsSync();return console.log("ðŸ“Š Stats sync verification:",f),f},window.debugForceStatsUpdate=async()=>{console.log("ðŸ”§ Force updating stats..."),await h(),console.log("âœ… Force update completed")}},[]),e.jsx(vt.Provider,{value:k,children:m})},jt=E.createContext(void 0),xe=()=>{const m=E.useContext(jt);if(!m)throw new Error("usePet must be used within a PetProvider");return m},Ge=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content"}),St=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),Es=()=>{try{const m=localStorage.getItem("bookish_pet");if(m){const t=JSON.parse(m);return{...Ge(),...t}}}catch(m){console.error("Error loading pet from storage:",m)}return Ge()},_s=()=>{try{const m=localStorage.getItem("bookish_pet_stats");if(m)return JSON.parse(m)}catch(m){console.error("Error loading pet stats from storage:",m)}return St()},Rs=m=>{localStorage.setItem("bookish_pet",JSON.stringify(m))},Bs=m=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(m))},Ds=({children:m})=>{const[t,n]=E.useState(Es),[o,s]=E.useState(_s);E.useEffect(()=>{Rs(t)},[t]),E.useEffect(()=>{Bs(o)},[o]),E.useEffect(()=>{const f=setInterval(()=>{const C=new Date,A=new Date(t.lastFed),R=(C.getTime()-A.getTime())/(1e3*60*60);R>1&&n(b=>{const P=Math.floor(R);return{...b,hunger:Math.max(0,b.hunger-P*2),energy:Math.max(0,b.energy-P),happiness:Math.max(0,b.happiness-P),mood:r(Math.max(0,b.happiness-P),Math.max(0,b.hunger-P*2),Math.max(0,b.energy-P))}});const D=C.toDateString(),y=new Date(o.lastActiveDate).toDateString();D!==y&&s(b=>({...b,booksReadToday:0,readingTimeToday:0,lastActiveDate:C.toISOString()}))},3e4);return()=>clearInterval(f)},[t.lastFed,o.lastActiveDate]);const r=(f,C,A)=>C<20?"hungry":A<20?"sleepy":f>80?"happy":f>60?"excited":f<30?"sad":"content",a=f=>100+f*50,d=(f,C)=>{let A=C,R=a(A);for(;f>=R;)A++,R=a(A);return{newLevel:A,newExpToNext:R}},l=f=>f<3?"egg":f<8?"baby":f<15?"child":f<25?"teen":f<40?"adult":"elder",u=()=>{const f=t.evolutionStage,C=t.mood,A={egg:{happy:"ðŸ¥š",content:"ðŸ¥š",sad:"ðŸ’”",excited:"âœ¨",sleepy:"ðŸ˜´",hungry:"ðŸ¥š"},baby:{happy:"ðŸ˜Š",content:"ðŸ›",sad:"ðŸ˜¢",excited:"ðŸ¤©",sleepy:"ðŸ˜´",hungry:"ðŸ˜‹"},child:{happy:"ðŸ˜„",content:"ðŸ¯",sad:"ðŸ˜­",excited:"ðŸ¤—",sleepy:"ðŸ’¤",hungry:"ðŸŽ"},teen:{happy:"ðŸ˜Ž",content:"ðŸ¦Š",sad:"ðŸ˜”",excited:"ðŸš€",sleepy:"ðŸ˜ª",hungry:"ðŸ•"},adult:{happy:"ðŸŒŸ",content:"ðŸ¦‰",sad:"ðŸ˜ž",excited:"ðŸŽ‰",sleepy:"ðŸ˜Œ",hungry:"ðŸ½ï¸"},elder:{happy:"ðŸ‘‘",content:"ðŸ‰",sad:"ðŸ˜Ÿ",excited:"ðŸŽŠ",sleepy:"ðŸ§˜",hungry:"ðŸ±"}};return A[f][C]||A[f].content},h=()=>{n(f=>{if(f.points<3)return f;const C=Math.min(100,f.hunger+30),A=Math.min(100,f.happiness+10),R=f.experience+5,{newLevel:D,newExpToNext:y}=d(R,f.level);return{...f,hunger:C,happiness:A,experience:R,level:D,experienceToNext:y,points:f.points-3,lastFed:new Date().toISOString(),evolutionStage:l(D),mood:r(A,C,f.energy)}})},c=()=>{n(f=>{if(f.points<5)return f;const C=Math.min(100,f.happiness+20),A=Math.max(0,f.energy-15),R=f.experience+10,{newLevel:D,newExpToNext:y}=d(R,f.level);return{...f,happiness:C,energy:A,experience:R,level:D,experienceToNext:y,points:f.points-5,lastPlayed:new Date().toISOString(),evolutionStage:l(D),mood:r(C,f.hunger,A)}})},g=()=>{n(f=>{const C=Math.min(100,f.energy+40),A=Math.min(100,f.health+10);return{...f,energy:C,health:A,lastSlept:new Date().toISOString(),mood:r(f.happiness,f.hunger,C)}})},j=(f,C=!1)=>{const D=Math.floor(f/5)+(C?50:0);D>0&&(n(y=>{const b=y.experience+D,P=Math.min(100,y.happiness+Math.floor(f/10)),S=y.totalReadingTime+f,{newLevel:U,newExpToNext:F}=d(b,y.level);return{...y,experience:b,level:U,experienceToNext:F,happiness:P,totalReadingTime:S,evolutionStage:l(U),mood:r(P,y.hunger,y.energy)}}),s(y=>({...y,readingTimeToday:y.readingTimeToday+f,lastActiveDate:new Date().toISOString()})))},i=()=>{n(f=>{const C=f.experience+50,A=Math.min(100,f.happiness+25),R=f.totalBooksRead+1,D=20,{newLevel:y,newExpToNext:b}=d(C,f.level),P=[...f.badges];return R===1&&!P.includes("first-book")&&P.push("first-book"),R===10&&!P.includes("book-lover")&&P.push("book-lover"),R===50&&!P.includes("bookworm")&&P.push("bookworm"),{...f,experience:C,level:y,experienceToNext:b,happiness:A,points:f.points+D,totalBooksRead:R,badges:P,evolutionStage:l(y),mood:r(A,f.hunger,f.energy)}}),s(f=>({...f,booksReadToday:f.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},v=()=>({happy:"Your pet is very happy! Keep up the great reading!",excited:"Your pet is excited about your reading progress!",content:"Your pet is content and enjoying your company.",sad:"Your pet seems sad. Try feeding or playing with them!",sleepy:"Your pet is tired. Maybe they need some rest?",hungry:"Your pet is hungry! Don't forget to feed them."})[t.mood],x=()=>{const f=l(t.level+1),C=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:C,stage:f}},T=()=>{const f=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=f&&t.evolutionStage!==l(t.level)},p=()=>{n(f=>({...f,evolutionStage:l(f.level),happiness:100,health:100}))},_=()=>{const f=Ge();n(f),s(St())},w=f=>{n(C=>({...C,name:f}))},N=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",k=()=>t.experience/t.experienceToNext*100;return e.jsx(jt.Provider,{value:{pet:t,petStats:o,feedPet:h,playWithPet:c,petSleep:g,updatePetFromReading:j,updatePetFromBookCompletion:i,getPetMood:v,getPetEvolutionRequirement:x,resetPet:_,updatePetName:w,getPetEmoji:u,canEvolve:T,evolvePet:p,getPetHappinessLevel:N,getLevelProgress:k},children:m})},se={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet",USER_SETTINGS:"bookish-user-settings"};class ae{static get(t){try{const n=localStorage.getItem(t);return n?JSON.parse(n):null}catch(n){return console.error("Error reading from localStorage:",n),null}}static set(t,n){try{return localStorage.setItem(t,JSON.stringify(n)),!0}catch(o){return console.error("Error writing to localStorage:",o),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(n){return console.error("Error removing from localStorage:",n),!1}}static clear(){try{return Object.values(se).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(se.GUEST_PROFILE)}static setGuestProfile(t){return this.set(se.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(se.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(se.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(se.GUEST_PET)}static setGuestPet(t){return this.set(se.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}static getUserSettings(){return this.get(se.USER_SETTINGS)}static saveUserSettings(t){return this.set(se.USER_SETTINGS,{...t,lastUpdated:new Date().toISOString()})}}const Nt=E.createContext(void 0),Is={isAuthenticated:!1,user:null,isLoading:!0,error:null},Fs=(m,t)=>{switch(t.type){case"AUTH_START":return{...m,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...m,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...m,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...m,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...m,error:null};case"UPDATE_USER":return{...m,user:m.user?{...m.user,...t.payload}:null};default:return m}},Us=({children:m})=>{const[t,n]=E.useReducer(Fs,Is);E.useEffect(()=>{(async()=>{var c;try{const g=new Promise((v,x)=>setTimeout(()=>x(new Error("Authentication check timeout")),5e3)),j=$.recallUser(),i=await Promise.race([j,g]);if(i&&i.success&&i.user){const v=new Promise((x,T)=>setTimeout(()=>T(new Error("Profile load timeout")),3e3));try{const x=await Promise.race([$.getProfile(),v]),T={...i.user,username:x!=null&&x.success&&((c=x==null?void 0:x.profile)!=null&&c.originalUsername)?x.profile.originalUsername:i.user.username||"Unknown User",profile:x&&x.success?x.profile:void 0};n({type:"AUTH_SUCCESS",payload:T})}catch{const T={...i.user,username:i.user.username||"Unknown User",profile:void 0};n({type:"AUTH_SUCCESS",payload:T})}}else n({type:"AUTH_FAILURE",payload:""})}catch(g){console.log("GunJS auth check failed (servers may be down):",g),n({type:"AUTH_FAILURE",payload:""})}})()},[]);const u={...t,signIn:async(h,c)=>{n({type:"AUTH_START"});try{const g=await $.signIn(h,c);if(g.success&&g.user){const j=await $.getProfile(),i={...g.user,username:h,profile:j.success?j.profile:void 0};return n({type:"AUTH_SUCCESS",payload:i}),{success:!0}}else return n({type:"AUTH_FAILURE",payload:g.error||"Sign in failed"}),{success:!1,error:g.error}}catch{const j="An unexpected error occurred";return n({type:"AUTH_FAILURE",payload:j}),{success:!1,error:j}}},signUp:async(h,c)=>{n({type:"AUTH_START"});try{const g=await $.signUp(h,c);return g.success?(n({type:"AUTH_FAILURE",payload:""}),{success:!0}):(n({type:"AUTH_FAILURE",payload:g.error||"Sign up failed"}),{success:!1,error:g.error})}catch{const j="An unexpected error occurred";return n({type:"AUTH_FAILURE",payload:j}),{success:!1,error:j}}},signOut:()=>{$.signOut(),n({type:"SIGN_OUT"})},updateProfile:async h=>{console.log("AuthContext: updateProfile called with:",h);try{const c=await $.updateProfile(h);return console.log("AuthContext: gunService.updateProfile result:",c),c.success?(console.log("AuthContext: Updating user state with profile:",h),n({type:"UPDATE_USER",payload:{profile:h}}),{success:!0}):(console.log("AuthContext: Profile update failed:",c.error),{success:!1,error:c.error})}catch(c){return console.error("AuthContext: Profile update error:",c),{success:!1,error:"Failed to update profile"}}},clearError:()=>{n({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let h={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const c=ae.getGuestProfile();c&&(h={displayName:c.displayName||"Guest User",bio:c.bio||"Browsing as a guest",favoriteGenres:c.favoriteGenres||[],readingGoal:c.readingGoal||0});const g={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:h};n({type:"AUTH_SUCCESS",payload:g})}};return e.jsx(Nt.Provider,{value:u,children:m})},ce=()=>{const m=E.useContext(Nt);if(m===void 0)throw new Error("useAuth must be used within an AuthProvider");return m},Os={colors:{primary:"#D2691E",primaryLight:"#E89556",primaryDark:"#B8571A",secondary:"#8B7355",secondaryLight:"#A68B6B",secondaryDark:"#6B5A47",background:"#F7F5F3",surface:"#FFFFFF",surfaceElevated:"#FEFEFE",surfaceSecondary:"#F5F5F5",textPrimary:"#3A3A3A",textSecondary:"#8B7355",textTertiary:"#A0A0A0",textInverse:"#FFFFFF",border:"#E8E3DD",borderLight:"#F0EDE8",borderDark:"#D4C4B0",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",wantToRead:"#FEF3C7",wantToReadText:"#D97706",currentlyReading:"#DBEAFE",currentlyReadingText:"#2563EB",completed:"#D1FAE5",completedText:"#059669",overlay:"rgba(0, 0, 0, 0.5)",overlayLight:"rgba(0, 0, 0, 0.3)"}},Gs={colors:{primary:"#E89556",primaryLight:"#F4A971",primaryDark:"#D2691E",secondary:"#A68B6B",secondaryLight:"#B89980",secondaryDark:"#8B7355",background:"#0F0F0F",surface:"#1A1A1A",surfaceElevated:"#252525",surfaceSecondary:"#1F1F1F",textPrimary:"#F5F5F5",textSecondary:"#C0C0C0",textTertiary:"#909090",textInverse:"#0F0F0F",border:"#333333",borderLight:"#2A2A2A",borderDark:"#444444",success:"#4ADE80",warning:"#FBBF24",error:"#FB7185",info:"#60A5FA",wantToRead:"#2D1B00",wantToReadText:"#FBBF24",currentlyReading:"#1E293B",currentlyReadingText:"#7DD3FC",completed:"#1B2E1B",completedText:"#4ADE80",overlay:"rgba(0, 0, 0, 0.8)",overlayLight:"rgba(0, 0, 0, 0.6)"}},kt=E.createContext(void 0),W=()=>{const m=E.useContext(kt);if(!m)throw new Error("useTheme must be used within a ThemeProvider");return m},Ls=({children:m})=>{const{user:t,isLoading:n}=ce(),o=()=>{try{const h=localStorage.getItem("bookish-theme");if(h)return h==="dark";if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(h){console.error("Error getting initial theme:",h)}return!1},[s,r]=E.useState(o);E.useEffect(()=>{if(n)return;(()=>{var c;if(t){const g=(c=ae.getUserSettings())==null?void 0:c.theme;if(g){r(g==="dark");return}}r(o())})()},[t,n]),E.useEffect(()=>{if(!window.matchMedia)return;const h=window.matchMedia("(prefers-color-scheme: dark)"),c=g=>{var i;(t?!!((i=ae.getUserSettings())!=null&&i.theme):!!localStorage.getItem("bookish-theme"))||r(g.matches)};return h.addEventListener("change",c),()=>h.removeEventListener("change",c)},[t]),E.useEffect(()=>{const h=document.documentElement;s?(h.classList.add("dark"),h.setAttribute("data-theme","dark")):(h.classList.remove("dark"),h.setAttribute("data-theme","light"));const c=document.querySelector('meta[name="theme-color"]');c&&c.setAttribute("content",s?"#0F0F0F":"#F7F5F3")},[s]);const a=()=>{const h=!s;r(h),l(h)},d=h=>{r(h),l(h)},l=h=>{const c=h?"dark":"light";if(t){const g=ae.getUserSettings()||{reminders:[],theme:"light",petName:"Buddy"};ae.saveUserSettings({...g,theme:c})}else localStorage.setItem("bookish-theme",c)},u={colors:s?Gs.colors:Os.colors,isDark:s};return e.jsx(kt.Provider,{value:{theme:u,toggleTheme:a,setTheme:d},children:m})},Ct=E.createContext(void 0),Se=()=>{const m=E.useContext(Ct);if(!m)throw new Error("useFriends must be used within a FriendsProvider");return m},Ms=({children:m})=>{const{user:t,isAuthenticated:n}=ce(),[o,s]=E.useState([]),[r,a]=E.useState([]),[d,l]=E.useState([]),[u,h]=E.useState([]),[c,g]=E.useState(!1),[j,i]=E.useState(null),v=E.useRef(!1),x=E.useRef(!1);E.useEffect(()=>{n&&t&&T()},[n,t]);const T=async()=>{if(t){g(!0);try{const y=await $.getFriends();if(y.success&&y.friends){const P=await Promise.all(y.friends.map(async S=>{const U=await p(S.id);return{...S,stats:U}}));s(P)}const b=await $.getFriendRequests();b.success&&b.requests&&a(b.requests)}catch(y){console.error("Error loading friends data:",y),i("Failed to load friends data")}finally{g(!1)}}},p=async y=>{try{if(y===(t==null?void 0:t.id)){const[b,P]=await Promise.all([$.getUserBooks(),$.getUserSessions()]),S=b.success?b.books||[]:[],U=P.success?P.sessions||[]:[],F=S.filter(M=>M.category==="completed"),G=U.reduce((M,I)=>M+(I.duration||0),0),L=U.reduce((M,I)=>{const J=(I.endPage||0)-(I.startPage||0);return M+Math.max(0,J)},0),O=_(U),B={totalBooksRead:F.length,totalPagesRead:Math.max(L,F.length*200),totalReadingTime:G,currentStreak:O};return $.updatePublicStats(B).catch(console.error),B}else{try{const P=await $.getPublicStats(y);if(P.success&&P.stats)return{totalBooksRead:P.stats.totalBooksRead||0,totalPagesRead:P.stats.totalPagesRead||0,totalReadingTime:P.stats.totalReadingTime||0,currentStreak:P.stats.currentStreak||0}}catch(P){console.error("Error fetching friend public stats:",P)}const b=o.find(P=>P.id===y);return b&&b.stats?b.stats:{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}}catch(b){return console.error("Error calculating user stats:",b),{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}},_=y=>{if(!y.length)return 0;const b=y.map(F=>new Date(F.startTime).toDateString()).filter((F,G,L)=>L.indexOf(F)===G).sort((F,G)=>new Date(G).getTime()-new Date(F).getTime());let P=0;const S=new Date().toDateString(),U=new Date(Date.now()-864e5).toDateString();if(b[0]===S||b[0]===U){P=1;for(let F=1;F<b.length;F++){const G=new Date(b[F]);if((new Date(b[F-1]).getTime()-G.getTime())/(1e3*60*60*24)===1)P++;else break}}return P},w=async y=>{var b;if(!t)return!1;g(!0),i(null);try{const S=(await R(y)).find(L=>L.username.toLowerCase()===y.toLowerCase());if(!S)return i("User not found"),!1;if(o.find(L=>L.id===S.id))return i("Already friends with this user"),!1;if(r.find(L=>L.fromUserId===t.id&&L.toUserId===S.id||L.fromUserId===S.id&&L.toUserId===t.id))return i("Friend request already exists"),!1;const G=await $.sendFriendRequest(t.id,t.username,((b=t.profile)==null?void 0:b.displayName)||t.username,S.id,S.username,S.displayName||S.username);return G.success?(await T(),!0):(i(G.error||"Failed to send friend request"),!1)}catch(P){return console.error("Error sending friend request:",P),i("Failed to send friend request"),!1}finally{g(!1)}},N=async y=>{if(!t)return!1;g(!0),i(null);try{const b=r.find(S=>S.id===y);if(!b)return i("Friend request not found"),!1;const P=await $.acceptFriendRequest(y,b.fromUserId);return P.success?(await T(),setTimeout(()=>{C()},1e3),!0):(i(P.error||"Failed to accept friend request"),!1)}catch(b){return console.error("Error accepting friend request:",b),i("Failed to accept friend request"),!1}finally{g(!1)}},k=async y=>{if(!t)return!1;try{const b=r.find(S=>S.id===y);if(!b)return i("Friend request not found"),!1;const P=await $.declineFriendRequest(y,b.fromUserId);return P.success?(await T(),!0):(i(P.error||"Failed to decline friend request"),!1)}catch(b){return console.error("Error declining friend request:",b),i("Failed to decline friend request"),!1}},f=async y=>{if(!t)return!1;try{const b=await $.removeFriend(y);return b.success?(await T(),!0):(i(b.error||"Failed to remove friend"),!1)}catch(b){return console.error("Error removing friend:",b),i("Failed to remove friend"),!1}},C=E.useCallback(async()=>{if(t){if(x.current){console.log("âš ï¸ Friend activity refresh already in progress, skipping...");return}x.current=!0,g(!0);try{const y=o.map(P=>P.id);if(y.length===0){l([]);return}const b=await $.getFriendActivities(y);b.success&&b.activities?(l(b.activities),console.log("âœ… Friend activities loaded:",b.activities.length)):(console.log("âš ï¸ No friend activities found"),l([]))}catch(y){console.error("Error refreshing friend activity:",y),i("Failed to refresh friend activity")}finally{x.current=!1,g(!1)}}},[t,o]),A=E.useCallback(async(y,b)=>{var P;if(t){if(v.current){console.log("âš ï¸ Leaderboard refresh already in progress, skipping...");return}v.current=!0,g(!0);try{console.log("ðŸ”„ Refreshing leaderboard for period:",y,"metric:",b);const S=await $.getAllPublicStats();if(console.log("ðŸ“Š All public stats result:",S),S.success&&S.allStats&&S.allStats.length>0){const G=(await Promise.all(S.allStats.map(async L=>{var B,M,I;const O=await $.getPublicProfile(L.userId);return{userId:L.userId,username:O.success&&((B=O.profile)==null?void 0:B.username)||"Unknown",displayName:O.success?((M=O.profile)==null?void 0:M.displayName)||((I=O.profile)==null?void 0:I.username):"Unknown",stats:{booksRead:L.totalBooksRead||0,pagesRead:L.totalPagesRead||0,readingTime:L.totalReadingTime||0,currentStreak:L.currentStreak||0}}}))).sort((L,O)=>{switch(b){case"books_read":return O.stats.booksRead-L.stats.booksRead;case"pages_read":return O.stats.pagesRead-L.stats.pagesRead;case"reading_time":return O.stats.readingTime-L.stats.readingTime;case"streak":return O.stats.currentStreak-L.stats.currentStreak;default:return 0}}).map((L,O)=>({userId:L.userId,username:L.username,displayName:L.displayName,rank:O+1,score:L.stats[b==="books_read"?"booksRead":b==="pages_read"?"pagesRead":b==="reading_time"?"readingTime":"currentStreak"],period:y,metric:b,details:{booksRead:L.stats.booksRead,pagesRead:L.stats.pagesRead,readingTime:L.stats.readingTime,currentStreak:L.stats.currentStreak}}));h(G),console.log("âœ… Leaderboard updated with",G.length,"entries")}else{console.log("âš ï¸ No public stats available, using fallback method");const U=await p(t.id),L=[{userId:t.id,username:t.username,displayName:((P=t.profile)==null?void 0:P.displayName)||t.username,stats:{booksRead:U.totalBooksRead,pagesRead:U.totalPagesRead,readingTime:U.totalReadingTime,currentStreak:U.currentStreak}},...o.map(O=>{var B,M,I,J;return{userId:O.id,username:O.username,displayName:O.displayName||O.username,stats:{booksRead:((B=O.stats)==null?void 0:B.totalBooksRead)||0,pagesRead:((M=O.stats)==null?void 0:M.totalPagesRead)||0,readingTime:((I=O.stats)==null?void 0:I.totalReadingTime)||0,currentStreak:((J=O.stats)==null?void 0:J.currentStreak)||0}}})].sort((O,B)=>{switch(b){case"books_read":return B.stats.booksRead-O.stats.booksRead;case"pages_read":return B.stats.pagesRead-O.stats.pagesRead;case"reading_time":return B.stats.readingTime-O.stats.readingTime;case"streak":return B.stats.currentStreak-O.stats.currentStreak;default:return 0}}).map((O,B)=>({userId:O.userId,username:O.username,displayName:O.displayName,rank:B+1,score:O.stats[b==="books_read"?"booksRead":b==="pages_read"?"pagesRead":b==="reading_time"?"readingTime":"currentStreak"],period:y,metric:b,details:{booksRead:O.stats.booksRead,pagesRead:O.stats.pagesRead,readingTime:O.stats.readingTime,currentStreak:O.stats.currentStreak}}));h(L)}}catch(S){console.error("Error refreshing leaderboard:",S),i("Failed to refresh leaderboard")}finally{v.current=!1,g(!1)}}},[t,o]),R=async y=>{if(!y.trim())return[];try{console.log("ðŸ” Searching for users with query:",y);const b=await $.searchPublicUsers(y);return console.log("ðŸ” Search results:",b),b}catch(b){return console.error("Error searching users:",b),[]}};Le.useEffect(()=>{window.debugRefreshLeaderboard=()=>A("week","books_read"),window.debugRefreshActivity=C,window.debugGetAllStats=()=>$.getAllPublicStats()},[A,C]),E.useEffect(()=>{if(n&&t){console.log("ðŸ”„ User authenticated, initializing leaderboard and activity...");const y=setTimeout(()=>{A("week","books_read"),C()},2e3);return()=>clearTimeout(y)}},[n,t,A,C]);const D={friends:o,friendRequests:r,friendActivity:d,leaderboard:u,loading:c,error:j,sendFriendRequest:w,acceptFriendRequest:N,declineFriendRequest:k,removeFriend:f,refreshFriendActivity:C,refreshLeaderboard:A,searchUsers:R};return e.jsx(Ct.Provider,{value:D,children:m})},Js=({onClose:m})=>{const[t,n]=E.useState(!1),[o,s]=E.useState(""),[r,a]=E.useState(""),[d,l]=E.useState(!1),[u,h]=E.useState(!1),{signIn:c,signUp:g,error:j,clearError:i,continueAsGuest:v}=ce(),x={colors:{background:"#F7F5F3",surface:"#FFFFFF",borderLight:"#F0EDE8",border:"#E8E3DD",primary:"#8B7355",textPrimary:"#3A3A3A",textSecondary:"#8B7355"}},T=async w=>{if(w.preventDefault(),!(!o.trim()||!r.trim())){h(!0),i();try{let N;t?(N=await g(o.trim(),r),N.success&&(n(!1),a(""),alert("Account created successfully! Please sign in."))):(N=await c(o.trim(),r),N.success&&m&&m())}finally{h(!1)}}},p=()=>{n(!t),a(""),i()},_=()=>{v(),m&&m()};return e.jsxs("div",{className:"rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border},children:[e.jsxs("div",{className:"text-center mb-8",children:["        ",e.jsx("div",{className:"rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",style:{backgroundColor:x.colors.borderLight},children:e.jsx(K,{className:"w-8 h-8",style:{color:x.colors.primary}})}),e.jsx("h2",{className:"font-serif text-2xl font-medium mb-2",style:{color:x.colors.textPrimary},children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{style:{color:x.colors.textSecondary},children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),"      ",e.jsxs("form",{onSubmit:T,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",style:{color:x.colors.textPrimary},children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:x.colors.textSecondary}}),e.jsx("input",{id:"username",type:"text",value:o,onChange:w=>s(w.target.value),className:"pl-10 pr-4 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:x.colors.background,borderColor:x.colors.border,color:x.colors.textPrimary},placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",style:{color:x.colors.textPrimary},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:x.colors.textSecondary}}),"            ",e.jsx("input",{id:"password",type:d?"text":"password",value:r,onChange:w=>a(w.target.value),className:"pl-10 pr-12 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:x.colors.background,borderColor:x.colors.border,color:x.colors.textPrimary},placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!d),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:opacity-70 transition-colors",style:{color:x.colors.textSecondary},children:d?e.jsx(Lt,{className:"w-5 h-5"}):e.jsx(Mt,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm mt-1",style:{color:x.colors.textSecondary},children:"Password must be at least 8 characters long"})]}),"        ",j&&e.jsx("div",{className:"border px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"#FEF2F2",borderColor:"#FCA5A5",color:"#DC2626"},children:j}),e.jsx("button",{type:"submit",disabled:u,className:"w-full text-white py-3 px-4 rounded-xl font-medium hover:opacity-90 focus:ring-2 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:x.colors.primary},children:u?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:_,className:"w-full py-3 px-4 rounded-xl font-medium focus:ring-2 focus:ring-offset-2 transition-all duration-200 border",style:{backgroundColor:x.colors.surface,color:x.colors.primary,borderColor:x.colors.border},children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center mt-2",style:{color:x.colors.textSecondary},children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{style:{color:x.colors.textSecondary},children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:p,className:"font-medium transition-colors underline hover:opacity-70",style:{color:x.colors.textPrimary},children:t?"Sign In":"Sign Up"})]})}),m&&e.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},$s=({children:m,fallback:t})=>{const{isAuthenticated:n,isLoading:o}=ce(),s={colors:{background:"#F7F5F3",surface:"#FFFFFF",border:"#E8E3DD",primary:"#8B7355",textSecondary:"#8B7355"}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.primary}}),e.jsx("p",{className:"font-medium",style:{color:s.colors.textSecondary},children:"Loading your reading world..."})]})}):n?e.jsx(e.Fragment,{children:m}):t||e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:s.colors.background},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(Js,{})})})},qs=()=>{const m=X(),t=[{icon:K,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:ht,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:ge,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:Ie,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:ne,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:Jt,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],n=[{icon:we,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:$t,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:me,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen style={{backgroundColor: lightTheme.colors.background}} max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(K,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>m("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx($e,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>m("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((o,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(o.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:n.map((o,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(o.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>m("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx($e,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>m("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>m("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},Hs=({className:m=""})=>{const{theme:t,toggleTheme:n}=W();return e.jsx("button",{onClick:n,className:`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 ${m}`,style:{backgroundColor:t.colors.surfaceSecondary},onMouseEnter:o=>{o.currentTarget.style.backgroundColor=t.colors.border},onMouseLeave:o=>{o.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},title:`Switch to ${t.isDark?"light":"dark"} mode`,"aria-label":`Switch to ${t.isDark?"light":"dark"} mode`,children:t.isDark?e.jsx(gt,{size:16,style:{color:t.colors.warning}}):e.jsx(ft,{size:16,style:{color:t.colors.textSecondary}})})},Ys=({greeting:m})=>{var d;const t=X(),{pet:n}=xe(),{user:o}=ce(),{theme:s}=W(),r=(d=o==null?void 0:o.id)==null?void 0:d.startsWith("guest-"),a=()=>{const l=n.mood;return{happy:"ðŸ˜Š",excited:"ðŸ¤©",content:"ðŸ˜Œ",sad:"ðŸ˜¢",sleepy:"ðŸ˜´",hungry:"ðŸŽ"}[l]||"ðŸ˜Œ"};return e.jsx("header",{className:"p-4 transition-colors duration-200",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:m}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Hs,{}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors duration-200",style:{backgroundColor:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=s.colors.surfaceSecondary},onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:a()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.colors.textPrimary},children:n.name}),e.jsxs("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:["Lv.",n.level]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200",style:{backgroundColor:r?s.colors.wantToRead:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=r?s.colors.wantToRead:s.colors.surfaceSecondary},onClick:()=>t("/profile"),title:r?"Guest User":"Profile",children:e.jsx(mt,{className:"w-5 h-5",style:{color:r?s.colors.wantToReadText:s.colors.textSecondary}})})]})]})})},Ws=({onContinueReading:m})=>{const{currentBook:t,sessions:n,setActiveBook:o}=ie(),{theme:s}=W(),[r,a]=E.useState(!0);if(E.useEffect(()=>{if(t){const i=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(v=>v.key===t.key);a(i),i||o(null)}},[t,o]),!t||!r)return e.jsx("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed rounded-lg",style:{borderColor:s.colors.textSecondary},children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2",style:{color:s.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-1",style:{color:s.colors.textPrimary},children:"No book selected"}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Search for a book to start reading"})]})})});const d=[...n].sort((j,i)=>new Date(i.startTime).getTime()-new Date(j.startTime).getTime())[0],l=(d==null?void 0:d.endPage)||(d==null?void 0:d.startPage)||1,u=t.number_of_pages_median||0,h=u>0?Math.min(Math.round(l/u*100),100):0,c=u>0,g=c&&h>0;return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:s.colors.textPrimary},children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white p-2",style:{backgroundColor:s.colors.secondary},children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium line-clamp-2 mb-1",style:{color:s.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-2",style:{color:s.colors.textSecondary},children:["by ",t.author_name[0]]}),g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:s.colors.textSecondary},children:[e.jsxs("span",{children:[h,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 rounded-full overflow-hidden",style:{backgroundColor:s.colors.border},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${h}%`,backgroundColor:s.colors.primary}})})]}),e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",u]})]}):c?e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",u]}):e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Currently on page ",l,e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:m,className:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:s.colors.primary,color:s.colors.textInverse},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=s.colors.primaryLight},onMouseLeave:j=>{j.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(K,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},Te=({icon:m,value:t,label:n,color:o})=>{const{theme:s}=W();return e.jsxs("div",{className:"flex flex-col items-center p-3 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full mb-1",style:{backgroundColor:o},children:m}),e.jsx("span",{className:"font-serif text-lg font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:n})]})},Ks=()=>{const{theme:m}=W(),t=bt(),n=wt(),o=s=>{if(s<60)return`${s} min`;const r=Math.floor(s/60),a=s%60;return a===0?`${r} hrs`:`${r}.${Math.floor(a/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Te,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeToday),label:"Today",color:m.colors.primary}),e.jsx(Te,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeThisWeek),label:"This Week",color:m.colors.primaryDark}),e.jsx(Te,{icon:e.jsx(qt,{className:"w-5 h-5 text-white"}),value:t.totalBooksRead,label:"Books Read",color:m.colors.secondary}),e.jsx(Te,{icon:e.jsx(Ht,{className:"w-5 h-5 text-white"}),value:n.currentStreak,label:"Streak",color:m.colors.primaryLight})]})},de=({icon:m,label:t,onClick:n})=>{const{theme:o}=W();return e.jsxs("button",{onClick:n,className:"flex flex-col items-center justify-center p-4 rounded-xl shadow-sm transition-colors duration-200",style:{backgroundColor:o.colors.surface},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=o.colors.surfaceSecondary},onMouseLeave:s=>{s.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full mb-2",style:{backgroundColor:o.colors.background},children:e.jsx(m,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm",style:{color:o.colors.textPrimary},children:t})]})},zs=({type:m,title:t,timestamp:n,duration:o})=>{const{theme:s}=W(),r=()=>{switch(m){case"reading":return e.jsx(re,{className:"w-4 h-4",style:{color:s.colors.primary}});case"note":return e.jsx(qe,{className:"w-4 h-4",style:{color:s.colors.secondary}});case"completed":return e.jsx(qe,{className:"w-4 h-4",style:{color:s.colors.success}})}},a=d=>{const l=new Date,u=new Date(d),h=Math.floor((l.getTime()-u.getTime())/(1e3*60));if(h<1)return"just now";if(h<60)return`${h} minute${h===1?"":"s"} ago`;const c=Math.floor(h/60);if(c<24)return`${c} hour${c===1?"":"s"} ago`;const g=Math.floor(c/24);return`${g} day${g===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b",style:{borderColor:s.colors.border},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.colors.surfaceSecondary},children:r()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:s.colors.textSecondary},children:[e.jsx("span",{children:a(n)}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[o," min"]})]})]})]})]})},Vs=()=>{const m=X(),{theme:t}=W(),o=[...Me()].sort((r,a)=>new Date(a.startTime).getTime()-new Date(r.startTime).getTime()).slice(0,5),s=()=>{const r=new Date().getHours();return r<12?"Good morning":r<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:t.colors.background},children:[e.jsx(Ys,{greeting:s()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(Ws,{onContinueReading:()=>m("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:he,label:"Find Books",onClick:()=>m("/search")}),e.jsx(de,{icon:ge,label:"My Notes",onClick:()=>m("/notes")}),e.jsx(de,{icon:Yt,label:"My Library",onClick:()=>m("/library")}),e.jsx(de,{icon:Wt,label:"Statistics",onClick:()=>m("/stats")}),"          "]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Social"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:me,label:"Friends",onClick:()=>m("/friends")}),e.jsx(de,{icon:ne,label:"Leaderboard",onClick:()=>m("/leaderboard")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Your Progress"}),e.jsx(Ks,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-1",style:{color:t.colors.textPrimary},children:"Recent Activity"}),o.length>0?e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden",style:{backgroundColor:t.colors.surface},children:o.map(r=>e.jsx(zs,{type:"reading",title:"Reading session completed",timestamp:r.endTime||r.startTime,duration:r.duration||0},r.id))}):e.jsx("p",{className:"text-sm p-4 rounded-xl shadow-sm",style:{color:t.colors.textSecondary,backgroundColor:t.colors.surface},children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>m("/welcome"),className:"text-sm hover:underline transition-colors underline",style:{color:t.colors.textSecondary},onMouseEnter:r=>{r.currentTarget.style.color=t.colors.textPrimary},onMouseLeave:r=>{r.currentTarget.style.color=t.colors.textSecondary},children:"Learn more about Bookish features"})})]})]})},Qs="modulepreload",Xs=function(m){return"/Bookish/"+m},lt={},it=function(t,n,o){let s=Promise.resolve();if(n&&n.length>0){let a=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),l=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=a(n.map(u=>{if(u=Xs(u),u in lt)return;lt[u]=!0;const h=u.endsWith(".css"),c=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":Qs,h||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),h)return new Promise((j,i)=>{g.addEventListener("load",j),g.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return s.then(a=>{for(const d of a||[])d.status==="rejected"&&r(d.reason);return t().catch(r)})},Ee=({children:m,className:t=""})=>{const{theme:n}=W();return e.jsx("div",{className:`min-h-screen transition-colors duration-200 ${t}`,style:{backgroundColor:n.colors.background},children:m})},Zs=()=>{const m=X(),{theme:t}=W(),[n,o]=E.useState(""),[s,r]=E.useState([]),[a,d]=E.useState(!1),[l,u]=E.useState("general"),[h,c]=E.useState(!1);E.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const g=async w=>{if(w.preventDefault(),!!n.trim()){d(!0);try{let N;l==="subject"?N=await vs(n):N=await xs(n),r(N)}catch(N){console.error("Error searching books:",N)}finally{d(!1)}}},j=async()=>{try{c(!0),setTimeout(()=>{v()},300)}catch(w){console.error("Error starting camera:",w),alert("Unable to access camera. Please check permissions."),c(!1)}},i=()=>{try{it(()=>import("./quagga.min-CA_kn7cW.js").then(w=>w.q),__vite__mapDeps([0,1])).then(w=>{const N=w.default;N.stop(),N.offDetected(),N.offProcessed(),console.log("Quagga stopped successfully")}).catch(w=>{console.log("Error stopping Quagga:",w)})}catch(w){console.log("Quagga cleanup error:",w)}c(!1)},v=async()=>{try{const w=document.querySelector("#barcode-scanner");if(!w){console.error("Scanner element not found");return}const k=(await it(()=>import("./quagga.min-CA_kn7cW.js").then(A=>A.q),__vite__mapDeps([0,1]))).default,f={inputStream:{name:"Live",type:"LiveStream",target:w,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",f),k.init(f,A=>{if(A){console.error("QuaggaJS initialization failed:",A),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),i();return}console.log("QuaggaJS initialized successfully"),k.start(),console.log("QuaggaJS started")}),k.onDetected(A=>{const R=A.codeResult.code;console.log("Barcode detected:",R);const D=T(R);console.log("Cleaned barcode:",D),x(D)?(console.log("Valid ISBN detected, searching..."),p(D),i()):console.log("Invalid ISBN format, continuing scan...")});let C=0;k.onProcessed(A=>{C++,C%30===0&&console.log("Processing frames... Count:",C),A&&A.codeResult&&A.codeResult.code&&console.log("Potential code detected:",A.codeResult.code)})}catch(w){console.error("Error loading Quagga:",w),alert("Failed to load barcode scanner. Please try again."),i()}},x=w=>{const N=w.replace(/[^0-9X]/gi,"");return N.length===10||N.length===13},T=w=>w.replace(/[^0-9X]/gi,""),p=async w=>{d(!0);try{const N=await js(w);N?(r([N]),o(w)):alert("No book found for this barcode")}catch(N){console.error("Error searching by ISBN:",N),alert("Error scanning barcode")}finally{d(!1)}},_=w=>{m(`/book?book=${encodeURIComponent(w.key)}`,{state:{bookData:w}})};return e.jsx(Ee,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",children:[e.jsxs("header",{className:"page-header p-4 shadow-sm",style:{backgroundColor:t.colors.surfaceSecondary},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>m(-1),className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors",style:{backgroundColor:t.colors.surface},onMouseEnter:w=>{w.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},onMouseLeave:w=>{w.currentTarget.style.backgroundColor=t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsxs("form",{onSubmit:g,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:n,onChange:w=>o(w.target.value),placeholder:l==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 border rounded-lg focus:outline-none focus:ring-2 input-field",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.textPrimary}}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full text-white",style:{backgroundColor:t.colors.primary},children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:j,className:"w-10 h-10 flex items-center justify-center rounded-full text-white transition-colors",style:{backgroundColor:t.colors.primary},onMouseEnter:w=>{w.currentTarget.style.backgroundColor=t.colors.primaryLight},onMouseLeave:w=>{w.currentTarget.style.backgroundColor=t.colors.primary},children:e.jsx(He,{className:"w-5 h-5"})})]}),"        ",e.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:t.colors.surface},children:[e.jsxs("button",{onClick:()=>u("general"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="general"?t.colors.primary:"transparent",color:l==="general"?"white":t.colors.textSecondary},children:[e.jsx(he,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>u("subject"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="subject"?t.colors.primary:"transparent",color:l==="subject"?"white":t.colors.textSecondary},children:[e.jsx(Ye,{className:"w-4 h-4"}),"Subject"]})]})]}),h&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded-lg p-4 m-4 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“·"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none",style:{border:`2px solid ${t.colors.primary}`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{borderTop:`2px solid ${t.colors.primary}`}})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm mb-2",style:{color:t.colors.textSecondary},children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs mb-2",style:{color:t.colors.textSecondary},children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs italic",style:{color:t.colors.textSecondary},children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4",style:{borderTop:`1px solid ${t.colors.border}`},children:e.jsx("button",{onClick:()=>{const w=prompt("Enter ISBN manually (if barcode scan fails):");w&&(p(w.trim()),i())},className:"text-xs underline",style:{color:t.colors.primary},children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:a?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2",style:{borderTopColor:t.colors.primary,borderBottomColor:t.colors.primary}})}):s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:l==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:s.map(w=>e.jsxs("div",{onClick:()=>_(w),className:"flex gap-4 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:[w.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${w.cover_i}-M.jpg`,alt:w.title,className:"w-full h-full object-cover",onError:N=>{var f;const k=N.target;k.style.display="none",(f=k.nextElementSibling)==null||f.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${w.cover_i?"hidden":""}`,children:e.jsx(K,{className:"w-6 h-6",style:{color:t.colors.textSecondary}})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:t.colors.textPrimary},children:w.title}),w.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:t.colors.textSecondary},children:["by ",w.author_name[0]]}),w.first_publish_year&&e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:w.first_publish_year})]})]},w.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(he,{className:"w-12 h-12 mb-4 opacity-70",style:{color:t.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Find your next great read"}),e.jsx("p",{className:"text-sm max-w-xs mb-4",style:{color:t.colors.textSecondary},children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",style:{color:t.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Browse"]})]})]})})]})})},Ne=({isOpen:m,onClose:t,onConfirm:n,title:o,message:s,type:r="confirm",confirmText:a="Confirm",cancelText:d="Cancel"})=>{const{theme:l}=W();if(!m)return null;const u=()=>{switch(r){case"alert":return e.jsx(We,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(zt,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(Kt,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(We,{className:"w-8 h-8",style:{color:l.colors.primary}})}},h=()=>{n&&n(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl shadow-xl w-full max-w-sm mx-auto",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[u(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:o})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm leading-relaxed mb-6",style:{color:l.colors.textPrimary},children:s}),e.jsxs("div",{className:"flex gap-3",children:[r==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:d}),e.jsx("button",{onClick:h,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${r==="success"?"bg-green-600 text-white hover:bg-green-700":r==="alert"?"bg-red-600 text-white hover:bg-red-700":"text-white hover:opacity-80"}`,style:r==="confirm"?{backgroundColor:l.colors.primary}:{},children:r==="confirm"?a:"OK"})]})]})})})},ke=()=>{const[m,t]=E.useState(!1),[n,o]=E.useState({title:"",message:""}),[s,r]=E.useState(null);return{isOpen:m,config:n,onConfirm:s,close:()=>{t(!1),r(null)},showConfirm:(u,h,c,g)=>{o({title:u,message:h,type:"confirm",confirmText:g==null?void 0:g.confirmText,cancelText:g==null?void 0:g.cancelText}),r(()=>c),t(!0)},showAlert:(u,h,c="info")=>{o({title:u,message:h,type:c}),r(null),t(!0)}}},er=()=>{const m=X(),[t]=ut(),n=Bt(),{books:o,setActiveBook:s,sessions:r,notes:a,addBook:d,updatePublicStatsAfterBookCompletion:l}=ie(),{refreshLeaderboard:u}=Se(),{updatePetFromBookCompletion:h}=xe(),{theme:c}=W(),[g,j]=E.useState(!1),[i,v]=E.useState(null),[x,T]=E.useState(!1),[p,_]=E.useState(!1),[w,N]=E.useState(!1),k=ke(),f=t.get("book");if(E.useEffect(()=>{var I;if((I=n.state)!=null&&I.bookData)v(n.state.bookData);else{const J=o.find(q=>q.key===f);if(J)v(J);else{m("/");return}}},[f,o,n.state,m]),E.useEffect(()=>{if(i){const J=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(H=>H.key===i.key);T(J);const q=yt(i.key);if(q&&q.description&&!i.description){v(H=>({...H,description:q.description,number_of_pages_median:q.number_of_pages_median||H.number_of_pages_median}));return}i.description||(j(!0),ps(i.key).then(H=>{if(H){const z={...i,description:H.description,number_of_pages_median:H.number_of_pages_median||i.number_of_pages_median};v(z),at(z)}}).catch(H=>{console.error("Error fetching book details:",H),q&&v(z=>({...z,...q}))}).finally(()=>{j(!1)}))}},[i]),!i)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>m("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const C=async I=>{const J=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!J.some(q=>q.key===i.key)){const q={...i,category:I==="want-to-read"?"wishlist":"reading",dateAdded:new Date().toISOString()};await d(q),J.push(q),localStorage.setItem("bookish_books",JSON.stringify(J)),at(q);const H=JSON.parse(localStorage.getItem("myBooks")||"[]");H.some(z=>z.key===i.key)||(H.push(q),localStorage.setItem("myBooks",JSON.stringify(H))),T(!0),_(!1),I==="currently-reading"&&(s(i),m("/reading"))}},A=()=>{k.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{var Je;const I={...i,category:"completed",completedAt:new Date().toISOString()};await d(I),await l();const q=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(pe=>pe.key===i.key?I:pe);localStorage.setItem("bookish_books",JSON.stringify(q));const z=JSON.parse(localStorage.getItem("myBooks")||"[]").map(pe=>pe.key===i.key?I:pe);localStorage.setItem("myBooks",JSON.stringify(z)),h(),setTimeout(()=>{u("week","books_read")},1e3),i.key===((Je=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:Je.key)&&s(null),k.showAlert("Congratulations!","ðŸŽ‰ You've completed the book and your pet gained experience!","success"),setTimeout(()=>{m("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},R=i.number_of_pages_median||0,D=[...r].filter(I=>I.bookId===i.key).sort((I,J)=>new Date(J.startTime).getTime()-new Date(I.startTime).getTime())[0],y=(D==null?void 0:D.endPage)||(D==null?void 0:D.startPage)||1,b=R>0?Math.min(Math.round(y/R*100),100):0,P=r.filter(I=>I.bookId===i.key).reduce((I,J)=>I+(J.duration||0),0),S=Math.floor(P/60),U=P%60,F=S>0?`${S} hr${S!==1?"s":""} ${U>0?`${U} min`:""}`:`${U} min`,G=a.filter(I=>I.bookId===i.key),O=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(I=>I.key===i.key),B=(O==null?void 0:O.category)==="completed",M=()=>{m(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:c.colors.background},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:c.colors.background},children:e.jsx("button",{onClick:M,className:"w-8 h-8 flex items-center justify-center rounded-full hover:opacity-80 transition-colors",style:{backgroundColor:c.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:c.colors.primary}})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:i.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${i.cover_i}-M.jpg`,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:c.colors.primary},children:e.jsx(K,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium mb-2 leading-tight",style:{color:c.colors.textPrimary},children:i.title}),i.author_name&&i.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-3",style:{color:c.colors.textSecondary},children:["by ",i.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[i.first_publish_year&&e.jsxs("p",{className:"text-xs",style:{color:c.colors.textSecondary},children:["First published: ",i.first_publish_year]}),R>0&&e.jsxs("p",{className:"text-xs",style:{color:c.colors.textSecondary},children:[R," pages"]})]})]})]}),"        ",x&&R>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textPrimary},children:[b,"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden mb-2",style:{backgroundColor:c.colors.borderLight},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${b}%`,backgroundColor:c.colors.secondary}})}),e.jsxs("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:["Page ",y," of ",R]})]}),e.jsx("div",{className:"w-px",style:{backgroundColor:c.colors.border}}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(ht,{className:"w-5 h-5 mb-1",style:{color:c.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:c.colors.textPrimary},children:F}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),g?e.jsx("div",{className:"h-32 animate-pulse rounded-lg mb-6",style:{backgroundColor:c.colors.borderLight}}):i.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:c.colors.textPrimary},children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm leading-relaxed ${w?"":"line-clamp-4"}`,style:{color:c.colors.textPrimary},children:typeof i.description=="string"?i.description:"No description available."}),i.description&&i.description.length>200&&e.jsx("button",{onClick:()=>N(!w),className:"mt-2 flex items-center gap-1 text-sm font-medium hover:opacity-80 transition-colors",style:{color:c.colors.textSecondary},children:w?e.jsxs(e.Fragment,{children:["Show less",e.jsx(Vt,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(Qt,{className:"w-4 h-4"})]})})]})]}):null,x&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>m("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),G.length>0?e.jsx("div",{className:"space-y-2",children:G.slice(0,2).map(I=>e.jsxs("div",{className:"p-3 rounded-lg shadow-sm",style:{backgroundColor:c.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:[I.chapter?`Chapter: ${I.chapter}`:"",I.chapter&&I.page?" â€¢ ":"",I.page?`Page ${I.page}`:""]}),e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:new Date(I.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm line-clamp-2",style:{color:c.colors.textPrimary},children:I.content})]},I.id))}):e.jsx("div",{className:"p-4 rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:c.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-6 h-6 mx-auto mb-2",style:{color:c.colors.textSecondary}}),e.jsx("p",{className:"text-sm mb-1",style:{color:c.colors.textSecondary},children:"No notes yet"}),e.jsx("button",{onClick:()=>m("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 border-t flex gap-4 max-w-md mx-auto",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border},children:x?e.jsx(e.Fragment,{children:B?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>m("/notes/add"),className:"flex-1 py-3 px-4 border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:c.colors.surface},children:[e.jsx(ge,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(i),m("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Xt,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:A,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(fe,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m("/library"),className:"flex-1 py-3 px-4 border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",style:{backgroundColor:c.colors.surface},children:"View Library"}),e.jsxs("button",{onClick:()=>_(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),"      ",p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:c.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:c.colors.textPrimary},children:"Add to Library"}),e.jsx("p",{className:"text-sm mb-6",style:{color:c.colors.textSecondary},children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>C("want-to-read"),className:"w-full p-4 rounded-lg text-left hover:opacity-80 transition-colors",style:{backgroundColor:c.colors.borderLight},children:[e.jsx("div",{className:"font-medium mb-1",style:{color:c.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:c.colors.textSecondary},children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>C("currently-reading"),className:"w-full p-4 text-white rounded-lg text-left hover:opacity-90 transition-colors",style:{backgroundColor:c.colors.primary},children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>_(!1),className:"w-full mt-4 py-2 text-sm hover:opacity-80 transition-colors",style:{color:c.colors.textSecondary},children:"Cancel"})]})}),e.jsx(Ne,{isOpen:k.isOpen,onClose:k.close,onConfirm:k.onConfirm||void 0,title:k.config.title,message:k.config.message,type:k.config.type,confirmText:k.config.confirmText,cancelText:k.config.cancelText})]})},V=[];for(let m=0;m<256;++m)V.push((m+256).toString(16).slice(1));function tr(m,t=0){return(V[m[t+0]]+V[m[t+1]]+V[m[t+2]]+V[m[t+3]]+"-"+V[m[t+4]]+V[m[t+5]]+"-"+V[m[t+6]]+V[m[t+7]]+"-"+V[m[t+8]]+V[m[t+9]]+"-"+V[m[t+10]]+V[m[t+11]]+V[m[t+12]]+V[m[t+13]]+V[m[t+14]]+V[m[t+15]]).toLowerCase()}let De;const sr=new Uint8Array(16);function rr(){if(!De){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");De=crypto.getRandomValues.bind(crypto)}return De(sr)}const or=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ct={randomUUID:or};function ve(m,t,n){var s;if(ct.randomUUID&&!m)return ct.randomUUID();m=m||{};const o=m.random??((s=m.rng)==null?void 0:s.call(m))??rr();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,tr(o)}const ue="bookish_active_timer",ar=({bookId:m,startPage:t})=>{const[n,o]=E.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=E.useRef();E.useEffect(()=>{const c=localStorage.getItem(ue);if(c)try{const g=JSON.parse(c);g.bookId===m?o(g.timerState):localStorage.removeItem(ue)}catch(g){console.error("Error loading timer state:",g),localStorage.removeItem(ue)}},[m]),E.useEffect(()=>{n.sessionId&&localStorage.setItem(ue,JSON.stringify({bookId:m,startPage:t,timerState:n}))},[n,m,t]),E.useEffect(()=>(n.isActive?s.current=setInterval(()=>{o(c=>({...c}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[n.isActive]);const r=()=>{if(!n.startTime)return 0;let c=n.totalElapsed;if(n.isActive&&n.lastPauseTime===null){const g=Date.now(),j=new Date(n.startTime).getTime();c+=Math.floor((g-j)/1e3)}return c},a=r(),d=()=>{const c=new Date().toISOString();n.sessionId?o(g=>({...g,startTime:c,lastPauseTime:null,isActive:!0})):o({sessionId:ve(),startTime:c,totalElapsed:0,lastPauseTime:null,isActive:!0})},l=()=>{if(!n.isActive||!n.startTime)return;const c=Date.now(),g=new Date(n.startTime).getTime(),j=Math.floor((c-g)/1e3);o(i=>({...i,totalElapsed:i.totalElapsed+j,lastPauseTime:new Date().toISOString(),isActive:!1}))},u=c=>{const g=r(),j={id:n.sessionId||ve(),bookId:m,startTime:n.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:c,duration:Math.floor(g/60)};return o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue),j},h=()=>{o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue)};return{isActive:n.isActive,elapsedTime:a,startTimer:d,pauseTimer:l,stopTimer:u,resetTimer:h}},nr=()=>{const m=X(),{currentBook:t,addSession:n,addNote:o,addBook:s,updatePublicStatsAfterBookCompletion:r}=ie(),{refreshLeaderboard:a}=Se(),{updatePetFromReading:d}=xe(),{theme:l}=W(),u=ke(),[h,c]=E.useState(1),[g,j]=E.useState(1),[i,v]=E.useState(!1),[x,T]=E.useState(""),[p,_]=E.useState(""),[w,N]=E.useState(!1),[k,f]=E.useState(!1),{isActive:C,elapsedTime:A,startTimer:R,pauseTimer:D,stopTimer:y,resetTimer:b}=ar({bookId:(t==null?void 0:t.key)||"",startPage:1});if(E.useEffect(()=>{if(t&&!k){const B=localStorage.getItem("bookish_active_timer");if(B)try{const J=JSON.parse(B);if(J.bookId===t.key){c(J.startPage),j(J.startPage),f(!0);return}}catch(J){console.error("Error parsing active timer:",J)}const I=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(J=>J.bookId===t.key);if(I.length>0){I.sort((q,H)=>new Date(H.startTime).getTime()-new Date(q.startTime).getTime());const J=I[0].endPage||I[0].startPage;c(J),j(J)}f(!0)}},[t,k]),E.useEffect(()=>{const B=M=>{C&&(M.preventDefault(),M.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",B),()=>window.removeEventListener("beforeunload",B)},[C]),!t)return m("/"),null;const P=()=>{try{if(!t){u.showAlert("Error","No book selected","alert");return}if(g<h){u.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(A<=0){u.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const B=y(g);if(!B)throw new Error("Failed to create session");if(n(B),B.duration&&d(B.duration),x.trim()){const M={id:ve(),bookId:t.key,page:g,chapter:p.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(M)}m("/")}catch(B){console.error("Error finishing session:",B),u.showAlert("Error","Failed to save reading session. Please try again.","alert")}},S=B=>{const M=Math.floor(B/3600),I=Math.floor(B%3600/60),J=B%60;return M>0?`${M}:${I.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`:`${I.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`},U=t.number_of_pages_median||9999,F=t.number_of_pages_median&&t.number_of_pages_median>0,G=()=>{const B=(t==null?void 0:t.number_of_pages_median)||0;return B>0&&g>=B},L=B=>{const M=Math.max(h,Math.min(B,U));j(M),t!=null&&t.number_of_pages_median&&M>=t.number_of_pages_median&&N(!0)},O=async()=>{try{const B=y(g);if(B&&(n(B),B.duration&&d(B.duration)),x.trim()){const z={id:ve(),bookId:t.key,page:g,chapter:p.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(z)}const M={...t,category:"completed",completedAt:new Date().toISOString()};await s(M),await r();const J=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(z=>z.key===t.key?M:z);localStorage.setItem("bookish_books",JSON.stringify(J));const H=JSON.parse(localStorage.getItem("myBooks")||"[]").map(z=>z.key===t.key?{...z,category:"completed",completedAt:new Date().toISOString()}:z);localStorage.setItem("myBooks",JSON.stringify(H)),localStorage.removeItem("bookish_current_book"),d((B==null?void 0:B.duration)||0,!0),setTimeout(()=>{a("week","books_read")},1e3),u.showAlert("Congratulations!","ðŸŽ‰ You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{m("/library")},2e3)}catch(B){console.error("Error marking book as finished:",B),u.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",style:{backgroundColor:l.colors.background},children:[e.jsxs("header",{className:"p-4 flex items-center gap-3 shadow-sm",style:{backgroundColor:l.colors.surface},children:[e.jsx("button",{onClick:()=>{C||A>0?u.showConfirm("Leave Reading Session",C?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!C&&A>0?P():m(-1)},{confirmText:C?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):m(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:"Reading Session"}),C&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center p-4",style:{borderBottom:`1px solid ${l.colors.border}`},children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:ws(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full",style:{backgroundColor:l.colors.secondary}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium line-clamp-1",style:{color:l.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm",style:{color:l.colors.textSecondary},children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center shadow-inner",style:{backgroundColor:l.colors.borderLight},children:e.jsx("span",{className:"font-serif text-2xl font-medium",style:{color:l.colors.textPrimary},children:S(A)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:C?D:R,className:"w-16 h-16 rounded-full text-white flex items-center justify-center shadow-md transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},children:C?e.jsx(Zt,{className:"w-8 h-8"}):e.jsx(es,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Start Page"}),e.jsx("input",{type:"number",value:h,onChange:B=>{const M=Math.max(1,Math.min(parseInt(B.target.value)||1,U));c(M),g<M&&j(M)},min:"1",max:U,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary},disabled:C||A>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"End Page"}),e.jsx("input",{type:"number",value:g,onChange:B=>L(parseInt(B.target.value)||h),min:h,max:U,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]}),G()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:O,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!F&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"ðŸ“˜ Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>v(!i),className:"w-full py-2 text-sm mb-2",style:{color:l.colors.primary},children:i?"Hide Note Form":"+ Add a note about this session"}),i&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 rounded-lg",style:{backgroundColor:l.colors.borderLight},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:p,onChange:B=>_(B.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Note"}),e.jsx("textarea",{value:x,onChange:B=>T(B.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 rounded-md resize-none",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 flex gap-4 max-w-md mx-auto",style:{backgroundColor:l.colors.surface,borderTop:`1px solid ${l.colors.border}`},children:[e.jsxs("button",{onClick:()=>{u.showConfirm("Cancel Session",C?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{b(),m(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:[e.jsx(_e,{className:"w-5 h-5"}),"Cancel"]}),G()?e.jsxs("button",{onClick:O,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-green-700 transition-colors",children:[e.jsx(ne,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:P,className:"flex-1 py-3 px-4 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},disabled:A<=0||g<h,children:[e.jsx(fe,{className:"w-5 h-5"}),"Finish Session"]})]}),"      ",w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ne,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:l.colors.textPrimary},children:"Congratulations!"}),e.jsxs("p",{className:"text-sm mb-6",style:{color:l.colors.textSecondary},children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:O,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>N(!1),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:"Continue Reading"})]})]})})}),e.jsx(Ne,{isOpen:u.isOpen,onClose:u.close,onConfirm:u.onConfirm||void 0,title:u.config.title,message:u.config.message,type:u.config.type,confirmText:u.config.confirmText,cancelText:u.config.cancelText})]})},lr=()=>{const m=X(),{books:t,addBook:n,updatePublicStatsAfterBookCompletion:o}=ie(),{refreshLeaderboard:s}=Se(),{updatePetFromBookCompletion:r}=xe(),{theme:a}=W(),d=ke(),[l,u]=E.useState(null),[h,c]=E.useState(null),[g,j]=E.useState({}),[i,v]=E.useState([]);E.useEffect(()=>{(()=>{const b=JSON.parse(localStorage.getItem("bookish_books")||"[]");v(b)})()},[]),E.useEffect(()=>{const y=()=>{u(null)};if(l)return document.addEventListener("click",y),()=>document.removeEventListener("click",y)},[l]);const x=i.length>0?i:t,T=y=>{m(`/book?book=${y.key}`,{state:{bookData:y}})},p=(y,b)=>{b.stopPropagation(),d.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const S=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(O=>O.key!==y);localStorage.setItem("bookish_books",JSON.stringify(S));const F=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(O=>O.key!==y);localStorage.setItem("myBooks",JSON.stringify(F));const G=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete G[y],localStorage.setItem("bookish_cached_books",JSON.stringify(G));const L=JSON.parse(localStorage.getItem("bookish_current_book")||"null");L&&L.key===y&&localStorage.removeItem("bookish_current_book"),v(S)},{confirmText:"Remove",cancelText:"Keep Book"}),u(null)},_=async(y,b,P)=>{const S=JSON.parse(localStorage.getItem("bookish_books")||"[]"),U=S.find(B=>B.key===y);if(!U)return;const F={...U,category:b,...b==="completed"&&{completedAt:new Date().toISOString()}};await n(F);const G=S.map(B=>B.key===y?F:B);localStorage.setItem("bookish_books",JSON.stringify(G));const O=JSON.parse(localStorage.getItem("myBooks")||"[]").map(B=>B.key===y?F:B);localStorage.setItem("myBooks",JSON.stringify(O)),v(G),c(null),u(null)},w=(y,b)=>{b.stopPropagation(),d.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{await _(y,"completed"),await o(),r(),setTimeout(()=>{s("week","books_read")},1e3),setTimeout(()=>{d.showAlert("Book Completed!","ðŸŽ‰ Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),u(null)},N=(y,b)=>{b.stopPropagation(),u(l===y?null:y)},k=y=>{const b=nt(y);if(b.length===0)return 0;const P=b[b.length-1],S=t.find(U=>U.key===y);return!(S!=null&&S.number_of_pages_median)||!P.endPage?0:Math.min(100,Math.round(P.endPage/S.number_of_pages_median*100))},f=y=>nt(y).reduce((P,S)=>P+(S.duration||0),0),C=y=>{const b=Math.floor(y/60),P=y%60;return b>0?`${b}h ${P}m`:`${P}m`},A=()=>{const y=[],b=[],P=[];return x.forEach(S=>{const U=k(S.key),F=f(S.key);S.category==="want-to-read"?P.push(S):S.category==="completed"||U>=100?b.push(S):S.category==="currently-reading"||U>0||F>0?y.push(S):P.push(S)}),{currentlyReading:y,completed:b,wantToRead:P}},R=y=>{const b=k(y.key),P=f(y.key),S=g[y.key]||{translateX:0,isDeleting:!1},U=B=>{const M=B.touches[0];j(I=>({...I,[y.key]:{...S,startX:M.clientX,startY:M.clientY}}))},F=B=>{const M=B.touches[0],I=g[y.key];if(!(I!=null&&I.startX)||!(I!=null&&I.startY))return;const J=M.clientX-I.startX,q=M.clientY-I.startY;Math.abs(q)>Math.abs(J)||J<-20&&j(H=>({...H,[y.key]:{...I,translateX:Math.max(J,-120)}}))},G=()=>{const B=g[y.key];B&&(B.translateX<-60?j(M=>({...M,[y.key]:{...B,translateX:-120,isDeleting:!0}})):j(M=>({...M,[y.key]:{...B,translateX:0,isDeleting:!1}})))},L=()=>{d.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(q=>q.key!==y.key);localStorage.setItem("bookish_books",JSON.stringify(M));const J=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(q=>q.key!==y.key);localStorage.setItem("myBooks",JSON.stringify(J)),v(M),j(q=>{const H={...q};return delete H[y.key],H})},{confirmText:"Remove",cancelText:"Keep Book"})},O=()=>{j(B=>({...B,[y.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{backgroundColor:a.colors.surface,transform:`translateX(${S.translateX}px)`,transition:S.isDeleting||S.translateX===0?"transform 0.3s ease":"none",overflow:S.isDeleting?"hidden":"visible"},onTouchStart:U,onTouchMove:F,onTouchEnd:G,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!S.isDeleting&&T(y),children:["          ",e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 flex items-center justify-center",style:{backgroundColor:a.colors.borderLight},children:[y.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${y.cover_i}-M.jpg`,alt:y.title,className:"w-full h-full object-cover rounded",onError:B=>{var I;const M=B.target;M.style.display="none",(I=M.nextElementSibling)==null||I.classList.remove("hidden")}}):null,e.jsx(K,{className:`w-6 h-6 ${y.cover_i?"hidden":""}`,style:{color:a.colors.textSecondary}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:a.colors.textPrimary},children:y.title}),y.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:a.colors.textSecondary},children:["by ",y.author_name[0]]}),b>0&&b<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:a.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:a.colors.textSecondary},children:[b,"%"]})]}),e.jsx("div",{className:"w-full rounded-full h-1.5",style:{backgroundColor:a.colors.borderLight},children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${b}%`,backgroundColor:a.colors.secondary}})})]}),b>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),P>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:a.colors.textSecondary},children:[e.jsx(re,{className:"w-3 h-3"}),e.jsxs("span",{children:[C(P)," read"]})]})]})]}),!S.isDeleting&&e.jsx("button",{onClick:B=>N(y.key,B),className:"absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center transition-colors hover:opacity-80",style:{backgroundColor:a.colors.borderLight},children:e.jsx(ts,{className:"w-4 h-4",style:{color:a.colors.textSecondary}})}),"        ",l===y.key&&!S.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 rounded-lg shadow-lg py-1 z-50 min-w-[180px]",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`},children:[e.jsxs("button",{onClick:B=>{B.stopPropagation(),c(y.key),u(null)},className:"flex items-center gap-2 px-3 py-2 text-sm w-full text-left transition-colors hover:opacity-80",style:{color:a.colors.textSecondary,backgroundColor:"transparent"},onMouseEnter:B=>B.currentTarget.style.backgroundColor=a.colors.borderLight,onMouseLeave:B=>B.currentTarget.style.backgroundColor="transparent",children:[e.jsx(ss,{className:"w-4 h-4"}),"Move to category"]}),y.category!=="completed"&&e.jsxs("button",{onClick:B=>w(y.key,B),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(fe,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:B=>p(y.key,B),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(pt,{className:"w-4 h-4"}),"Remove from library"]})]}),S.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:["              ",e.jsx("button",{onClick:O,className:"px-3 py-1 text-xs text-red-500 rounded",style:{backgroundColor:a.colors.surface},children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},y.key)},D=(y,b)=>b.length===0?null:e.jsxs("div",{className:"mb-8",children:["        ",e.jsxs("h2",{className:"font-serif text-lg font-medium mb-4 flex items-center gap-2",style:{color:a.colors.textPrimary},children:[y,e.jsxs("span",{className:"text-sm font-normal",style:{color:a.colors.textSecondary},children:["(",b.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:b.map(R)})]});return e.jsx(Ee,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:a.colors.background,borderColor:a.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:a.colors.surfaceSecondary},children:e.jsx(ee,{className:"w-5 h-5",style:{color:a.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:a.colors.textPrimary},children:"My Library"})]})}),e.jsx("main",{className:"p-4",children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4",style:{color:a.colors.textSecondary}}),"            ",e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:a.colors.textPrimary},children:"No books yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:a.colors.textSecondary},children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>m("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:a.colors.secondary},children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:[x.length," book",x.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:y,completed:b,wantToRead:P}=A();return e.jsxs(e.Fragment,{children:[D("Currently Reading",y),D("Want to Read",P),D("Completed",b)]})})()]})}),h&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:["          ",e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:a.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:a.colors.textPrimary},children:"Move Book"}),e.jsx("p",{className:"text-sm mb-6",style:{color:a.colors.textSecondary},children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>_(h,"want-to-read"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:a.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:a.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:a.colors.textSecondary},children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>_(h,"currently-reading"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:a.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:a.colors.textPrimary},children:"Currently Reading"}),e.jsx("div",{className:"text-xs",style:{color:a.colors.textSecondary},children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>_(h,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium",style:{color:a.colors.textPrimary},children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>c(null),className:"w-full mt-4 py-2 text-sm transition-colors hover:opacity-80",style:{color:a.colors.textSecondary},children:"Cancel"}),"          "]})]}),"      ",e.jsx(Ne,{isOpen:d.isOpen,onClose:d.close,onConfirm:d.onConfirm||void 0,title:d.config.title,message:d.config.message,type:d.config.type,confirmText:d.config.confirmText,cancelText:d.config.cancelText})]})})},ir=()=>{const m=X(),{books:t}=ie(),{pet:n}=xe(),{theme:o}=W(),s=bt(),r=wt(),a=Me(),d=g=>{const j=Math.floor(g/60),i=g%60;return j>0?`${j}h ${i}m`:`${i}m`},l=()=>{if(a.length===0)return 0;const g=a.reduce((j,i)=>j+(i.duration||0),0);return Math.round(g/a.length)},h=(()=>{const g=new Date,j=new Date(g.getFullYear(),g.getMonth(),1),i=a.filter(T=>new Date(T.startTime)>=j),v=i.reduce((T,p)=>T+(p.duration||0),0),x=i.reduce((T,p)=>T+((p.endPage||0)-(p.startPage||0)),0);return{time:v,pages:x,sessions:i.length}})(),c=({icon:g,title:j,value:i,subtitle:v})=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(g,{className:"w-4 h-4",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:j})]}),e.jsx("p",{className:"text-2xl font-serif font-medium mb-1",style:{color:o.colors.textPrimary},children:i}),v&&e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:v})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:o.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:o.colors.background,borderBottom:`1px solid ${o.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:o.colors.textPrimary},children:"Reading Statistics"})]})}),"      ",e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{icon:K,title:"Books Read",value:s.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(c,{icon:re,title:"Total Time",value:d(s.totalReadingTime),subtitle:"all time"}),e.jsx(c,{icon:we,title:"Pages Read",value:s.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(c,{icon:Ke,title:"Current Streak",value:`${r.currentStreak} days`,subtitle:`longest: ${r.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Fe,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsx("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.sessions}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:d(h.time)}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.pages}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"pages"})]})]})]})})]}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{icon:re,title:"Today",value:d(s.readingTimeToday)}),e.jsx(c,{icon:Fe,title:"This Week",value:d(s.readingTimeThisWeek)}),e.jsx(c,{icon:we,title:"Average Session",value:d(l())}),e.jsx(c,{icon:K,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Reading Companion"}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(rs,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:[n.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:n.level}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:[n.happiness,"%"]}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:n.experience}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"experience"})]})]})]})]}),a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ke,{className:"w-16 h-16 mx-auto mb-4",style:{color:o.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:o.colors.textPrimary},children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm mb-6",style:{color:o.colors.textSecondary},children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>m("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:o.colors.secondary},children:"Find a Book to Read"})]})]})]})},cr=()=>{const m=X(),{notes:t,books:n,deleteNote:o}=ie(),{theme:s}=W(),r=ke(),a=u=>{r.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{o(u)},{confirmText:"Delete",cancelText:"Cancel"})},d=u=>{const h=n.find(c=>c.key===u);return h?h.title:"Unknown Book"},l=u=>new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:s.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:s.colors.background,borderBottom:`1px solid ${s.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:s.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:"My Notes"})]}),e.jsx("button",{onClick:()=>m("/notes/add"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.secondary},children:e.jsx(xt,{className:"w-5 h-5 text-white"})})]})}),"      ",e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4",style:{color:s.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:s.colors.textPrimary},children:"No notes yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:s.colors.textSecondary},children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>m("/notes/add"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:s.colors.secondary},children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(u=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4",style:{color:s.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:s.colors.textPrimary},children:d(u.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:s.colors.textSecondary},children:[u.chapter&&e.jsxs("span",{children:["Chapter: ",u.chapter]}),u.page&&e.jsxs("span",{children:["Page ",u.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:l(u.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>a(u.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(pt,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",style:{color:s.colors.textPrimary},children:u.content})})]},u.id))]})}),e.jsx(Ne,{isOpen:r.isOpen,onClose:r.close,onConfirm:r.onConfirm||void 0,title:r.config.title,message:r.config.message,type:r.config.type,confirmText:r.config.confirmText,cancelText:r.config.cancelText})]})},dr=()=>{const m=X(),[t]=ut(),{books:n,currentBook:o,addNote:s,notes:r,updateNote:a}=ie(),{theme:d}=W(),l=ke(),u=t.get("edit"),[h,c]=E.useState((o==null?void 0:o.key)||""),[g,j]=E.useState(""),[i,v]=E.useState(""),[x,T]=E.useState("");E.useEffect(()=>{var w;if(u){const N=r.find(k=>k.id===u);N&&(c(N.bookId),j(N.content),v(((w=N.page)==null?void 0:w.toString())||""),T(N.chapter||""))}},[u,r]);const p=()=>{var N;if(!g.trim()){l.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const w={id:u||ve(),bookId:h,content:g.trim(),page:i?parseInt(i):void 0,chapter:x.trim()||void 0,createdAt:u?((N=r.find(k=>k.id===u))==null?void 0:N.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};u&&a?a(w):s(w),l.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{m("/notes")},1500)},_=()=>{g.trim()||x.trim()||i.trim()?l.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{m(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):m(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:d.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:d.colors.background,borderColor:d.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:_,className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:d.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:d.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:d.colors.textPrimary},children:u?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(os,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:d.colors.textPrimary},children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:h,onChange:w=>c(w.target.value),className:"w-full p-3 pr-10 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] appearance-none",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textPrimary},children:[e.jsx("option",{value:"",children:"Choose a book..."}),n.map(w=>e.jsx("option",{value:w.key,children:w.title},w.key))]}),e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:d.colors.textSecondary}})]})]}),"        ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:d.colors.textPrimary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:x,onChange:w=>T(w.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:d.colors.textPrimary},children:"Page (optional)"}),e.jsx("input",{type:"number",value:i,onChange:w=>v(w.target.value),placeholder:"Page number",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textPrimary}})]})]}),"        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:d.colors.textPrimary},children:"Your Note"}),e.jsx("textarea",{value:g,onChange:w=>j(w.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] resize-none",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textPrimary}}),e.jsxs("p",{className:"text-xs mt-2",style:{color:d.colors.textSecondary},children:[g.length,"/500 characters"]})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:d.colors.surface},children:[e.jsx("h3",{className:"font-medium mb-2",style:{color:d.colors.textPrimary},children:"ðŸ’¡ Note-taking tips:"}),e.jsxs("ul",{className:"text-sm space-y-1",style:{color:d.colors.textSecondary},children:[e.jsx("li",{children:"â€¢ Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"â€¢ Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"â€¢ Record connections to other books or personal experiences"}),e.jsx("li",{children:"â€¢ Include your emotional reactions or reflections"})]})]})]}),e.jsx(Ne,{isOpen:l.isOpen,onClose:l.close,onConfirm:l.onConfirm||void 0,title:l.config.title,message:l.config.message,type:l.config.type,confirmText:l.config.confirmText,cancelText:l.config.cancelText})]})},ur=()=>{const m=X(),{theme:t}=W(),{pet:n,petStats:o,feedPet:s,playWithPet:r,petSleep:a,getPetMood:d,getPetEvolutionRequirement:l,resetPet:u,updatePetName:h,getPetEmoji:c,canEvolve:g,evolvePet:j}=xe(),[i,v]=E.useState(!1),[x,T]=E.useState(n.name),[p,_]=E.useState(!1),w=y=>y>70?"bg-green-500":y>40?"bg-yellow-500":"bg-red-500",N=y=>`${Math.max(0,Math.min(100,y))}%`,k=()=>{x.trim()&&(h(x.trim()),v(!1))},f=()=>{u(),_(!1)},C=y=>({"first-book":"ðŸ“–","book-lover":"ðŸ“š",bookworm:"ðŸ›","speed-reader":"âš¡","night-owl":"ðŸ¦‰","early-bird":"ðŸ¦"})[y]||"ðŸ†",A=y=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[y]||"Special achievement",R=y=>{const b=Math.floor(y/60),P=y%60;return b>0?`${b}h ${P}m`:`${P}m`},D=l();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:["          ",e.jsx("button",{onClick:()=>m(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"My Reading Pet"})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-6 text-center",style:{backgroundColor:t.colors.surface},children:[e.jsx("div",{className:"text-8xl mb-4",children:c()}),e.jsxs("div",{className:"mb-4",children:[i?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:x,onChange:y=>T(y.target.value),className:"text-2xl font-serif font-medium rounded px-3 py-1 border text-center",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary,borderColor:t.colors.border},onBlur:k,onKeyPress:y=>y.key==="Enter"&&k(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["                ",e.jsx("h2",{className:"text-2xl font-serif font-medium",style:{color:t.colors.textPrimary},children:n.name}),e.jsx("button",{onClick:()=>v(!0),className:"p-1 rounded transition-colors hover:opacity-80",style:{color:t.colors.textSecondary,backgroundColor:t.colors.borderLight},children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg mb-2",style:{color:t.colors.textSecondary},children:[e.jsxs("span",{children:["Level ",n.level]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:n.evolutionStage})]}),g()&&e.jsxs("button",{onClick:j,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["âœ¨ Evolve to ",D.stage,"!"]})]}),"          ",e.jsx("p",{className:"mb-4",style:{color:t.colors.textPrimary},children:d()}),e.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold mb-1",style:{color:t.colors.primary},children:["ðŸ’° ",n.points]}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Care Points (Earned from reading)"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",style:{color:t.colors.textSecondary},children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[n.experience,"/",n.experienceToNext]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${n.experience/n.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:s,disabled:n.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${n.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(ze,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"ðŸ’° 3 pts"})]}),e.jsxs("button",{onClick:r,disabled:n.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${n.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ie,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"ðŸ’° 5 pts"})]}),e.jsxs("button",{onClick:a,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(Ve,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),"                ",e.jsxs("span",{children:[n.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${w(n.happiness)} rounded-full transition-all duration-300`,style:{width:N(n.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),"                ",e.jsxs("span",{children:[n.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${w(n.hunger)} rounded-full transition-all duration-300`,style:{width:N(n.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),"                ",e.jsxs("span",{children:[n.energy,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${w(n.energy)} rounded-full transition-all duration-300`,style:{width:N(n.energy)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[n.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${w(n.health)} rounded-full transition-all duration-300`,style:{width:N(n.health)}})})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:["            ",e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:n.totalBooksRead}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:R(n.totalReadingTime)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:o.booksReadToday}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:R(o.readingTimeToday)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Time"})]})]})]}),"        ",n.badges.length>0&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.badges.map((y,b)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl",children:C(y)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize text-sm",style:{color:t.colors.textPrimary},children:y.replace("-"," ")}),e.jsx("div",{className:"text-xs",style:{color:t.colors.textSecondary},children:A(y)})]})]},b))})]}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Pet Management"}),e.jsx("p",{className:"text-sm mb-4",style:{color:t.colors.textSecondary},children:"Reset your pet to start over with a new companion. This action cannot be undone."}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(as,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},Tt=({message:m,type:t,onClose:n})=>{const o={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"âœ“",error:"âœ•",info:"â„¹"}[t];return Le.useEffect(()=>{const r=setTimeout(()=>{n()},3e3);return()=>clearTimeout(r)},[n]),e.jsxs("div",{className:`fixed top-4 right-4 ${o} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:m}),e.jsx("button",{onClick:n,className:"ml-2 text-white hover:text-gray-200",children:"âœ•"})]})},dt=({className:m="",showLabel:t=!0})=>{const{theme:n,toggleTheme:o}=W();return e.jsxs("div",{className:`flex items-center gap-3 ${m}`,children:[t&&e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.textPrimary},children:"Theme"}),e.jsx("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:n.colors.surface,border:`1px solid ${n.colors.border}`,color:n.colors.textPrimary},"aria-label":`Switch to ${n.isDark?"light":"dark"} mode`,children:e.jsx("div",{className:"flex items-center gap-2",children:n.isDark?e.jsxs(e.Fragment,{children:[e.jsx(gt,{size:16,style:{color:n.colors.warning}}),t&&e.jsx("span",{className:"text-sm",children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{size:16,style:{color:n.colors.textSecondary}}),t&&e.jsx("span",{className:"text-sm",children:"Dark"})]})})})]})},mr=()=>{var N;const{user:m,signOut:t,updateProfile:n}=ce(),{theme:o}=W(),s=X(),[r,a]=E.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[d,l]=E.useState(!1),[u,h]=E.useState(!1),[c,g]=E.useState(""),[j,i]=E.useState(null),v=(N=m==null?void 0:m.id)==null?void 0:N.startsWith("guest-");E.useEffect(()=>{m&&x()},[m]),E.useEffect(()=>{m!=null&&m.profile&&!v&&a({displayName:m.profile.displayName||"",bio:m.profile.bio||"",favoriteGenres:m.profile.favoriteGenres||[],readingGoal:m.profile.readingGoal||12,joinedDate:m.profile.joinedDate||m.createdAt})},[m==null?void 0:m.profile,v]);const x=async()=>{console.log("ProfilePage: Loading profile for user:",m==null?void 0:m.id,"isGuest:",v);try{if(v){const f=ae.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",f),f){a({displayName:f.displayName||"Guest User",bio:f.bio||"Browsing as a guest",favoriteGenres:f.favoriteGenres||[],readingGoal:f.readingGoal||12,joinedDate:f.joinedDate||(m==null?void 0:m.createdAt)});return}m!=null&&m.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),a({displayName:m.profile.displayName||"Guest User",bio:m.profile.bio||"Browsing as a guest",favoriteGenres:m.profile.favoriteGenres||[],readingGoal:m.profile.readingGoal||12,joinedDate:m.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const k=await $.getProfile();if(console.log("ProfilePage: Gun service profile result:",k),k.success&&k.profile){const f={displayName:k.profile.displayName||"",bio:k.profile.bio||"",favoriteGenres:k.profile.favoriteGenres||[],readingGoal:k.profile.readingGoal||12,joinedDate:k.profile.joinedDate||k.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",f),a(f)}else console.log("ProfilePage: No profile found or error loading profile")}catch(k){console.error("Error loading profile:",k)}},T=async()=>{if(m){console.log("ProfilePage: Saving profile:",r),h(!0);try{if(v){ae.setGuestProfile(r),l(!1),console.log("Guest profile saved to localStorage:",r),i({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",r);const k=await n(r);console.log("ProfilePage: updateProfile result:",k),k.success?(l(!1),console.log("Profile saved successfully"),i({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await x()):(console.error("Error saving profile:",k.error),i({message:`Failed to save profile: ${k.error||"Unknown error"}`,type:"error"}))}catch(k){console.error("Error saving profile:",k),i({message:"Failed to save profile. Please try again.",type:"error"})}finally{h(!1)}}},p=()=>{c.trim()&&!r.favoriteGenres.includes(c.trim())&&(a(k=>({...k,favoriteGenres:[...k.favoriteGenres,c.trim()]})),g(""))},_=k=>{a(f=>({...f,favoriteGenres:f.favoriteGenres.filter(C=>C!==k)}))},w=()=>{t()};return m?e.jsxs(Ee,{children:[e.jsxs("div",{className:"min-h-screen py-8 transition-colors duration-200",style:{backgroundColor:o.colors.background},children:[v&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"border px-4 py-3 rounded-lg",style:{backgroundColor:o.colors.wantToRead,borderColor:o.colors.border,color:o.colors.wantToReadText},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl overflow-hidden transition-colors duration-200",style:{backgroundColor:o.colors.surface},children:["            ",e.jsxs("div",{className:"px-8 py-12 text-white relative",style:{background:`linear-gradient(to right, ${o.colors.primary}, ${o.colors.primaryLight})`},children:[e.jsx("button",{onClick:()=>s(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:r.displayName||(m==null?void 0:m.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:r.bio||"A passionate reader exploring new worlds through books"}),r.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(r.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>l(!d),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),d?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:w,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),d?e.jsx("input",{type:"text",value:r.displayName,onChange:k=>a(f=>({...f,displayName:k.target.value})),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent input-field",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.textPrimary},placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:r.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),d?e.jsx("textarea",{value:r.bio,onChange:k=>a(f=>({...f,bio:k.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:r.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),d?e.jsx("input",{type:"number",min:"1",max:"365",value:r.readingGoal,onChange:k=>a(f=>({...f,readingGoal:parseInt(k.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[r.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),d&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:k=>g(k.target.value),onKeyPress:k=>k.key==="Enter"&&p(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.favoriteGenres.map((k,f)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[k,d&&e.jsx("button",{onClick:()=>_(k),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},f)),"                    ",r.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:o.colors.primary},children:"App Settings"}),e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border},children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:o.colors.textPrimary},children:"Appearance"}),e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Choose your preferred theme for the app"})]}),e.jsx(dt,{})]})})})]}),"                  ",e.jsxs("div",{className:"mt-8 p-6 rounded-xl",style:{background:`linear-gradient(to right, ${o.colors.surfaceSecondary}, ${o.colors.surfaceElevated})`},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.primary},children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Pages Read"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.textPrimary},children:"Preferences"}),e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:o.colors.surface},children:e.jsx(dt,{})})]})]})]}),d&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:T,disabled:u,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),j&&e.jsx(Tt,{message:j.message,type:j.type,onClose:()=>i(null)})]}):e.jsx(Ee,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},hr=()=>{const m=X(),{theme:t}=W(),{friends:n,friendRequests:o,friendActivity:s,loading:r,sendFriendRequest:a,acceptFriendRequest:d,declineFriendRequest:l,removeFriend:u,refreshFriendActivity:h,searchUsers:c}=Se(),[g,j]=E.useState("activity"),[i,v]=E.useState(""),[x,T]=E.useState([]),[p,_]=E.useState(!1),[w,N]=E.useState(null),[k,f]=E.useState(null),[C,A]=E.useState(null);E.useEffect(()=>{h()},[]),E.useEffect(()=>{i.length>2?c(i).then(T):T([])},[i,c]);const R=async S=>{N(S);try{await a(S)?(v(""),T([]),_(!1),A({message:`Friend request sent to ${S}!`,type:"success"})):A({message:"Failed to send friend request",type:"error"})}finally{N(null)}},D=async(S,U)=>{f(S);try{const F=await d(S);A(F?{message:`You're now friends with ${U}!`,type:"success"}:{message:"Failed to accept friend request",type:"error"})}finally{f(null)}},y=async S=>{const U=await l(S);A(U?{message:"Friend request declined",type:"info"}:{message:"Failed to decline friend request",type:"error"})},b=S=>{const U=new Date,F=new Date(S),G=Math.floor((U.getTime()-F.getTime())/(1e3*60));return G<60?`${G}m ago`:G<1440?`${Math.floor(G/60)}h ago`:`${Math.floor(G/1440)}d ago`},P=S=>{switch(S){case"book_completed":return e.jsx(K,{className:"w-4 h-4"});case"reading_session":return e.jsx(re,{className:"w-4 h-4"});case"achievement_unlocked":return e.jsx(ne,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Friends"})]}),e.jsx("button",{onClick:()=>_(!p),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.primary},children:e.jsx(Qe,{className:"w-5 h-5 text-white"})})]})}),p&&e.jsxs("div",{className:"p-4 border-b",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:t.colors.textSecondary}}),e.jsx("input",{type:"text",placeholder:"Search for users...",value:i,onChange:S=>v(S.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-opacity-50",style:{backgroundColor:t.colors.background,borderColor:t.colors.border,color:t.colors.textPrimary}})]}),x.length>0&&e.jsx("div",{className:"space-y-2",children:x.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg",style:{backgroundColor:t.colors.background},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:S.displayName||S.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",S.username]})]}),"                  ",e.jsx("button",{onClick:()=>R(S.username),className:"px-3 py-1 rounded-lg text-sm font-medium text-white",style:{backgroundColor:t.colors.primary},disabled:r||w===S.username,children:w===S.username?"Sending...":"Add"})]},S.id))})]}),e.jsx("div",{className:"flex border-b",style:{borderColor:t.colors.border},children:[{id:"activity",label:"Activity",count:s.length},{id:"friends",label:"Friends",count:n.length},{id:"requests",label:"Requests",count:o.length}].map(S=>e.jsxs("button",{onClick:()=>j(S.id),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${g===S.id?"border-opacity-100":"border-transparent"}`,style:{color:g===S.id?t.colors.primary:t.colors.textSecondary,borderColor:g===S.id?t.colors.primary:"transparent"},children:[S.label,S.count>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:S.count})]},S.id))}),e.jsxs("div",{className:"p-4",children:[g==="activity"&&e.jsx("div",{className:"space-y-3",children:s.length>0?s.map(S=>e.jsx("div",{className:"p-3 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:P(S.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",style:{color:t.colors.textPrimary},children:S.displayName||S.username}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:b(S.timestamp)})]}),e.jsx("p",{className:"text-sm mb-1",style:{color:t.colors.textPrimary},children:S.description}),S.metadata&&e.jsxs("div",{className:"flex gap-4 text-xs",style:{color:t.colors.textSecondary},children:[S.metadata.pagesRead&&e.jsxs("span",{children:[S.metadata.pagesRead," pages"]}),S.metadata.duration&&e.jsxs("span",{children:[S.metadata.duration," min"]})]})]})]})},S.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend activity yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Friend activity will appear here when your friends complete books or reading sessions"})]})}),g==="friends"&&e.jsx("div",{className:"space-y-3",children:n.length>0?n.map(S=>e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:S.displayName||S.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",S.username]})]})]}),e.jsx("button",{onClick:()=>u(S.id),className:"px-3 py-1 rounded-lg text-sm",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:"Remove"})]}),S.stats&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:S.stats.totalBooksRead}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:S.stats.currentStreak}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Day Streak"})]})]})]},S.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friends yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Start by searching for users to add as friends!"})]})}),g==="requests"&&e.jsx("div",{className:"space-y-3",children:o.length>0?o.map(S=>e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:S.fromDisplayName||S.fromUsername}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",S.fromUsername]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(S.id,S.fromUsername),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:k===S.id?"#6B7280":"#10B981"},disabled:r||k===S.id,children:k===S.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(fe,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>y(S.id),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#EF4444"},disabled:r||k===S.id,children:e.jsx(_e,{className:"w-4 h-4 text-white"})})]})]})},S.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend requests"}),"              "]})})]}),C&&e.jsx(Tt,{message:C.message,type:C.type,onClose:()=>A(null)})]})},gr=()=>{const m=X(),{theme:t}=W(),{user:n}=ce(),{leaderboard:o,loading:s,refreshLeaderboard:r}=Se(),[a,d]=E.useState("week"),[l,u]=E.useState("books_read");E.useEffect(()=>{r(a,l)},[a,l,r]);const h=x=>{switch(x){case 1:return e.jsx(ns,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(Xe,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Xe,{className:"w-5 h-5 text-yellow-600"});default:return e.jsxs("span",{className:"font-bold text-lg",style:{color:t.colors.textSecondary},children:["#",x]})}},c=x=>{switch(x){case"books_read":return e.jsx(K,{className:"w-4 h-4"});case"pages_read":return e.jsx(we,{className:"w-4 h-4"});case"reading_time":return e.jsx(re,{className:"w-4 h-4"});case"streak":return e.jsx(Ue,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}},g=(x,T)=>{switch(T){case"books_read":return`${x} books`;case"pages_read":return`${x.toLocaleString()} pages`;case"reading_time":const p=Math.floor(x/60),_=x%60;return p>0?`${p}h ${_}m`:`${_}m`;case"streak":return`${x} days`;default:return x.toString()}},j=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"year",label:"This Year"},{id:"alltime",label:"All Time"}],i=[{id:"books_read",label:"Books Read",icon:K},{id:"pages_read",label:"Pages Read",icon:we},{id:"reading_time",label:"Reading Time",icon:re},{id:"streak",label:"Reading Streak",icon:Ue}],v=o.find(x=>x.userId===(n==null?void 0:n.id));return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Leaderboard"})]})}),v&&e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.primary+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(v.rank)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:"Your Rank"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:g(v.score,l)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["#",v.rank]}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:["out of ",o.length]})]})]})})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"flex gap-2",children:j.map(x=>e.jsx("button",{onClick:()=>d(x.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${a===x.id?"text-white":""}`,style:{backgroundColor:a===x.id?t.colors.primary:t.colors.surface,color:a===x.id?"white":t.colors.textSecondary},children:x.label},x.id))})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(x=>{const T=x.icon;return e.jsxs("button",{onClick:()=>u(x.id),className:`p-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l===x.id?"text-white":""}`,style:{backgroundColor:l===x.id?t.colors.primary:t.colors.surface,color:l===x.id?"white":t.colors.textSecondary},children:[e.jsx(T,{className:"w-4 h-4"}),x.label]},x.id)})})}),e.jsxs("div",{className:"p-4",children:[s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((x,T)=>e.jsx("div",{className:"p-4 rounded-xl animate-pulse",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:t.colors.borderLight}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:t.colors.borderLight}}),e.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:t.colors.borderLight}})]})]})},T))}):e.jsxs("div",{className:"space-y-3",children:["            ",o.map(x=>e.jsx("div",{className:`p-4 rounded-xl transition-all ${x.userId===(n==null?void 0:n.id)?"ring-2":""}`,style:{backgroundColor:t.colors.surface,...x.userId===(n==null?void 0:n.id)&&{boxShadow:`0 0 0 2px ${t.colors.primary}`}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(x.rank)}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:[x.displayName||x.username,x.userId===(n==null?void 0:n.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:"You"})]}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",x.username]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[c(l),e.jsx("span",{className:"font-bold",style:{color:t.colors.primary},children:g(x.score,l)})]}),x.details&&e.jsxs("div",{className:"text-xs mt-1",style:{color:t.colors.textSecondary},children:[l!=="books_read"&&x.details.booksRead&&e.jsxs("span",{children:[x.details.booksRead," books â€¢ "]}),l!=="streak"&&x.details.currentStreak&&e.jsxs("span",{children:[x.details.currentStreak," day streak"]})]})]})]})},x.userId))]}),!s&&o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No leaderboard data yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Add friends to compete on the leaderboard!"})]})]})]})},fr=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"ðŸ“š"}),e.jsx("span",{children:"Bookish"})]})}),"      ",e.jsx(Us,{children:e.jsx(Ls,{children:e.jsx(Ms,{children:e.jsx(Ds,{children:e.jsx(Ps,{children:e.jsx(Dt,{basename:"/Bookish",children:e.jsxs($s,{children:[e.jsxs(It,{children:[e.jsx(Z,{path:"/",element:e.jsx(Vs,{})}),e.jsx(Z,{path:"/welcome",element:e.jsx(qs,{})}),e.jsx(Z,{path:"/search",element:e.jsx(Zs,{})}),e.jsx(Z,{path:"/library",element:e.jsx(lr,{})}),e.jsx(Z,{path:"/book",element:e.jsx(er,{})}),e.jsx(Z,{path:"/reading",element:e.jsx(nr,{})}),e.jsx(Z,{path:"/notes",element:e.jsx(cr,{})}),e.jsx(Z,{path:"/notes/add",element:e.jsx(dr,{})}),e.jsx(Z,{path:"/pet",element:e.jsx(ur,{})}),e.jsx(Z,{path:"/stats",element:e.jsx(ir,{})}),e.jsx(Z,{path:"/profile",element:e.jsx(mr,{})}),e.jsx(Z,{path:"/friends",element:e.jsx(hr,{})}),e.jsx(Z,{path:"/leaderboard",element:e.jsx(gr,{})})]}),"                  "]})})})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});ds.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(fr,{})}));
