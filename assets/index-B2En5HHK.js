const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var _t=Object.defineProperty;var Rt=(u,t,a)=>t in u?_t(u,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[t]=a;var ve=(u,t,a)=>Rt(u,typeof t!="symbol"?t+"":t,a);import{a as Bt,b as Dt,g as It,c as Fe,r as E,R as ht,u as X,d as ft,e as Ft,B as Ut,f as Ot,h as Z}from"./vendor-CGGxujwj.js";import{r as Lt,c as Gt,a as Mt}from"./gun-CJ6ok8hl.js";import{B as K,U as gt,L as Jt,E as $t,a as qt,A as Ye,T as xt,P as ge,H as Le,b as le,S as Ht,c as je,d as Yt,e as me,f as pt,M as yt,C as re,g as Wt,F as Kt,h as We,i as he,j as zt,k as Vt,l as ee,m as Ke,n as ze,X as De,o as Ve,I as Qt,p as Xt,q as Zt,r as es,s as xe,t as ts,u as bt,v as ss,w as rs,x as os,y as as,z as vt,D as Qe,G as Ge,J as ns,K as ls,N as Xe,O as Ze,Z as Me,R as is,Q as et,V as tt,W as cs}from"./icons-wR8Y5JGC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();var Ue={exports:{}},we={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var st;function ds(){if(st)return we;st=1;var u=Bt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(m,l,c){var f,d={},h=null,N=null;c!==void 0&&(h=""+c),l.key!==void 0&&(h=""+l.key),l.ref!==void 0&&(N=l.ref);for(f in l)o.call(l,f)&&!r.hasOwnProperty(f)&&(d[f]=l[f]);if(m&&m.defaultProps)for(f in l=m.defaultProps,l)d[f]===void 0&&(d[f]=l[f]);return{$$typeof:t,type:m,key:h,ref:N,props:d,_owner:s.current}}return we.Fragment=a,we.jsx=n,we.jsxs=n,we}var rt;function us(){return rt||(rt=1,Ue.exports=ds()),Ue.exports}var e=us(),Ee={},ot;function ms(){if(ot)return Ee;ot=1;var u=Dt();return Ee.createRoot=u.createRoot,Ee.hydrateRoot=u.hydrateRoot,Ee}var hs=ms(),fs=Lt();const te=It(fs);var Ae={exports:{}};Ae.exports;var at;function gs(){return at||(at=1,function(u){(function(){function t(o,s){return s?Gt(o):o.slice?t[r(o)]:function(n,m){o(n={exports:{}}),t[r(m)]=n.exports};function r(n){return n.split("/").slice(-1).toString().replace(".js","")}}var a=u;t(function(o){typeof self<"u"&&(o.window=self),typeof window<"u"&&(o.window=window);var s=o.window||o,r,n=s.SEA||{};(n.window=o.window)&&(n.window.SEA=n);try{r+""!=typeof a&&(a.exports=n)}catch{}o.exports=n})(t,"./root"),t(function(o){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(o){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{Fe.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Fe.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},Fe.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(t,"./base64"),t(function(o){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(r,n,m){r=r||"utf8",n=n||0;const l=this.length;if(r==="hex"){const c=new Uint8Array(this);return[...Array((m&&m+1||l)-n).keys()].map(f=>c[f+n].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(m||l)-n},(c,f)=>String.fromCharCode(this[f+n])).join("");if(r==="base64")return btoa(this)},o.exports=s})(t,"./array"),t(function(o){t("./base64");var s=t("./array");function r(...n){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...n)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const n=arguments[0];let m;if(typeof n=="string"){const c=arguments[1]||"utf8";if(c==="hex"){const f=n.match(/([\da-fA-F]{2})/g).map(d=>parseInt(d,16));if(!f||!f.length)throw new TypeError("Invalid first argument for type 'hex'.");m=s.from(f)}else if(c==="utf8"||c==="binary"){const f=n.length,d=new Uint16Array(f);Array.from({length:f},(h,N)=>d[N]=n.charCodeAt(N)),m=s.from(d)}else if(c==="base64"){const f=atob(n),d=f.length,h=new Uint8Array(d);Array.from({length:d},(N,i)=>h[i]=f.charCodeAt(i)),m=s.from(h)}else c==="binary"?m=s.from(n):console.info("SafeBuffer.from unknown encoding: "+c);return m}if(n.byteLength,n.byteLength?n.byteLength:n.length){let c;return n instanceof ArrayBuffer&&(c=new Uint8Array(n)),s.from(c||n)}},alloc(n,m=0){return s.from(new Uint8Array(Array.from({length:n},()=>m)))},allocUnsafe(n){return s.from(new Uint8Array(Array.from({length:n})))},concat(n){if(!Array.isArray(n))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(n.reduce((m,l)=>m.concat(Array.from(l)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,o.exports=r})(t,"./buffer"),t(function(o){const s=t("./root"),r={Buffer:t("./buffer")};var n={},m;if(JSON.parseAsync=JSON.parseAsync||function(c,f,d){var h;try{f(h,JSON.parse(c,d))}catch(N){f(N)}},JSON.stringifyAsync=JSON.stringifyAsync||function(c,f,d,h){var N;try{f(N,JSON.stringify(c,d,h))}catch(i){f(i)}},r.parse=function(c,f){return new Promise(function(d,h){JSON.parseAsync(c,function(N,i){N?h(N):d(i)},f)})},r.stringify=function(c,f,d){return new Promise(function(h,N){JSON.stringifyAsync(c,function(i,w){i?N(i):h(w)},f,d)})},s.window&&(r.crypto=s.window.crypto||s.window.msCrypto,r.subtle=(r.crypto||n).subtle||(r.crypto||n).webkitSubtle,r.TextEncoder=s.window.TextEncoder,r.TextDecoder=s.window.TextDecoder,r.random=c=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(c))))),!r.TextDecoder){const{TextEncoder:c,TextDecoder:f}=t((m+""==typeof a?".":"")+"./lib/text-encoding",1);r.TextDecoder=f,r.TextEncoder=c}if(!r.crypto)try{var l=t("crypto",1);Object.assign(r,{crypto:l,random:f=>r.Buffer.from(l.randomBytes(f))});const{Crypto:c}=t("@peculiar/webcrypto",1);r.ossl=r.subtle=new c({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}o.exports=r})(t,"./shim"),t(function(o){var s=t("./root"),r=t("./shim"),n={};n.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},n.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},n.ecdh={name:"ECDH",namedCurve:"P-256"},n.jwk=function(m,l){m=m.split(".");var c=m[0],f=m[1],d={kty:"EC",crv:"P-256",x:c,y:f,ext:!0};return d.key_ops=l?["sign"]:["verify"],l&&(d.d=l),d},n.keyToJwk=function(m){return{kty:"oct",k:m.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},n.recall={validity:12*60*60,hook:function(m){return m}},n.check=function(m){return typeof m=="string"&&m.slice(0,4)==="SEA{"},n.parse=async function(l){try{var c=typeof l=="string";return c&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),c?await r.parse(l):l}catch{}return l},s.opt=n,o.exports=n})(t,"./settings"),t(function(o){var s=t("./shim");o.exports=async function(r,n){var m=typeof r=="string"?r:await s.stringify(r),l=await s.subtle.digest({name:n||"SHA-256"},new s.TextEncoder().encode(m));return s.Buffer.from(l)}})(t,"./sha256"),t(function(o){const s=t("./shim"),r=s.subtle,n=s.ossl?s.ossl:r,m=l=>n.digest({name:"SHA-1"},new ArrayBuffer(l));o.exports=m})(t,"./sha1"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.work=s.work||(async(c,f,d,h)=>{try{var N=(f||{}).epub||f;if(h=h||{},N instanceof Function&&(d=N,N=l),c=typeof c=="string"?c:await r.stringify(c),(h.name||"").toLowerCase().slice(0,3)==="sha"){var i=r.Buffer.from(await m(c,h.name),"binary").toString(h.encode||"base64");if(d)try{d(i)}catch(p){console.log(p)}return i}N=N||r.random(9);var w=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(c),{name:h.name||"PBKDF2"},!1,["deriveBits"]),g=await(r.ossl||r.subtle).deriveBits({name:h.name||"PBKDF2",iterations:h.iterations||n.pbkdf2.iter,salt:new r.TextEncoder().encode(h.salt||N),hash:h.hash||n.pbkdf2.hash},w,h.length||n.pbkdf2.ks*8);c=r.random(c.length);var k=r.Buffer.from(g,"binary").toString(h.encode||"base64");if(d)try{d(k)}catch(p){console.log(p)}return k}catch(p){if(console.log(p),s.err=p,s.throw)throw p;d&&d();return}}),o.exports=s.work})(t,"./work"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.name=s.name||(async(n,m)=>{try{if(n)try{n()}catch(l){console.log(l)}return}catch(l){if(console.log(l),s.err=l,s.throw)throw l;n&&n();return}}),s.pair=s.pair||(async(n,m)=>{try{var l=r.ossl||r.subtle,c=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async h=>{var N={};N.priv=(await r.subtle.exportKey("jwk",h.privateKey)).d;var i=await r.subtle.exportKey("jwk",h.publicKey);return N.pub=i.x+"."+i.y,N});try{var f=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async h=>{var N={};N.epriv=(await l.exportKey("jwk",h.privateKey)).d;var i=await l.exportKey("jwk",h.publicKey);return N.epub=i.x+"."+i.y,N})}catch(h){if(s.window)throw h;if(h=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw h}f=f||{};var d={pub:c.pub,priv:c.priv,epub:f.epub,epriv:f.epriv};if(n)try{n(d)}catch(h){console.log(h)}return d}catch(h){if(console.log(h),s.err=h,s.throw)throw h;n&&n();return}}),o.exports=s.pair})(t,"./pair"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.sign=s.sign||(async(c,f,d,h)=>{try{if(h=h||{},!(f||h).priv){if(!s.I)throw"No signing key.";f=await s.I(null,{what:c,how:"sign",why:h.why})}if(l===c)throw"`undefined` not allowed.";var N=await n.parse(c),i=h.check=h.check||N;if(s.verify&&(s.opt.check(i)||i&&i.s&&i.m)&&l!==await s.verify(i,f)){var b=await n.parse(i);if(h.raw||(b="SEA"+await r.stringify(b)),d)try{d(b)}catch(j){console.log(j)}return b}var w=f.pub,g=f.priv,k=n.jwk(w,g),p=await m(N),T=await(r.ossl||r.subtle).importKey("jwk",k,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(x=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},x,new Uint8Array(p))),b={m:N,s:r.Buffer.from(T,"binary").toString(h.encode||"base64")};if(h.raw||(b="SEA"+await r.stringify(b)),d)try{d(b)}catch(x){console.log(x)}return b}catch(x){if(console.log(x),s.err=x,s.throw)throw x;d&&d();return}}),o.exports=s.sign})(t,"./sign"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.verify=s.verify||(async(d,h,N,i)=>{try{var w=await n.parse(d);if(h===!1){var g=await n.parse(w.m);if(N)try{N(g)}catch(_){console.log(_)}return g}i=i||{};var k=h.pub||h,p=s.opt.slow_leak?await s.opt.slow_leak(k):await(r.ossl||r.subtle).importKey("jwk",n.jwk(k),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),T=await m(w.m),b,x,j,y;try{if(b=r.Buffer.from(w.s,i.encode||"base64"),x=new Uint8Array(b),j=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},p,x,new Uint8Array(T)),!j)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(d,h,N,i)}var C=j?await n.parse(w.m):l;if(N)try{N(C)}catch(_){console.log(_)}return C}catch(_){if(console.log(_),s.err=_,s.throw)throw _;N&&N();return}}),o.exports=s.verify;var c={};s.opt.slow_leak=d=>{if(c[d])return c[d];var h=n.jwk(d);return c[d]=(r.ossl||r.subtle).importKey("jwk",h,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),c[d]};var f=s.opt;s.opt.fall_verify=async function(d,h,N,i,w){if(w===s.opt.fallback)throw"Signature did not match";w=w||1;var g=d||"";d=s.opt.unpack(d)||d;var k=await n.parse(d),p=h.pub||h,T=await s.opt.slow_leak(p),b=w<=s.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await n.parse(k.m)))):await m(k.m),x,j,y;try{if(x=r.Buffer.from(k.s,i.encode||"base64"),j=new Uint8Array(x),y=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},T,j,new Uint8Array(b)),!y)throw"Signature did not match."}catch{try{x=r.Buffer.from(k.s,"utf8"),j=new Uint8Array(x),y=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},T,j,new Uint8Array(b))}catch{if(!y)throw"Signature did not match."}}var C=y?await n.parse(k.m):l;if(f.fall_soul=g["#"],f.fall_key=g["."],f.fall_val=d,f.fall_state=g[">"],N)try{N(C)}catch(_){console.log(_)}return C},s.opt.fallback=2})(t,"./verify"),t(function(o){var s=t("./shim"),r=t("./settings"),n=t("./sha256");const m=async(l,c,f)=>{const d=l+(c||s.random(8)).toString("utf8"),h=s.Buffer.from(await n(d),"binary"),N=r.keyToJwk(h);return await s.subtle.importKey("jwk",N,{name:"AES-GCM"},!1,["encrypt","decrypt"])};o.exports=m})(t,"./aeskey"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings");var n=t("./aeskey"),m;s.encrypt=s.encrypt||(async(l,c,f,d)=>{try{d=d||{};var h=(c||d).epriv||c;if(m===l)throw"`undefined` not allowed.";if(!h){if(!s.I)throw"No encryption key.";c=await s.I(null,{what:l,how:"encrypt",why:d.why}),h=c.epriv||c}var N=typeof l=="string"?l:await r.stringify(l),i={s:r.random(9),iv:r.random(15)},w=await n(h,i.s,d).then(k=>r.subtle.encrypt({name:d.name||"AES-GCM",iv:new Uint8Array(i.iv)},k,new r.TextEncoder().encode(N))),g={ct:r.Buffer.from(w,"binary").toString(d.encode||"base64"),iv:i.iv.toString(d.encode||"base64"),s:i.s.toString(d.encode||"base64")};if(d.raw||(g="SEA"+await r.stringify(g)),f)try{f(g)}catch(k){console.log(k)}return g}catch(k){if(console.log(k),s.err=k,s.throw)throw k;f&&f();return}}),o.exports=s.encrypt})(t,"./encrypt"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./aeskey");s.decrypt=s.decrypt||(async(l,c,f,d)=>{try{d=d||{};var h=(c||d).epriv||c;if(!h){if(!s.I)throw"No decryption key.";c=await s.I(null,{what:l,how:"decrypt",why:d.why}),h=c.epriv||c}var N=await n.parse(l),i,w,g;try{i=r.Buffer.from(N.s,d.encode||"base64"),w=r.Buffer.from(N.iv,d.encode||"base64"),g=r.Buffer.from(N.ct,d.encode||"base64");var k=await m(h,i,d).then(T=>r.subtle.decrypt({name:d.name||"AES-GCM",iv:new Uint8Array(w),tagLength:128},T,new Uint8Array(g)))}catch{if(d.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return d.encode="utf8",await s.decrypt(l,c,f,d)}var p=await n.parse(new r.TextDecoder("utf8").decode(k));if(f)try{f(p)}catch(T){console.log(T)}return p}catch(T){if(console.log(T),s.err=T,s.throw)throw T;f&&f();return}}),o.exports=s.decrypt})(t,"./decrypt"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.secret=s.secret||(async(m,l,c,f)=>{try{if(f=f||{},!l||!l.epriv||!l.epub){if(!s.I)throw"No secret mix.";l=await s.I(null,{what:m,how:"secret",why:f.why})}var d=m.epub||m,h=l.epub,N=l.epriv,i=r.ossl||r.subtle,w=n(d),g=Object.assign({public:await i.importKey(...w,!0,[])},{name:"ECDH",namedCurve:"P-256"}),k=n(h,N),p=await i.importKey(...k,!1,["deriveBits"]).then(async b=>{var x=await i.deriveBits(g,b,256),j=new Uint8Array(x),y=await i.importKey("raw",j,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return i.exportKey("jwk",y).then(({k:C})=>C)}),T=p;if(c)try{c(T)}catch(b){console.log(b)}return T}catch(b){if(console.log(b),s.err=b,s.throw)throw b;c&&c();return}});var n=(m,l)=>{var[c,f]=m.split("."),d=l?{d:l}:{};return["jwk",Object.assign(d,{x:c,y:f,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};o.exports=s.secret})(t,"./secret"),t(function(o){var s=t("./root");s.certify=s.certify||(async(r,n={},m,l,c={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),r=(()=>{var T=[];if(r){if((typeof r=="string"||Array.isArray(r))&&r.indexOf("*")>-1)return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(b=>{typeof b=="string"?T.push(b):typeof b=="object"&&b.pub&&T.push(b.pub)})}return typeof r=="object"&&r.pub?r.pub:T.length>0?T:null}})(),!r)return console.log("No certificant found.");const d=c.expiry&&(typeof c.expiry=="number"||typeof c.expiry=="string")?parseFloat(c.expiry):null,h=(n||{}).read?n.read:null,N=(n||{}).write?n.write:typeof n=="string"||Array.isArray(n)||n["+"]||n["#"]||n["."]||n["="]||n["*"]||n[">"]||n["<"]?n:null,i=(c||{}).block||(c||{}).blacklist||(c||{}).ban||{},w=i.read&&(typeof i.read=="string"||(i.read||{})["#"])?i.read:null,g=typeof i=="string"?i:i.write&&(typeof i.write=="string"||i.write["#"])?i.write:null;if(!h&&!N)return console.log("No policy found.");const k=JSON.stringify({c:r,...d?{e:d}:{},...h?{r:h}:{},...N?{w:N}:{},...w?{rb:w}:{},...g?{wb:g}:{}});var f=await s.sign(k,m,null,{raw:1});if(c.raw||(f="SEA"+JSON.stringify(f)),l)try{l(f)}catch(T){console.log(T)}return f}catch(d){if(s.err=d,s.throw)throw d;l&&l();return}}),o.exports=s.certify})(t,"./certify"),t(function(o){var s=t("./shim"),r=t("./root");r.work=t("./work"),r.sign=t("./sign"),r.verify=t("./verify"),r.encrypt=t("./encrypt"),r.decrypt=t("./decrypt"),r.certify=t("./certify"),r.random=r.random||s.random,r.Buffer=r.Buffer||t("./buffer"),r.keyid=r.keyid||(async n=>{try{const m=s.Buffer.concat(n.replace(/-/g,"+").replace(/_/g,"/").split(".").map(d=>s.Buffer.from(d,"base64"))),l=s.Buffer.concat([s.Buffer.from([153,m.length/256,m.length%256]),m]),c=await sha1hash(l),f=s.Buffer.from(c,"binary");return f.toString("hex",f.length-8)}catch(m){throw console.log(m),m}}),((r.window||{}).GUN||{}).SEA=r,o.exports=r})(t,"./sea"),t(function(o){var s=t("./sea"),r,n;s.window?r=s.window.GUN||{chain:{}}:r=t((n+""==typeof a?".":"")+"./gun",1),s.GUN=r;function m(c){this._={$:this}}m.prototype=function(){function c(){}return c.prototype=r.chain,new c}(),m.prototype.constructor=m,r.chain.user=function(c){var f=this,h=f.back(-1),d;if(c)return c=s.opt.pub((c._||"")["#"])||c,h.get("~"+c);if(d=h.back("user"))return d;var h=h._,N=h,i=N.opt.uuid||l;return(N=(d=N.user=f.chain(new m))._).opt={},N.opt.uuid=function(w){var g=i(),k=h.user;return!k||!(k=k.is)||!(k=k.pub)||(g="~"+k+"/"+g,w&&w.call&&w(null,g)),g},d};function l(){return r.state().toString(36).replace(".","")}r.User=m,m.GUN=r,m.SEA=r.SEA=s,o.exports=m})(t,"./user"),t(function(o){var s,r=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof a?".":"")+"./gun",1);r.chain.then=function(n,m){var l=this,c=new Promise(function(f,d){l.once(f,m)});return n?c.then(n):c}})(t,"./then"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.create=function(...l){var c=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,f=c&&(c.pub||c.epub)?c.pub:typeof l[0]=="string"?l[0]:null,d=c&&(c.pub||c.epub)?c:f&&typeof l[1]=="string"?l[1]:null,h=l.filter(T=>typeof T=="function")[0]||null,N=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},i=this,w=i._,g=i.back(-1);if(h=h||m,N=N||{},N.check!==!1){var k;if(f||(k="No user."),(d||"").length<8&&(k="Password too short!"),k)return h({err:n.log(k)}),i}if(w.ing)return(h||m)({err:n.log("User is already being created or authenticated!"),wait:!0}),i;w.ing=!0;var p={};return p.a=function(T){if(p.pubs=T,T&&!N.already){var b={err:n.log("User already created!")};w.ing=!1,(h||m)(b),i.leave();return}p.salt=String.random(64),r.work(d,p.salt,p.b)},p.b=function(T){p.proof=T,c?p.c(c):r.pair(p.c)},p.c=function(T){var b;p.pair=T||{},(b=w.root.user)&&(b._.sea=T,b.is={pub:T.pub,epub:T.epub,alias:f}),p.data={pub:T.pub},p.d()},p.d=function(){p.data.alias=f,p.e()},p.e=function(){p.data.epub=p.pair.epub,r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},p.proof,p.f,{raw:1})},p.f=function(T){p.data.auth=JSON.stringify({ek:T,s:p.salt}),p.g(p.data.auth)},p.g=function(T){var b;p.data.auth=p.data.auth||T,g.get(b="~"+p.pair.pub).put(p.data).on(p.h);var x={};x[b]={"#":b},g.get("~@"+f).put(x).get(b).on(p.i)},p.h=function(T,b,x,j){j.off(),p.h.ok=1,p.i()},p.i=function(T,b,x,j){j&&(p.i.ok=1,j.off()),!(!p.h.ok||!p.i.ok)&&(w.ing=!1,h({ok:0,pub:p.pair.pub}),m===h&&(c?i.auth(c):i.auth(f,d)))},g.get("~@"+f).once(p.a),i},s.prototype.leave=function(l,c){var f=this,d=f.back(-1)._.user;if(d&&(delete d.is,delete d._.is,delete d._.sea),r.window)try{var h={};h=r.window.sessionStorage,delete h.recall,delete h.pair}catch{}return f}})(t,"./create"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.auth=function(...c){var f=typeof c[0]=="object"&&(c[0].pub||c[0].epub)?c[0]:typeof c[1]=="object"&&(c[1].pub||c[1].epub)?c[1]:null,d=!f&&typeof c[0]=="string"?c[0]:null,h=(d||f&&!(f.priv&&f.epriv))&&typeof c[1]=="string"?c[1]:null,N=c.filter(x=>typeof x=="function")[0]||null,i=c&&c.length>1&&typeof c[c.length-1]=="object"?c[c.length-1]:{},w=this,g=w._,k=w.back(-1);if(g.ing)return(N||m)({err:n.log("User is already being created or authenticated!"),wait:!0}),w;g.ing=!0;var p={},T,b=9;return p.a=function(x){if(!x)return p.b();if(!x.pub){var j=[];return Object.keys(x).forEach(function(y){y!="_"&&j.push(x[y])}),p.b(j)}if(p.name)return p.f(x);p.c((p.data=x).auth)},p.b=function(x){var j=(p.list=(p.list||[]).concat(x||[])).shift();if(T===j){if(p.name)return p.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(d&&b--){k.get("~@"+d).once(p.a);return}return p.err("Wrong user or password.")}k.get(j).once(p.a)},p.c=function(x){if(T===x)return p.b();if(typeof x=="string")return p.c(l(x));r.work(h,(p.auth=x).s,p.d,p.enc)},p.d=function(x){r.decrypt(p.auth.ek,x,p.e,p.enc)},p.e=function(x){if(T===x)return p.enc?(p.enc=null,p.b()):(p.enc={encode:"utf8"},p.c(p.auth));p.half=x,p.f(p.data)},p.f=function(x){var j=p.half||{},y=p.data||{};p.g(p.lol={pub:x.pub||y.pub,epub:x.epub||y.epub,priv:x.priv||j.priv,epriv:x.epriv||j.epriv})},p.g=function(x){if(!x||!x.pub||!x.epub)return p.b();p.pair=x;var j=k._.user,y=j._;y.tag;var C=y.opt;y=j._=k.get("~"+x.pub)._,y.opt=C,j.is={pub:x.pub,epub:x.epub,alias:d||x.pub},y.sea=p.pair,g.ing=!1;try{h&&T==(l(g.root.graph["~"+x.pub].auth)||"")[":"]&&(i.shuffle=i.change=h)}catch{}if(i.change?p.z():(N||m)(y),r.window&&(w.back("user")._.opt||i).remember)try{var _={};_=r.window.sessionStorage,_.recall=!0,_.pair=JSON.stringify(x)}catch{}try{k._.tag.auth?k._.on("auth",y):setTimeout(function(){k._.on("auth",y)},1)}catch(B){n.log("Your 'auth' callback crashed with:",B)}},p.h=function(x){if(!x)return p.b();if(d=x.alias,d||(d=x.alias="~"+f.pub),!x.auth)return p.g(f);f=null,p.c((p.data=x).auth)},p.z=function(){p.salt=String.random(64),r.work(i.change,p.salt,p.y)},p.y=function(x){r.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},x,p.x,{raw:1})},p.x=function(x){p.w(JSON.stringify({ek:x,s:p.salt}))},p.w=function(x){if(i.shuffle){console.log("migrate core account from UTF8 & shuffle");var j={};Object.keys(p.data).forEach(function(y){j[y]=p.data[y]}),delete j._,j.auth=x,k.get("~"+p.pair.pub).put(j)}k.get("~"+p.pair.pub).get("auth").put(x,N||m)},p.err=function(x){var j={err:n.log(x||"User cannot be found!")};g.ing=!1,(N||m)(j)},p.plugin=function(x){if(!(p.name=x))return p.err();var j=[x];x[0]!=="~"&&(j[1]="~"+x,j[2]="~@"+x),p.b(j)},f?f.priv&&f.epriv?p.g(f):k.get("~"+f.pub).once(p.h):d?k.get("~@"+d).once(p.a):!d&&!h&&r.name(p.plugin),w};function l(c){if(typeof c!="string")return c;try{c=JSON.parse(c)}catch{c={}}return c}})(t,"./auth"),t(function(o){var s=t("./user"),r=s.SEA;s.GUN,s.prototype.recall=function(n,m){var l=this,c=l.back(-1);if(n=n||{},n&&n.sessionStorage){if(r.window)try{var f={};f=r.window.sessionStorage,f&&(c._.opt.remember=!0,(l.back("user")._.opt||n).remember=!0,(f.recall||f.pair)&&c.user().auth(JSON.parse(f.pair),m))}catch{}return l}return l}})(t,"./recall"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.pair=function(){var l=this,c;try{c=new Proxy({DANGER:"☠"},{get:function(f,d,h){if(!(!l.is||!(l._||"").sea))return l._.sea[d]}})}catch{}return c},s.prototype.delete=async function(l,c,f){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var d=this;d.back(-1);var h=d.back("user");try{h.auth(l,c,function(N){var i=(h.is||{}).pub;h.map().once(function(){this.put(null)}),h.leave(),(f||m)({ok:0})})}catch(N){n.log("User.delete failed! Error:",N)}return d},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const f="No session!";throw n.log(f),{err:f}}},s.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),n.is(l)&&l.get("pub").get((c,f)=>{console.log(c,f)}),l.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(l,c){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var f=this,d=f.back(-1).user(),h=d._.sea,N="";return f.back(function(i){i.is||(N+=i.get||"")}),async function(){var i,w=await d.get("grant").get(h.pub).get(N).then();w=await r.decrypt(w,h),w||(w=r.random(16).toString(),i=await r.encrypt(w,h),d.get("grant").get(h.pub).get(N).put(i));var g=l.get("pub").then(),k=l.get("epub").then();g=await g,k=await k;var p=await r.secret(k,h);i=await r.encrypt(w,p),d.get("grant").get(g).get(N).put(i,c)}(),f},s.prototype.secret=function(l,c){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var f=this,d=f.back(-1).user(),h=d.pair(),N="";return f.back(function(i){i.is||(N+=i.get||"")}),async function(){var i,w=await d.get("trust").get(h.pub).get(N).then();w=await r.decrypt(w,h),w||(w=r.random(16).toString(),i=await r.encrypt(w,h),d.get("trust").get(h.pub).get(N).put(i)),i=await r.encrypt(l,w),f.put(i,c)}(),f},o.exports=s})(t,"./share"),t(function(o){var s=t("./sea"),r=t("./settings"),n,m=(s.window||"").GUN||t((""+n==typeof a?".":"")+"./gun",1);m.on("opt",function(i){i.sea||(i.sea={own:{}},i.on("put",l,i)),this.to.next(i)});function l(i){var w=this,g=w.as,k=i.put,p=k["#"],T=k["."],b=k[":"],x=k[">"],j=i["#"],y;if(!(!p||!T)){if((i._||"").faith&&(g.opt||"").faith&&typeof i._=="function"){s.opt.pack(k,function(_){s.verify(_,!1,function(B){k["="]=s.opt.unpack(B),w.to.next(i)})});return}var C=function(_){g.on("in",{"@":j,err:i.err=_})};if((i._||"").DBG&&((i._||"").DBG.c=+new Date),0<=p.indexOf("<?")&&(y=parseFloat(p.split("<?")[1]||""),y&&x<m.state()-y*1e3)){(y=i._)&&y.stun&&y.stun--;return}if(p==="~@"){l.alias(w,i,b,T,p,g,C);return}if(p.slice(0,2)==="~@"){l.pubs(w,i,b,T,p,g,C);return}if(y=s.opt.pub(p)){l.pub(w,i,b,T,p,g,C,g.user||"",y);return}if(0<=p.indexOf("#")){l.hash(w,i,b,T,p,g,C);return}l.any(w,i,b,T,p,g,C,g.user||"")}}l.hash=function(i,w,g,k,p,T,b){s.work(g,null,function(x){function j(y){let C="";for(let _=0;_<y.length;_++)C+=_-1&1?"":String.fromCharCode(parseInt(y.substring(_-1,_+1),16));return btoa(C)}if(x&&x===k.split("#").slice(-1)[0])return i.to.next(w);if(x&&x===j(k.split("#").slice(-1)[0]))return i.to.next(w);b("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(i,w,g,k,p,T,b){if(!g)return b("Data must exist!");if("~@"+k===f(g))return i.to.next(w);b("Alias not same!")},l.pubs=function(i,w,g,k,p,T,b){if(!g)return b("Alias must exist!");if(k===f(g))return i.to.next(w);b("Alias not same!")},l.pub=async function(i,w,g,k,p,T,b,x,j){var y;const C=await r.parse(g)||{},_=(B,D,S)=>{if(B.m&&B.s&&D&&j)return s.verify(B,j,A=>{if(n!==A&&n!==A.e&&w.put[">"]&&w.put[">"]>parseFloat(A.e))return b("Certificate expired.");if(n!==A&&A.c&&A.w&&(A.c===D||A.c.indexOf("*")>-1)){let v=p.indexOf("/")>-1?p.replace(p.substring(0,p.indexOf("/")+1),""):"";String.match=String.match||m.text.match;const I=Array.isArray(A.w)?A.w:typeof A.w=="object"||typeof A.w=="string"?[A.w]:[];for(const O of I)if(String.match(v,O["#"])&&String.match(k,O["."])||!O["."]&&String.match(v,O["#"])||!O["#"]&&String.match(k,O["."])||String.match(v?v+"/"+k:k,O["#"]||O)){if(O["+"]&&O["+"].indexOf("*")>-1&&v&&v.indexOf(D)==-1&&k.indexOf(D)==-1)return b(`Path "${v}" or key "${k}" must contain string "${D}".`);if(A.wb&&(typeof A.wb=="string"||(A.wb||{})["#"])){var R=i.as.root.$.back(-1);return typeof A.wb=="string"&&A.wb.slice(0,1)!=="~"&&(R=R.get("~"+j)),R.get(A.wb).get(D).once(G=>G&&(G===1||G===!0)?b(`Certificant ${D} blocked.`):S(A))}return S(A)}return b("Certificate verification fail.")}})};if(k==="pub"&&"~"+j===p)return g===j?i.to.next(w):b("Account not same!");if((y=x.is)&&y.pub&&!C["*"]&&!C["+"]&&(j===y.pub||j!==y.pub&&((w._.msg||{}).opt||{}).cert)){s.opt.pack(w.put,B=>{s.sign(B,x._.sea,async function(D){if(n===D)return b(s.err||"Signature fail.");if(w.put[":"]={":":y=s.opt.unpack(D.m),"~":D.s},w.put["="]=y,j===x.is.pub){(y=f(g))&&((T.sea.own[y]=T.sea.own[y]||{})[j]=1),JSON.stringifyAsync(w.put[":"],function(S,A){return S?b(S||"Stringify error."):(w.put[":"]=A,i.to.next(w))});return}if(j!==x.is.pub&&((w._.msg||{}).opt||{}).cert){const S=await r.parse(w._.msg.opt.cert);S&&S.m&&S.s&&_(S,x.is.pub,A=>{w.put[":"]["+"]=S,w.put[":"]["*"]=x.is.pub,JSON.stringifyAsync(w.put[":"],function(R,v){return R?b(R||"Stringify error."):(w.put[":"]=v,i.to.next(w))})})}},{raw:1})});return}s.opt.pack(w.put,B=>{s.verify(B,C["*"]||j,function(D){var S;if(D=s.opt.unpack(D),n===D)return b("Unverified data.");if((S=f(D))&&j===s.opt.pub(S)&&((T.sea.own[S]=T.sea.own[S]||{})[j]=1),C["+"]&&C["+"].m&&C["+"].s&&C["*"])_(C["+"],C["*"],A=>(w.put["="]=D,i.to.next(w)));else return w.put["="]=D,i.to.next(w)})})},l.any=function(i,w,g,k,p,T,b,x){if(T.opt.secure)return b("Soul missing public key at '"+k+"'.");T.on("secure",function(j){if(this.off(),!T.opt.secure)return i.to.next(j);b("Data cannot be changed.")}).on.on("secure",w)};var c=m.valid,f=function(i,w){return typeof(w=c(i))=="string"&&w};(m.state||"").ify;var d=/[^\w_-]/;s.opt.pub=function(i){if(i&&(i=i.split("~"),!(!i||!(i=i[1]))&&(i=i.split(d).slice(0,2),!(!i||i.length!=2)&&(i[0]||"")[0]!=="@")))return i=i.slice(0,2).join("."),i},s.opt.stringy=function(i){},s.opt.pack=function(i,w,g,k,p){var T,b;if(s.opt.check(i))return w(i);i&&i["#"]&&i["."]&&i[">"]&&(T=i[":"],b=1),JSON.parseAsync(b?T:i,function(x,j){var y=n!==(j||"")[":"]&&(j||"")["~"];if(!y){w(i);return}w({m:{"#":p||i["#"],".":g||i["."],":":(j||"")[":"],">":i[">"]||m.state.is(k,g)},s:y})})};var h=s.opt;s.opt.unpack=function(i,w,g){var k;if(n!==i){if(i&&n!==(k=i[":"]))return k;if(w=w||h.fall_key,!g&&h.fall_val&&(g={},g[w]=h.fall_val),!(!w||!g)){if(i===g[w]||!s.opt.check(g[w]))return i;var p=g&&g._&&g._["#"]||h.fall_soul,T=m.state.is(g,w)||h.fall_state;if(i&&i.length===4&&p===i[0]&&w===i[1]&&N(T)===N(i[3]))return i[2];if(T<s.opt.shuffle_attack)return i}}},s.opt.shuffle_attack=15463296e5;var N=Math.floor})(t,"./index")})()}(Ae)),Ae.exports}gs();var nt={},lt;function xs(){if(lt)return nt;lt=1;var u=typeof window<"u"?window.Gun:Mt();return u.chain.promise=function(o){var a=this,o=o||function(s){return s};return new Promise(function(s,r){a.once(function(n,m){s({put:n,get:m,gun:this})})}).then(o)},u.chain.then=function(t){var a=this,o=new Promise((s,r)=>{a.once(function(n,m){s(n,m)})});return t?o.then(t):o},nt}xs();console.log("🔫 GunJS service file loading...");console.log("🔫 Imported Gun:",typeof te);console.log("🔫 After importing gun/sea and gun/lib/then");console.log("🔫 Gun.SEA is available:",!!te.SEA);te.SEA?(console.log("🔫 ✅ Gun.SEA is properly initialized"),console.log("🔫 Gun.SEA methods:",te.SEA?Object.keys(te.SEA):"undefined")):(console.error("🔫 CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("🔫 Will check SEA availability after Gun instance creation..."));console.log("🔫 About to initialize Gun instance...");const Q=te({peers:["https://gun-ad4i.onrender.com/gun","https://bewildered-dulcy-amend09-294cb39e.koyeb.app/gun"]});console.log("🔫 GunJS initialized with Render peer and Nest peer");console.log("🔫 Gun instance created:",typeof Q);console.log("🔫 Gun instance properties:",Object.keys(Q));console.log("🔫 Checking Gun.SEA after instance creation:",!!te.SEA);Q.SEA&&(console.log("🔫 Found SEA on gun instance:",!!Q.SEA),te.SEA=Q.SEA);console.log("🔫 Testing gun.user() method availability...");typeof Q.user=="function"?console.log("🔫 ✅ gun.user() method is available"):(console.error("🔫 ❌ gun.user() method is NOT available"),console.error("🔫 Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(Q))));Q.on("hi",u=>{console.log("🔫 GunJS: Connected to peer",u)});Q.on("bye",u=>{console.log("🔫 GunJS: Disconnected from peer",u)});Q.on("out",u=>{u&&u.err&&console.warn("🔫 GunJS: Connection error:",u.err)});setTimeout(()=>{console.log("🔫 GunJS connection test - gun object:",Q),console.log("🔫 GunJS internal state:",Q._),Q.get("test").put({hello:"world",timestamp:Date.now()}),console.log("🔫 GunJS: Test data written")},2e3);console.log("🔫 Creating user instance...");let ae;try{ae=Q.user(),console.log("🔫 ✅ User instance created successfully:",typeof ae),console.log("🔫 User instance properties:",Object.keys(ae)),typeof ae.create=="function"?console.log("🔫 ✅ user.create() method is available"):console.error("🔫 ❌ user.create() method is NOT available"),typeof ae.auth=="function"?console.log("🔫 ✅ user.auth() method is available"):console.error("🔫 ❌ user.auth() method is NOT available")}catch(u){console.error("🔫 ❌ FAILED to create user instance:",u),console.error("🔫 This confirms that SEA is not properly loaded"),ae={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const Re=te.SEA;console.log("🔫 SEA reference:",typeof Re);Re&&typeof Re.encrypt=="function"?console.log("🔫 ✅ SEA.encrypt() method is available"):(console.error("🔫 ❌ SEA.encrypt() method is NOT available"),console.error("🔫 Final Gun.SEA status:",te.SEA));class ps{constructor(){ve(this,"gun");ve(this,"user");ve(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=Q,this.user=ae,this.SEA=Re,console.log("GunJS: GunService initialized")}async signUp(t,a){return console.log("🔫 GunJS: Attempting to sign up user:",t),new Promise(o=>{if(a.length<8){console.log("🔫 GunJS: Password too short"),o({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("🔫 GunJS: Sign up timed out"),o({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,a,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign up response:",r),r.err){console.log("🔫 GunJS: Sign up error:",r.err),o({success:!1,error:r.err});return}this.user.auth(t,a,n=>{if(!n.err){const m={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(m,()=>{console.log("🔫 GunJS: Initial profile created with original username"),this.addToPublicUsersIndex(t,t),this.user.leave()})}}),console.log("🔫 GunJS: Sign up successful"),o({success:!0})})})}async signIn(t,a){return console.log("🔫 GunJS: Attempting to sign in user:",t),new Promise(o=>{const s=setTimeout(()=>{console.log("🔫 GunJS: Sign in timed out"),o({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,a,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign in response:",r),r.err){console.log("🔫 GunJS: Sign in error:",r.err),o({success:!1,error:r.err});return}console.log("🔫 GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(n=>{if(!(n!=null&&n.originalUsername)){console.log("🔫 GunJS: Storing original username in profile");const m={...n,originalUsername:t,favoriteGenres:(n==null?void 0:n.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(m)}this.addToPublicUsersIndex(t,(n==null?void 0:n.displayName)||t)}),o({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const a=setTimeout(()=>{console.log("🔫 GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(a),this.user.is?(console.log("🔫 GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(o=>{const s=(o==null?void 0:o.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("🔫 GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}const o=setTimeout(()=>{console.log("🔫 GunJS: updateProfile timed out"),a({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("🔫 GunJS: Existing profile:",s);const r=(s==null?void 0:s.originalUsername)||this.user.is.alias,n={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:r};console.log("🔫 GunJS: Updating profile with Gun-compatible data:",n),this.user.get("profile").put(n,m=>{if(clearTimeout(o),console.log("🔫 GunJS: Profile update response:",m),m.err){console.log("🔫 GunJS: Profile update error:",m.err),a({success:!1,error:m.err});return}console.log("🔫 GunJS: Profile updated successfully"),this.user.get("profile").once(l=>{console.log("🔫 GunJS: Profile after update:",l),a({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=setTimeout(()=>{console.log("🔫 GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(o=>{if(clearTimeout(a),console.log("🔫 GunJS: Raw profile loaded:",o),o){const s={displayName:o.displayName||"",bio:o.bio||"",favoriteGenres:o.favoriteGenres?JSON.parse(o.favoriteGenres):[],readingGoal:o.readingGoal||12,joinedDate:o.joinedDate,lastUpdated:o.lastUpdated,originalUsername:o.originalUsername};console.log("🔫 GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(a=>{t({success:!0,books:a||[]})})})}async syncUserNotes(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(a=>{t({success:!0,notes:a||[]})})})}async syncUserSessions(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(a=>{t({success:!0,sessions:a||[]})})})}async syncPetData(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(a=>{t({success:!0,petData:a||null})})})}async syncUserData(t,a){return new Promise(o=>{if(!this.user.is){o({success:!1,error:"User not authenticated"});return}this.user.get(t).put(a,s=>{if(s.err){o({success:!1,error:s.err});return}o({success:!0})})})}async getUserData(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get(t).once(o=>{a({success:!0,data:o||{}})})})}subscribeToUserData(t,a){this.user.is&&this.user.get(t).on(a)}unsubscribeFromUserData(t){this.user.is&&this.user.get(t).off()}async addToPublicUsersIndex(t,a){try{if(!this.user.is)return;const o={id:this.user.is.pub,username:t,displayName:a||t,joinedAt:new Date().toISOString()};this.gun.get("publicUsers").get(this.user.is.pub).put(o),console.log("🔫 GunJS: Added user to public index:",o)}catch(o){console.error("🔫 GunJS: Error adding user to public index:",o)}}async searchPublicUsers(t){return new Promise(a=>{if(!t.trim()){a([]);return}const o=[],s=setTimeout(()=>{console.log("🔫 GunJS: User search timed out"),a(o)},5e3);try{this.gun.get("publicUsers").map().on(r=>{var n;r&&r.username&&r.id&&(r.username.toLowerCase().includes(t.toLowerCase())||r.displayName&&r.displayName.toLowerCase().includes(t.toLowerCase()))&&r.id!==((n=this.user.is)==null?void 0:n.pub)&&o.findIndex(c=>c.id===r.id)===-1&&o.push({id:r.id,username:r.username,displayName:r.displayName})}),setTimeout(()=>{clearTimeout(s),a(o)},2e3)}catch(r){clearTimeout(s),console.error("🔫 GunJS: Error searching users:",r),a([])}})}async getPublicProfile(t){return new Promise(a=>{const o=setTimeout(()=>{a({success:!1,error:"Profile request timed out"})},3e3);try{this.gun.get("publicUsers").get(t).once(s=>{clearTimeout(o),a(s?{success:!0,profile:s}:{success:!1,error:"User not found"})})}catch{clearTimeout(o),a({success:!1,error:"Error fetching profile"})}})}async sendFriendRequest(t,a,o,s,r,n){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const m=`req_${Date.now()}_${t}_${s}`,l={id:m,fromUserId:t,fromUsername:a,fromDisplayName:o,toUserId:s,toUsername:r,toDisplayName:n,status:"pending",createdAt:new Date().toISOString()};return this.gun.get("friendRequests").get(s).get(m).put(l),this.gun.get("sentRequests").get(t).get(m).put(l),{success:!0}}catch(m){return console.error("🔫 GunJS: Error sending friend request:",m),{success:!1,error:"Failed to send friend request"}}}async getFriendRequests(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=[],o=setTimeout(()=>{t({success:!0,requests:a})},3e3);try{this.gun.get("friendRequests").get(this.user.is.pub).map().on(s=>{s&&s.id&&s.status==="pending"&&a.findIndex(n=>n.id===s.id)===-1&&a.push(s)}),setTimeout(()=>{clearTimeout(o),t({success:!0,requests:a})},2e3)}catch{clearTimeout(o),t({success:!1,error:"Error fetching friend requests"})}})}async acceptFriendRequest(t,a){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};console.log("🔫 GunJS: Accepting friend request:",t,"from:",a);const o={status:"accepted",respondedAt:new Date().toISOString()};this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(a).get(t).put(o);const s=[this.user.is.pub,a].sort().join("_"),r={id:s,user1:this.user.is.pub,user2:a,createdAt:new Date().toISOString(),status:"active"};return console.log("🔫 GunJS: Creating friendship:",s),this.gun.get("friendships").get(s).put(r),this.gun.get("userFriends").get(this.user.is.pub).get(a).put({friendId:a,since:new Date().toISOString()}),this.gun.get("userFriends").get(a).get(this.user.is.pub).put({friendId:this.user.is.pub,since:new Date().toISOString()}),console.log("🔫 GunJS: Friend request accepted successfully"),{success:!0}}catch(o){return console.error("🔫 GunJS: Error accepting friend request:",o),{success:!1,error:"Failed to accept friend request"}}}async declineFriendRequest(t,a){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const o={status:"declined",respondedAt:new Date().toISOString()};return this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(a).get(t).put(o),{success:!0}}catch(o){return console.error("🔫 GunJS: Error declining friend request:",o),{success:!1,error:"Failed to decline friend request"}}}async getFriends(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=[],o=new Set;let s=0;const r=setTimeout(()=>{console.log("🔫 GunJS: getFriends timeout, returning",a.length,"friends"),t({success:!0,friends:a})},4e3);try{this.gun.get("friendships").map().on((n,m)=>{if(!(!n||!m||o.has(m))&&(n.user1===this.user.is.pub||n.user2===this.user.is.pub)){o.add(m),s++;const l=n.user1===this.user.is.pub?n.user2:n.user1;this.gun.get("publicUsers").get(l).once(c=>{s--,c&&!a.find(f=>f.id===l)&&(a.push({id:l,username:c.username,displayName:c.displayName,status:"accepted",addedAt:n.createdAt}),console.log("🔫 GunJS: Added friend:",c.username)),s===0&&setTimeout(()=>{clearTimeout(r),t({success:!0,friends:a})},500)})}}),setTimeout(()=>{s===0&&(clearTimeout(r),t({success:!0,friends:a}))},2e3)}catch{clearTimeout(r),t({success:!1,error:"Error fetching friends"})}})}async removeFriend(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const a=[this.user.is.pub,t].sort().join("_");return this.gun.get("friendships").get(a).put(null),{success:!0}}catch(a){return console.error("🔫 GunJS: Error removing friend:",a),{success:!1,error:"Failed to remove friend"}}}async updatePublicStats(t){return new Promise(a=>{try{if(!this.user.is){console.error("🔫 GunJS: Cannot update public stats - user not authenticated"),a({success:!1,error:"User not authenticated"});return}const o={userId:this.user.is.pub,totalBooksRead:t.totalBooksRead||0,totalPagesRead:t.totalPagesRead||0,totalReadingTime:t.totalReadingTime||0,currentStreak:t.currentStreak||0,lastUpdated:new Date().toISOString()};console.log("🔫 GunJS: Updating public stats for user:",this.user.is.pub),console.log("🔫 GunJS: Stats being updated:",o),this.gun.get("publicStats").get(this.user.is.pub).put(o,s=>{s.err?(console.error("🔫 GunJS: ❌ Error updating public stats:",s.err),a({success:!1,error:s.err})):(console.log("🔫 GunJS: ✅ Public stats updated successfully with ack:",s),setTimeout(()=>{this.gun.get("publicStats").get(this.user.is.pub).once(r=>{console.log("🔫 GunJS: Verified stats after update:",r),a({success:!0})})},500))})}catch(o){console.error("🔫 GunJS: ❌ Error updating public stats:",o),a({success:!1,error:"Failed to update public stats"})}})}async getPublicStats(t){return new Promise(a=>{const o=setTimeout(()=>{a({success:!1,error:"Stats request timed out"})},3e3);try{this.gun.get("publicStats").get(t).once(s=>{clearTimeout(o),a(s?{success:!0,stats:s}:{success:!1,error:"Stats not found"})})}catch{clearTimeout(o),a({success:!1,error:"Error fetching stats"})}})}async getAllPublicStats(){return new Promise(t=>{const a=[],o=setTimeout(()=>{console.log("🔫 GunJS: getAllPublicStats timeout, returning",a.length,"stats"),t({success:!0,allStats:a})},4e3);try{console.log("🔫 GunJS: Starting to fetch all public stats..."),this.gun.get("publicStats").map().on((s,r)=>{s&&r&&!a.find(n=>n.userId===r)&&(console.log("🔫 GunJS: Found public stats for user:",r,s),a.push({...s,userId:r}))}),setTimeout(()=>{clearTimeout(o),console.log("🔫 GunJS: Returning",a.length,"public stats"),t({success:!0,allStats:a})},2e3)}catch(s){clearTimeout(o),console.error("🔫 GunJS: Error fetching all public stats:",s),t({success:!1,error:"Failed to fetch public stats"})}})}async publishActivity(t){var a,o;try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const s=this.getCurrentUser(),r=await this.getProfile(),n=r.success?((a=r.profile)==null?void 0:a.displayName)||((o=r.profile)==null?void 0:o.username)||(s==null?void 0:s.username):(s==null?void 0:s.username)||"Unknown",m={id:`activity_${Date.now()}_${this.user.is.pub}`,userId:this.user.is.pub,username:(s==null?void 0:s.username)||"Unknown",displayName:n,type:t.type,title:t.title,description:t.description,timestamp:new Date().toISOString(),bookTitle:t.bookTitle,bookCover:t.bookCover,metadata:t.metadata};return this.gun.get("publicActivity").get(m.id).put(m),this.gun.get("userActivity").get(this.user.is.pub).set(m),console.log("🔫 GunJS: Published activity:",m),{success:!0}}catch(s){return console.error("🔫 GunJS: Error publishing activity:",s),{success:!1,error:"Failed to publish activity"}}}async getFriendActivities(t){return new Promise(a=>{const o=[],s=setTimeout(()=>{console.log("🔫 GunJS: getFriendActivities timeout, returning",o.length,"activities"),a({success:!0,activities:o})},4e3);try{if(console.log("🔫 GunJS: Fetching activities for friends:",t),t.length===0){clearTimeout(s),a({success:!0,activities:[]});return}const r=n=>{this.gun.get("userActivity").get(n).map().once(m=>{if(m&&m.id&&m.timestamp){const l=new Date(m.timestamp),c=new Date(Date.now()-30*24*60*60*1e3);l>c&&!o.find(f=>f.id===m.id)&&o.push(m)}})};t.forEach(r),this.gun.get("publicActivity").map().on(n=>{if(n&&n.userId&&t.includes(n.userId)){const m=new Date(n.timestamp),l=new Date(Date.now()-30*24*60*60*1e3);m>l&&!o.find(c=>c.id===n.id)&&o.push(n)}}),setTimeout(()=>{clearTimeout(s);const n=o.sort((m,l)=>new Date(l.timestamp).getTime()-new Date(m.timestamp).getTime()).slice(0,20);console.log("🔫 GunJS: Returning",n.length,"friend activities"),a({success:!0,activities:n})},2e3)}catch(r){clearTimeout(s),console.error("🔫 GunJS: Error fetching friend activities:",r),a({success:!1,error:"Failed to fetch activities"})}})}async getRecentPublicActivity(t=50){return new Promise(a=>{const o=[],s=setTimeout(()=>{console.log("🔫 GunJS: getRecentPublicActivity timeout, returning",o.length,"activities"),a({success:!0,activities:o})},3e3);try{this.gun.get("publicActivity").map().on(r=>{if(r&&r.id&&r.timestamp){const n=new Date(r.timestamp),m=new Date(Date.now()-7*24*60*60*1e3);n>m&&!o.find(l=>l.id===r.id)&&o.push(r)}}),setTimeout(()=>{clearTimeout(s);const r=o.sort((n,m)=>new Date(m.timestamp).getTime()-new Date(n.timestamp).getTime()).slice(0,t);a({success:!0,activities:r})},2e3)}catch(r){clearTimeout(s),console.error("🔫 GunJS: Error fetching recent public activity:",r),a({success:!1,error:"Failed to fetch public activity"})}})}}const J=new ps;class ys{constructor(){ve(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,a){if(J.isAuthenticated()&&this.isOnline)try{await J.syncUserData(t,a)}catch(o){console.warn("Failed to sync data to server:",o)}}async getData(t,a){if(J.isAuthenticated()&&this.isOnline)try{const s=await J.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const o=localStorage.getItem(`bookish_${t}`);return o?JSON.parse(o):a}setLocalStorage(t,a){localStorage.setItem(`bookish_${t}`,JSON.stringify(a))}async syncPendingChanges(){if(!J.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const a of t)try{const o=localStorage.getItem(`bookish_${a}`);o&&await J.syncUserData(a,JSON.parse(o))}catch(o){console.warn(`Failed to sync ${a}:`,o)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!J.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const a of t)try{const o=a.getter();o!==null&&(Array.isArray(o)?o.length>0:Object.keys(o).length>0)&&await J.syncUserData(a.key,o)}catch(o){console.warn(`Failed to migrate ${a.key}:`,o)}}}const Y=new ys,bs=Object.freeze(Object.defineProperty({__proto__:null,default:Y,syncedStorage:Y},Symbol.toStringTag,{value:"Module"})),vs="modulepreload",ws=function(u){return"/Bookish/"+u},it={},Je=function(t,a,o){let s=Promise.resolve();if(a&&a.length>0){let n=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));s=n(a.map(c=>{if(c=ws(c),c in it)return;it[c]=!0;const f=c.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=f?"stylesheet":vs,f||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),f)return new Promise((N,i)=>{h.addEventListener("load",N),h.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(n){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=n,window.dispatchEvent(m),!m.defaultPrevented)throw n}return s.then(n=>{for(const m of n||[])m.status==="rejected"&&r(m.reason);return t().catch(r)})},ie="https://openlibrary.org",js=async u=>{try{return(await(await fetch(`${ie}/search.json?q=${encodeURIComponent(u)}&limit=10`)).json()).docs.map(o=>({key:o.key,title:o.title,author_name:o.author_name,cover_i:o.cover_i,first_publish_year:o.first_publish_year,number_of_pages_median:o.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},Ns=async u=>{var t,a;try{const o=u.replace("/works/",""),r=await(await fetch(`${ie}/works/${o}.json`)).json();let n=r.number_of_pages_median;!n&&r.editions&&(n=await Ss(r.editions)),n||(n=await ks(o));let m=[];if(r.authors&&r.authors.length>0){const l=r.authors.slice(0,3).map(async f=>{try{return(await(await fetch(`${ie}${f.author.key}.json`)).json()).name}catch{return null}});m=(await Promise.all(l)).filter(f=>f!==null)}return{key:r.key,title:r.title,author_name:m,cover_i:(t=r.covers)==null?void 0:t[0],first_publish_year:r.first_publish_year,description:((a=r.description)==null?void 0:a.value)||r.description||"",number_of_pages_median:n}}catch(o){return console.error("Error fetching book details:",o),null}},Ss=async u=>{try{if(!u||!u.entries||u.entries.length===0)return;for(const t of u.entries.slice(0,3))try{const o=await(await fetch(`${ie}${t.key}.json`)).json();if(o.number_of_pages)return o.number_of_pages}catch(a){console.error("Error fetching edition:",a);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},ks=async u=>{try{const a=await(await fetch(`${ie}/works/${u}/editions.json?limit=5`)).json();if(a.entries&&a.entries.length>0){for(const o of a.entries)if(o.number_of_pages)return o.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},Cs=u=>{const t=new Date().getFullYear(),a=u.first_publish_year||t;return a<1900?320:a<1950?280:a<2e3?250:220},Ts=(u,t="M")=>u?`https://covers.openlibrary.org/b/id/${u}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",Es=async u=>{var t;try{return((t=(await(await fetch(`${ie}/subjects/${encodeURIComponent(u.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var r;return{key:s.key,title:s.title,author_name:((r=s.authors)==null?void 0:r.map(n=>n.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(a){return console.error("Error searching books by subject:",a),[]}},Ps=async u=>{var t,a;try{const o=u.replace(/[-\s]/g,""),s=await fetch(`${ie}/isbn/${o}.json`);if(!s.ok)return null;const r=await s.json();return{key:r.key,title:r.title,author_name:((t=r.authors)==null?void 0:t.map(n=>n.name))||[],cover_i:(a=r.covers)==null?void 0:a[0],first_publish_year:r.publish_date?new Date(r.publish_date).getFullYear():void 0,number_of_pages_median:r.number_of_pages}}catch(o){return console.error("Error searching book by ISBN:",o),null}},As="bookish_books",_s="bookish_reading_sessions",wt="bookish_stats",Rs="bookish_streak",$e="bookish_cached_books",pe=(u,t)=>{const a=localStorage.getItem(u);return a?JSON.parse(a):t},jt=(u,t)=>{localStorage.setItem(u,JSON.stringify(t))},Bs=()=>pe(As,[]),Nt=u=>pe($e,{})[u]||null,ct=u=>{const t=pe($e,{});t[u.key]={...u,cached_at:new Date().toISOString()},jt($e,t)},Ie=()=>pe(_s,[]),dt=u=>Ie().filter(t=>t.bookId===u),Ds=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),Ne=()=>pe(wt,Ds()),Is=()=>{const u=Ie(),t=Bs(),a=u.reduce((h,N)=>h+(N.duration||0),0),o=new Date().setHours(0,0,0,0),s=u.reduce((h,N)=>new Date(N.startTime).setHours(0,0,0,0)===o?h+(N.duration||0):h,0),r=new Date;r.setDate(r.getDate()-r.getDay()),r.setHours(0,0,0,0);const n=u.reduce((h,N)=>new Date(N.startTime)>=r?h+(N.duration||0):h,0),m=u.reduce((h,N)=>{const i=(N.endPage||0)-(N.startPage||0);return h+Math.max(0,i)},0),l=new Date(new Date().getFullYear(),0,1),c=new Set;u.forEach(h=>{if(new Date(h.startTime)>=l&&h.endPage){const i=t.find(w=>w.key===h.bookId);if(i){const w=i.number_of_pages_median;if(w&&h.endPage>=w)c.add(h.bookId);else if(!w){const g=Cs(i);h.endPage>=g*.9&&c.add(h.bookId)}}}}),JSON.parse(localStorage.getItem("bookish_books")||"[]").forEach(h=>{h.category==="completed"&&c.add(h.key)});const d={totalBooksRead:c.size,totalPagesRead:m,totalReadingTime:a,readingTimeToday:s,readingTimeThisWeek:n,booksFinishedThisYear:c.size};jt(wt,d),window.dispatchEvent(new CustomEvent("statsUpdated",{detail:d}))},_e=async()=>{Is();const u=Ne();try{const{default:t}=await Je(async()=>{const{default:a}=await Promise.resolve().then(()=>bs);return{default:a}},void 0);await t.saveStats(u)}catch(t){console.warn("Failed to sync stats to remote storage:",t)}return u},Fs=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),fe=()=>pe(Rs,Fs()),se={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet",USER_SETTINGS:"bookish-user-settings"};class ne{static get(t){try{const a=localStorage.getItem(t);return a?JSON.parse(a):null}catch(a){return console.error("Error reading from localStorage:",a),null}}static set(t,a){try{return localStorage.setItem(t,JSON.stringify(a)),!0}catch(o){return console.error("Error writing to localStorage:",o),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(a){return console.error("Error removing from localStorage:",a),!1}}static clear(){try{return Object.values(se).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(se.GUEST_PROFILE)}static setGuestProfile(t){return this.set(se.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(se.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(se.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(se.GUEST_PET)}static setGuestPet(t){return this.set(se.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}static getUserSettings(){return this.get(se.USER_SETTINGS)}static saveUserSettings(t){return this.set(se.USER_SETTINGS,{...t,lastUpdated:new Date().toISOString()})}}const St=E.createContext(void 0),Us={isAuthenticated:!1,user:null,isLoading:!0,error:null},Os=(u,t)=>{switch(t.type){case"AUTH_START":return{...u,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...u,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...u,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...u,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...u,error:null};case"UPDATE_USER":return{...u,user:u.user?{...u.user,...t.payload}:null};default:return u}},Ls=({children:u})=>{const[t,a]=E.useReducer(Os,Us);E.useEffect(()=>{(async()=>{var d;try{const h=new Promise((w,g)=>setTimeout(()=>g(new Error("Authentication check timeout")),5e3)),N=J.recallUser(),i=await Promise.race([N,h]);if(i&&i.success&&i.user){const w=new Promise((g,k)=>setTimeout(()=>k(new Error("Profile load timeout")),3e3));try{const g=await Promise.race([J.getProfile(),w]),k={...i.user,username:g!=null&&g.success&&((d=g==null?void 0:g.profile)!=null&&d.originalUsername)?g.profile.originalUsername:i.user.username||"Unknown User",profile:g&&g.success?g.profile:void 0};a({type:"AUTH_SUCCESS",payload:k})}catch{const k={...i.user,username:i.user.username||"Unknown User",profile:void 0};a({type:"AUTH_SUCCESS",payload:k})}}else a({type:"AUTH_FAILURE",payload:""})}catch(h){console.log("GunJS auth check failed (servers may be down):",h),a({type:"AUTH_FAILURE",payload:""})}})()},[]);const c={...t,signIn:async(f,d)=>{a({type:"AUTH_START"});try{const h=await J.signIn(f,d);if(h.success&&h.user){const N=await J.getProfile(),i={...h.user,username:f,profile:N.success?N.profile:void 0};return a({type:"AUTH_SUCCESS",payload:i}),{success:!0}}else return a({type:"AUTH_FAILURE",payload:h.error||"Sign in failed"}),{success:!1,error:h.error}}catch{const N="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:N}),{success:!1,error:N}}},signUp:async(f,d)=>{a({type:"AUTH_START"});try{const h=await J.signUp(f,d);return h.success?(a({type:"AUTH_FAILURE",payload:""}),{success:!0}):(a({type:"AUTH_FAILURE",payload:h.error||"Sign up failed"}),{success:!1,error:h.error})}catch{const N="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:N}),{success:!1,error:N}}},signOut:()=>{J.signOut(),a({type:"SIGN_OUT"})},updateProfile:async f=>{console.log("AuthContext: updateProfile called with:",f);try{const d=await J.updateProfile(f);return console.log("AuthContext: gunService.updateProfile result:",d),d.success?(console.log("AuthContext: Updating user state with profile:",f),a({type:"UPDATE_USER",payload:{profile:f}}),{success:!0}):(console.log("AuthContext: Profile update failed:",d.error),{success:!1,error:d.error})}catch(d){return console.error("AuthContext: Profile update error:",d),{success:!1,error:"Failed to update profile"}}},clearError:()=>{a({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let f={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const d=ne.getGuestProfile();d&&(f={displayName:d.displayName||"Guest User",bio:d.bio||"Browsing as a guest",favoriteGenres:d.favoriteGenres||[],readingGoal:d.readingGoal||0});const h={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:f};a({type:"AUTH_SUCCESS",payload:h})}};return e.jsx(St.Provider,{value:c,children:u})},oe=()=>{const u=E.useContext(St);if(u===void 0)throw new Error("useAuth must be used within an AuthProvider");return u},kt=E.createContext(void 0),ce=()=>{const u=E.useContext(kt);if(!u)throw new Error("useBooks must be used within a BookProvider");return u},Gs=({children:u})=>{const{user:t}=oe(),[a,o]=E.useState([]),[s,r]=E.useState(null),[n,m]=E.useState([]),[l,c]=E.useState([]);E.useEffect(()=>{(async()=>{const y=(await Y.getBooks()).map(_=>{const B=Nt(_.key);return B?{..._,...B}:_});o(y);const C=await Y.getCurrentBook();r(C)})()},[]),E.useEffect(()=>{(async()=>{if(s){const j=await Y.getReadingSessions(),y=await Y.getNotes();m(j.filter(C=>C.bookId===s.key)),c(y.filter(C=>C.bookId===s.key))}else m([]),c([])})()},[s]);const f=async x=>{const j=[...a],y=j.findIndex(B=>B.key===x.key),C=y>=0&&j[y].category==="completed",_=x.category==="completed";if(y>=0?j[y]=x:j.push(x),o(j),await Y.saveBooks(j),!C&&_)try{await J.publishActivity({type:"book_completed",title:"Completed a book!",description:`Just finished reading "${x.title}"`,bookTitle:x.title,bookCover:x.cover_i?`https://covers.openlibrary.org/b/id/${x.cover_i}-S.jpg`:void 0,metadata:{pagesRead:x.number_of_pages_median||200}}),console.log("📚 Published book completion activity:",x.title),await d()}catch(B){console.error("Error publishing book completion activity:",B)}await _e()},d=async()=>{try{console.log("📊 Updating public stats after book completion...");const x=JSON.parse(localStorage.getItem("bookish_books")||"[]"),j=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]");console.log("📊 Local books data:",x),console.log("📊 Local sessions data:",j);const y=x.filter(A=>A.category==="completed");console.log("📊 Completed books count:",y.length);const C=j.reduce((A,R)=>A+(R.duration||0),0),_=j.reduce((A,R)=>{const v=(R.endPage||0)-(R.startPage||0);return A+Math.max(0,v)},0),B=h(j),D={totalBooksRead:y.length,totalPagesRead:Math.max(_,y.length*200),totalReadingTime:C,currentStreak:B};console.log("📊 Calculated stats:",D);const S=await J.updatePublicStats(D);S.success?(console.log("✅ Public stats updated successfully"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("publicStatsUpdated",{detail:{userId:t==null?void 0:t.id,stats:D}}))},1e3)):console.error("❌ Failed to update public stats:",S.error)}catch(x){console.error("❌ Error updating public stats:",x)}},h=x=>{if(!x.length)return 0;const j=x.map(B=>new Date(B.startTime).toDateString()).filter((B,D,S)=>S.indexOf(B)===D).sort((B,D)=>new Date(D).getTime()-new Date(B).getTime());let y=0;const C=new Date().toDateString(),_=new Date(Date.now()-864e5).toDateString();if(j[0]===C||j[0]===_){y=1;for(let B=1;B<j.length;B++){const D=new Date(j[B]);if((new Date(j[B-1]).getTime()-D.getTime())/(1e3*60*60*24)===1)y++;else break}}return y},N=async x=>{const j=a.filter(D=>D.key!==x);o(j),await Y.saveBooks(j);const y=await Y.getReadingSessions(),C=await Y.getNotes(),_=y.filter(D=>D.bookId!==x),B=C.filter(D=>D.bookId!==x);await Y.saveReadingSessions(_),await Y.saveNotes(B),s&&s.key===x&&(r(null),await Y.setCurrentBook(null)),await _e()},i=async x=>{r(x),await Y.setCurrentBook(x)},w=async x=>{const j=await Y.getReadingSessions(),y=j.findIndex(C=>C.id===x.id);if(y>=0?j[y]=x:j.push(x),await Y.saveReadingSessions(j),s&&x.bookId===s.key&&m(j.filter(C=>C.bookId===s.key)),await _e(),x.duration&&x.duration>=15)try{const C=a.find(B=>B.key===x.bookId),_=x.endPage&&x.startPage?x.endPage-x.startPage:0;await J.publishActivity({type:"reading_session",title:"Had a reading session",description:`Read for ${x.duration} minutes${C?` in "${C.title}"`:""}`,bookTitle:C==null?void 0:C.title,bookCover:C!=null&&C.cover_i?`https://covers.openlibrary.org/b/id/${C.cover_i}-S.jpg`:void 0,metadata:{duration:x.duration,pagesRead:Math.max(0,_)}}),console.log("📖 Published reading session activity:",x.duration,"minutes"),await d()}catch(C){console.error("Error publishing reading session activity:",C)}},g=async x=>{const y=[...await Y.getNotes(),x];await Y.saveNotes(y),s&&x.bookId===s.key&&c(y.filter(C=>C.bookId===s.key))},k=async x=>{const y=(await Y.getNotes()).map(C=>C.id===x.id?x:C);await Y.saveNotes(y),s&&x.bookId===s.key&&c(y.filter(C=>C.bookId===s.key))},p=async x=>{const y=(await Y.getNotes()).filter(C=>C.id!==x);await Y.saveNotes(y),s&&c(y.filter(C=>C.bookId===s.key))},T=async()=>{try{const x=a.filter(D=>D.category==="completed"),j=n.reduce((D,S)=>D+(S.duration||0),0),y=n.reduce((D,S)=>{const A=(S.endPage||0)-(S.startPage||0);return D+Math.max(0,A)},0),_=(D=>{if(!D.length)return 0;const S=D.map(I=>new Date(I.startTime).toDateString()).filter((I,O,G)=>G.indexOf(I)===O).sort((I,O)=>new Date(O).getTime()-new Date(I).getTime());let A=0;const R=new Date().toDateString(),v=new Date(Date.now()-864e5).toDateString();if(S[0]===R||S[0]===v){A=1;for(let I=1;I<S.length;I++){const O=new Date(S[I]);if((new Date(S[I-1]).getTime()-O.getTime())/(1e3*60*60*24)===1)A++;else break}}return A})(n),B={totalBooksRead:x.length,totalPagesRead:Math.max(y,x.length*200),totalReadingTime:j,currentStreak:_};await J.updatePublicStats(B)}catch(x){console.error("Error updating public stats:",x)}};E.useEffect(()=>{(a.length>0||n.length>0)&&T()},[a,n]);const b={books:a,currentBook:s,sessions:n,notes:l,addBook:f,removeBook:N,setActiveBook:i,addSession:w,addNote:g,updateNote:k,deleteNote:p,updatePublicStatsAfterBookCompletion:d};return ht.useEffect(()=>{window.debugUpdateStats=d},[]),e.jsx(kt.Provider,{value:b,children:u})},Ct=E.createContext(void 0),ye=()=>{const u=E.useContext(Ct);if(!u)throw new Error("usePet must be used within a PetProvider");return u},qe=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content"}),Tt=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),Ms=()=>{try{const u=localStorage.getItem("bookish_pet");if(u){const t=JSON.parse(u);return{...qe(),...t}}}catch(u){console.error("Error loading pet from storage:",u)}return qe()},Js=()=>{try{const u=localStorage.getItem("bookish_pet_stats");if(u)return JSON.parse(u)}catch(u){console.error("Error loading pet stats from storage:",u)}return Tt()},$s=u=>{localStorage.setItem("bookish_pet",JSON.stringify(u))},qs=u=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(u))},Hs=({children:u})=>{const[t,a]=E.useState(Ms),[o,s]=E.useState(Js);E.useEffect(()=>{$s(t)},[t]),E.useEffect(()=>{qs(o)},[o]),E.useEffect(()=>{const y=setInterval(()=>{const C=new Date,_=new Date(t.lastFed),B=(C.getTime()-_.getTime())/(1e3*60*60);B>1&&a(A=>{const R=Math.floor(B);return{...A,hunger:Math.max(0,A.hunger-R*2),energy:Math.max(0,A.energy-R),happiness:Math.max(0,A.happiness-R),mood:r(Math.max(0,A.happiness-R),Math.max(0,A.hunger-R*2),Math.max(0,A.energy-R))}});const D=C.toDateString(),S=new Date(o.lastActiveDate).toDateString();D!==S&&s(A=>({...A,booksReadToday:0,readingTimeToday:0,lastActiveDate:C.toISOString()}))},3e4);return()=>clearInterval(y)},[t.lastFed,o.lastActiveDate]);const r=(y,C,_)=>C<20?"hungry":_<20?"sleepy":y>80?"happy":y>60?"excited":y<30?"sad":"content",n=y=>100+y*50,m=(y,C)=>{let _=C,B=n(_);for(;y>=B;)_++,B=n(_);return{newLevel:_,newExpToNext:B}},l=y=>y<3?"egg":y<8?"baby":y<15?"child":y<25?"teen":y<40?"adult":"elder",c=()=>{const y=t.evolutionStage,C=t.mood,_={egg:{happy:"🥚",content:"🥚",sad:"💔",excited:"✨",sleepy:"😴",hungry:"🥚"},baby:{happy:"😊",content:"🐛",sad:"😢",excited:"🤩",sleepy:"😴",hungry:"😋"},child:{happy:"😄",content:"🐯",sad:"😭",excited:"🤗",sleepy:"💤",hungry:"🍎"},teen:{happy:"😎",content:"🦊",sad:"😔",excited:"🚀",sleepy:"😪",hungry:"🍕"},adult:{happy:"🌟",content:"🦉",sad:"😞",excited:"🎉",sleepy:"😌",hungry:"🍽️"},elder:{happy:"👑",content:"🐉",sad:"😟",excited:"🎊",sleepy:"🧘",hungry:"🍱"}};return _[y][C]||_[y].content},f=()=>{a(y=>{if(y.points<3)return y;const C=Math.min(100,y.hunger+30),_=Math.min(100,y.happiness+10),B=y.experience+5,{newLevel:D,newExpToNext:S}=m(B,y.level);return{...y,hunger:C,happiness:_,experience:B,level:D,experienceToNext:S,points:y.points-3,lastFed:new Date().toISOString(),evolutionStage:l(D),mood:r(_,C,y.energy)}})},d=()=>{a(y=>{if(y.points<5)return y;const C=Math.min(100,y.happiness+20),_=Math.max(0,y.energy-15),B=y.experience+10,{newLevel:D,newExpToNext:S}=m(B,y.level);return{...y,happiness:C,energy:_,experience:B,level:D,experienceToNext:S,points:y.points-5,lastPlayed:new Date().toISOString(),evolutionStage:l(D),mood:r(C,y.hunger,_)}})},h=()=>{a(y=>{const C=Math.min(100,y.energy+40),_=Math.min(100,y.health+10);return{...y,energy:C,health:_,lastSlept:new Date().toISOString(),mood:r(y.happiness,y.hunger,C)}})},N=(y,C=!1)=>{const D=Math.floor(y/5)+(C?50:0);D>0&&(a(S=>{const A=S.experience+D,R=Math.min(100,S.happiness+Math.floor(y/10)),v=S.totalReadingTime+y,{newLevel:I,newExpToNext:O}=m(A,S.level);return{...S,experience:A,level:I,experienceToNext:O,happiness:R,totalReadingTime:v,evolutionStage:l(I),mood:r(R,S.hunger,S.energy)}}),s(S=>({...S,readingTimeToday:S.readingTimeToday+y,lastActiveDate:new Date().toISOString()})))},i=()=>{a(y=>{const C=y.experience+50,_=Math.min(100,y.happiness+25),B=y.totalBooksRead+1,D=20,{newLevel:S,newExpToNext:A}=m(C,y.level),R=[...y.badges];return B===1&&!R.includes("first-book")&&R.push("first-book"),B===10&&!R.includes("book-lover")&&R.push("book-lover"),B===50&&!R.includes("bookworm")&&R.push("bookworm"),{...y,experience:C,level:S,experienceToNext:A,happiness:_,points:y.points+D,totalBooksRead:B,badges:R,evolutionStage:l(S),mood:r(_,y.hunger,y.energy)}}),s(y=>({...y,booksReadToday:y.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},w=()=>({happy:"Your pet is very happy! Keep up the great reading!",excited:"Your pet is excited about your reading progress!",content:"Your pet is content and enjoying your company.",sad:"Your pet seems sad. Try feeding or playing with them!",sleepy:"Your pet is tired. Maybe they need some rest?",hungry:"Your pet is hungry! Don't forget to feed them."})[t.mood],g=()=>{const y=l(t.level+1),C=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:C,stage:y}},k=()=>{const y=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=y&&t.evolutionStage!==l(t.level)},p=()=>{a(y=>({...y,evolutionStage:l(y.level),happiness:100,health:100}))},T=()=>{const y=qe();a(y),s(Tt())},b=y=>{a(C=>({...C,name:y}))},x=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",j=()=>t.experience/t.experienceToNext*100;return e.jsx(Ct.Provider,{value:{pet:t,petStats:o,feedPet:f,playWithPet:d,petSleep:h,updatePetFromReading:N,updatePetFromBookCompletion:i,getPetMood:w,getPetEvolutionRequirement:g,resetPet:T,updatePetName:b,getPetEmoji:c,canEvolve:k,evolvePet:p,getPetHappinessLevel:x,getLevelProgress:j},children:u})},Ys={colors:{primary:"#D2691E",primaryLight:"#E89556",primaryDark:"#B8571A",secondary:"#8B7355",secondaryLight:"#A68B6B",secondaryDark:"#6B5A47",background:"#F7F5F3",surface:"#FFFFFF",surfaceElevated:"#FEFEFE",surfaceSecondary:"#F5F5F5",textPrimary:"#3A3A3A",textSecondary:"#8B7355",textTertiary:"#A0A0A0",textInverse:"#FFFFFF",border:"#E8E3DD",borderLight:"#F0EDE8",borderDark:"#D4C4B0",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",wantToRead:"#FEF3C7",wantToReadText:"#D97706",currentlyReading:"#DBEAFE",currentlyReadingText:"#2563EB",completed:"#D1FAE5",completedText:"#059669",overlay:"rgba(0, 0, 0, 0.5)",overlayLight:"rgba(0, 0, 0, 0.3)"}},Ws={colors:{primary:"#E89556",primaryLight:"#F4A971",primaryDark:"#D2691E",secondary:"#A68B6B",secondaryLight:"#B89980",secondaryDark:"#8B7355",background:"#0F0F0F",surface:"#1A1A1A",surfaceElevated:"#252525",surfaceSecondary:"#1F1F1F",textPrimary:"#F5F5F5",textSecondary:"#C0C0C0",textTertiary:"#909090",textInverse:"#0F0F0F",border:"#333333",borderLight:"#2A2A2A",borderDark:"#444444",success:"#4ADE80",warning:"#FBBF24",error:"#FB7185",info:"#60A5FA",wantToRead:"#2D1B00",wantToReadText:"#FBBF24",currentlyReading:"#1E293B",currentlyReadingText:"#7DD3FC",completed:"#1B2E1B",completedText:"#4ADE80",overlay:"rgba(0, 0, 0, 0.8)",overlayLight:"rgba(0, 0, 0, 0.6)"}},Et=E.createContext(void 0),W=()=>{const u=E.useContext(Et);if(!u)throw new Error("useTheme must be used within a ThemeProvider");return u},Ks=({children:u})=>{const{user:t,isLoading:a}=oe(),o=()=>{try{const f=localStorage.getItem("bookish-theme");if(f)return f==="dark";if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(f){console.error("Error getting initial theme:",f)}return!1},[s,r]=E.useState(o);E.useEffect(()=>{if(a)return;(()=>{var d;if(t){const h=(d=ne.getUserSettings())==null?void 0:d.theme;if(h){r(h==="dark");return}}r(o())})()},[t,a]),E.useEffect(()=>{if(!window.matchMedia)return;const f=window.matchMedia("(prefers-color-scheme: dark)"),d=h=>{var i;(t?!!((i=ne.getUserSettings())!=null&&i.theme):!!localStorage.getItem("bookish-theme"))||r(h.matches)};return f.addEventListener("change",d),()=>f.removeEventListener("change",d)},[t]),E.useEffect(()=>{const f=document.documentElement;s?(f.classList.add("dark"),f.setAttribute("data-theme","dark")):(f.classList.remove("dark"),f.setAttribute("data-theme","light"));const d=document.querySelector('meta[name="theme-color"]');d&&d.setAttribute("content",s?"#0F0F0F":"#F7F5F3")},[s]);const n=()=>{const f=!s;r(f),l(f)},m=f=>{r(f),l(f)},l=f=>{const d=f?"dark":"light";if(t){const h=ne.getUserSettings()||{reminders:[],theme:"light",petName:"Buddy"};ne.saveUserSettings({...h,theme:d})}else localStorage.setItem("bookish-theme",d)},c={colors:s?Ws.colors:Ys.colors,isDark:s};return e.jsx(Et.Provider,{value:{theme:c,toggleTheme:n,setTheme:m},children:u})},Pt=E.createContext(void 0),ke=()=>{const u=E.useContext(Pt);if(!u)throw new Error("useFriends must be used within a FriendsProvider");return u},zs=({children:u})=>{const{user:t,isAuthenticated:a}=oe(),[o,s]=E.useState([]),[r,n]=E.useState([]),[m,l]=E.useState([]),[c,f]=E.useState([]),[d,h]=E.useState(!1),[N,i]=E.useState(null),w=E.useRef(!1),g=E.useRef(!1),[k,p]=E.useState(null);E.useEffect(()=>{a&&t&&T()},[a,t]);const T=async()=>{if(t){h(!0);try{const R=await J.getFriends();if(R.success&&R.friends){const I=await Promise.all(R.friends.map(async O=>{const G=await b(O.id);return{...O,stats:G}}));s(I)}const v=await J.getFriendRequests();v.success&&v.requests&&n(v.requests)}catch(R){console.error("Error loading friends data:",R),i("Failed to load friends data")}finally{h(!1)}}},b=async R=>{try{if(R===(t==null?void 0:t.id)){const[v,I]=await Promise.all([J.getUserBooks(),J.getUserSessions()]),O=v.success?v.books||[]:[],G=I.success?I.sessions||[]:[],H=O.filter(L=>L.category==="completed"),$=G.reduce((L,M)=>L+(M.duration||0),0),P=G.reduce((L,M)=>{const q=(M.endPage||0)-(M.startPage||0);return L+Math.max(0,q)},0),F=x(G),U={totalBooksRead:H.length,totalPagesRead:Math.max(P,H.length*200),totalReadingTime:$,currentStreak:F};return J.updatePublicStats(U).catch(console.error),U}else{try{const I=await J.getPublicStats(R);if(I.success&&I.stats)return{totalBooksRead:I.stats.totalBooksRead||0,totalPagesRead:I.stats.totalPagesRead||0,totalReadingTime:I.stats.totalReadingTime||0,currentStreak:I.stats.currentStreak||0}}catch(I){console.error("Error fetching friend public stats:",I)}const v=o.find(I=>I.id===R);return v&&v.stats?v.stats:{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}}catch(v){return console.error("Error calculating user stats:",v),{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}},x=R=>{if(!R.length)return 0;const v=R.map(H=>new Date(H.startTime).toDateString()).filter((H,$,P)=>P.indexOf(H)===$).sort((H,$)=>new Date($).getTime()-new Date(H).getTime());let I=0;const O=new Date().toDateString(),G=new Date(Date.now()-864e5).toDateString();if(v[0]===O||v[0]===G){I=1;for(let H=1;H<v.length;H++){const $=new Date(v[H]);if((new Date(v[H-1]).getTime()-$.getTime())/(1e3*60*60*24)===1)I++;else break}}return I},j=async R=>{var v;if(!t)return!1;h(!0),i(null);try{const O=(await S(R)).find(P=>P.username.toLowerCase()===R.toLowerCase());if(!O)return i("User not found"),!1;if(o.find(P=>P.id===O.id))return i("Already friends with this user"),!1;if(r.find(P=>P.fromUserId===t.id&&P.toUserId===O.id||P.fromUserId===O.id&&P.toUserId===t.id))return i("Friend request already exists"),!1;const $=await J.sendFriendRequest(t.id,t.username,((v=t.profile)==null?void 0:v.displayName)||t.username,O.id,O.username,O.displayName||O.username);return $.success?(await T(),!0):(i($.error||"Failed to send friend request"),!1)}catch(I){return console.error("Error sending friend request:",I),i("Failed to send friend request"),!1}finally{h(!1)}},y=async R=>{if(!t)return!1;h(!0),i(null);try{const v=r.find(O=>O.id===R);if(!v)return i("Friend request not found"),!1;const I=await J.acceptFriendRequest(R,v.fromUserId);return I.success?(await T(),setTimeout(()=>{B()},1e3),!0):(i(I.error||"Failed to accept friend request"),!1)}catch(v){return console.error("Error accepting friend request:",v),i("Failed to accept friend request"),!1}finally{h(!1)}},C=async R=>{if(!t)return!1;try{const v=r.find(O=>O.id===R);if(!v)return i("Friend request not found"),!1;const I=await J.declineFriendRequest(R,v.fromUserId);return I.success?(await T(),!0):(i(I.error||"Failed to decline friend request"),!1)}catch(v){return console.error("Error declining friend request:",v),i("Failed to decline friend request"),!1}},_=async R=>{if(!t)return!1;try{const v=await J.removeFriend(R);return v.success?(await T(),!0):(i(v.error||"Failed to remove friend"),!1)}catch(v){return console.error("Error removing friend:",v),i("Failed to remove friend"),!1}},B=E.useCallback(async()=>{if(t){if(g.current){console.log("⚠️ Friend activity refresh already in progress, skipping...");return}g.current=!0,h(!0);try{const R=o.map(I=>I.id);if(R.length===0){l([]);return}const v=await J.getFriendActivities(R);v.success&&v.activities?(l(v.activities),console.log("✅ Friend activities loaded:",v.activities.length)):(console.log("⚠️ No friend activities found"),l([]))}catch(R){console.error("Error refreshing friend activity:",R),i("Failed to refresh friend activity")}finally{g.current=!1,h(!1)}}},[t,o]),D=E.useCallback(async(R,v)=>{var I;if(t){if(p({period:R,metric:v}),w.current){console.log("⚠️ Leaderboard refresh already in progress, skipping...");return}w.current=!0,h(!0);try{console.log("🔄 Refreshing leaderboard for period:",R,"metric:",v);const O=await J.getAllPublicStats();if(console.log("📊 All public stats result:",O),O.success&&O.allStats&&O.allStats.length>0){const $=(await Promise.all(O.allStats.map(async P=>{var U,L,M;const F=await J.getPublicProfile(P.userId);return{userId:P.userId,username:F.success&&((U=F.profile)==null?void 0:U.username)||"Unknown",displayName:F.success?((L=F.profile)==null?void 0:L.displayName)||((M=F.profile)==null?void 0:M.username):"Unknown",stats:{booksRead:P.totalBooksRead||0,pagesRead:P.totalPagesRead||0,readingTime:P.totalReadingTime||0,currentStreak:P.currentStreak||0}}}))).sort((P,F)=>{switch(v){case"books_read":return F.stats.booksRead-P.stats.booksRead;case"pages_read":return F.stats.pagesRead-P.stats.pagesRead;case"reading_time":return F.stats.readingTime-P.stats.readingTime;case"streak":return F.stats.currentStreak-P.stats.currentStreak;default:return 0}}).map((P,F)=>({userId:P.userId,username:P.username,displayName:P.displayName,rank:F+1,score:P.stats[v==="books_read"?"booksRead":v==="pages_read"?"pagesRead":v==="reading_time"?"readingTime":"currentStreak"],period:R,metric:v,details:{booksRead:P.stats.booksRead,pagesRead:P.stats.pagesRead,readingTime:P.stats.readingTime,currentStreak:P.stats.currentStreak}}));f($),console.log("✅ Leaderboard updated with",$.length,"entries")}else{console.log("⚠️ No public stats available, using fallback method");const G=await b(t.id),P=[{userId:t.id,username:t.username,displayName:((I=t.profile)==null?void 0:I.displayName)||t.username,stats:{booksRead:G.totalBooksRead,pagesRead:G.totalPagesRead,readingTime:G.totalReadingTime,currentStreak:G.currentStreak}},...o.map(F=>{var U,L,M,q;return{userId:F.id,username:F.username,displayName:F.displayName||F.username,stats:{booksRead:((U=F.stats)==null?void 0:U.totalBooksRead)||0,pagesRead:((L=F.stats)==null?void 0:L.totalPagesRead)||0,readingTime:((M=F.stats)==null?void 0:M.totalReadingTime)||0,currentStreak:((q=F.stats)==null?void 0:q.currentStreak)||0}}})].sort((F,U)=>{switch(v){case"books_read":return U.stats.booksRead-F.stats.booksRead;case"pages_read":return U.stats.pagesRead-F.stats.pagesRead;case"reading_time":return U.stats.readingTime-F.stats.readingTime;case"streak":return U.stats.currentStreak-F.stats.currentStreak;default:return 0}}).map((F,U)=>({userId:F.userId,username:F.username,displayName:F.displayName,rank:U+1,score:F.stats[v==="books_read"?"booksRead":v==="pages_read"?"pagesRead":v==="reading_time"?"readingTime":"currentStreak"],period:R,metric:v,details:{booksRead:F.stats.booksRead,pagesRead:F.stats.pagesRead,readingTime:F.stats.readingTime,currentStreak:F.stats.currentStreak}}));f(P)}}catch(O){console.error("Error refreshing leaderboard:",O),i("Failed to refresh leaderboard")}finally{w.current=!1,h(!1)}}},[t,o]);E.useEffect(()=>{const R=v=>{console.log("🔄 Public stats updated, refreshing leaderboard...",v.detail),setTimeout(()=>{k&&(console.log("🔄 Re-fetching leaderboard with settings:",k),D(k.period,k.metric))},1500)};return window.addEventListener("publicStatsUpdated",R),()=>{window.removeEventListener("publicStatsUpdated",R)}},[k,D]);const S=async R=>{if(!R.trim())return[];try{console.log("🔍 Searching for users with query:",R);const v=await J.searchPublicUsers(R);return console.log("🔍 Search results:",v),v}catch(v){return console.error("Error searching users:",v),[]}},A={friends:o,friendRequests:r,friendActivity:m,leaderboard:c,loading:d,error:N,sendFriendRequest:j,acceptFriendRequest:y,declineFriendRequest:C,removeFriend:_,refreshFriendActivity:B,refreshLeaderboard:D,searchUsers:S};return e.jsx(Pt.Provider,{value:A,children:u})},Vs=({onClose:u})=>{const[t,a]=E.useState(!1),[o,s]=E.useState(""),[r,n]=E.useState(""),[m,l]=E.useState(!1),[c,f]=E.useState(!1),{signIn:d,signUp:h,error:N,clearError:i,continueAsGuest:w}=oe(),g={colors:{background:"#F7F5F3",surface:"#FFFFFF",borderLight:"#F0EDE8",border:"#E8E3DD",primary:"#8B7355",textPrimary:"#3A3A3A",textSecondary:"#8B7355"}},k=async b=>{if(b.preventDefault(),!(!o.trim()||!r.trim())){f(!0),i();try{let x;t?(x=await h(o.trim(),r),x.success&&(a(!1),n(""),alert("Account created successfully! Please sign in."))):(x=await d(o.trim(),r),x.success&&u&&u())}finally{f(!1)}}},p=()=>{a(!t),n(""),i()},T=()=>{w(),u&&u()};return e.jsxs("div",{className:"rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border",style:{backgroundColor:g.colors.surface,borderColor:g.colors.border},children:[e.jsxs("div",{className:"text-center mb-8",children:["        ",e.jsx("div",{className:"rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",style:{backgroundColor:g.colors.borderLight},children:e.jsx(K,{className:"w-8 h-8",style:{color:g.colors.primary}})}),e.jsx("h2",{className:"font-serif text-2xl font-medium mb-2",style:{color:g.colors.textPrimary},children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{style:{color:g.colors.textSecondary},children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),"      ",e.jsxs("form",{onSubmit:k,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",style:{color:g.colors.textPrimary},children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:g.colors.textSecondary}}),e.jsx("input",{id:"username",type:"text",value:o,onChange:b=>s(b.target.value),className:"pl-10 pr-4 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:g.colors.background,borderColor:g.colors.border,color:g.colors.textPrimary},placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",style:{color:g.colors.textPrimary},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:g.colors.textSecondary}}),"            ",e.jsx("input",{id:"password",type:m?"text":"password",value:r,onChange:b=>n(b.target.value),className:"pl-10 pr-12 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:g.colors.background,borderColor:g.colors.border,color:g.colors.textPrimary},placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:opacity-70 transition-colors",style:{color:g.colors.textSecondary},children:m?e.jsx($t,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm mt-1",style:{color:g.colors.textSecondary},children:"Password must be at least 8 characters long"})]}),"        ",N&&e.jsx("div",{className:"border px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"#FEF2F2",borderColor:"#FCA5A5",color:"#DC2626"},children:N}),e.jsx("button",{type:"submit",disabled:c,className:"w-full text-white py-3 px-4 rounded-xl font-medium hover:opacity-90 focus:ring-2 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:g.colors.primary},children:c?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:T,className:"w-full py-3 px-4 rounded-xl font-medium focus:ring-2 focus:ring-offset-2 transition-all duration-200 border",style:{backgroundColor:g.colors.surface,color:g.colors.primary,borderColor:g.colors.border},children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center mt-2",style:{color:g.colors.textSecondary},children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{style:{color:g.colors.textSecondary},children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:p,className:"font-medium transition-colors underline hover:opacity-70",style:{color:g.colors.textPrimary},children:t?"Sign In":"Sign Up"})]})}),u&&e.jsx("button",{onClick:u,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},Qs=({children:u,fallback:t})=>{const{isAuthenticated:a,isLoading:o}=oe(),s={colors:{background:"#F7F5F3",surface:"#FFFFFF",border:"#E8E3DD",primary:"#8B7355",textSecondary:"#8B7355"}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.primary}}),e.jsx("p",{className:"font-medium",style:{color:s.colors.textSecondary},children:"Loading your reading world..."})]})}):a?e.jsx(e.Fragment,{children:u}):t||e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:s.colors.background},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(Vs,{})})})},Xs=()=>{const u=X(),t=[{icon:K,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:xt,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:ge,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:Le,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:le,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:Ht,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],a=[{icon:je,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:Yt,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:me,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen style={{backgroundColor: lightTheme.colors.background}} max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(K,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>u("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx(Ye,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>u("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((o,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(o.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:a.map((o,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(o.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>u("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx(Ye,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>u("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>u("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},Zs=({className:u=""})=>{const{theme:t,toggleTheme:a}=W();return e.jsx("button",{onClick:a,className:`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 ${u}`,style:{backgroundColor:t.colors.surfaceSecondary},onMouseEnter:o=>{o.currentTarget.style.backgroundColor=t.colors.border},onMouseLeave:o=>{o.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},title:`Switch to ${t.isDark?"light":"dark"} mode`,"aria-label":`Switch to ${t.isDark?"light":"dark"} mode`,children:t.isDark?e.jsx(pt,{size:16,style:{color:t.colors.warning}}):e.jsx(yt,{size:16,style:{color:t.colors.textSecondary}})})},er=({greeting:u})=>{var m;const t=X(),{pet:a}=ye(),{user:o}=oe(),{theme:s}=W(),r=(m=o==null?void 0:o.id)==null?void 0:m.startsWith("guest-"),n=()=>{const l=a.mood;return{happy:"😊",excited:"🤩",content:"😌",sad:"😢",sleepy:"😴",hungry:"🍎"}[l]||"😌"};return e.jsx("header",{className:"p-4 transition-colors duration-200",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:u}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Zs,{}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors duration-200",style:{backgroundColor:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=s.colors.surfaceSecondary},onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:n()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.colors.textPrimary},children:a.name}),e.jsxs("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:["Lv.",a.level]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200",style:{backgroundColor:r?s.colors.wantToRead:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=r?s.colors.wantToRead:s.colors.surfaceSecondary},onClick:()=>t("/profile"),title:r?"Guest User":"Profile",children:e.jsx(gt,{className:"w-5 h-5",style:{color:r?s.colors.wantToReadText:s.colors.textSecondary}})})]})]})})},tr=({onContinueReading:u})=>{const{currentBook:t,sessions:a,setActiveBook:o}=ce(),{theme:s}=W(),[r,n]=E.useState(!0);if(E.useEffect(()=>{if(t){const i=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(w=>w.key===t.key);n(i),i||o(null)}},[t,o]),!t||!r)return e.jsx("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed rounded-lg",style:{borderColor:s.colors.textSecondary},children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2",style:{color:s.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-1",style:{color:s.colors.textPrimary},children:"No book selected"}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Search for a book to start reading"})]})})});const m=[...a].sort((N,i)=>new Date(i.startTime).getTime()-new Date(N.startTime).getTime())[0],l=(m==null?void 0:m.endPage)||(m==null?void 0:m.startPage)||1,c=t.number_of_pages_median||0,f=c>0?Math.min(Math.round(l/c*100),100):0,d=c>0,h=d&&f>0;return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:s.colors.textPrimary},children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white p-2",style:{backgroundColor:s.colors.secondary},children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium line-clamp-2 mb-1",style:{color:s.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-2",style:{color:s.colors.textSecondary},children:["by ",t.author_name[0]]}),h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:s.colors.textSecondary},children:[e.jsxs("span",{children:[f,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 rounded-full overflow-hidden",style:{backgroundColor:s.colors.border},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${f}%`,backgroundColor:s.colors.primary}})})]}),e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",c]})]}):d?e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",c]}):e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Currently on page ",l,e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:u,className:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:s.colors.primary,color:s.colors.textInverse},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=s.colors.primaryLight},onMouseLeave:N=>{N.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(K,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},Pe=({icon:u,value:t,label:a,color:o})=>{const{theme:s}=W();return e.jsxs("div",{className:"flex flex-col items-center p-3 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full mb-1",style:{backgroundColor:o},children:u}),e.jsx("span",{className:"font-serif text-lg font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:a})]})},sr=()=>{const{theme:u}=W(),[t,a]=E.useState(Ne()),[o,s]=E.useState(fe());E.useEffect(()=>{const n=m=>{a(m.detail),s(fe())};return window.addEventListener("statsUpdated",n),a(Ne()),s(fe()),()=>{window.removeEventListener("statsUpdated",n)}},[]);const r=n=>{if(n<60)return`${n} min`;const m=Math.floor(n/60),l=n%60;return l===0?`${m} hrs`:`${m}.${Math.floor(l/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Pe,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:r(t.readingTimeToday),label:"Today",color:u.colors.primary}),e.jsx(Pe,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:r(t.readingTimeThisWeek),label:"This Week",color:u.colors.primaryDark}),e.jsx(Pe,{icon:e.jsx(Wt,{className:"w-5 h-5 text-white"}),value:t.totalBooksRead,label:"Books Read",color:u.colors.secondary}),e.jsx(Pe,{icon:e.jsx(Kt,{className:"w-5 h-5 text-white"}),value:o.currentStreak,label:"Streak",color:u.colors.primaryLight})]})},de=({icon:u,label:t,onClick:a})=>{const{theme:o}=W();return e.jsxs("button",{onClick:a,className:"flex flex-col items-center justify-center p-4 rounded-xl shadow-sm transition-colors duration-200",style:{backgroundColor:o.colors.surface},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=o.colors.surfaceSecondary},onMouseLeave:s=>{s.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full mb-2",style:{backgroundColor:o.colors.background},children:e.jsx(u,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm",style:{color:o.colors.textPrimary},children:t})]})},rr=({type:u,title:t,timestamp:a,duration:o})=>{const{theme:s}=W(),r=()=>{switch(u){case"reading":return e.jsx(re,{className:"w-4 h-4",style:{color:s.colors.primary}});case"note":return e.jsx(We,{className:"w-4 h-4",style:{color:s.colors.secondary}});case"completed":return e.jsx(We,{className:"w-4 h-4",style:{color:s.colors.success}})}},n=m=>{const l=new Date,c=new Date(m),f=Math.floor((l.getTime()-c.getTime())/(1e3*60));if(f<1)return"just now";if(f<60)return`${f} minute${f===1?"":"s"} ago`;const d=Math.floor(f/60);if(d<24)return`${d} hour${d===1?"":"s"} ago`;const h=Math.floor(d/24);return`${h} day${h===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b",style:{borderColor:s.colors.border},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.colors.surfaceSecondary},children:r()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:s.colors.textSecondary},children:[e.jsx("span",{children:n(a)}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[o," min"]})]})]})]})]})},or=()=>{const u=X(),{theme:t}=W(),o=[...Ie()].sort((r,n)=>new Date(n.startTime).getTime()-new Date(r.startTime).getTime()).slice(0,5),s=()=>{const r=new Date().getHours();return r<12?"Good morning":r<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:t.colors.background},children:[e.jsx(er,{greeting:s()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(tr,{onContinueReading:()=>u("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:he,label:"Find Books",onClick:()=>u("/search")}),e.jsx(de,{icon:ge,label:"My Notes",onClick:()=>u("/notes")}),e.jsx(de,{icon:zt,label:"My Library",onClick:()=>u("/library")}),e.jsx(de,{icon:Vt,label:"Statistics",onClick:()=>u("/stats")}),"          "]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Social"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:me,label:"Friends",onClick:()=>u("/friends")}),e.jsx(de,{icon:le,label:"Leaderboard",onClick:()=>u("/leaderboard")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Your Progress"}),e.jsx(sr,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-1",style:{color:t.colors.textPrimary},children:"Recent Activity"}),o.length>0?e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden",style:{backgroundColor:t.colors.surface},children:o.map(r=>e.jsx(rr,{type:"reading",title:"Reading session completed",timestamp:r.endTime||r.startTime,duration:r.duration||0},r.id))}):e.jsx("p",{className:"text-sm p-4 rounded-xl shadow-sm",style:{color:t.colors.textSecondary,backgroundColor:t.colors.surface},children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>u("/welcome"),className:"text-sm hover:underline transition-colors underline",style:{color:t.colors.textSecondary},onMouseEnter:r=>{r.currentTarget.style.color=t.colors.textPrimary},onMouseLeave:r=>{r.currentTarget.style.color=t.colors.textSecondary},children:"Learn more about Bookish features"})})]})]})},Be=({children:u,className:t=""})=>{const{theme:a}=W();return e.jsx("div",{className:`min-h-screen transition-colors duration-200 ${t}`,style:{backgroundColor:a.colors.background},children:u})},ar=()=>{const u=X(),{theme:t}=W(),[a,o]=E.useState(""),[s,r]=E.useState([]),[n,m]=E.useState(!1),[l,c]=E.useState("general"),[f,d]=E.useState(!1);E.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const h=async b=>{if(b.preventDefault(),!!a.trim()){m(!0);try{let x;l==="subject"?x=await Es(a):x=await js(a),r(x)}catch(x){console.error("Error searching books:",x)}finally{m(!1)}}},N=async()=>{try{d(!0),setTimeout(()=>{w()},300)}catch(b){console.error("Error starting camera:",b),alert("Unable to access camera. Please check permissions."),d(!1)}},i=()=>{try{Je(()=>import("./quagga.min-CA_kn7cW.js").then(b=>b.q),__vite__mapDeps([0,1])).then(b=>{const x=b.default;x.stop(),x.offDetected(),x.offProcessed(),console.log("Quagga stopped successfully")}).catch(b=>{console.log("Error stopping Quagga:",b)})}catch(b){console.log("Quagga cleanup error:",b)}d(!1)},w=async()=>{try{const b=document.querySelector("#barcode-scanner");if(!b){console.error("Scanner element not found");return}const j=(await Je(()=>import("./quagga.min-CA_kn7cW.js").then(_=>_.q),__vite__mapDeps([0,1]))).default,y={inputStream:{name:"Live",type:"LiveStream",target:b,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",y),j.init(y,_=>{if(_){console.error("QuaggaJS initialization failed:",_),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),i();return}console.log("QuaggaJS initialized successfully"),j.start(),console.log("QuaggaJS started")}),j.onDetected(_=>{const B=_.codeResult.code;console.log("Barcode detected:",B);const D=k(B);console.log("Cleaned barcode:",D),g(D)?(console.log("Valid ISBN detected, searching..."),p(D),i()):console.log("Invalid ISBN format, continuing scan...")});let C=0;j.onProcessed(_=>{C++,C%30===0&&console.log("Processing frames... Count:",C),_&&_.codeResult&&_.codeResult.code&&console.log("Potential code detected:",_.codeResult.code)})}catch(b){console.error("Error loading Quagga:",b),alert("Failed to load barcode scanner. Please try again."),i()}},g=b=>{const x=b.replace(/[^0-9X]/gi,"");return x.length===10||x.length===13},k=b=>b.replace(/[^0-9X]/gi,""),p=async b=>{m(!0);try{const x=await Ps(b);x?(r([x]),o(b)):alert("No book found for this barcode")}catch(x){console.error("Error searching by ISBN:",x),alert("Error scanning barcode")}finally{m(!1)}},T=b=>{u(`/book?book=${encodeURIComponent(b.key)}`,{state:{bookData:b}})};return e.jsx(Be,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",children:[e.jsxs("header",{className:"page-header p-4 shadow-sm",style:{backgroundColor:t.colors.surfaceSecondary},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors",style:{backgroundColor:t.colors.surface},onMouseEnter:b=>{b.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsxs("form",{onSubmit:h,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:b=>o(b.target.value),placeholder:l==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 border rounded-lg focus:outline-none focus:ring-2 input-field",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.textPrimary}}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full text-white",style:{backgroundColor:t.colors.primary},children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:N,className:"w-10 h-10 flex items-center justify-center rounded-full text-white transition-colors",style:{backgroundColor:t.colors.primary},onMouseEnter:b=>{b.currentTarget.style.backgroundColor=t.colors.primaryLight},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=t.colors.primary},children:e.jsx(Ke,{className:"w-5 h-5"})})]}),"        ",e.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:t.colors.surface},children:[e.jsxs("button",{onClick:()=>c("general"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="general"?t.colors.primary:"transparent",color:l==="general"?"white":t.colors.textSecondary},children:[e.jsx(he,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>c("subject"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="subject"?t.colors.primary:"transparent",color:l==="subject"?"white":t.colors.textSecondary},children:[e.jsx(ze,{className:"w-4 h-4"}),"Subject"]})]})]}),f&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded-lg p-4 m-4 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:e.jsx(De,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"📷"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none",style:{border:`2px solid ${t.colors.primary}`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{borderTop:`2px solid ${t.colors.primary}`}})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm mb-2",style:{color:t.colors.textSecondary},children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs mb-2",style:{color:t.colors.textSecondary},children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs italic",style:{color:t.colors.textSecondary},children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4",style:{borderTop:`1px solid ${t.colors.border}`},children:e.jsx("button",{onClick:()=>{const b=prompt("Enter ISBN manually (if barcode scan fails):");b&&(p(b.trim()),i())},className:"text-xs underline",style:{color:t.colors.primary},children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2",style:{borderTopColor:t.colors.primary,borderBottomColor:t.colors.primary}})}):s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:l==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:s.map(b=>e.jsxs("div",{onClick:()=>T(b),className:"flex gap-4 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:[b.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${b.cover_i}-M.jpg`,alt:b.title,className:"w-full h-full object-cover",onError:x=>{var y;const j=x.target;j.style.display="none",(y=j.nextElementSibling)==null||y.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${b.cover_i?"hidden":""}`,children:e.jsx(K,{className:"w-6 h-6",style:{color:t.colors.textSecondary}})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:t.colors.textPrimary},children:b.title}),b.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:t.colors.textSecondary},children:["by ",b.author_name[0]]}),b.first_publish_year&&e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:b.first_publish_year})]})]},b.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(he,{className:"w-12 h-12 mb-4 opacity-70",style:{color:t.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Find your next great read"}),e.jsx("p",{className:"text-sm max-w-xs mb-4",style:{color:t.colors.textSecondary},children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",style:{color:t.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),"Browse"]})]})]})})]})})},Ce=({isOpen:u,onClose:t,onConfirm:a,title:o,message:s,type:r="confirm",confirmText:n="Confirm",cancelText:m="Cancel"})=>{const{theme:l}=W();if(!u)return null;const c=()=>{switch(r){case"alert":return e.jsx(Ve,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(Xt,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(Qt,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Ve,{className:"w-8 h-8",style:{color:l.colors.primary}})}},f=()=>{a&&a(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl shadow-xl w-full max-w-sm mx-auto",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:o})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(De,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm leading-relaxed mb-6",style:{color:l.colors.textPrimary},children:s}),e.jsxs("div",{className:"flex gap-3",children:[r==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:m}),e.jsx("button",{onClick:f,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${r==="success"?"bg-green-600 text-white hover:bg-green-700":r==="alert"?"bg-red-600 text-white hover:bg-red-700":"text-white hover:opacity-80"}`,style:r==="confirm"?{backgroundColor:l.colors.primary}:{},children:r==="confirm"?n:"OK"})]})]})})})},Te=()=>{const[u,t]=E.useState(!1),[a,o]=E.useState({title:"",message:""}),[s,r]=E.useState(null);return{isOpen:u,config:a,onConfirm:s,close:()=>{t(!1),r(null)},showConfirm:(c,f,d,h)=>{o({title:c,message:f,type:"confirm",confirmText:h==null?void 0:h.confirmText,cancelText:h==null?void 0:h.cancelText}),r(()=>d),t(!0)},showAlert:(c,f,d="info")=>{o({title:c,message:f,type:d}),r(null),t(!0)}}},nr=()=>{const u=X(),[t]=ft(),a=Ft(),{books:o,setActiveBook:s,sessions:r,notes:n,addBook:m,updatePublicStatsAfterBookCompletion:l}=ce(),{refreshLeaderboard:c}=ke(),{updatePetFromBookCompletion:f}=ye(),{theme:d}=W(),[h,N]=E.useState(!1),[i,w]=E.useState(null),[g,k]=E.useState(!1),[p,T]=E.useState(!1),[b,x]=E.useState(!1),j=Te(),y=t.get("book");if(E.useEffect(()=>{var U;if((U=a.state)!=null&&U.bookData)w(a.state.bookData);else{const L=o.find(M=>M.key===y);if(L)w(L);else{u("/");return}}},[y,o,a.state,u]),E.useEffect(()=>{if(i){const L=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(q=>q.key===i.key);k(L);const M=Nt(i.key);if(M&&M.description&&!i.description){w(q=>({...q,description:M.description,number_of_pages_median:M.number_of_pages_median||q.number_of_pages_median}));return}i.description||(N(!0),Ns(i.key).then(q=>{if(q){const z={...i,description:q.description,number_of_pages_median:q.number_of_pages_median||i.number_of_pages_median};w(z),ct(z)}}).catch(q=>{console.error("Error fetching book details:",q),M&&w(z=>({...z,...M}))}).finally(()=>{N(!1)}))}},[i]),!i)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>u("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const C=async U=>{const L=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!L.some(M=>M.key===i.key)){const M={...i,category:U==="want-to-read"?"wishlist":"reading",dateAdded:new Date().toISOString()};await m(M),L.push(M),localStorage.setItem("bookish_books",JSON.stringify(L)),ct(M);const q=JSON.parse(localStorage.getItem("myBooks")||"[]");q.some(z=>z.key===i.key)||(q.push(M),localStorage.setItem("myBooks",JSON.stringify(q))),k(!0),T(!1),U==="currently-reading"&&(s(i),u("/reading"))}},_=()=>{j.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{var He;const U={...i,category:"completed",completedAt:new Date().toISOString()};await m(U),await l();const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(be=>be.key===i.key?U:be);localStorage.setItem("bookish_books",JSON.stringify(M));const z=JSON.parse(localStorage.getItem("myBooks")||"[]").map(be=>be.key===i.key?U:be);localStorage.setItem("myBooks",JSON.stringify(z)),f(),setTimeout(()=>{c("week","books_read")},1e3),i.key===((He=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:He.key)&&s(null),j.showAlert("Congratulations!","🎉 You've completed the book and your pet gained experience!","success"),setTimeout(()=>{u("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},B=i.number_of_pages_median||0,D=[...r].filter(U=>U.bookId===i.key).sort((U,L)=>new Date(L.startTime).getTime()-new Date(U.startTime).getTime())[0],S=(D==null?void 0:D.endPage)||(D==null?void 0:D.startPage)||1,A=B>0?Math.min(Math.round(S/B*100),100):0,R=r.filter(U=>U.bookId===i.key).reduce((U,L)=>U+(L.duration||0),0),v=Math.floor(R/60),I=R%60,O=v>0?`${v} hr${v!==1?"s":""} ${I>0?`${I} min`:""}`:`${I} min`,G=n.filter(U=>U.bookId===i.key),$=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(U=>U.key===i.key),P=($==null?void 0:$.category)==="completed",F=()=>{u(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:d.colors.background},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:d.colors.background},children:e.jsx("button",{onClick:F,className:"w-8 h-8 flex items-center justify-center rounded-full hover:opacity-80 transition-colors",style:{backgroundColor:d.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:d.colors.primary}})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:i.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${i.cover_i}-M.jpg`,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:d.colors.primary},children:e.jsx(K,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium mb-2 leading-tight",style:{color:d.colors.textPrimary},children:i.title}),i.author_name&&i.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-3",style:{color:d.colors.textSecondary},children:["by ",i.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[i.first_publish_year&&e.jsxs("p",{className:"text-xs",style:{color:d.colors.textSecondary},children:["First published: ",i.first_publish_year]}),B>0&&e.jsxs("p",{className:"text-xs",style:{color:d.colors.textSecondary},children:[B," pages"]})]})]})]}),"        ",g&&B>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:d.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:d.colors.textPrimary},children:[A,"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden mb-2",style:{backgroundColor:d.colors.borderLight},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${A}%`,backgroundColor:d.colors.secondary}})}),e.jsxs("span",{className:"text-xs",style:{color:d.colors.textSecondary},children:["Page ",S," of ",B]})]}),e.jsx("div",{className:"w-px",style:{backgroundColor:d.colors.border}}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(xt,{className:"w-5 h-5 mb-1",style:{color:d.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:d.colors.textPrimary},children:O}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),h?e.jsx("div",{className:"h-32 animate-pulse rounded-lg mb-6",style:{backgroundColor:d.colors.borderLight}}):i.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:d.colors.textPrimary},children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm leading-relaxed ${b?"":"line-clamp-4"}`,style:{color:d.colors.textPrimary},children:typeof i.description=="string"?i.description:"No description available."}),i.description&&i.description.length>200&&e.jsx("button",{onClick:()=>x(!b),className:"mt-2 flex items-center gap-1 text-sm font-medium hover:opacity-80 transition-colors",style:{color:d.colors.textSecondary},children:b?e.jsxs(e.Fragment,{children:["Show less",e.jsx(Zt,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(es,{className:"w-4 h-4"})]})})]})]}):null,g&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>u("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),G.length>0?e.jsx("div",{className:"space-y-2",children:G.slice(0,2).map(U=>e.jsxs("div",{className:"p-3 rounded-lg shadow-sm",style:{backgroundColor:d.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:d.colors.textSecondary},children:[U.chapter?`Chapter: ${U.chapter}`:"",U.chapter&&U.page?" • ":"",U.page?`Page ${U.page}`:""]}),e.jsx("span",{className:"text-xs",style:{color:d.colors.textSecondary},children:new Date(U.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm line-clamp-2",style:{color:d.colors.textPrimary},children:U.content})]},U.id))}):e.jsx("div",{className:"p-4 rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:d.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-6 h-6 mx-auto mb-2",style:{color:d.colors.textSecondary}}),e.jsx("p",{className:"text-sm mb-1",style:{color:d.colors.textSecondary},children:"No notes yet"}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 border-t flex gap-4 max-w-md mx-auto",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border},children:g?e.jsx(e.Fragment,{children:P?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u("/notes/add"),className:"flex-1 py-3 px-4 border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:d.colors.surface},children:[e.jsx(ge,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(i),u("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:_,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(xe,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("/library"),className:"flex-1 py-3 px-4 border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",style:{backgroundColor:d.colors.surface},children:"View Library"}),e.jsxs("button",{onClick:()=>T(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),"      ",p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:d.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:d.colors.textPrimary},children:"Add to Library"}),e.jsx("p",{className:"text-sm mb-6",style:{color:d.colors.textSecondary},children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>C("want-to-read"),className:"w-full p-4 rounded-lg text-left hover:opacity-80 transition-colors",style:{backgroundColor:d.colors.borderLight},children:[e.jsx("div",{className:"font-medium mb-1",style:{color:d.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:d.colors.textSecondary},children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>C("currently-reading"),className:"w-full p-4 text-white rounded-lg text-left hover:opacity-90 transition-colors",style:{backgroundColor:d.colors.primary},children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>T(!1),className:"w-full mt-4 py-2 text-sm hover:opacity-80 transition-colors",style:{color:d.colors.textSecondary},children:"Cancel"})]})}),e.jsx(Ce,{isOpen:j.isOpen,onClose:j.close,onConfirm:j.onConfirm||void 0,title:j.config.title,message:j.config.message,type:j.config.type,confirmText:j.config.confirmText,cancelText:j.config.cancelText})]})},V=[];for(let u=0;u<256;++u)V.push((u+256).toString(16).slice(1));function lr(u,t=0){return(V[u[t+0]]+V[u[t+1]]+V[u[t+2]]+V[u[t+3]]+"-"+V[u[t+4]]+V[u[t+5]]+"-"+V[u[t+6]]+V[u[t+7]]+"-"+V[u[t+8]]+V[u[t+9]]+"-"+V[u[t+10]]+V[u[t+11]]+V[u[t+12]]+V[u[t+13]]+V[u[t+14]]+V[u[t+15]]).toLowerCase()}let Oe;const ir=new Uint8Array(16);function cr(){if(!Oe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Oe=crypto.getRandomValues.bind(crypto)}return Oe(ir)}const dr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ut={randomUUID:dr};function Se(u,t,a){var s;if(ut.randomUUID&&!u)return ut.randomUUID();u=u||{};const o=u.random??((s=u.rng)==null?void 0:s.call(u))??cr();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,lr(o)}const ue="bookish_active_timer",ur=({bookId:u,startPage:t})=>{const[a,o]=E.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=E.useRef();E.useEffect(()=>{const d=localStorage.getItem(ue);if(d)try{const h=JSON.parse(d);h.bookId===u?o(h.timerState):localStorage.removeItem(ue)}catch(h){console.error("Error loading timer state:",h),localStorage.removeItem(ue)}},[u]),E.useEffect(()=>{a.sessionId&&localStorage.setItem(ue,JSON.stringify({bookId:u,startPage:t,timerState:a}))},[a,u,t]),E.useEffect(()=>(a.isActive?s.current=setInterval(()=>{o(d=>({...d}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[a.isActive]);const r=()=>{if(!a.startTime)return 0;let d=a.totalElapsed;if(a.isActive&&a.lastPauseTime===null){const h=Date.now(),N=new Date(a.startTime).getTime();d+=Math.floor((h-N)/1e3)}return d},n=r(),m=()=>{const d=new Date().toISOString();a.sessionId?o(h=>({...h,startTime:d,lastPauseTime:null,isActive:!0})):o({sessionId:Se(),startTime:d,totalElapsed:0,lastPauseTime:null,isActive:!0})},l=()=>{if(!a.isActive||!a.startTime)return;const d=Date.now(),h=new Date(a.startTime).getTime(),N=Math.floor((d-h)/1e3);o(i=>({...i,totalElapsed:i.totalElapsed+N,lastPauseTime:new Date().toISOString(),isActive:!1}))},c=d=>{const h=r(),N={id:a.sessionId||Se(),bookId:u,startTime:a.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:d,duration:Math.floor(h/60)};return o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue),N},f=()=>{o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue)};return{isActive:a.isActive,elapsedTime:n,startTimer:m,pauseTimer:l,stopTimer:c,resetTimer:f}},mr=()=>{const u=X(),{currentBook:t,addSession:a,addNote:o,addBook:s,updatePublicStatsAfterBookCompletion:r}=ce(),{refreshLeaderboard:n}=ke(),{updatePetFromReading:m}=ye(),{theme:l}=W(),c=Te(),[f,d]=E.useState(1),[h,N]=E.useState(1),[i,w]=E.useState(!1),[g,k]=E.useState(""),[p,T]=E.useState(""),[b,x]=E.useState(!1),[j,y]=E.useState(!1),{isActive:C,elapsedTime:_,startTimer:B,pauseTimer:D,stopTimer:S,resetTimer:A}=ur({bookId:(t==null?void 0:t.key)||"",startPage:1});if(E.useEffect(()=>{if(t&&!j){const P=localStorage.getItem("bookish_active_timer");if(P)try{const L=JSON.parse(P);if(L.bookId===t.key){d(L.startPage),N(L.startPage),y(!0);return}}catch(L){console.error("Error parsing active timer:",L)}const U=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(L=>L.bookId===t.key);if(U.length>0){U.sort((M,q)=>new Date(q.startTime).getTime()-new Date(M.startTime).getTime());const L=U[0].endPage||U[0].startPage;d(L),N(L)}y(!0)}},[t,j]),E.useEffect(()=>{const P=F=>{C&&(F.preventDefault(),F.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",P),()=>window.removeEventListener("beforeunload",P)},[C]),!t)return u("/"),null;const R=()=>{try{if(!t){c.showAlert("Error","No book selected","alert");return}if(h<f){c.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(_<=0){c.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const P=S(h);if(!P)throw new Error("Failed to create session");if(a(P),P.duration&&m(P.duration),g.trim()){const F={id:Se(),bookId:t.key,page:h,chapter:p.trim()||void 0,content:g.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(F)}u("/")}catch(P){console.error("Error finishing session:",P),c.showAlert("Error","Failed to save reading session. Please try again.","alert")}},v=P=>{const F=Math.floor(P/3600),U=Math.floor(P%3600/60),L=P%60;return F>0?`${F}:${U.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`:`${U.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`},I=t.number_of_pages_median||9999,O=t.number_of_pages_median&&t.number_of_pages_median>0,G=()=>{const P=(t==null?void 0:t.number_of_pages_median)||0;return P>0&&h>=P},H=P=>{const F=Math.max(f,Math.min(P,I));N(F),t!=null&&t.number_of_pages_median&&F>=t.number_of_pages_median&&x(!0)},$=async()=>{try{const P=S(h);if(P&&(a(P),P.duration&&m(P.duration)),g.trim()){const z={id:Se(),bookId:t.key,page:h,chapter:p.trim()||void 0,content:g.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(z)}const F={...t,category:"completed",completedAt:new Date().toISOString()};await s(F),await r();const L=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(z=>z.key===t.key?F:z);localStorage.setItem("bookish_books",JSON.stringify(L));const q=JSON.parse(localStorage.getItem("myBooks")||"[]").map(z=>z.key===t.key?{...z,category:"completed",completedAt:new Date().toISOString()}:z);localStorage.setItem("myBooks",JSON.stringify(q)),localStorage.removeItem("bookish_current_book"),m((P==null?void 0:P.duration)||0,!0),setTimeout(()=>{n("week","books_read")},1e3),c.showAlert("Congratulations!","🎉 You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{u("/library")},2e3)}catch(P){console.error("Error marking book as finished:",P),c.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",style:{backgroundColor:l.colors.background},children:[e.jsxs("header",{className:"p-4 flex items-center gap-3 shadow-sm",style:{backgroundColor:l.colors.surface},children:[e.jsx("button",{onClick:()=>{C||_>0?c.showConfirm("Leave Reading Session",C?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!C&&_>0?R():u(-1)},{confirmText:C?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):u(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:"Reading Session"}),C&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center p-4",style:{borderBottom:`1px solid ${l.colors.border}`},children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:Ts(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full",style:{backgroundColor:l.colors.secondary}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium line-clamp-1",style:{color:l.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm",style:{color:l.colors.textSecondary},children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center shadow-inner",style:{backgroundColor:l.colors.borderLight},children:e.jsx("span",{className:"font-serif text-2xl font-medium",style:{color:l.colors.textPrimary},children:v(_)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:C?D:B,className:"w-16 h-16 rounded-full text-white flex items-center justify-center shadow-md transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},children:C?e.jsx(ss,{className:"w-8 h-8"}):e.jsx(rs,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Start Page"}),e.jsx("input",{type:"number",value:f,onChange:P=>{const F=Math.max(1,Math.min(parseInt(P.target.value)||1,I));d(F),h<F&&N(F)},min:"1",max:I,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary},disabled:C||_>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"End Page"}),e.jsx("input",{type:"number",value:h,onChange:P=>H(parseInt(P.target.value)||f),min:f,max:I,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]}),G()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:$,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!O&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"📘 Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>w(!i),className:"w-full py-2 text-sm mb-2",style:{color:l.colors.primary},children:i?"Hide Note Form":"+ Add a note about this session"}),i&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 rounded-lg",style:{backgroundColor:l.colors.borderLight},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:p,onChange:P=>T(P.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Note"}),e.jsx("textarea",{value:g,onChange:P=>k(P.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 rounded-md resize-none",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 flex gap-4 max-w-md mx-auto",style:{backgroundColor:l.colors.surface,borderTop:`1px solid ${l.colors.border}`},children:[e.jsxs("button",{onClick:()=>{c.showConfirm("Cancel Session",C?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{A(),u(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:[e.jsx(De,{className:"w-5 h-5"}),"Cancel"]}),G()?e.jsxs("button",{onClick:$,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-green-700 transition-colors",children:[e.jsx(le,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:R,className:"flex-1 py-3 px-4 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},disabled:_<=0||h<f,children:[e.jsx(xe,{className:"w-5 h-5"}),"Finish Session"]})]}),"      ",b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(le,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:l.colors.textPrimary},children:"Congratulations!"}),e.jsxs("p",{className:"text-sm mb-6",style:{color:l.colors.textSecondary},children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:$,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>x(!1),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:"Continue Reading"})]})]})})}),e.jsx(Ce,{isOpen:c.isOpen,onClose:c.close,onConfirm:c.onConfirm||void 0,title:c.config.title,message:c.config.message,type:c.config.type,confirmText:c.config.confirmText,cancelText:c.config.cancelText})]})},hr=()=>{const u=X(),{books:t,addBook:a,updatePublicStatsAfterBookCompletion:o}=ce(),{refreshLeaderboard:s}=ke(),{updatePetFromBookCompletion:r}=ye(),{theme:n}=W(),m=Te(),[l,c]=E.useState(null),[f,d]=E.useState(null),[h,N]=E.useState({}),[i,w]=E.useState([]);E.useEffect(()=>{(()=>{const A=JSON.parse(localStorage.getItem("bookish_books")||"[]");w(A)})()},[]),E.useEffect(()=>{const S=()=>{c(null)};if(l)return document.addEventListener("click",S),()=>document.removeEventListener("click",S)},[l]);const g=i.length>0?i:t,k=S=>{u(`/book?book=${S.key}`,{state:{bookData:S}})},p=(S,A)=>{A.stopPropagation(),m.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const v=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter($=>$.key!==S);localStorage.setItem("bookish_books",JSON.stringify(v));const O=JSON.parse(localStorage.getItem("myBooks")||"[]").filter($=>$.key!==S);localStorage.setItem("myBooks",JSON.stringify(O));const G=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete G[S],localStorage.setItem("bookish_cached_books",JSON.stringify(G));const H=JSON.parse(localStorage.getItem("bookish_current_book")||"null");H&&H.key===S&&localStorage.removeItem("bookish_current_book"),w(v)},{confirmText:"Remove",cancelText:"Keep Book"}),c(null)},T=async(S,A,R)=>{const v=JSON.parse(localStorage.getItem("bookish_books")||"[]"),I=v.find(P=>P.key===S);if(!I)return;const O={...I,category:A,...A==="completed"&&{completedAt:new Date().toISOString()}};await a(O);const G=v.map(P=>P.key===S?O:P);localStorage.setItem("bookish_books",JSON.stringify(G));const $=JSON.parse(localStorage.getItem("myBooks")||"[]").map(P=>P.key===S?O:P);localStorage.setItem("myBooks",JSON.stringify($)),await _e(),w(G),d(null),c(null),A==="completed"&&await o()},b=(S,A)=>{A.stopPropagation(),m.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{await T(S,"completed"),await o(),r(),setTimeout(()=>{s("week","books_read")},1e3),setTimeout(()=>{m.showAlert("Book Completed!","🎉 Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),c(null)},x=(S,A)=>{A.stopPropagation(),c(l===S?null:S)},j=S=>{const A=dt(S);if(A.length===0)return 0;const R=A[A.length-1],v=t.find(I=>I.key===S);return!(v!=null&&v.number_of_pages_median)||!R.endPage?0:Math.min(100,Math.round(R.endPage/v.number_of_pages_median*100))},y=S=>dt(S).reduce((R,v)=>R+(v.duration||0),0),C=S=>{const A=Math.floor(S/60),R=S%60;return A>0?`${A}h ${R}m`:`${R}m`},_=()=>{const S=[],A=[],R=[];return g.forEach(v=>{const I=j(v.key),O=y(v.key);v.category==="want-to-read"?R.push(v):v.category==="completed"||I>=100?A.push(v):v.category==="currently-reading"||I>0||O>0?S.push(v):R.push(v)}),{currentlyReading:S,completed:A,wantToRead:R}},B=S=>{const A=j(S.key),R=y(S.key),v=h[S.key]||{translateX:0,isDeleting:!1},I=P=>{const F=P.touches[0];N(U=>({...U,[S.key]:{...v,startX:F.clientX,startY:F.clientY}}))},O=P=>{const F=P.touches[0],U=h[S.key];if(!(U!=null&&U.startX)||!(U!=null&&U.startY))return;const L=F.clientX-U.startX,M=F.clientY-U.startY;Math.abs(M)>Math.abs(L)||L<-20&&N(q=>({...q,[S.key]:{...U,translateX:Math.max(L,-120)}}))},G=()=>{const P=h[S.key];P&&(P.translateX<-60?N(F=>({...F,[S.key]:{...P,translateX:-120,isDeleting:!0}})):N(F=>({...F,[S.key]:{...P,translateX:0,isDeleting:!1}})))},H=()=>{m.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const F=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(M=>M.key!==S.key);localStorage.setItem("bookish_books",JSON.stringify(F));const L=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(M=>M.key!==S.key);localStorage.setItem("myBooks",JSON.stringify(L)),w(F),N(M=>{const q={...M};return delete q[S.key],q})},{confirmText:"Remove",cancelText:"Keep Book"})},$=()=>{N(P=>({...P,[S.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{backgroundColor:n.colors.surface,transform:`translateX(${v.translateX}px)`,transition:v.isDeleting||v.translateX===0?"transform 0.3s ease":"none",overflow:v.isDeleting?"hidden":"visible"},onTouchStart:I,onTouchMove:O,onTouchEnd:G,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!v.isDeleting&&k(S),children:["          ",e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 flex items-center justify-center",style:{backgroundColor:n.colors.borderLight},children:[S.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${S.cover_i}-M.jpg`,alt:S.title,className:"w-full h-full object-cover rounded",onError:P=>{var U;const F=P.target;F.style.display="none",(U=F.nextElementSibling)==null||U.classList.remove("hidden")}}):null,e.jsx(K,{className:`w-6 h-6 ${S.cover_i?"hidden":""}`,style:{color:n.colors.textSecondary}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:n.colors.textPrimary},children:S.title}),S.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:n.colors.textSecondary},children:["by ",S.author_name[0]]}),A>0&&A<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:[A,"%"]})]}),e.jsx("div",{className:"w-full rounded-full h-1.5",style:{backgroundColor:n.colors.borderLight},children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${A}%`,backgroundColor:n.colors.secondary}})})]}),A>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),R>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:n.colors.textSecondary},children:[e.jsx(re,{className:"w-3 h-3"}),e.jsxs("span",{children:[C(R)," read"]})]})]})]}),!v.isDeleting&&e.jsx("button",{onClick:P=>x(S.key,P),className:"absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:e.jsx(os,{className:"w-4 h-4",style:{color:n.colors.textSecondary}})}),"        ",l===S.key&&!v.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 rounded-lg shadow-lg py-1 z-50 min-w-[180px]",style:{backgroundColor:n.colors.surface,border:`1px solid ${n.colors.border}`},children:[e.jsxs("button",{onClick:P=>{P.stopPropagation(),d(S.key),c(null)},className:"flex items-center gap-2 px-3 py-2 text-sm w-full text-left transition-colors hover:opacity-80",style:{color:n.colors.textSecondary,backgroundColor:"transparent"},onMouseEnter:P=>P.currentTarget.style.backgroundColor=n.colors.borderLight,onMouseLeave:P=>P.currentTarget.style.backgroundColor="transparent",children:[e.jsx(as,{className:"w-4 h-4"}),"Move to category"]}),S.category!=="completed"&&e.jsxs("button",{onClick:P=>b(S.key,P),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(xe,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:P=>p(S.key,P),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(vt,{className:"w-4 h-4"}),"Remove from library"]})]}),v.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:["              ",e.jsx("button",{onClick:$,className:"px-3 py-1 text-xs text-red-500 rounded",style:{backgroundColor:n.colors.surface},children:"Cancel"}),e.jsx("button",{onClick:H,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},S.key)},D=(S,A)=>A.length===0?null:e.jsxs("div",{className:"mb-8",children:["        ",e.jsxs("h2",{className:"font-serif text-lg font-medium mb-4 flex items-center gap-2",style:{color:n.colors.textPrimary},children:[S,e.jsxs("span",{className:"text-sm font-normal",style:{color:n.colors.textSecondary},children:["(",A.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:A.map(B)})]});return e.jsx(Be,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:n.colors.background,borderColor:n.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:n.colors.surfaceSecondary},children:e.jsx(ee,{className:"w-5 h-5",style:{color:n.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:n.colors.textPrimary},children:"My Library"})]})}),e.jsx("main",{className:"p-4",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4",style:{color:n.colors.textSecondary}}),"            ",e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:n.colors.textPrimary},children:"No books yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>u("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:n.colors.secondary},children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:n.colors.textSecondary},children:[g.length," book",g.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:S,completed:A,wantToRead:R}=_();return e.jsxs(e.Fragment,{children:[D("Currently Reading",S),D("Want to Read",R),D("Completed",A)]})})()]})}),f&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:["          ",e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:n.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:n.colors.textPrimary},children:"Move Book"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>T(f,"want-to-read"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>T(f,"currently-reading"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Currently Reading"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>T(f,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>d(null),className:"w-full mt-4 py-2 text-sm transition-colors hover:opacity-80",style:{color:n.colors.textSecondary},children:"Cancel"}),"          "]})]}),"      ",e.jsx(Ce,{isOpen:m.isOpen,onClose:m.close,onConfirm:m.onConfirm||void 0,title:m.config.title,message:m.config.message,type:m.config.type,confirmText:m.config.confirmText,cancelText:m.config.cancelText})]})})},fr=()=>{const u=X(),{books:t}=ce(),{pet:a}=ye(),{theme:o}=W(),[s,r]=E.useState(Ne()),[n,m]=E.useState(fe()),l=Ie();E.useEffect(()=>{const i=w=>{r(w.detail),m(fe())};return window.addEventListener("statsUpdated",i),r(Ne()),m(fe()),()=>{window.removeEventListener("statsUpdated",i)}},[]);const c=i=>{const w=Math.floor(i/60),g=i%60;return w>0?`${w}h ${g}m`:`${g}m`},f=()=>{if(l.length===0)return 0;const i=l.reduce((w,g)=>w+(g.duration||0),0);return Math.round(i/l.length)},h=(()=>{const i=new Date,w=new Date(i.getFullYear(),i.getMonth(),1),g=l.filter(T=>new Date(T.startTime)>=w),k=g.reduce((T,b)=>T+(b.duration||0),0),p=g.reduce((T,b)=>T+((b.endPage||0)-(b.startPage||0)),0);return{time:k,pages:p,sessions:g.length}})(),N=({icon:i,title:w,value:g,subtitle:k})=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(i,{className:"w-4 h-4",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:w})]}),e.jsx("p",{className:"text-2xl font-serif font-medium mb-1",style:{color:o.colors.textPrimary},children:g}),k&&e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:k})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:o.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:o.colors.background,borderBottom:`1px solid ${o.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:o.colors.textPrimary},children:"Reading Statistics"})]})}),"      ",e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(N,{icon:K,title:"Books Read",value:s.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(N,{icon:re,title:"Total Time",value:c(s.totalReadingTime),subtitle:"all time"}),e.jsx(N,{icon:je,title:"Pages Read",value:s.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(N,{icon:Qe,title:"Current Streak",value:`${n.currentStreak} days`,subtitle:`longest: ${n.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ge,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsx("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.sessions}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:c(h.time)}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.pages}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"pages"})]})]})]})})]}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(N,{icon:re,title:"Today",value:c(s.readingTimeToday)}),e.jsx(N,{icon:Ge,title:"This Week",value:c(s.readingTimeThisWeek)}),e.jsx(N,{icon:je,title:"Average Session",value:c(f())}),e.jsx(N,{icon:K,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Reading Companion"}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ns,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:[a.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.level}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:[a.happiness,"%"]}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.experience}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"experience"})]})]})]})]}),l.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Qe,{className:"w-16 h-16 mx-auto mb-4",style:{color:o.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:o.colors.textPrimary},children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm mb-6",style:{color:o.colors.textSecondary},children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>u("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:o.colors.secondary},children:"Find a Book to Read"})]})]})]})},gr=()=>{const u=X(),{notes:t,books:a,deleteNote:o}=ce(),{theme:s}=W(),r=Te(),n=c=>{r.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{o(c)},{confirmText:"Delete",cancelText:"Cancel"})},m=c=>{const f=a.find(d=>d.key===c);return f?f.title:"Unknown Book"},l=c=>new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:s.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:s.colors.background,borderBottom:`1px solid ${s.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:s.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:"My Notes"})]}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.secondary},children:e.jsx(bt,{className:"w-5 h-5 text-white"})})]})}),"      ",e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4",style:{color:s.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:s.colors.textPrimary},children:"No notes yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:s.colors.textSecondary},children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:s.colors.secondary},children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(c=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4",style:{color:s.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:s.colors.textPrimary},children:m(c.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:s.colors.textSecondary},children:[c.chapter&&e.jsxs("span",{children:["Chapter: ",c.chapter]}),c.page&&e.jsxs("span",{children:["Page ",c.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{children:l(c.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>n(c.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(vt,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",style:{color:s.colors.textPrimary},children:c.content})})]},c.id))]})}),e.jsx(Ce,{isOpen:r.isOpen,onClose:r.close,onConfirm:r.onConfirm||void 0,title:r.config.title,message:r.config.message,type:r.config.type,confirmText:r.config.confirmText,cancelText:r.config.cancelText})]})},xr=()=>{const u=X(),[t]=ft(),{books:a,currentBook:o,addNote:s,notes:r,updateNote:n}=ce(),{theme:m}=W(),l=Te(),c=t.get("edit"),[f,d]=E.useState((o==null?void 0:o.key)||""),[h,N]=E.useState(""),[i,w]=E.useState(""),[g,k]=E.useState("");E.useEffect(()=>{var b;if(c){const x=r.find(j=>j.id===c);x&&(d(x.bookId),N(x.content),w(((b=x.page)==null?void 0:b.toString())||""),k(x.chapter||""))}},[c,r]);const p=()=>{var x;if(!h.trim()){l.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const b={id:c||Se(),bookId:f,content:h.trim(),page:i?parseInt(i):void 0,chapter:g.trim()||void 0,createdAt:c?((x=r.find(j=>j.id===c))==null?void 0:x.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};c&&n?n(b):s(b),l.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{u("/notes")},1500)},T=()=>{h.trim()||g.trim()||i.trim()?l.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{u(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):u(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:m.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:m.colors.background,borderColor:m.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:T,className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:m.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:m.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:m.colors.textPrimary},children:c?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(ls,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:f,onChange:b=>d(b.target.value),className:"w-full p-3 pr-10 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] appearance-none",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary},children:[e.jsx("option",{value:"",children:"Choose a book..."}),a.map(b=>e.jsx("option",{value:b.key,children:b.title},b.key))]}),e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:m.colors.textSecondary}})]})]}),"        ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:g,onChange:b=>k(b.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Page (optional)"}),e.jsx("input",{type:"number",value:i,onChange:b=>w(b.target.value),placeholder:"Page number",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}})]})]}),"        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Your Note"}),e.jsx("textarea",{value:h,onChange:b=>N(b.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] resize-none",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}}),e.jsxs("p",{className:"text-xs mt-2",style:{color:m.colors.textSecondary},children:[h.length,"/500 characters"]})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:m.colors.surface},children:[e.jsx("h3",{className:"font-medium mb-2",style:{color:m.colors.textPrimary},children:"💡 Note-taking tips:"}),e.jsxs("ul",{className:"text-sm space-y-1",style:{color:m.colors.textSecondary},children:[e.jsx("li",{children:"• Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"• Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"• Record connections to other books or personal experiences"}),e.jsx("li",{children:"• Include your emotional reactions or reflections"})]})]})]}),e.jsx(Ce,{isOpen:l.isOpen,onClose:l.close,onConfirm:l.onConfirm||void 0,title:l.config.title,message:l.config.message,type:l.config.type,confirmText:l.config.confirmText,cancelText:l.config.cancelText})]})},pr=()=>{const u=X(),{theme:t}=W(),{pet:a,petStats:o,feedPet:s,playWithPet:r,petSleep:n,getPetMood:m,getPetEvolutionRequirement:l,resetPet:c,updatePetName:f,getPetEmoji:d,canEvolve:h,evolvePet:N}=ye(),[i,w]=E.useState(!1),[g,k]=E.useState(a.name),[p,T]=E.useState(!1),b=S=>S>70?"bg-green-500":S>40?"bg-yellow-500":"bg-red-500",x=S=>`${Math.max(0,Math.min(100,S))}%`,j=()=>{g.trim()&&(f(g.trim()),w(!1))},y=()=>{c(),T(!1)},C=S=>({"first-book":"📖","book-lover":"📚",bookworm:"🐛","speed-reader":"⚡","night-owl":"🦉","early-bird":"🐦"})[S]||"🏆",_=S=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[S]||"Special achievement",B=S=>{const A=Math.floor(S/60),R=S%60;return A>0?`${A}h ${R}m`:`${R}m`},D=l();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:["          ",e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"My Reading Pet"})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-6 text-center",style:{backgroundColor:t.colors.surface},children:[e.jsx("div",{className:"text-8xl mb-4",children:d()}),e.jsxs("div",{className:"mb-4",children:[i?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:g,onChange:S=>k(S.target.value),className:"text-2xl font-serif font-medium rounded px-3 py-1 border text-center",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary,borderColor:t.colors.border},onBlur:j,onKeyPress:S=>S.key==="Enter"&&j(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["                ",e.jsx("h2",{className:"text-2xl font-serif font-medium",style:{color:t.colors.textPrimary},children:a.name}),e.jsx("button",{onClick:()=>w(!0),className:"p-1 rounded transition-colors hover:opacity-80",style:{color:t.colors.textSecondary,backgroundColor:t.colors.borderLight},children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg mb-2",style:{color:t.colors.textSecondary},children:[e.jsxs("span",{children:["Level ",a.level]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:a.evolutionStage})]}),h()&&e.jsxs("button",{onClick:N,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["✨ Evolve to ",D.stage,"!"]})]}),"          ",e.jsx("p",{className:"mb-4",style:{color:t.colors.textPrimary},children:m()}),e.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold mb-1",style:{color:t.colors.primary},children:["💰 ",a.points]}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Care Points (Earned from reading)"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",style:{color:t.colors.textSecondary},children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[a.experience,"/",a.experienceToNext]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${a.experience/a.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:s,disabled:a.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Xe,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"💰 3 pts"})]}),e.jsxs("button",{onClick:r,disabled:a.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Le,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"💰 5 pts"})]}),e.jsxs("button",{onClick:n,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(Ze,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),"                ",e.jsxs("span",{children:[a.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${b(a.happiness)} rounded-full transition-all duration-300`,style:{width:x(a.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),"                ",e.jsxs("span",{children:[a.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${b(a.hunger)} rounded-full transition-all duration-300`,style:{width:x(a.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),"                ",e.jsxs("span",{children:[a.energy,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${b(a.energy)} rounded-full transition-all duration-300`,style:{width:x(a.energy)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[a.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${b(a.health)} rounded-full transition-all duration-300`,style:{width:x(a.health)}})})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:["            ",e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:a.totalBooksRead}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:B(a.totalReadingTime)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:o.booksReadToday}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:B(o.readingTimeToday)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Time"})]})]})]}),"        ",a.badges.length>0&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.badges.map((S,A)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl",children:C(S)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize text-sm",style:{color:t.colors.textPrimary},children:S.replace("-"," ")}),e.jsx("div",{className:"text-xs",style:{color:t.colors.textSecondary},children:_(S)})]})]},A))})]}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Pet Management"}),e.jsx("p",{className:"text-sm mb-4",style:{color:t.colors.textSecondary},children:"Reset your pet to start over with a new companion. This action cannot be undone."}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(is,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},At=({message:u,type:t,onClose:a})=>{const o={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"✓",error:"✕",info:"ℹ"}[t];return ht.useEffect(()=>{const r=setTimeout(()=>{a()},3e3);return()=>clearTimeout(r)},[a]),e.jsxs("div",{className:`fixed top-4 right-4 ${o} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:u}),e.jsx("button",{onClick:a,className:"ml-2 text-white hover:text-gray-200",children:"✕"})]})},mt=({className:u="",showLabel:t=!0})=>{const{theme:a,toggleTheme:o}=W();return e.jsxs("div",{className:`flex items-center gap-3 ${u}`,children:[t&&e.jsx("span",{className:"text-sm font-medium",style:{color:a.colors.textPrimary},children:"Theme"}),e.jsx("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`,color:a.colors.textPrimary},"aria-label":`Switch to ${a.isDark?"light":"dark"} mode`,children:e.jsx("div",{className:"flex items-center gap-2",children:a.isDark?e.jsxs(e.Fragment,{children:[e.jsx(pt,{size:16,style:{color:a.colors.warning}}),t&&e.jsx("span",{className:"text-sm",children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{size:16,style:{color:a.colors.textSecondary}}),t&&e.jsx("span",{className:"text-sm",children:"Dark"})]})})})]})},yr=()=>{var x;const{user:u,signOut:t,updateProfile:a}=oe(),{theme:o}=W(),s=X(),[r,n]=E.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[m,l]=E.useState(!1),[c,f]=E.useState(!1),[d,h]=E.useState(""),[N,i]=E.useState(null),w=(x=u==null?void 0:u.id)==null?void 0:x.startsWith("guest-");E.useEffect(()=>{u&&g()},[u]),E.useEffect(()=>{u!=null&&u.profile&&!w&&n({displayName:u.profile.displayName||"",bio:u.profile.bio||"",favoriteGenres:u.profile.favoriteGenres||[],readingGoal:u.profile.readingGoal||12,joinedDate:u.profile.joinedDate||u.createdAt})},[u==null?void 0:u.profile,w]);const g=async()=>{console.log("ProfilePage: Loading profile for user:",u==null?void 0:u.id,"isGuest:",w);try{if(w){const y=ne.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",y),y){n({displayName:y.displayName||"Guest User",bio:y.bio||"Browsing as a guest",favoriteGenres:y.favoriteGenres||[],readingGoal:y.readingGoal||12,joinedDate:y.joinedDate||(u==null?void 0:u.createdAt)});return}u!=null&&u.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),n({displayName:u.profile.displayName||"Guest User",bio:u.profile.bio||"Browsing as a guest",favoriteGenres:u.profile.favoriteGenres||[],readingGoal:u.profile.readingGoal||12,joinedDate:u.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const j=await J.getProfile();if(console.log("ProfilePage: Gun service profile result:",j),j.success&&j.profile){const y={displayName:j.profile.displayName||"",bio:j.profile.bio||"",favoriteGenres:j.profile.favoriteGenres||[],readingGoal:j.profile.readingGoal||12,joinedDate:j.profile.joinedDate||j.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",y),n(y)}else console.log("ProfilePage: No profile found or error loading profile")}catch(j){console.error("Error loading profile:",j)}},k=async()=>{if(u){console.log("ProfilePage: Saving profile:",r),f(!0);try{if(w){ne.setGuestProfile(r),l(!1),console.log("Guest profile saved to localStorage:",r),i({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",r);const j=await a(r);console.log("ProfilePage: updateProfile result:",j),j.success?(l(!1),console.log("Profile saved successfully"),i({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await g()):(console.error("Error saving profile:",j.error),i({message:`Failed to save profile: ${j.error||"Unknown error"}`,type:"error"}))}catch(j){console.error("Error saving profile:",j),i({message:"Failed to save profile. Please try again.",type:"error"})}finally{f(!1)}}},p=()=>{d.trim()&&!r.favoriteGenres.includes(d.trim())&&(n(j=>({...j,favoriteGenres:[...j.favoriteGenres,d.trim()]})),h(""))},T=j=>{n(y=>({...y,favoriteGenres:y.favoriteGenres.filter(C=>C!==j)}))},b=()=>{t()};return u?e.jsxs(Be,{children:[e.jsxs("div",{className:"min-h-screen py-8 transition-colors duration-200",style:{backgroundColor:o.colors.background},children:[w&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"border px-4 py-3 rounded-lg",style:{backgroundColor:o.colors.wantToRead,borderColor:o.colors.border,color:o.colors.wantToReadText},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl overflow-hidden transition-colors duration-200",style:{backgroundColor:o.colors.surface},children:["            ",e.jsxs("div",{className:"px-8 py-12 text-white relative",style:{background:`linear-gradient(to right, ${o.colors.primary}, ${o.colors.primaryLight})`},children:[e.jsx("button",{onClick:()=>s(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:r.displayName||(u==null?void 0:u.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:r.bio||"A passionate reader exploring new worlds through books"}),r.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(r.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>l(!m),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),m?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:b,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),m?e.jsx("input",{type:"text",value:r.displayName,onChange:j=>n(y=>({...y,displayName:j.target.value})),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent input-field",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.textPrimary},placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:r.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),m?e.jsx("textarea",{value:r.bio,onChange:j=>n(y=>({...y,bio:j.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:r.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),m?e.jsx("input",{type:"number",min:"1",max:"365",value:r.readingGoal,onChange:j=>n(y=>({...y,readingGoal:parseInt(j.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[r.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),m&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:j=>h(j.target.value),onKeyPress:j=>j.key==="Enter"&&p(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.favoriteGenres.map((j,y)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[j,m&&e.jsx("button",{onClick:()=>T(j),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},y)),"                    ",r.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:o.colors.primary},children:"App Settings"}),e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border},children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:o.colors.textPrimary},children:"Appearance"}),e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Choose your preferred theme for the app"})]}),e.jsx(mt,{})]})})})]}),"                  ",e.jsxs("div",{className:"mt-8 p-6 rounded-xl",style:{background:`linear-gradient(to right, ${o.colors.surfaceSecondary}, ${o.colors.surfaceElevated})`},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.primary},children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Pages Read"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.textPrimary},children:"Preferences"}),e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:o.colors.surface},children:e.jsx(mt,{})})]})]})]}),m&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:k,disabled:c,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),N&&e.jsx(At,{message:N.message,type:N.type,onClose:()=>i(null)})]}):e.jsx(Be,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},br=()=>{const u=X(),{theme:t}=W(),{friends:a,friendRequests:o,friendActivity:s,loading:r,sendFriendRequest:n,acceptFriendRequest:m,declineFriendRequest:l,removeFriend:c,refreshFriendActivity:f,searchUsers:d}=ke(),[h,N]=E.useState("activity"),[i,w]=E.useState(""),[g,k]=E.useState([]),[p,T]=E.useState(!1),[b,x]=E.useState(null),[j,y]=E.useState(null),[C,_]=E.useState(null);E.useEffect(()=>{f()},[]),E.useEffect(()=>{i.length>2?d(i).then(k):k([])},[i,d]);const B=async v=>{x(v);try{await n(v)?(w(""),k([]),T(!1),_({message:`Friend request sent to ${v}!`,type:"success"})):_({message:"Failed to send friend request",type:"error"})}finally{x(null)}},D=async(v,I)=>{y(v);try{const O=await m(v);_(O?{message:`You're now friends with ${I}!`,type:"success"}:{message:"Failed to accept friend request",type:"error"})}finally{y(null)}},S=async v=>{const I=await l(v);_(I?{message:"Friend request declined",type:"info"}:{message:"Failed to decline friend request",type:"error"})},A=v=>{const I=new Date,O=new Date(v),G=Math.floor((I.getTime()-O.getTime())/(1e3*60));return G<60?`${G}m ago`:G<1440?`${Math.floor(G/60)}h ago`:`${Math.floor(G/1440)}d ago`},R=v=>{switch(v){case"book_completed":return e.jsx(K,{className:"w-4 h-4"});case"reading_session":return e.jsx(re,{className:"w-4 h-4"});case"achievement_unlocked":return e.jsx(le,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Friends"})]}),e.jsx("button",{onClick:()=>T(!p),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.primary},children:e.jsx(et,{className:"w-5 h-5 text-white"})})]})}),p&&e.jsxs("div",{className:"p-4 border-b",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:t.colors.textSecondary}}),e.jsx("input",{type:"text",placeholder:"Search for users...",value:i,onChange:v=>w(v.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-opacity-50",style:{backgroundColor:t.colors.background,borderColor:t.colors.border,color:t.colors.textPrimary}})]}),g.length>0&&e.jsx("div",{className:"space-y-2",children:g.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg",style:{backgroundColor:t.colors.background},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:v.displayName||v.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",v.username]})]}),"                  ",e.jsx("button",{onClick:()=>B(v.username),className:"px-3 py-1 rounded-lg text-sm font-medium text-white",style:{backgroundColor:t.colors.primary},disabled:r||b===v.username,children:b===v.username?"Sending...":"Add"})]},v.id))})]}),e.jsx("div",{className:"flex border-b",style:{borderColor:t.colors.border},children:[{id:"activity",label:"Activity",count:s.length},{id:"friends",label:"Friends",count:a.length},{id:"requests",label:"Requests",count:o.length}].map(v=>e.jsxs("button",{onClick:()=>N(v.id),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${h===v.id?"border-opacity-100":"border-transparent"}`,style:{color:h===v.id?t.colors.primary:t.colors.textSecondary,borderColor:h===v.id?t.colors.primary:"transparent"},children:[v.label,v.count>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:v.count})]},v.id))}),e.jsxs("div",{className:"p-4",children:[h==="activity"&&e.jsx("div",{className:"space-y-3",children:s.length>0?s.map(v=>e.jsx("div",{className:"p-3 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:R(v.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",style:{color:t.colors.textPrimary},children:v.displayName||v.username}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:A(v.timestamp)})]}),e.jsx("p",{className:"text-sm mb-1",style:{color:t.colors.textPrimary},children:v.description}),v.metadata&&e.jsxs("div",{className:"flex gap-4 text-xs",style:{color:t.colors.textSecondary},children:[v.metadata.pagesRead&&e.jsxs("span",{children:[v.metadata.pagesRead," pages"]}),v.metadata.duration&&e.jsxs("span",{children:[v.metadata.duration," min"]})]})]})]})},v.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend activity yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Friend activity will appear here when your friends complete books or reading sessions"})]})}),h==="friends"&&e.jsx("div",{className:"space-y-3",children:a.length>0?a.map(v=>e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:v.displayName||v.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",v.username]})]})]}),e.jsx("button",{onClick:()=>c(v.id),className:"px-3 py-1 rounded-lg text-sm",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:"Remove"})]}),v.stats&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:v.stats.totalBooksRead}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:v.stats.currentStreak}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Day Streak"})]})]})]},v.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friends yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Start by searching for users to add as friends!"})]})}),h==="requests"&&e.jsx("div",{className:"space-y-3",children:o.length>0?o.map(v=>e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:v.fromDisplayName||v.fromUsername}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",v.fromUsername]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(v.id,v.fromUsername),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:j===v.id?"#6B7280":"#10B981"},disabled:r||j===v.id,children:j===v.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(xe,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>S(v.id),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#EF4444"},disabled:r||j===v.id,children:e.jsx(De,{className:"w-4 h-4 text-white"})})]})]})},v.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend requests"}),"              "]})})]}),C&&e.jsx(At,{message:C.message,type:C.type,onClose:()=>_(null)})]})},vr=()=>{const u=X(),{theme:t}=W(),{user:a}=oe(),{leaderboard:o,loading:s,refreshLeaderboard:r}=ke(),[n,m]=E.useState("week"),[l,c]=E.useState("books_read");E.useEffect(()=>{r(n,l)},[n,l,r]);const f=g=>{switch(g){case 1:return e.jsx(cs,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(tt,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(tt,{className:"w-5 h-5 text-yellow-600"});default:return e.jsxs("span",{className:"font-bold text-lg",style:{color:t.colors.textSecondary},children:["#",g]})}},d=g=>{switch(g){case"books_read":return e.jsx(K,{className:"w-4 h-4"});case"pages_read":return e.jsx(je,{className:"w-4 h-4"});case"reading_time":return e.jsx(re,{className:"w-4 h-4"});case"streak":return e.jsx(Me,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}},h=(g,k)=>{switch(k){case"books_read":return`${g} books`;case"pages_read":return`${g.toLocaleString()} pages`;case"reading_time":const p=Math.floor(g/60),T=g%60;return p>0?`${p}h ${T}m`:`${T}m`;case"streak":return`${g} days`;default:return g.toString()}},N=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"year",label:"This Year"},{id:"alltime",label:"All Time"}],i=[{id:"books_read",label:"Books Read",icon:K},{id:"pages_read",label:"Pages Read",icon:je},{id:"reading_time",label:"Reading Time",icon:re},{id:"streak",label:"Reading Streak",icon:Me}],w=o.find(g=>g.userId===(a==null?void 0:a.id));return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Leaderboard"})]})}),w&&e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.primary+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:f(w.rank)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:"Your Rank"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:h(w.score,l)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["#",w.rank]}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:["out of ",o.length]})]})]})})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"flex gap-2",children:N.map(g=>e.jsx("button",{onClick:()=>m(g.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===g.id?"text-white":""}`,style:{backgroundColor:n===g.id?t.colors.primary:t.colors.surface,color:n===g.id?"white":t.colors.textSecondary},children:g.label},g.id))})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(g=>{const k=g.icon;return e.jsxs("button",{onClick:()=>c(g.id),className:`p-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l===g.id?"text-white":""}`,style:{backgroundColor:l===g.id?t.colors.primary:t.colors.surface,color:l===g.id?"white":t.colors.textSecondary},children:[e.jsx(k,{className:"w-4 h-4"}),g.label]},g.id)})})}),e.jsxs("div",{className:"p-4",children:[s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((g,k)=>e.jsx("div",{className:"p-4 rounded-xl animate-pulse",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:t.colors.borderLight}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:t.colors.borderLight}}),e.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:t.colors.borderLight}})]})]})},k))}):e.jsxs("div",{className:"space-y-3",children:["            ",o.map(g=>e.jsx("div",{className:`p-4 rounded-xl transition-all ${g.userId===(a==null?void 0:a.id)?"ring-2":""}`,style:{backgroundColor:t.colors.surface,...g.userId===(a==null?void 0:a.id)&&{boxShadow:`0 0 0 2px ${t.colors.primary}`}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:f(g.rank)}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:[g.displayName||g.username,g.userId===(a==null?void 0:a.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:"You"})]}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",g.username]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[d(l),e.jsx("span",{className:"font-bold",style:{color:t.colors.primary},children:h(g.score,l)})]}),g.details&&e.jsxs("div",{className:"text-xs mt-1",style:{color:t.colors.textSecondary},children:[l!=="books_read"&&g.details.booksRead&&e.jsxs("span",{children:[g.details.booksRead," books • "]}),l!=="streak"&&g.details.currentStreak&&e.jsxs("span",{children:[g.details.currentStreak," day streak"]})]})]})]})},g.userId))]}),!s&&o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No leaderboard data yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Add friends to compete on the leaderboard!"})]})]})]})},wr=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"📚"}),e.jsx("span",{children:"Bookish"})]})}),"      ",e.jsx(Ls,{children:e.jsx(Ks,{children:e.jsx(zs,{children:e.jsx(Hs,{children:e.jsx(Gs,{children:e.jsx(Ut,{basename:"/Bookish",children:e.jsxs(Qs,{children:[e.jsxs(Ot,{children:[e.jsx(Z,{path:"/",element:e.jsx(or,{})}),e.jsx(Z,{path:"/welcome",element:e.jsx(Xs,{})}),e.jsx(Z,{path:"/search",element:e.jsx(ar,{})}),e.jsx(Z,{path:"/library",element:e.jsx(hr,{})}),e.jsx(Z,{path:"/book",element:e.jsx(nr,{})}),e.jsx(Z,{path:"/reading",element:e.jsx(mr,{})}),e.jsx(Z,{path:"/notes",element:e.jsx(gr,{})}),e.jsx(Z,{path:"/notes/add",element:e.jsx(xr,{})}),e.jsx(Z,{path:"/pet",element:e.jsx(pr,{})}),e.jsx(Z,{path:"/stats",element:e.jsx(fr,{})}),e.jsx(Z,{path:"/profile",element:e.jsx(yr,{})}),e.jsx(Z,{path:"/friends",element:e.jsx(br,{})}),e.jsx(Z,{path:"/leaderboard",element:e.jsx(vr,{})})]}),"                  "]})})})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});hs.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(wr,{})}));
