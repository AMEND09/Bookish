const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var Et=Object.defineProperty;var At=(u,t,a)=>t in u?Et(u,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[t]=a;var ye=(u,t,a)=>At(u,typeof t!="symbol"?t+"":t,a);import{a as Pt,b as _t,g as Rt,c as Re,r as E,R as dt,u as X,d as ut,e as Bt,B as Dt,f as It,h as Z}from"./vendor-CGGxujwj.js";import{r as Ft,c as Ut,a as Ot}from"./gun-CJ6ok8hl.js";import{B as K,U as mt,L as Gt,E as Lt,a as Mt,A as Je,T as ht,P as fe,H as Ie,b as ne,S as Jt,c as ve,d as $t,e as me,f as ft,M as gt,C as re,g as qt,F as Ht,h as $e,i as he,j as Yt,k as Wt,l as ee,m as qe,n as He,X as _e,o as Ye,I as Kt,p as zt,q as Qt,r as Vt,s as ge,t as Xt,u as xt,v as Zt,w as es,x as ts,y as ss,z as pt,D as We,G as Fe,J as rs,K as os,N as Ke,O as ze,Z as Ue,R as as,Q as Qe,V as Ve,W as ns}from"./icons-wR8Y5JGC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();var Be={exports:{}},be={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xe;function ls(){if(Xe)return be;Xe=1;var u=Pt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(m,l,d){var h,c={},f=null,N=null;d!==void 0&&(f=""+d),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(N=l.ref);for(h in l)o.call(l,h)&&!r.hasOwnProperty(h)&&(c[h]=l[h]);if(m&&m.defaultProps)for(h in l=m.defaultProps,l)c[h]===void 0&&(c[h]=l[h]);return{$$typeof:t,type:m,key:f,ref:N,props:c,_owner:s.current}}return be.Fragment=a,be.jsx=n,be.jsxs=n,be}var Ze;function is(){return Ze||(Ze=1,Be.exports=ls()),Be.exports}var e=is(),Ce={},et;function cs(){if(et)return Ce;et=1;var u=_t();return Ce.createRoot=u.createRoot,Ce.hydrateRoot=u.hydrateRoot,Ce}var ds=cs(),us=Ft();const te=Rt(us);var Ee={exports:{}};Ee.exports;var tt;function ms(){return tt||(tt=1,function(u){(function(){function t(o,s){return s?Ut(o):o.slice?t[r(o)]:function(n,m){o(n={exports:{}}),t[r(m)]=n.exports};function r(n){return n.split("/").slice(-1).toString().replace(".js","")}}var a=u;t(function(o){typeof self<"u"&&(o.window=self),typeof window<"u"&&(o.window=window);var s=o.window||o,r,n=s.SEA||{};(n.window=o.window)&&(n.window.SEA=n);try{r+""!=typeof a&&(a.exports=n)}catch{}o.exports=n})(t,"./root"),t(function(o){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(o){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{Re.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Re.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},Re.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(t,"./base64"),t(function(o){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(r,n,m){r=r||"utf8",n=n||0;const l=this.length;if(r==="hex"){const d=new Uint8Array(this);return[...Array((m&&m+1||l)-n).keys()].map(h=>d[h+n].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(m||l)-n},(d,h)=>String.fromCharCode(this[h+n])).join("");if(r==="base64")return btoa(this)},o.exports=s})(t,"./array"),t(function(o){t("./base64");var s=t("./array");function r(...n){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...n)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const n=arguments[0];let m;if(typeof n=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const h=n.match(/([\da-fA-F]{2})/g).map(c=>parseInt(c,16));if(!h||!h.length)throw new TypeError("Invalid first argument for type 'hex'.");m=s.from(h)}else if(d==="utf8"||d==="binary"){const h=n.length,c=new Uint16Array(h);Array.from({length:h},(f,N)=>c[N]=n.charCodeAt(N)),m=s.from(c)}else if(d==="base64"){const h=atob(n),c=h.length,f=new Uint8Array(c);Array.from({length:c},(N,i)=>f[i]=h.charCodeAt(i)),m=s.from(f)}else d==="binary"?m=s.from(n):console.info("SafeBuffer.from unknown encoding: "+d);return m}if(n.byteLength,n.byteLength?n.byteLength:n.length){let d;return n instanceof ArrayBuffer&&(d=new Uint8Array(n)),s.from(d||n)}},alloc(n,m=0){return s.from(new Uint8Array(Array.from({length:n},()=>m)))},allocUnsafe(n){return s.from(new Uint8Array(Array.from({length:n})))},concat(n){if(!Array.isArray(n))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(n.reduce((m,l)=>m.concat(Array.from(l)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,o.exports=r})(t,"./buffer"),t(function(o){const s=t("./root"),r={Buffer:t("./buffer")};var n={},m;if(JSON.parseAsync=JSON.parseAsync||function(d,h,c){var f;try{h(f,JSON.parse(d,c))}catch(N){h(N)}},JSON.stringifyAsync=JSON.stringifyAsync||function(d,h,c,f){var N;try{h(N,JSON.stringify(d,c,f))}catch(i){h(i)}},r.parse=function(d,h){return new Promise(function(c,f){JSON.parseAsync(d,function(N,i){N?f(N):c(i)},h)})},r.stringify=function(d,h,c){return new Promise(function(f,N){JSON.stringifyAsync(d,function(i,j){i?N(i):f(j)},h,c)})},s.window&&(r.crypto=s.window.crypto||s.window.msCrypto,r.subtle=(r.crypto||n).subtle||(r.crypto||n).webkitSubtle,r.TextEncoder=s.window.TextEncoder,r.TextDecoder=s.window.TextDecoder,r.random=d=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(d))))),!r.TextDecoder){const{TextEncoder:d,TextDecoder:h}=t((m+""==typeof a?".":"")+"./lib/text-encoding",1);r.TextDecoder=h,r.TextEncoder=d}if(!r.crypto)try{var l=t("crypto",1);Object.assign(r,{crypto:l,random:h=>r.Buffer.from(l.randomBytes(h))});const{Crypto:d}=t("@peculiar/webcrypto",1);r.ossl=r.subtle=new d({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}o.exports=r})(t,"./shim"),t(function(o){var s=t("./root"),r=t("./shim"),n={};n.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},n.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},n.ecdh={name:"ECDH",namedCurve:"P-256"},n.jwk=function(m,l){m=m.split(".");var d=m[0],h=m[1],c={kty:"EC",crv:"P-256",x:d,y:h,ext:!0};return c.key_ops=l?["sign"]:["verify"],l&&(c.d=l),c},n.keyToJwk=function(m){return{kty:"oct",k:m.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},n.recall={validity:12*60*60,hook:function(m){return m}},n.check=function(m){return typeof m=="string"&&m.slice(0,4)==="SEA{"},n.parse=async function(l){try{var d=typeof l=="string";return d&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),d?await r.parse(l):l}catch{}return l},s.opt=n,o.exports=n})(t,"./settings"),t(function(o){var s=t("./shim");o.exports=async function(r,n){var m=typeof r=="string"?r:await s.stringify(r),l=await s.subtle.digest({name:n||"SHA-256"},new s.TextEncoder().encode(m));return s.Buffer.from(l)}})(t,"./sha256"),t(function(o){const s=t("./shim"),r=s.subtle,n=s.ossl?s.ossl:r,m=l=>n.digest({name:"SHA-1"},new ArrayBuffer(l));o.exports=m})(t,"./sha1"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.work=s.work||(async(d,h,c,f)=>{try{var N=(h||{}).epub||h;if(f=f||{},N instanceof Function&&(c=N,N=l),d=typeof d=="string"?d:await r.stringify(d),(f.name||"").toLowerCase().slice(0,3)==="sha"){var i=r.Buffer.from(await m(d,f.name),"binary").toString(f.encode||"base64");if(c)try{c(i)}catch(y){console.log(y)}return i}N=N||r.random(9);var j=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(d),{name:f.name||"PBKDF2"},!1,["deriveBits"]),p=await(r.ossl||r.subtle).deriveBits({name:f.name||"PBKDF2",iterations:f.iterations||n.pbkdf2.iter,salt:new r.TextEncoder().encode(f.salt||N),hash:f.hash||n.pbkdf2.hash},j,f.length||n.pbkdf2.ks*8);d=r.random(d.length);var C=r.Buffer.from(p,"binary").toString(f.encode||"base64");if(c)try{c(C)}catch(y){console.log(y)}return C}catch(y){if(console.log(y),s.err=y,s.throw)throw y;c&&c();return}}),o.exports=s.work})(t,"./work"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.name=s.name||(async(n,m)=>{try{if(n)try{n()}catch(l){console.log(l)}return}catch(l){if(console.log(l),s.err=l,s.throw)throw l;n&&n();return}}),s.pair=s.pair||(async(n,m)=>{try{var l=r.ossl||r.subtle,d=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async f=>{var N={};N.priv=(await r.subtle.exportKey("jwk",f.privateKey)).d;var i=await r.subtle.exportKey("jwk",f.publicKey);return N.pub=i.x+"."+i.y,N});try{var h=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async f=>{var N={};N.epriv=(await l.exportKey("jwk",f.privateKey)).d;var i=await l.exportKey("jwk",f.publicKey);return N.epub=i.x+"."+i.y,N})}catch(f){if(s.window)throw f;if(f=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw f}h=h||{};var c={pub:d.pub,priv:d.priv,epub:h.epub,epriv:h.epriv};if(n)try{n(c)}catch(f){console.log(f)}return c}catch(f){if(console.log(f),s.err=f,s.throw)throw f;n&&n();return}}),o.exports=s.pair})(t,"./pair"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.sign=s.sign||(async(d,h,c,f)=>{try{if(f=f||{},!(h||f).priv){if(!s.I)throw"No signing key.";h=await s.I(null,{what:d,how:"sign",why:f.why})}if(l===d)throw"`undefined` not allowed.";var N=await n.parse(d),i=f.check=f.check||N;if(s.verify&&(s.opt.check(i)||i&&i.s&&i.m)&&l!==await s.verify(i,h)){var g=await n.parse(i);if(f.raw||(g="SEA"+await r.stringify(g)),c)try{c(g)}catch(w){console.log(w)}return g}var j=h.pub,p=h.priv,C=n.jwk(j,p),y=await m(N),A=await(r.ossl||r.subtle).importKey("jwk",C,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(b=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},b,new Uint8Array(y))),g={m:N,s:r.Buffer.from(A,"binary").toString(f.encode||"base64")};if(f.raw||(g="SEA"+await r.stringify(g)),c)try{c(g)}catch(b){console.log(b)}return g}catch(b){if(console.log(b),s.err=b,s.throw)throw b;c&&c();return}}),o.exports=s.sign})(t,"./sign"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./sha256"),l;s.verify=s.verify||(async(c,f,N,i)=>{try{var j=await n.parse(c);if(f===!1){var p=await n.parse(j.m);if(N)try{N(p)}catch(T){console.log(T)}return p}i=i||{};var C=f.pub||f,y=s.opt.slow_leak?await s.opt.slow_leak(C):await(r.ossl||r.subtle).importKey("jwk",n.jwk(C),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),A=await m(j.m),g,b,w,x;try{if(g=r.Buffer.from(j.s,i.encode||"base64"),b=new Uint8Array(g),w=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},y,b,new Uint8Array(A)),!w)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(c,f,N,i)}var P=w?await n.parse(j.m):l;if(N)try{N(P)}catch(T){console.log(T)}return P}catch(T){if(console.log(T),s.err=T,s.throw)throw T;N&&N();return}}),o.exports=s.verify;var d={};s.opt.slow_leak=c=>{if(d[c])return d[c];var f=n.jwk(c);return d[c]=(r.ossl||r.subtle).importKey("jwk",f,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),d[c]};var h=s.opt;s.opt.fall_verify=async function(c,f,N,i,j){if(j===s.opt.fallback)throw"Signature did not match";j=j||1;var p=c||"";c=s.opt.unpack(c)||c;var C=await n.parse(c),y=f.pub||f,A=await s.opt.slow_leak(y),g=j<=s.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await n.parse(C.m)))):await m(C.m),b,w,x;try{if(b=r.Buffer.from(C.s,i.encode||"base64"),w=new Uint8Array(b),x=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},A,w,new Uint8Array(g)),!x)throw"Signature did not match."}catch{try{b=r.Buffer.from(C.s,"utf8"),w=new Uint8Array(b),x=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},A,w,new Uint8Array(g))}catch{if(!x)throw"Signature did not match."}}var P=x?await n.parse(C.m):l;if(h.fall_soul=p["#"],h.fall_key=p["."],h.fall_val=c,h.fall_state=p[">"],N)try{N(P)}catch(T){console.log(T)}return P},s.opt.fallback=2})(t,"./verify"),t(function(o){var s=t("./shim"),r=t("./settings"),n=t("./sha256");const m=async(l,d,h)=>{const c=l+(d||s.random(8)).toString("utf8"),f=s.Buffer.from(await n(c),"binary"),N=r.keyToJwk(f);return await s.subtle.importKey("jwk",N,{name:"AES-GCM"},!1,["encrypt","decrypt"])};o.exports=m})(t,"./aeskey"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings");var n=t("./aeskey"),m;s.encrypt=s.encrypt||(async(l,d,h,c)=>{try{c=c||{};var f=(d||c).epriv||d;if(m===l)throw"`undefined` not allowed.";if(!f){if(!s.I)throw"No encryption key.";d=await s.I(null,{what:l,how:"encrypt",why:c.why}),f=d.epriv||d}var N=typeof l=="string"?l:await r.stringify(l),i={s:r.random(9),iv:r.random(15)},j=await n(f,i.s,c).then(C=>r.subtle.encrypt({name:c.name||"AES-GCM",iv:new Uint8Array(i.iv)},C,new r.TextEncoder().encode(N))),p={ct:r.Buffer.from(j,"binary").toString(c.encode||"base64"),iv:i.iv.toString(c.encode||"base64"),s:i.s.toString(c.encode||"base64")};if(c.raw||(p="SEA"+await r.stringify(p)),h)try{h(p)}catch(C){console.log(C)}return p}catch(C){if(console.log(C),s.err=C,s.throw)throw C;h&&h();return}}),o.exports=s.encrypt})(t,"./encrypt"),t(function(o){var s=t("./root"),r=t("./shim"),n=t("./settings"),m=t("./aeskey");s.decrypt=s.decrypt||(async(l,d,h,c)=>{try{c=c||{};var f=(d||c).epriv||d;if(!f){if(!s.I)throw"No decryption key.";d=await s.I(null,{what:l,how:"decrypt",why:c.why}),f=d.epriv||d}var N=await n.parse(l),i,j,p;try{i=r.Buffer.from(N.s,c.encode||"base64"),j=r.Buffer.from(N.iv,c.encode||"base64"),p=r.Buffer.from(N.ct,c.encode||"base64");var C=await m(f,i,c).then(A=>r.subtle.decrypt({name:c.name||"AES-GCM",iv:new Uint8Array(j),tagLength:128},A,new Uint8Array(p)))}catch{if(c.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return c.encode="utf8",await s.decrypt(l,d,h,c)}var y=await n.parse(new r.TextDecoder("utf8").decode(C));if(h)try{h(y)}catch(A){console.log(A)}return y}catch(A){if(console.log(A),s.err=A,s.throw)throw A;h&&h();return}}),o.exports=s.decrypt})(t,"./decrypt"),t(function(o){var s=t("./root"),r=t("./shim");t("./settings"),s.secret=s.secret||(async(m,l,d,h)=>{try{if(h=h||{},!l||!l.epriv||!l.epub){if(!s.I)throw"No secret mix.";l=await s.I(null,{what:m,how:"secret",why:h.why})}var c=m.epub||m,f=l.epub,N=l.epriv,i=r.ossl||r.subtle,j=n(c),p=Object.assign({public:await i.importKey(...j,!0,[])},{name:"ECDH",namedCurve:"P-256"}),C=n(f,N),y=await i.importKey(...C,!1,["deriveBits"]).then(async g=>{var b=await i.deriveBits(p,g,256),w=new Uint8Array(b),x=await i.importKey("raw",w,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return i.exportKey("jwk",x).then(({k:P})=>P)}),A=y;if(d)try{d(A)}catch(g){console.log(g)}return A}catch(g){if(console.log(g),s.err=g,s.throw)throw g;d&&d();return}});var n=(m,l)=>{var[d,h]=m.split("."),c=l?{d:l}:{};return["jwk",Object.assign(c,{x:d,y:h,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};o.exports=s.secret})(t,"./secret"),t(function(o){var s=t("./root");s.certify=s.certify||(async(r,n={},m,l,d={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),r=(()=>{var A=[];if(r){if((typeof r=="string"||Array.isArray(r))&&r.indexOf("*")>-1)return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(g=>{typeof g=="string"?A.push(g):typeof g=="object"&&g.pub&&A.push(g.pub)})}return typeof r=="object"&&r.pub?r.pub:A.length>0?A:null}})(),!r)return console.log("No certificant found.");const c=d.expiry&&(typeof d.expiry=="number"||typeof d.expiry=="string")?parseFloat(d.expiry):null,f=(n||{}).read?n.read:null,N=(n||{}).write?n.write:typeof n=="string"||Array.isArray(n)||n["+"]||n["#"]||n["."]||n["="]||n["*"]||n[">"]||n["<"]?n:null,i=(d||{}).block||(d||{}).blacklist||(d||{}).ban||{},j=i.read&&(typeof i.read=="string"||(i.read||{})["#"])?i.read:null,p=typeof i=="string"?i:i.write&&(typeof i.write=="string"||i.write["#"])?i.write:null;if(!f&&!N)return console.log("No policy found.");const C=JSON.stringify({c:r,...c?{e:c}:{},...f?{r:f}:{},...N?{w:N}:{},...j?{rb:j}:{},...p?{wb:p}:{}});var h=await s.sign(C,m,null,{raw:1});if(d.raw||(h="SEA"+JSON.stringify(h)),l)try{l(h)}catch(A){console.log(A)}return h}catch(c){if(s.err=c,s.throw)throw c;l&&l();return}}),o.exports=s.certify})(t,"./certify"),t(function(o){var s=t("./shim"),r=t("./root");r.work=t("./work"),r.sign=t("./sign"),r.verify=t("./verify"),r.encrypt=t("./encrypt"),r.decrypt=t("./decrypt"),r.certify=t("./certify"),r.random=r.random||s.random,r.Buffer=r.Buffer||t("./buffer"),r.keyid=r.keyid||(async n=>{try{const m=s.Buffer.concat(n.replace(/-/g,"+").replace(/_/g,"/").split(".").map(c=>s.Buffer.from(c,"base64"))),l=s.Buffer.concat([s.Buffer.from([153,m.length/256,m.length%256]),m]),d=await sha1hash(l),h=s.Buffer.from(d,"binary");return h.toString("hex",h.length-8)}catch(m){throw console.log(m),m}}),((r.window||{}).GUN||{}).SEA=r,o.exports=r})(t,"./sea"),t(function(o){var s=t("./sea"),r,n;s.window?r=s.window.GUN||{chain:{}}:r=t((n+""==typeof a?".":"")+"./gun",1),s.GUN=r;function m(d){this._={$:this}}m.prototype=function(){function d(){}return d.prototype=r.chain,new d}(),m.prototype.constructor=m,r.chain.user=function(d){var h=this,f=h.back(-1),c;if(d)return d=s.opt.pub((d._||"")["#"])||d,f.get("~"+d);if(c=f.back("user"))return c;var f=f._,N=f,i=N.opt.uuid||l;return(N=(c=N.user=h.chain(new m))._).opt={},N.opt.uuid=function(j){var p=i(),C=f.user;return!C||!(C=C.is)||!(C=C.pub)||(p="~"+C+"/"+p,j&&j.call&&j(null,p)),p},c};function l(){return r.state().toString(36).replace(".","")}r.User=m,m.GUN=r,m.SEA=r.SEA=s,o.exports=m})(t,"./user"),t(function(o){var s,r=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof a?".":"")+"./gun",1);r.chain.then=function(n,m){var l=this,d=new Promise(function(h,c){l.once(h,m)});return n?d.then(n):d}})(t,"./then"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.create=function(...l){var d=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,h=d&&(d.pub||d.epub)?d.pub:typeof l[0]=="string"?l[0]:null,c=d&&(d.pub||d.epub)?d:h&&typeof l[1]=="string"?l[1]:null,f=l.filter(A=>typeof A=="function")[0]||null,N=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},i=this,j=i._,p=i.back(-1);if(f=f||m,N=N||{},N.check!==!1){var C;if(h||(C="No user."),(c||"").length<8&&(C="Password too short!"),C)return f({err:n.log(C)}),i}if(j.ing)return(f||m)({err:n.log("User is already being created or authenticated!"),wait:!0}),i;j.ing=!0;var y={};return y.a=function(A){if(y.pubs=A,A&&!N.already){var g={err:n.log("User already created!")};j.ing=!1,(f||m)(g),i.leave();return}y.salt=String.random(64),r.work(c,y.salt,y.b)},y.b=function(A){y.proof=A,d?y.c(d):r.pair(y.c)},y.c=function(A){var g;y.pair=A||{},(g=j.root.user)&&(g._.sea=A,g.is={pub:A.pub,epub:A.epub,alias:h}),y.data={pub:A.pub},y.d()},y.d=function(){y.data.alias=h,y.e()},y.e=function(){y.data.epub=y.pair.epub,r.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},y.proof,y.f,{raw:1})},y.f=function(A){y.data.auth=JSON.stringify({ek:A,s:y.salt}),y.g(y.data.auth)},y.g=function(A){var g;y.data.auth=y.data.auth||A,p.get(g="~"+y.pair.pub).put(y.data).on(y.h);var b={};b[g]={"#":g},p.get("~@"+h).put(b).get(g).on(y.i)},y.h=function(A,g,b,w){w.off(),y.h.ok=1,y.i()},y.i=function(A,g,b,w){w&&(y.i.ok=1,w.off()),!(!y.h.ok||!y.i.ok)&&(j.ing=!1,f({ok:0,pub:y.pair.pub}),m===f&&(d?i.auth(d):i.auth(h,c)))},p.get("~@"+h).once(y.a),i},s.prototype.leave=function(l,d){var h=this,c=h.back(-1)._.user;if(c&&(delete c.is,delete c._.is,delete c._.sea),r.window)try{var f={};f=r.window.sessionStorage,delete f.recall,delete f.pair}catch{}return h}})(t,"./create"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.auth=function(...d){var h=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,c=!h&&typeof d[0]=="string"?d[0]:null,f=(c||h&&!(h.priv&&h.epriv))&&typeof d[1]=="string"?d[1]:null,N=d.filter(b=>typeof b=="function")[0]||null,i=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},j=this,p=j._,C=j.back(-1);if(p.ing)return(N||m)({err:n.log("User is already being created or authenticated!"),wait:!0}),j;p.ing=!0;var y={},A,g=9;return y.a=function(b){if(!b)return y.b();if(!b.pub){var w=[];return Object.keys(b).forEach(function(x){x!="_"&&w.push(b[x])}),y.b(w)}if(y.name)return y.f(b);y.c((y.data=b).auth)},y.b=function(b){var w=(y.list=(y.list||[]).concat(b||[])).shift();if(A===w){if(y.name)return y.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(c&&g--){C.get("~@"+c).once(y.a);return}return y.err("Wrong user or password.")}C.get(w).once(y.a)},y.c=function(b){if(A===b)return y.b();if(typeof b=="string")return y.c(l(b));r.work(f,(y.auth=b).s,y.d,y.enc)},y.d=function(b){r.decrypt(y.auth.ek,b,y.e,y.enc)},y.e=function(b){if(A===b)return y.enc?(y.enc=null,y.b()):(y.enc={encode:"utf8"},y.c(y.auth));y.half=b,y.f(y.data)},y.f=function(b){var w=y.half||{},x=y.data||{};y.g(y.lol={pub:b.pub||x.pub,epub:b.epub||x.epub,priv:b.priv||w.priv,epriv:b.epriv||w.epriv})},y.g=function(b){if(!b||!b.pub||!b.epub)return y.b();y.pair=b;var w=C._.user,x=w._;x.tag;var P=x.opt;x=w._=C.get("~"+b.pub)._,x.opt=P,w.is={pub:b.pub,epub:b.epub,alias:c||b.pub},x.sea=y.pair,p.ing=!1;try{f&&A==(l(p.root.graph["~"+b.pub].auth)||"")[":"]&&(i.shuffle=i.change=f)}catch{}if(i.change?y.z():(N||m)(x),r.window&&(j.back("user")._.opt||i).remember)try{var T={};T=r.window.sessionStorage,T.recall=!0,T.pair=JSON.stringify(b)}catch{}try{C._.tag.auth?C._.on("auth",x):setTimeout(function(){C._.on("auth",x)},1)}catch(B){n.log("Your 'auth' callback crashed with:",B)}},y.h=function(b){if(!b)return y.b();if(c=b.alias,c||(c=b.alias="~"+h.pub),!b.auth)return y.g(h);h=null,y.c((y.data=b).auth)},y.z=function(){y.salt=String.random(64),r.work(i.change,y.salt,y.y)},y.y=function(b){r.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},b,y.x,{raw:1})},y.x=function(b){y.w(JSON.stringify({ek:b,s:y.salt}))},y.w=function(b){if(i.shuffle){console.log("migrate core account from UTF8 & shuffle");var w={};Object.keys(y.data).forEach(function(x){w[x]=y.data[x]}),delete w._,w.auth=b,C.get("~"+y.pair.pub).put(w)}C.get("~"+y.pair.pub).get("auth").put(b,N||m)},y.err=function(b){var w={err:n.log(b||"User cannot be found!")};p.ing=!1,(N||m)(w)},y.plugin=function(b){if(!(y.name=b))return y.err();var w=[b];b[0]!=="~"&&(w[1]="~"+b,w[2]="~@"+b),y.b(w)},h?h.priv&&h.epriv?y.g(h):C.get("~"+h.pub).once(y.h):c?C.get("~@"+c).once(y.a):!c&&!f&&r.name(y.plugin),j};function l(d){if(typeof d!="string")return d;try{d=JSON.parse(d)}catch{d={}}return d}})(t,"./auth"),t(function(o){var s=t("./user"),r=s.SEA;s.GUN,s.prototype.recall=function(n,m){var l=this,d=l.back(-1);if(n=n||{},n&&n.sessionStorage){if(r.window)try{var h={};h=r.window.sessionStorage,h&&(d._.opt.remember=!0,(l.back("user")._.opt||n).remember=!0,(h.recall||h.pair)&&d.user().auth(JSON.parse(h.pair),m))}catch{}return l}return l}})(t,"./recall"),t(function(o){var s=t("./user"),r=s.SEA,n=s.GUN,m=function(){};s.prototype.pair=function(){var l=this,d;try{d=new Proxy({DANGER:"â˜ "},{get:function(h,c,f){if(!(!l.is||!(l._||"").sea))return l._.sea[c]}})}catch{}return d},s.prototype.delete=async function(l,d,h){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var c=this;c.back(-1);var f=c.back("user");try{f.auth(l,d,function(N){var i=(f.is||{}).pub;f.map().once(function(){this.put(null)}),f.leave(),(h||m)({ok:0})})}catch(N){n.log("User.delete failed! Error:",N)}return c},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const h="No session!";throw n.log(h),{err:h}}},s.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),n.is(l)&&l.get("pub").get((d,h)=>{console.log(d,h)}),l.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(l,d){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,c=h.back(-1).user(),f=c._.sea,N="";return h.back(function(i){i.is||(N+=i.get||"")}),async function(){var i,j=await c.get("grant").get(f.pub).get(N).then();j=await r.decrypt(j,f),j||(j=r.random(16).toString(),i=await r.encrypt(j,f),c.get("grant").get(f.pub).get(N).put(i));var p=l.get("pub").then(),C=l.get("epub").then();p=await p,C=await C;var y=await r.secret(C,f);i=await r.encrypt(j,y),c.get("grant").get(p).get(N).put(i,d)}(),h},s.prototype.secret=function(l,d){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,c=h.back(-1).user(),f=c.pair(),N="";return h.back(function(i){i.is||(N+=i.get||"")}),async function(){var i,j=await c.get("trust").get(f.pub).get(N).then();j=await r.decrypt(j,f),j||(j=r.random(16).toString(),i=await r.encrypt(j,f),c.get("trust").get(f.pub).get(N).put(i)),i=await r.encrypt(l,j),h.put(i,d)}(),h},o.exports=s})(t,"./share"),t(function(o){var s=t("./sea"),r=t("./settings"),n,m=(s.window||"").GUN||t((""+n==typeof a?".":"")+"./gun",1);m.on("opt",function(i){i.sea||(i.sea={own:{}},i.on("put",l,i)),this.to.next(i)});function l(i){var j=this,p=j.as,C=i.put,y=C["#"],A=C["."],g=C[":"],b=C[">"],w=i["#"],x;if(!(!y||!A)){if((i._||"").faith&&(p.opt||"").faith&&typeof i._=="function"){s.opt.pack(C,function(T){s.verify(T,!1,function(B){C["="]=s.opt.unpack(B),j.to.next(i)})});return}var P=function(T){p.on("in",{"@":w,err:i.err=T})};if((i._||"").DBG&&((i._||"").DBG.c=+new Date),0<=y.indexOf("<?")&&(x=parseFloat(y.split("<?")[1]||""),x&&b<m.state()-x*1e3)){(x=i._)&&x.stun&&x.stun--;return}if(y==="~@"){l.alias(j,i,g,A,y,p,P);return}if(y.slice(0,2)==="~@"){l.pubs(j,i,g,A,y,p,P);return}if(x=s.opt.pub(y)){l.pub(j,i,g,A,y,p,P,p.user||"",x);return}if(0<=y.indexOf("#")){l.hash(j,i,g,A,y,p,P);return}l.any(j,i,g,A,y,p,P,p.user||"")}}l.hash=function(i,j,p,C,y,A,g){s.work(p,null,function(b){function w(x){let P="";for(let T=0;T<x.length;T++)P+=T-1&1?"":String.fromCharCode(parseInt(x.substring(T-1,T+1),16));return btoa(P)}if(b&&b===C.split("#").slice(-1)[0])return i.to.next(j);if(b&&b===w(C.split("#").slice(-1)[0]))return i.to.next(j);g("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(i,j,p,C,y,A,g){if(!p)return g("Data must exist!");if("~@"+C===h(p))return i.to.next(j);g("Alias not same!")},l.pubs=function(i,j,p,C,y,A,g){if(!p)return g("Alias must exist!");if(C===h(p))return i.to.next(j);g("Alias not same!")},l.pub=async function(i,j,p,C,y,A,g,b,w){var x;const P=await r.parse(p)||{},T=(B,D,v)=>{if(B.m&&B.s&&D&&w)return s.verify(B,w,S=>{if(n!==S&&n!==S.e&&j.put[">"]&&j.put[">"]>parseFloat(S.e))return g("Certificate expired.");if(n!==S&&S.c&&S.w&&(S.c===D||S.c.indexOf("*")>-1)){let k=y.indexOf("/")>-1?y.replace(y.substring(0,y.indexOf("/")+1),""):"";String.match=String.match||m.text.match;const U=Array.isArray(S.w)?S.w:typeof S.w=="object"||typeof S.w=="string"?[S.w]:[];for(const O of U)if(String.match(k,O["#"])&&String.match(C,O["."])||!O["."]&&String.match(k,O["#"])||!O["#"]&&String.match(C,O["."])||String.match(k?k+"/"+C:C,O["#"]||O)){if(O["+"]&&O["+"].indexOf("*")>-1&&k&&k.indexOf(D)==-1&&C.indexOf(D)==-1)return g(`Path "${k}" or key "${C}" must contain string "${D}".`);if(S.wb&&(typeof S.wb=="string"||(S.wb||{})["#"])){var _=i.as.root.$.back(-1);return typeof S.wb=="string"&&S.wb.slice(0,1)!=="~"&&(_=_.get("~"+w)),_.get(S.wb).get(D).once(J=>J&&(J===1||J===!0)?g(`Certificant ${D} blocked.`):v(S))}return v(S)}return g("Certificate verification fail.")}})};if(C==="pub"&&"~"+w===y)return p===w?i.to.next(j):g("Account not same!");if((x=b.is)&&x.pub&&!P["*"]&&!P["+"]&&(w===x.pub||w!==x.pub&&((j._.msg||{}).opt||{}).cert)){s.opt.pack(j.put,B=>{s.sign(B,b._.sea,async function(D){if(n===D)return g(s.err||"Signature fail.");if(j.put[":"]={":":x=s.opt.unpack(D.m),"~":D.s},j.put["="]=x,w===b.is.pub){(x=h(p))&&((A.sea.own[x]=A.sea.own[x]||{})[w]=1),JSON.stringifyAsync(j.put[":"],function(v,S){return v?g(v||"Stringify error."):(j.put[":"]=S,i.to.next(j))});return}if(w!==b.is.pub&&((j._.msg||{}).opt||{}).cert){const v=await r.parse(j._.msg.opt.cert);v&&v.m&&v.s&&T(v,b.is.pub,S=>{j.put[":"]["+"]=v,j.put[":"]["*"]=b.is.pub,JSON.stringifyAsync(j.put[":"],function(_,k){return _?g(_||"Stringify error."):(j.put[":"]=k,i.to.next(j))})})}},{raw:1})});return}s.opt.pack(j.put,B=>{s.verify(B,P["*"]||w,function(D){var v;if(D=s.opt.unpack(D),n===D)return g("Unverified data.");if((v=h(D))&&w===s.opt.pub(v)&&((A.sea.own[v]=A.sea.own[v]||{})[w]=1),P["+"]&&P["+"].m&&P["+"].s&&P["*"])T(P["+"],P["*"],S=>(j.put["="]=D,i.to.next(j)));else return j.put["="]=D,i.to.next(j)})})},l.any=function(i,j,p,C,y,A,g,b){if(A.opt.secure)return g("Soul missing public key at '"+C+"'.");A.on("secure",function(w){if(this.off(),!A.opt.secure)return i.to.next(w);g("Data cannot be changed.")}).on.on("secure",j)};var d=m.valid,h=function(i,j){return typeof(j=d(i))=="string"&&j};(m.state||"").ify;var c=/[^\w_-]/;s.opt.pub=function(i){if(i&&(i=i.split("~"),!(!i||!(i=i[1]))&&(i=i.split(c).slice(0,2),!(!i||i.length!=2)&&(i[0]||"")[0]!=="@")))return i=i.slice(0,2).join("."),i},s.opt.stringy=function(i){},s.opt.pack=function(i,j,p,C,y){var A,g;if(s.opt.check(i))return j(i);i&&i["#"]&&i["."]&&i[">"]&&(A=i[":"],g=1),JSON.parseAsync(g?A:i,function(b,w){var x=n!==(w||"")[":"]&&(w||"")["~"];if(!x){j(i);return}j({m:{"#":y||i["#"],".":p||i["."],":":(w||"")[":"],">":i[">"]||m.state.is(C,p)},s:x})})};var f=s.opt;s.opt.unpack=function(i,j,p){var C;if(n!==i){if(i&&n!==(C=i[":"]))return C;if(j=j||f.fall_key,!p&&f.fall_val&&(p={},p[j]=f.fall_val),!(!j||!p)){if(i===p[j]||!s.opt.check(p[j]))return i;var y=p&&p._&&p._["#"]||f.fall_soul,A=m.state.is(p,j)||f.fall_state;if(i&&i.length===4&&y===i[0]&&j===i[1]&&N(A)===N(i[3]))return i[2];if(A<s.opt.shuffle_attack)return i}}},s.opt.shuffle_attack=15463296e5;var N=Math.floor})(t,"./index")})()}(Ee)),Ee.exports}ms();var st={},rt;function hs(){if(rt)return st;rt=1;var u=typeof window<"u"?window.Gun:Ot();return u.chain.promise=function(o){var a=this,o=o||function(s){return s};return new Promise(function(s,r){a.once(function(n,m){s({put:n,get:m,gun:this})})}).then(o)},u.chain.then=function(t){var a=this,o=new Promise((s,r)=>{a.once(function(n,m){s(n,m)})});return t?o.then(t):o},st}hs();console.log("ðŸ”« GunJS service file loading...");console.log("ðŸ”« Imported Gun:",typeof te);console.log("ðŸ”« After importing gun/sea and gun/lib/then");console.log("ðŸ”« Gun.SEA is available:",!!te.SEA);te.SEA?(console.log("ðŸ”« âœ… Gun.SEA is properly initialized"),console.log("ðŸ”« Gun.SEA methods:",te.SEA?Object.keys(te.SEA):"undefined")):(console.error("ðŸ”« CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("ðŸ”« Will check SEA availability after Gun instance creation..."));console.log("ðŸ”« About to initialize Gun instance...");const V=te({peers:["https://gun-ad4i.onrender.com/gun","http://amend09.hackclub.app:8765/gun","bewildered-dulcy-amend09-294cb39e.koyeb.app/gun"]});console.log("ðŸ”« GunJS initialized with Render peer and Nest peer");console.log("ðŸ”« Gun instance created:",typeof V);console.log("ðŸ”« Gun instance properties:",Object.keys(V));console.log("ðŸ”« Checking Gun.SEA after instance creation:",!!te.SEA);V.SEA&&(console.log("ðŸ”« Found SEA on gun instance:",!!V.SEA),te.SEA=V.SEA);console.log("ðŸ”« Testing gun.user() method availability...");typeof V.user=="function"?console.log("ðŸ”« âœ… gun.user() method is available"):(console.error("ðŸ”« âŒ gun.user() method is NOT available"),console.error("ðŸ”« Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(V))));V.on("hi",u=>{console.log("ðŸ”« GunJS: Connected to peer",u)});V.on("bye",u=>{console.log("ðŸ”« GunJS: Disconnected from peer",u)});V.on("out",u=>{u&&u.err&&console.warn("ðŸ”« GunJS: Connection error:",u.err)});setTimeout(()=>{console.log("ðŸ”« GunJS connection test - gun object:",V),console.log("ðŸ”« GunJS internal state:",V._),V.get("test").put({hello:"world",timestamp:Date.now()}),console.log("ðŸ”« GunJS: Test data written")},2e3);console.log("ðŸ”« Creating user instance...");let oe;try{oe=V.user(),console.log("ðŸ”« âœ… User instance created successfully:",typeof oe),console.log("ðŸ”« User instance properties:",Object.keys(oe)),typeof oe.create=="function"?console.log("ðŸ”« âœ… user.create() method is available"):console.error("ðŸ”« âŒ user.create() method is NOT available"),typeof oe.auth=="function"?console.log("ðŸ”« âœ… user.auth() method is available"):console.error("ðŸ”« âŒ user.auth() method is NOT available")}catch(u){console.error("ðŸ”« âŒ FAILED to create user instance:",u),console.error("ðŸ”« This confirms that SEA is not properly loaded"),oe={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const Ae=te.SEA;console.log("ðŸ”« SEA reference:",typeof Ae);Ae&&typeof Ae.encrypt=="function"?console.log("ðŸ”« âœ… SEA.encrypt() method is available"):(console.error("ðŸ”« âŒ SEA.encrypt() method is NOT available"),console.error("ðŸ”« Final Gun.SEA status:",te.SEA));class fs{constructor(){ye(this,"gun");ye(this,"user");ye(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=V,this.user=oe,this.SEA=Ae,console.log("GunJS: GunService initialized")}async signUp(t,a){return console.log("ðŸ”« GunJS: Attempting to sign up user:",t),new Promise(o=>{if(a.length<8){console.log("ðŸ”« GunJS: Password too short"),o({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("ðŸ”« GunJS: Sign up timed out"),o({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,a,r=>{if(clearTimeout(s),console.log("ðŸ”« GunJS: Sign up response:",r),r.err){console.log("ðŸ”« GunJS: Sign up error:",r.err),o({success:!1,error:r.err});return}this.user.auth(t,a,n=>{if(!n.err){const m={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(m,()=>{console.log("ðŸ”« GunJS: Initial profile created with original username"),this.addToPublicUsersIndex(t,t),this.user.leave()})}}),console.log("ðŸ”« GunJS: Sign up successful"),o({success:!0})})})}async signIn(t,a){return console.log("ðŸ”« GunJS: Attempting to sign in user:",t),new Promise(o=>{const s=setTimeout(()=>{console.log("ðŸ”« GunJS: Sign in timed out"),o({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,a,r=>{if(clearTimeout(s),console.log("ðŸ”« GunJS: Sign in response:",r),r.err){console.log("ðŸ”« GunJS: Sign in error:",r.err),o({success:!1,error:r.err});return}console.log("ðŸ”« GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(n=>{if(!(n!=null&&n.originalUsername)){console.log("ðŸ”« GunJS: Storing original username in profile");const m={...n,originalUsername:t,favoriteGenres:(n==null?void 0:n.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(m)}this.addToPublicUsersIndex(t,(n==null?void 0:n.displayName)||t)}),o({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const a=setTimeout(()=>{console.log("ðŸ”« GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(a),this.user.is?(console.log("ðŸ”« GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(o=>{const s=(o==null?void 0:o.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("ðŸ”« GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}const o=setTimeout(()=>{console.log("ðŸ”« GunJS: updateProfile timed out"),a({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("ðŸ”« GunJS: Existing profile:",s);const r=(s==null?void 0:s.originalUsername)||this.user.is.alias,n={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:r};console.log("ðŸ”« GunJS: Updating profile with Gun-compatible data:",n),this.user.get("profile").put(n,m=>{if(clearTimeout(o),console.log("ðŸ”« GunJS: Profile update response:",m),m.err){console.log("ðŸ”« GunJS: Profile update error:",m.err),a({success:!1,error:m.err});return}console.log("ðŸ”« GunJS: Profile updated successfully"),this.user.get("profile").once(l=>{console.log("ðŸ”« GunJS: Profile after update:",l),a({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=setTimeout(()=>{console.log("ðŸ”« GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(o=>{if(clearTimeout(a),console.log("ðŸ”« GunJS: Raw profile loaded:",o),o){const s={displayName:o.displayName||"",bio:o.bio||"",favoriteGenres:o.favoriteGenres?JSON.parse(o.favoriteGenres):[],readingGoal:o.readingGoal||12,joinedDate:o.joinedDate,lastUpdated:o.lastUpdated,originalUsername:o.originalUsername};console.log("ðŸ”« GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(a=>{t({success:!0,books:a||[]})})})}async syncUserNotes(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(a=>{t({success:!0,notes:a||[]})})})}async syncUserSessions(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(a=>{t({success:!0,sessions:a||[]})})})}async syncPetData(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,o=>{if(o.err){a({success:!1,error:o.err});return}a({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(a=>{t({success:!0,petData:a||null})})})}async syncUserData(t,a){return new Promise(o=>{if(!this.user.is){o({success:!1,error:"User not authenticated"});return}this.user.get(t).put(a,s=>{if(s.err){o({success:!1,error:s.err});return}o({success:!0})})})}async getUserData(t){return new Promise(a=>{if(!this.user.is){a({success:!1,error:"User not authenticated"});return}this.user.get(t).once(o=>{a({success:!0,data:o||{}})})})}subscribeToUserData(t,a){this.user.is&&this.user.get(t).on(a)}unsubscribeFromUserData(t){this.user.is&&this.user.get(t).off()}async addToPublicUsersIndex(t,a){try{if(!this.user.is)return;const o={id:this.user.is.pub,username:t,displayName:a||t,joinedAt:new Date().toISOString()};this.gun.get("publicUsers").get(this.user.is.pub).put(o),console.log("ðŸ”« GunJS: Added user to public index:",o)}catch(o){console.error("ðŸ”« GunJS: Error adding user to public index:",o)}}async searchPublicUsers(t){return new Promise(a=>{if(!t.trim()){a([]);return}const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: User search timed out"),a(o)},5e3);try{this.gun.get("publicUsers").map().on(r=>{var n;r&&r.username&&r.id&&(r.username.toLowerCase().includes(t.toLowerCase())||r.displayName&&r.displayName.toLowerCase().includes(t.toLowerCase()))&&r.id!==((n=this.user.is)==null?void 0:n.pub)&&o.findIndex(d=>d.id===r.id)===-1&&o.push({id:r.id,username:r.username,displayName:r.displayName})}),setTimeout(()=>{clearTimeout(s),a(o)},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error searching users:",r),a([])}})}async getPublicProfile(t){return new Promise(a=>{const o=setTimeout(()=>{a({success:!1,error:"Profile request timed out"})},3e3);try{this.gun.get("publicUsers").get(t).once(s=>{clearTimeout(o),a(s?{success:!0,profile:s}:{success:!1,error:"User not found"})})}catch{clearTimeout(o),a({success:!1,error:"Error fetching profile"})}})}async sendFriendRequest(t,a,o,s,r,n){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const m=`req_${Date.now()}_${t}_${s}`,l={id:m,fromUserId:t,fromUsername:a,fromDisplayName:o,toUserId:s,toUsername:r,toDisplayName:n,status:"pending",createdAt:new Date().toISOString()};return this.gun.get("friendRequests").get(s).get(m).put(l),this.gun.get("sentRequests").get(t).get(m).put(l),{success:!0}}catch(m){return console.error("ðŸ”« GunJS: Error sending friend request:",m),{success:!1,error:"Failed to send friend request"}}}async getFriendRequests(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=[],o=setTimeout(()=>{t({success:!0,requests:a})},3e3);try{this.gun.get("friendRequests").get(this.user.is.pub).map().on(s=>{s&&s.id&&s.status==="pending"&&a.findIndex(n=>n.id===s.id)===-1&&a.push(s)}),setTimeout(()=>{clearTimeout(o),t({success:!0,requests:a})},2e3)}catch{clearTimeout(o),t({success:!1,error:"Error fetching friend requests"})}})}async acceptFriendRequest(t,a){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};console.log("ðŸ”« GunJS: Accepting friend request:",t,"from:",a);const o={status:"accepted",respondedAt:new Date().toISOString()};this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(a).get(t).put(o);const s=[this.user.is.pub,a].sort().join("_"),r={id:s,user1:this.user.is.pub,user2:a,createdAt:new Date().toISOString(),status:"active"};return console.log("ðŸ”« GunJS: Creating friendship:",s),this.gun.get("friendships").get(s).put(r),this.gun.get("userFriends").get(this.user.is.pub).get(a).put({friendId:a,since:new Date().toISOString()}),this.gun.get("userFriends").get(a).get(this.user.is.pub).put({friendId:this.user.is.pub,since:new Date().toISOString()}),console.log("ðŸ”« GunJS: Friend request accepted successfully"),{success:!0}}catch(o){return console.error("ðŸ”« GunJS: Error accepting friend request:",o),{success:!1,error:"Failed to accept friend request"}}}async declineFriendRequest(t,a){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const o={status:"declined",respondedAt:new Date().toISOString()};return this.gun.get("friendRequests").get(this.user.is.pub).get(t).put(o),this.gun.get("sentRequests").get(a).get(t).put(o),{success:!0}}catch(o){return console.error("ðŸ”« GunJS: Error declining friend request:",o),{success:!1,error:"Failed to decline friend request"}}}async getFriends(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const a=[],o=new Set;let s=0;const r=setTimeout(()=>{console.log("ðŸ”« GunJS: getFriends timeout, returning",a.length,"friends"),t({success:!0,friends:a})},4e3);try{this.gun.get("friendships").map().on((n,m)=>{if(!(!n||!m||o.has(m))&&(n.user1===this.user.is.pub||n.user2===this.user.is.pub)){o.add(m),s++;const l=n.user1===this.user.is.pub?n.user2:n.user1;this.gun.get("publicUsers").get(l).once(d=>{s--,d&&!a.find(h=>h.id===l)&&(a.push({id:l,username:d.username,displayName:d.displayName,status:"accepted",addedAt:n.createdAt}),console.log("ðŸ”« GunJS: Added friend:",d.username)),s===0&&setTimeout(()=>{clearTimeout(r),t({success:!0,friends:a})},500)})}}),setTimeout(()=>{s===0&&(clearTimeout(r),t({success:!0,friends:a}))},2e3)}catch{clearTimeout(r),t({success:!1,error:"Error fetching friends"})}})}async removeFriend(t){try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const a=[this.user.is.pub,t].sort().join("_");return this.gun.get("friendships").get(a).put(null),{success:!0}}catch(a){return console.error("ðŸ”« GunJS: Error removing friend:",a),{success:!1,error:"Failed to remove friend"}}}async updatePublicStats(t){try{if(!this.user.is)return console.error("ðŸ”« GunJS: Cannot update public stats - user not authenticated"),{success:!1,error:"User not authenticated"};const a={userId:this.user.is.pub,totalBooksRead:t.totalBooksRead||0,totalPagesRead:t.totalPagesRead||0,totalReadingTime:t.totalReadingTime||0,currentStreak:t.currentStreak||0,lastUpdated:new Date().toISOString()};return console.log("ðŸ”« GunJS: Updating public stats for user:",this.user.is.pub),console.log("ðŸ”« GunJS: Stats being updated:",a),this.gun.get("publicStats").get(this.user.is.pub).put(a),console.log("ðŸ”« GunJS: âœ… Public stats updated successfully"),{success:!0}}catch(a){return console.error("ðŸ”« GunJS: âŒ Error updating public stats:",a),{success:!1,error:"Failed to update public stats"}}}async getPublicStats(t){return new Promise(a=>{const o=setTimeout(()=>{a({success:!1,error:"Stats request timed out"})},3e3);try{this.gun.get("publicStats").get(t).once(s=>{clearTimeout(o),a(s?{success:!0,stats:s}:{success:!1,error:"Stats not found"})})}catch{clearTimeout(o),a({success:!1,error:"Error fetching stats"})}})}async getAllPublicStats(){return new Promise(t=>{const a=[],o=setTimeout(()=>{console.log("ðŸ”« GunJS: getAllPublicStats timeout, returning",a.length,"stats"),t({success:!0,allStats:a})},4e3);try{console.log("ðŸ”« GunJS: Starting to fetch all public stats..."),this.gun.get("publicStats").map().on((s,r)=>{s&&r&&!a.find(n=>n.userId===r)&&(console.log("ðŸ”« GunJS: Found public stats for user:",r,s),a.push({...s,userId:r}))}),setTimeout(()=>{clearTimeout(o),console.log("ðŸ”« GunJS: Returning",a.length,"public stats"),t({success:!0,allStats:a})},2e3)}catch(s){clearTimeout(o),console.error("ðŸ”« GunJS: Error fetching all public stats:",s),t({success:!1,error:"Failed to fetch public stats"})}})}async publishActivity(t){var a,o;try{if(!this.user.is)return{success:!1,error:"User not authenticated"};const s=this.getCurrentUser(),r=await this.getProfile(),n=r.success?((a=r.profile)==null?void 0:a.displayName)||((o=r.profile)==null?void 0:o.username)||(s==null?void 0:s.username):(s==null?void 0:s.username)||"Unknown",m={id:`activity_${Date.now()}_${this.user.is.pub}`,userId:this.user.is.pub,username:(s==null?void 0:s.username)||"Unknown",displayName:n,type:t.type,title:t.title,description:t.description,timestamp:new Date().toISOString(),bookTitle:t.bookTitle,bookCover:t.bookCover,metadata:t.metadata};return this.gun.get("publicActivity").get(m.id).put(m),this.gun.get("userActivity").get(this.user.is.pub).set(m),console.log("ðŸ”« GunJS: Published activity:",m),{success:!0}}catch(s){return console.error("ðŸ”« GunJS: Error publishing activity:",s),{success:!1,error:"Failed to publish activity"}}}async getFriendActivities(t){return new Promise(a=>{const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: getFriendActivities timeout, returning",o.length,"activities"),a({success:!0,activities:o})},4e3);try{if(console.log("ðŸ”« GunJS: Fetching activities for friends:",t),t.length===0){clearTimeout(s),a({success:!0,activities:[]});return}const r=n=>{this.gun.get("userActivity").get(n).map().once(m=>{if(m&&m.id&&m.timestamp){const l=new Date(m.timestamp),d=new Date(Date.now()-30*24*60*60*1e3);l>d&&!o.find(h=>h.id===m.id)&&o.push(m)}})};t.forEach(r),this.gun.get("publicActivity").map().on(n=>{if(n&&n.userId&&t.includes(n.userId)){const m=new Date(n.timestamp),l=new Date(Date.now()-30*24*60*60*1e3);m>l&&!o.find(d=>d.id===n.id)&&o.push(n)}}),setTimeout(()=>{clearTimeout(s);const n=o.sort((m,l)=>new Date(l.timestamp).getTime()-new Date(m.timestamp).getTime()).slice(0,20);console.log("ðŸ”« GunJS: Returning",n.length,"friend activities"),a({success:!0,activities:n})},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error fetching friend activities:",r),a({success:!1,error:"Failed to fetch activities"})}})}async getRecentPublicActivity(t=50){return new Promise(a=>{const o=[],s=setTimeout(()=>{console.log("ðŸ”« GunJS: getRecentPublicActivity timeout, returning",o.length,"activities"),a({success:!0,activities:o})},3e3);try{this.gun.get("publicActivity").map().on(r=>{if(r&&r.id&&r.timestamp){const n=new Date(r.timestamp),m=new Date(Date.now()-7*24*60*60*1e3);n>m&&!o.find(l=>l.id===r.id)&&o.push(r)}}),setTimeout(()=>{clearTimeout(s);const r=o.sort((n,m)=>new Date(m.timestamp).getTime()-new Date(n.timestamp).getTime()).slice(0,t);a({success:!0,activities:r})},2e3)}catch(r){clearTimeout(s),console.error("ðŸ”« GunJS: Error fetching recent public activity:",r),a({success:!1,error:"Failed to fetch public activity"})}})}}const $=new fs;class gs{constructor(){ye(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,a){if($.isAuthenticated()&&this.isOnline)try{await $.syncUserData(t,a)}catch(o){console.warn("Failed to sync data to server:",o)}}async getData(t,a){if($.isAuthenticated()&&this.isOnline)try{const s=await $.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const o=localStorage.getItem(`bookish_${t}`);return o?JSON.parse(o):a}setLocalStorage(t,a){localStorage.setItem(`bookish_${t}`,JSON.stringify(a))}async syncPendingChanges(){if(!$.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const a of t)try{const o=localStorage.getItem(`bookish_${a}`);o&&await $.syncUserData(a,JSON.parse(o))}catch(o){console.warn(`Failed to sync ${a}:`,o)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!$.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const a of t)try{const o=a.getter();o!==null&&(Array.isArray(o)?o.length>0:Object.keys(o).length>0)&&await $.syncUserData(a.key,o)}catch(o){console.warn(`Failed to migrate ${a.key}:`,o)}}}const W=new gs,le="https://openlibrary.org",xs=async u=>{try{return(await(await fetch(`${le}/search.json?q=${encodeURIComponent(u)}&limit=10`)).json()).docs.map(o=>({key:o.key,title:o.title,author_name:o.author_name,cover_i:o.cover_i,first_publish_year:o.first_publish_year,number_of_pages_median:o.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},ps=async u=>{var t,a;try{const o=u.replace("/works/",""),r=await(await fetch(`${le}/works/${o}.json`)).json();let n=r.number_of_pages_median;!n&&r.editions&&(n=await ys(r.editions)),n||(n=await bs(o));let m=[];if(r.authors&&r.authors.length>0){const l=r.authors.slice(0,3).map(async h=>{try{return(await(await fetch(`${le}${h.author.key}.json`)).json()).name}catch{return null}});m=(await Promise.all(l)).filter(h=>h!==null)}return{key:r.key,title:r.title,author_name:m,cover_i:(t=r.covers)==null?void 0:t[0],first_publish_year:r.first_publish_year,description:((a=r.description)==null?void 0:a.value)||r.description||"",number_of_pages_median:n}}catch(o){return console.error("Error fetching book details:",o),null}},ys=async u=>{try{if(!u||!u.entries||u.entries.length===0)return;for(const t of u.entries.slice(0,3))try{const o=await(await fetch(`${le}${t.key}.json`)).json();if(o.number_of_pages)return o.number_of_pages}catch(a){console.error("Error fetching edition:",a);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},bs=async u=>{try{const a=await(await fetch(`${le}/works/${u}/editions.json?limit=5`)).json();if(a.entries&&a.entries.length>0){for(const o of a.entries)if(o.number_of_pages)return o.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},vs=(u,t="M")=>u?`https://covers.openlibrary.org/b/id/${u}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",ws=async u=>{var t;try{return((t=(await(await fetch(`${le}/subjects/${encodeURIComponent(u.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var r;return{key:s.key,title:s.title,author_name:((r=s.authors)==null?void 0:r.map(n=>n.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(a){return console.error("Error searching books by subject:",a),[]}},js=async u=>{var t,a;try{const o=u.replace(/[-\s]/g,""),s=await fetch(`${le}/isbn/${o}.json`);if(!s.ok)return null;const r=await s.json();return{key:r.key,title:r.title,author_name:((t=r.authors)==null?void 0:t.map(n=>n.name))||[],cover_i:(a=r.covers)==null?void 0:a[0],first_publish_year:r.publish_date?new Date(r.publish_date).getFullYear():void 0,number_of_pages_median:r.number_of_pages}}catch(o){return console.error("Error searching book by ISBN:",o),null}},Ns="bookish_reading_sessions",Ss="bookish_stats",ks="bookish_streak",Oe="bookish_cached_books",je=(u,t)=>{const a=localStorage.getItem(u);return a?JSON.parse(a):t},Cs=(u,t)=>{localStorage.setItem(u,JSON.stringify(t))},yt=u=>je(Oe,{})[u]||null,ot=u=>{const t=je(Oe,{});t[u.key]={...u,cached_at:new Date().toISOString()},Cs(Oe,t)},Le=()=>je(Ns,[]),at=u=>Le().filter(t=>t.bookId===u),Ts=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),bt=()=>je(Ss,Ts()),Es=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),vt=()=>je(ks,Es()),wt=E.createContext(void 0),ie=()=>{const u=E.useContext(wt);if(!u)throw new Error("useBooks must be used within a BookProvider");return u},As=({children:u})=>{const[t,a]=E.useState([]),[o,s]=E.useState(null),[r,n]=E.useState([]),[m,l]=E.useState([]);E.useEffect(()=>{(async()=>{const w=(await W.getBooks()).map(P=>{const T=yt(P.key);return T?{...P,...T}:P});a(w);const x=await W.getCurrentBook();s(x)})()},[]),E.useEffect(()=>{(async()=>{if(o){const b=await W.getReadingSessions(),w=await W.getNotes();n(b.filter(x=>x.bookId===o.key)),l(w.filter(x=>x.bookId===o.key))}else n([]),l([])})()},[o]);const d=async g=>{const b=[...t],w=b.findIndex(T=>T.key===g.key),x=w>=0&&b[w].category==="completed",P=g.category==="completed";if(w>=0?b[w]=g:b.push(g),a(b),await W.saveBooks(b),!x&&P)try{await $.publishActivity({type:"book_completed",title:"Completed a book!",description:`Just finished reading "${g.title}"`,bookTitle:g.title,bookCover:g.cover_i?`https://covers.openlibrary.org/b/id/${g.cover_i}-S.jpg`:void 0,metadata:{pagesRead:g.number_of_pages_median||200}}),console.log("ðŸ“š Published book completion activity:",g.title),await h()}catch(T){console.error("Error publishing book completion activity:",T)}},h=async()=>{try{console.log("ðŸ“Š Updating public stats after book completion...");const g=JSON.parse(localStorage.getItem("bookish_books")||"[]"),b=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]");console.log("ðŸ“Š Local books data:",g),console.log("ðŸ“Š Local sessions data:",b);const w=g.filter(v=>v.category==="completed");console.log("ðŸ“Š Completed books count:",w.length);const x=b.reduce((v,S)=>v+(S.duration||0),0),P=b.reduce((v,S)=>{const _=(S.endPage||0)-(S.startPage||0);return v+Math.max(0,_)},0),T=c(b),B={totalBooksRead:w.length,totalPagesRead:Math.max(P,w.length*200),totalReadingTime:x,currentStreak:T};console.log("ðŸ“Š Calculated stats:",B);const D=await $.updatePublicStats(B);D.success?console.log("âœ… Public stats updated successfully"):console.error("âŒ Failed to update public stats:",D.error)}catch(g){console.error("âŒ Error updating public stats:",g)}},c=g=>{if(!g.length)return 0;const b=g.map(T=>new Date(T.startTime).toDateString()).filter((T,B,D)=>D.indexOf(T)===B).sort((T,B)=>new Date(B).getTime()-new Date(T).getTime());let w=0;const x=new Date().toDateString(),P=new Date(Date.now()-864e5).toDateString();if(b[0]===x||b[0]===P){w=1;for(let T=1;T<b.length;T++){const B=new Date(b[T]);if((new Date(b[T-1]).getTime()-B.getTime())/(1e3*60*60*24)===1)w++;else break}}return w},f=async g=>{const b=t.filter(B=>B.key!==g);a(b),await W.saveBooks(b);const w=await W.getReadingSessions(),x=await W.getNotes(),P=w.filter(B=>B.bookId!==g),T=x.filter(B=>B.bookId!==g);await W.saveReadingSessions(P),await W.saveNotes(T),o&&o.key===g&&(s(null),await W.setCurrentBook(null))},N=async g=>{s(g),await W.setCurrentBook(g)},i=async g=>{const b=await W.getReadingSessions(),w=b.findIndex(x=>x.id===g.id);if(w>=0?b[w]=g:b.push(g),await W.saveReadingSessions(b),o&&g.bookId===o.key&&n(b.filter(x=>x.bookId===o.key)),g.duration&&g.duration>=15)try{const x=t.find(T=>T.key===g.bookId),P=g.endPage&&g.startPage?g.endPage-g.startPage:0;await $.publishActivity({type:"reading_session",title:"Had a reading session",description:`Read for ${g.duration} minutes${x?` in "${x.title}"`:""}`,bookTitle:x==null?void 0:x.title,bookCover:x!=null&&x.cover_i?`https://covers.openlibrary.org/b/id/${x.cover_i}-S.jpg`:void 0,metadata:{duration:g.duration,pagesRead:Math.max(0,P)}}),console.log("ðŸ“– Published reading session activity:",g.duration,"minutes"),await h()}catch(x){console.error("Error publishing reading session activity:",x)}},j=async g=>{const w=[...await W.getNotes(),g];await W.saveNotes(w),o&&g.bookId===o.key&&l(w.filter(x=>x.bookId===o.key))},p=async g=>{const w=(await W.getNotes()).map(x=>x.id===g.id?g:x);await W.saveNotes(w),o&&g.bookId===o.key&&l(w.filter(x=>x.bookId===o.key))},C=async g=>{const w=(await W.getNotes()).filter(x=>x.id!==g);await W.saveNotes(w),o&&l(w.filter(x=>x.bookId===o.key))},y=async()=>{try{const g=t.filter(B=>B.category==="completed"),b=r.reduce((B,D)=>B+(D.duration||0),0),w=r.reduce((B,D)=>{const v=(D.endPage||0)-(D.startPage||0);return B+Math.max(0,v)},0),P=(B=>{if(!B.length)return 0;const D=B.map(k=>new Date(k.startTime).toDateString()).filter((k,U,O)=>O.indexOf(k)===U).sort((k,U)=>new Date(U).getTime()-new Date(k).getTime());let v=0;const S=new Date().toDateString(),_=new Date(Date.now()-864e5).toDateString();if(D[0]===S||D[0]===_){v=1;for(let k=1;k<D.length;k++){const U=new Date(D[k]);if((new Date(D[k-1]).getTime()-U.getTime())/(1e3*60*60*24)===1)v++;else break}}return v})(r),T={totalBooksRead:g.length,totalPagesRead:Math.max(w,g.length*200),totalReadingTime:b,currentStreak:P};await $.updatePublicStats(T)}catch(g){console.error("Error updating public stats:",g)}};E.useEffect(()=>{(t.length>0||r.length>0)&&y()},[t,r]);const A={books:t,currentBook:o,sessions:r,notes:m,addBook:d,removeBook:f,setActiveBook:N,addSession:i,addNote:j,updateNote:p,deleteNote:C,updatePublicStatsAfterBookCompletion:h};return dt.useEffect(()=>{window.debugUpdateStats=h},[]),e.jsx(wt.Provider,{value:A,children:u})},jt=E.createContext(void 0),xe=()=>{const u=E.useContext(jt);if(!u)throw new Error("usePet must be used within a PetProvider");return u},Ge=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content"}),Nt=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),Ps=()=>{try{const u=localStorage.getItem("bookish_pet");if(u){const t=JSON.parse(u);return{...Ge(),...t}}}catch(u){console.error("Error loading pet from storage:",u)}return Ge()},_s=()=>{try{const u=localStorage.getItem("bookish_pet_stats");if(u)return JSON.parse(u)}catch(u){console.error("Error loading pet stats from storage:",u)}return Nt()},Rs=u=>{localStorage.setItem("bookish_pet",JSON.stringify(u))},Bs=u=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(u))},Ds=({children:u})=>{const[t,a]=E.useState(Ps),[o,s]=E.useState(_s);E.useEffect(()=>{Rs(t)},[t]),E.useEffect(()=>{Bs(o)},[o]),E.useEffect(()=>{const x=setInterval(()=>{const P=new Date,T=new Date(t.lastFed),B=(P.getTime()-T.getTime())/(1e3*60*60);B>1&&a(S=>{const _=Math.floor(B);return{...S,hunger:Math.max(0,S.hunger-_*2),energy:Math.max(0,S.energy-_),happiness:Math.max(0,S.happiness-_),mood:r(Math.max(0,S.happiness-_),Math.max(0,S.hunger-_*2),Math.max(0,S.energy-_))}});const D=P.toDateString(),v=new Date(o.lastActiveDate).toDateString();D!==v&&s(S=>({...S,booksReadToday:0,readingTimeToday:0,lastActiveDate:P.toISOString()}))},3e4);return()=>clearInterval(x)},[t.lastFed,o.lastActiveDate]);const r=(x,P,T)=>P<20?"hungry":T<20?"sleepy":x>80?"happy":x>60?"excited":x<30?"sad":"content",n=x=>100+x*50,m=(x,P)=>{let T=P,B=n(T);for(;x>=B;)T++,B=n(T);return{newLevel:T,newExpToNext:B}},l=x=>x<3?"egg":x<8?"baby":x<15?"child":x<25?"teen":x<40?"adult":"elder",d=()=>{const x=t.evolutionStage,P=t.mood,T={egg:{happy:"ðŸ¥š",content:"ðŸ¥š",sad:"ðŸ’”",excited:"âœ¨",sleepy:"ðŸ˜´",hungry:"ðŸ¥š"},baby:{happy:"ðŸ˜Š",content:"ðŸ›",sad:"ðŸ˜¢",excited:"ðŸ¤©",sleepy:"ðŸ˜´",hungry:"ðŸ˜‹"},child:{happy:"ðŸ˜„",content:"ðŸ¯",sad:"ðŸ˜­",excited:"ðŸ¤—",sleepy:"ðŸ’¤",hungry:"ðŸŽ"},teen:{happy:"ðŸ˜Ž",content:"ðŸ¦Š",sad:"ðŸ˜”",excited:"ðŸš€",sleepy:"ðŸ˜ª",hungry:"ðŸ•"},adult:{happy:"ðŸŒŸ",content:"ðŸ¦‰",sad:"ðŸ˜ž",excited:"ðŸŽ‰",sleepy:"ðŸ˜Œ",hungry:"ðŸ½ï¸"},elder:{happy:"ðŸ‘‘",content:"ðŸ‰",sad:"ðŸ˜Ÿ",excited:"ðŸŽŠ",sleepy:"ðŸ§˜",hungry:"ðŸ±"}};return T[x][P]||T[x].content},h=()=>{a(x=>{if(x.points<3)return x;const P=Math.min(100,x.hunger+30),T=Math.min(100,x.happiness+10),B=x.experience+5,{newLevel:D,newExpToNext:v}=m(B,x.level);return{...x,hunger:P,happiness:T,experience:B,level:D,experienceToNext:v,points:x.points-3,lastFed:new Date().toISOString(),evolutionStage:l(D),mood:r(T,P,x.energy)}})},c=()=>{a(x=>{if(x.points<5)return x;const P=Math.min(100,x.happiness+20),T=Math.max(0,x.energy-15),B=x.experience+10,{newLevel:D,newExpToNext:v}=m(B,x.level);return{...x,happiness:P,energy:T,experience:B,level:D,experienceToNext:v,points:x.points-5,lastPlayed:new Date().toISOString(),evolutionStage:l(D),mood:r(P,x.hunger,T)}})},f=()=>{a(x=>{const P=Math.min(100,x.energy+40),T=Math.min(100,x.health+10);return{...x,energy:P,health:T,lastSlept:new Date().toISOString(),mood:r(x.happiness,x.hunger,P)}})},N=(x,P=!1)=>{const D=Math.floor(x/5)+(P?50:0);D>0&&(a(v=>{const S=v.experience+D,_=Math.min(100,v.happiness+Math.floor(x/10)),k=v.totalReadingTime+x,{newLevel:U,newExpToNext:O}=m(S,v.level);return{...v,experience:S,level:U,experienceToNext:O,happiness:_,totalReadingTime:k,evolutionStage:l(U),mood:r(_,v.hunger,v.energy)}}),s(v=>({...v,readingTimeToday:v.readingTimeToday+x,lastActiveDate:new Date().toISOString()})))},i=()=>{a(x=>{const P=x.experience+50,T=Math.min(100,x.happiness+25),B=x.totalBooksRead+1,D=20,{newLevel:v,newExpToNext:S}=m(P,x.level),_=[...x.badges];return B===1&&!_.includes("first-book")&&_.push("first-book"),B===10&&!_.includes("book-lover")&&_.push("book-lover"),B===50&&!_.includes("bookworm")&&_.push("bookworm"),{...x,experience:P,level:v,experienceToNext:S,happiness:T,points:x.points+D,totalBooksRead:B,badges:_,evolutionStage:l(v),mood:r(T,x.hunger,x.energy)}}),s(x=>({...x,booksReadToday:x.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},j=()=>({happy:"Your pet is very happy! Keep up the great reading!",excited:"Your pet is excited about your reading progress!",content:"Your pet is content and enjoying your company.",sad:"Your pet seems sad. Try feeding or playing with them!",sleepy:"Your pet is tired. Maybe they need some rest?",hungry:"Your pet is hungry! Don't forget to feed them."})[t.mood],p=()=>{const x=l(t.level+1),P=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:P,stage:x}},C=()=>{const x=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=x&&t.evolutionStage!==l(t.level)},y=()=>{a(x=>({...x,evolutionStage:l(x.level),happiness:100,health:100}))},A=()=>{const x=Ge();a(x),s(Nt())},g=x=>{a(P=>({...P,name:x}))},b=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",w=()=>t.experience/t.experienceToNext*100;return e.jsx(jt.Provider,{value:{pet:t,petStats:o,feedPet:h,playWithPet:c,petSleep:f,updatePetFromReading:N,updatePetFromBookCompletion:i,getPetMood:j,getPetEvolutionRequirement:p,resetPet:A,updatePetName:g,getPetEmoji:d,canEvolve:C,evolvePet:y,getPetHappinessLevel:b,getLevelProgress:w},children:u})},se={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet",USER_SETTINGS:"bookish-user-settings"};class ae{static get(t){try{const a=localStorage.getItem(t);return a?JSON.parse(a):null}catch(a){return console.error("Error reading from localStorage:",a),null}}static set(t,a){try{return localStorage.setItem(t,JSON.stringify(a)),!0}catch(o){return console.error("Error writing to localStorage:",o),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(a){return console.error("Error removing from localStorage:",a),!1}}static clear(){try{return Object.values(se).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(se.GUEST_PROFILE)}static setGuestProfile(t){return this.set(se.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(se.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(se.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(se.GUEST_PET)}static setGuestPet(t){return this.set(se.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}static getUserSettings(){return this.get(se.USER_SETTINGS)}static saveUserSettings(t){return this.set(se.USER_SETTINGS,{...t,lastUpdated:new Date().toISOString()})}}const St=E.createContext(void 0),Is={isAuthenticated:!1,user:null,isLoading:!0,error:null},Fs=(u,t)=>{switch(t.type){case"AUTH_START":return{...u,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...u,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...u,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...u,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...u,error:null};case"UPDATE_USER":return{...u,user:u.user?{...u.user,...t.payload}:null};default:return u}},Us=({children:u})=>{const[t,a]=E.useReducer(Fs,Is);E.useEffect(()=>{(async()=>{var c;try{const f=new Promise((j,p)=>setTimeout(()=>p(new Error("Authentication check timeout")),5e3)),N=$.recallUser(),i=await Promise.race([N,f]);if(i&&i.success&&i.user){const j=new Promise((p,C)=>setTimeout(()=>C(new Error("Profile load timeout")),3e3));try{const p=await Promise.race([$.getProfile(),j]),C={...i.user,username:p!=null&&p.success&&((c=p==null?void 0:p.profile)!=null&&c.originalUsername)?p.profile.originalUsername:i.user.username||"Unknown User",profile:p&&p.success?p.profile:void 0};a({type:"AUTH_SUCCESS",payload:C})}catch{const C={...i.user,username:i.user.username||"Unknown User",profile:void 0};a({type:"AUTH_SUCCESS",payload:C})}}else a({type:"AUTH_FAILURE",payload:""})}catch(f){console.log("GunJS auth check failed (servers may be down):",f),a({type:"AUTH_FAILURE",payload:""})}})()},[]);const d={...t,signIn:async(h,c)=>{a({type:"AUTH_START"});try{const f=await $.signIn(h,c);if(f.success&&f.user){const N=await $.getProfile(),i={...f.user,username:h,profile:N.success?N.profile:void 0};return a({type:"AUTH_SUCCESS",payload:i}),{success:!0}}else return a({type:"AUTH_FAILURE",payload:f.error||"Sign in failed"}),{success:!1,error:f.error}}catch{const N="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:N}),{success:!1,error:N}}},signUp:async(h,c)=>{a({type:"AUTH_START"});try{const f=await $.signUp(h,c);return f.success?(a({type:"AUTH_FAILURE",payload:""}),{success:!0}):(a({type:"AUTH_FAILURE",payload:f.error||"Sign up failed"}),{success:!1,error:f.error})}catch{const N="An unexpected error occurred";return a({type:"AUTH_FAILURE",payload:N}),{success:!1,error:N}}},signOut:()=>{$.signOut(),a({type:"SIGN_OUT"})},updateProfile:async h=>{console.log("AuthContext: updateProfile called with:",h);try{const c=await $.updateProfile(h);return console.log("AuthContext: gunService.updateProfile result:",c),c.success?(console.log("AuthContext: Updating user state with profile:",h),a({type:"UPDATE_USER",payload:{profile:h}}),{success:!0}):(console.log("AuthContext: Profile update failed:",c.error),{success:!1,error:c.error})}catch(c){return console.error("AuthContext: Profile update error:",c),{success:!1,error:"Failed to update profile"}}},clearError:()=>{a({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let h={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const c=ae.getGuestProfile();c&&(h={displayName:c.displayName||"Guest User",bio:c.bio||"Browsing as a guest",favoriteGenres:c.favoriteGenres||[],readingGoal:c.readingGoal||0});const f={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:h};a({type:"AUTH_SUCCESS",payload:f})}};return e.jsx(St.Provider,{value:d,children:u})},ce=()=>{const u=E.useContext(St);if(u===void 0)throw new Error("useAuth must be used within an AuthProvider");return u},Os={colors:{primary:"#D2691E",primaryLight:"#E89556",primaryDark:"#B8571A",secondary:"#8B7355",secondaryLight:"#A68B6B",secondaryDark:"#6B5A47",background:"#F7F5F3",surface:"#FFFFFF",surfaceElevated:"#FEFEFE",surfaceSecondary:"#F5F5F5",textPrimary:"#3A3A3A",textSecondary:"#8B7355",textTertiary:"#A0A0A0",textInverse:"#FFFFFF",border:"#E8E3DD",borderLight:"#F0EDE8",borderDark:"#D4C4B0",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",wantToRead:"#FEF3C7",wantToReadText:"#D97706",currentlyReading:"#DBEAFE",currentlyReadingText:"#2563EB",completed:"#D1FAE5",completedText:"#059669",overlay:"rgba(0, 0, 0, 0.5)",overlayLight:"rgba(0, 0, 0, 0.3)"}},Gs={colors:{primary:"#E89556",primaryLight:"#F4A971",primaryDark:"#D2691E",secondary:"#A68B6B",secondaryLight:"#B89980",secondaryDark:"#8B7355",background:"#0F0F0F",surface:"#1A1A1A",surfaceElevated:"#252525",surfaceSecondary:"#1F1F1F",textPrimary:"#F5F5F5",textSecondary:"#C0C0C0",textTertiary:"#909090",textInverse:"#0F0F0F",border:"#333333",borderLight:"#2A2A2A",borderDark:"#444444",success:"#4ADE80",warning:"#FBBF24",error:"#FB7185",info:"#60A5FA",wantToRead:"#2D1B00",wantToReadText:"#FBBF24",currentlyReading:"#1E293B",currentlyReadingText:"#7DD3FC",completed:"#1B2E1B",completedText:"#4ADE80",overlay:"rgba(0, 0, 0, 0.8)",overlayLight:"rgba(0, 0, 0, 0.6)"}},kt=E.createContext(void 0),Y=()=>{const u=E.useContext(kt);if(!u)throw new Error("useTheme must be used within a ThemeProvider");return u},Ls=({children:u})=>{const{user:t,isLoading:a}=ce(),o=()=>{try{const h=localStorage.getItem("bookish-theme");if(h)return h==="dark";if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(h){console.error("Error getting initial theme:",h)}return!1},[s,r]=E.useState(o);E.useEffect(()=>{if(a)return;(()=>{var c;if(t){const f=(c=ae.getUserSettings())==null?void 0:c.theme;if(f){r(f==="dark");return}}r(o())})()},[t,a]),E.useEffect(()=>{if(!window.matchMedia)return;const h=window.matchMedia("(prefers-color-scheme: dark)"),c=f=>{var i;(t?!!((i=ae.getUserSettings())!=null&&i.theme):!!localStorage.getItem("bookish-theme"))||r(f.matches)};return h.addEventListener("change",c),()=>h.removeEventListener("change",c)},[t]),E.useEffect(()=>{const h=document.documentElement;s?(h.classList.add("dark"),h.setAttribute("data-theme","dark")):(h.classList.remove("dark"),h.setAttribute("data-theme","light"));const c=document.querySelector('meta[name="theme-color"]');c&&c.setAttribute("content",s?"#0F0F0F":"#F7F5F3")},[s]);const n=()=>{const h=!s;r(h),l(h)},m=h=>{r(h),l(h)},l=h=>{const c=h?"dark":"light";if(t){const f=ae.getUserSettings()||{reminders:[],theme:"light",petName:"Buddy"};ae.saveUserSettings({...f,theme:c})}else localStorage.setItem("bookish-theme",c)},d={colors:s?Gs.colors:Os.colors,isDark:s};return e.jsx(kt.Provider,{value:{theme:d,toggleTheme:n,setTheme:m},children:u})},Ct=E.createContext(void 0),Ne=()=>{const u=E.useContext(Ct);if(!u)throw new Error("useFriends must be used within a FriendsProvider");return u},Ms=({children:u})=>{const{user:t,isAuthenticated:a}=ce(),[o,s]=E.useState([]),[r,n]=E.useState([]),[m,l]=E.useState([]),[d,h]=E.useState([]),[c,f]=E.useState(!1),[N,i]=E.useState(null),j=E.useRef(!1),p=E.useRef(!1);E.useEffect(()=>{a&&t&&C()},[a,t]);const C=async()=>{if(t){f(!0);try{const v=await $.getFriends();if(v.success&&v.friends){const _=await Promise.all(v.friends.map(async k=>{const U=await y(k.id);return{...k,stats:U}}));s(_)}const S=await $.getFriendRequests();S.success&&S.requests&&n(S.requests)}catch(v){console.error("Error loading friends data:",v),i("Failed to load friends data")}finally{f(!1)}}},y=async v=>{try{if(v===(t==null?void 0:t.id)){const[S,_]=await Promise.all([$.getUserBooks(),$.getUserSessions()]),k=S.success?S.books||[]:[],U=_.success?_.sessions||[]:[],O=k.filter(G=>G.category==="completed"),J=U.reduce((G,I)=>G+(I.duration||0),0),L=U.reduce((G,I)=>{const M=(I.endPage||0)-(I.startPage||0);return G+Math.max(0,M)},0),F=A(U),R={totalBooksRead:O.length,totalPagesRead:Math.max(L,O.length*200),totalReadingTime:J,currentStreak:F};return $.updatePublicStats(R).catch(console.error),R}else{try{const _=await $.getPublicStats(v);if(_.success&&_.stats)return{totalBooksRead:_.stats.totalBooksRead||0,totalPagesRead:_.stats.totalPagesRead||0,totalReadingTime:_.stats.totalReadingTime||0,currentStreak:_.stats.currentStreak||0}}catch(_){console.error("Error fetching friend public stats:",_)}const S=o.find(_=>_.id===v);return S&&S.stats?S.stats:{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}}catch(S){return console.error("Error calculating user stats:",S),{totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,currentStreak:0}}},A=v=>{if(!v.length)return 0;const S=v.map(O=>new Date(O.startTime).toDateString()).filter((O,J,L)=>L.indexOf(O)===J).sort((O,J)=>new Date(J).getTime()-new Date(O).getTime());let _=0;const k=new Date().toDateString(),U=new Date(Date.now()-864e5).toDateString();if(S[0]===k||S[0]===U){_=1;for(let O=1;O<S.length;O++){const J=new Date(S[O]);if((new Date(S[O-1]).getTime()-J.getTime())/(1e3*60*60*24)===1)_++;else break}}return _},g=async v=>{var S;if(!t)return!1;f(!0),i(null);try{const k=(await B(v)).find(L=>L.username.toLowerCase()===v.toLowerCase());if(!k)return i("User not found"),!1;if(o.find(L=>L.id===k.id))return i("Already friends with this user"),!1;if(r.find(L=>L.fromUserId===t.id&&L.toUserId===k.id||L.fromUserId===k.id&&L.toUserId===t.id))return i("Friend request already exists"),!1;const J=await $.sendFriendRequest(t.id,t.username,((S=t.profile)==null?void 0:S.displayName)||t.username,k.id,k.username,k.displayName||k.username);return J.success?(await C(),!0):(i(J.error||"Failed to send friend request"),!1)}catch(_){return console.error("Error sending friend request:",_),i("Failed to send friend request"),!1}finally{f(!1)}},b=async v=>{if(!t)return!1;f(!0),i(null);try{const S=r.find(k=>k.id===v);if(!S)return i("Friend request not found"),!1;const _=await $.acceptFriendRequest(v,S.fromUserId);return _.success?(await C(),setTimeout(()=>{P()},1e3),!0):(i(_.error||"Failed to accept friend request"),!1)}catch(S){return console.error("Error accepting friend request:",S),i("Failed to accept friend request"),!1}finally{f(!1)}},w=async v=>{if(!t)return!1;try{const S=r.find(k=>k.id===v);if(!S)return i("Friend request not found"),!1;const _=await $.declineFriendRequest(v,S.fromUserId);return _.success?(await C(),!0):(i(_.error||"Failed to decline friend request"),!1)}catch(S){return console.error("Error declining friend request:",S),i("Failed to decline friend request"),!1}},x=async v=>{if(!t)return!1;try{const S=await $.removeFriend(v);return S.success?(await C(),!0):(i(S.error||"Failed to remove friend"),!1)}catch(S){return console.error("Error removing friend:",S),i("Failed to remove friend"),!1}},P=E.useCallback(async()=>{if(t){if(p.current){console.log("âš ï¸ Friend activity refresh already in progress, skipping...");return}p.current=!0,f(!0);try{const v=o.map(_=>_.id);if(v.length===0){l([]);return}const S=await $.getFriendActivities(v);S.success&&S.activities?(l(S.activities),console.log("âœ… Friend activities loaded:",S.activities.length)):(console.log("âš ï¸ No friend activities found"),l([]))}catch(v){console.error("Error refreshing friend activity:",v),i("Failed to refresh friend activity")}finally{p.current=!1,f(!1)}}},[t,o]),T=E.useCallback(async(v,S)=>{var _;if(t){if(j.current){console.log("âš ï¸ Leaderboard refresh already in progress, skipping...");return}j.current=!0,f(!0);try{console.log("ðŸ”„ Refreshing leaderboard for period:",v,"metric:",S);const k=await $.getAllPublicStats();if(console.log("ðŸ“Š All public stats result:",k),k.success&&k.allStats&&k.allStats.length>0){const J=(await Promise.all(k.allStats.map(async L=>{var R,G,I;const F=await $.getPublicProfile(L.userId);return{userId:L.userId,username:F.success&&((R=F.profile)==null?void 0:R.username)||"Unknown",displayName:F.success?((G=F.profile)==null?void 0:G.displayName)||((I=F.profile)==null?void 0:I.username):"Unknown",stats:{booksRead:L.totalBooksRead||0,pagesRead:L.totalPagesRead||0,readingTime:L.totalReadingTime||0,currentStreak:L.currentStreak||0}}}))).sort((L,F)=>{switch(S){case"books_read":return F.stats.booksRead-L.stats.booksRead;case"pages_read":return F.stats.pagesRead-L.stats.pagesRead;case"reading_time":return F.stats.readingTime-L.stats.readingTime;case"streak":return F.stats.currentStreak-L.stats.currentStreak;default:return 0}}).map((L,F)=>({userId:L.userId,username:L.username,displayName:L.displayName,rank:F+1,score:L.stats[S==="books_read"?"booksRead":S==="pages_read"?"pagesRead":S==="reading_time"?"readingTime":"currentStreak"],period:v,metric:S,details:{booksRead:L.stats.booksRead,pagesRead:L.stats.pagesRead,readingTime:L.stats.readingTime,currentStreak:L.stats.currentStreak}}));h(J),console.log("âœ… Leaderboard updated with",J.length,"entries")}else{console.log("âš ï¸ No public stats available, using fallback method");const U=await y(t.id),L=[{userId:t.id,username:t.username,displayName:((_=t.profile)==null?void 0:_.displayName)||t.username,stats:{booksRead:U.totalBooksRead,pagesRead:U.totalPagesRead,readingTime:U.totalReadingTime,currentStreak:U.currentStreak}},...o.map(F=>{var R,G,I,M;return{userId:F.id,username:F.username,displayName:F.displayName||F.username,stats:{booksRead:((R=F.stats)==null?void 0:R.totalBooksRead)||0,pagesRead:((G=F.stats)==null?void 0:G.totalPagesRead)||0,readingTime:((I=F.stats)==null?void 0:I.totalReadingTime)||0,currentStreak:((M=F.stats)==null?void 0:M.currentStreak)||0}}})].sort((F,R)=>{switch(S){case"books_read":return R.stats.booksRead-F.stats.booksRead;case"pages_read":return R.stats.pagesRead-F.stats.pagesRead;case"reading_time":return R.stats.readingTime-F.stats.readingTime;case"streak":return R.stats.currentStreak-F.stats.currentStreak;default:return 0}}).map((F,R)=>({userId:F.userId,username:F.username,displayName:F.displayName,rank:R+1,score:F.stats[S==="books_read"?"booksRead":S==="pages_read"?"pagesRead":S==="reading_time"?"readingTime":"currentStreak"],period:v,metric:S,details:{booksRead:F.stats.booksRead,pagesRead:F.stats.pagesRead,readingTime:F.stats.readingTime,currentStreak:F.stats.currentStreak}}));h(L)}}catch(k){console.error("Error refreshing leaderboard:",k),i("Failed to refresh leaderboard")}finally{j.current=!1,f(!1)}}},[t,o]),B=async v=>{if(!v.trim())return[];try{console.log("ðŸ” Searching for users with query:",v);const S=await $.searchPublicUsers(v);return console.log("ðŸ” Search results:",S),S}catch(S){return console.error("Error searching users:",S),[]}},D={friends:o,friendRequests:r,friendActivity:m,leaderboard:d,loading:c,error:N,sendFriendRequest:g,acceptFriendRequest:b,declineFriendRequest:w,removeFriend:x,refreshFriendActivity:P,refreshLeaderboard:T,searchUsers:B};return e.jsx(Ct.Provider,{value:D,children:u})},Js=({onClose:u})=>{const[t,a]=E.useState(!1),[o,s]=E.useState(""),[r,n]=E.useState(""),[m,l]=E.useState(!1),[d,h]=E.useState(!1),{signIn:c,signUp:f,error:N,clearError:i,continueAsGuest:j}=ce(),p={colors:{background:"#F7F5F3",surface:"#FFFFFF",borderLight:"#F0EDE8",border:"#E8E3DD",primary:"#8B7355",textPrimary:"#3A3A3A",textSecondary:"#8B7355"}},C=async g=>{if(g.preventDefault(),!(!o.trim()||!r.trim())){h(!0),i();try{let b;t?(b=await f(o.trim(),r),b.success&&(a(!1),n(""),alert("Account created successfully! Please sign in."))):(b=await c(o.trim(),r),b.success&&u&&u())}finally{h(!1)}}},y=()=>{a(!t),n(""),i()},A=()=>{j(),u&&u()};return e.jsxs("div",{className:"rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border",style:{backgroundColor:p.colors.surface,borderColor:p.colors.border},children:[e.jsxs("div",{className:"text-center mb-8",children:["        ",e.jsx("div",{className:"rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",style:{backgroundColor:p.colors.borderLight},children:e.jsx(K,{className:"w-8 h-8",style:{color:p.colors.primary}})}),e.jsx("h2",{className:"font-serif text-2xl font-medium mb-2",style:{color:p.colors.textPrimary},children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{style:{color:p.colors.textSecondary},children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),"      ",e.jsxs("form",{onSubmit:C,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",style:{color:p.colors.textPrimary},children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:p.colors.textSecondary}}),e.jsx("input",{id:"username",type:"text",value:o,onChange:g=>s(g.target.value),className:"pl-10 pr-4 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:p.colors.background,borderColor:p.colors.border,color:p.colors.textPrimary},placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",style:{color:p.colors.textPrimary},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:p.colors.textSecondary}}),"            ",e.jsx("input",{id:"password",type:m?"text":"password",value:r,onChange:g=>n(g.target.value),className:"pl-10 pr-12 py-3 w-full border-2 rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors",style:{backgroundColor:p.colors.background,borderColor:p.colors.border,color:p.colors.textPrimary},placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:opacity-70 transition-colors",style:{color:p.colors.textSecondary},children:m?e.jsx(Lt,{className:"w-5 h-5"}):e.jsx(Mt,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm mt-1",style:{color:p.colors.textSecondary},children:"Password must be at least 8 characters long"})]}),"        ",N&&e.jsx("div",{className:"border px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"#FEF2F2",borderColor:"#FCA5A5",color:"#DC2626"},children:N}),e.jsx("button",{type:"submit",disabled:d,className:"w-full text-white py-3 px-4 rounded-xl font-medium hover:opacity-90 focus:ring-2 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:p.colors.primary},children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:A,className:"w-full py-3 px-4 rounded-xl font-medium focus:ring-2 focus:ring-offset-2 transition-all duration-200 border",style:{backgroundColor:p.colors.surface,color:p.colors.primary,borderColor:p.colors.border},children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center mt-2",style:{color:p.colors.textSecondary},children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{style:{color:p.colors.textSecondary},children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:y,className:"font-medium transition-colors underline hover:opacity-70",style:{color:p.colors.textPrimary},children:t?"Sign In":"Sign Up"})]})}),u&&e.jsx("button",{onClick:u,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},$s=({children:u,fallback:t})=>{const{isAuthenticated:a,isLoading:o}=ce(),s={colors:{background:"#F7F5F3",surface:"#FFFFFF",border:"#E8E3DD",primary:"#8B7355",textSecondary:"#8B7355"}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.primary}}),e.jsx("p",{className:"font-medium",style:{color:s.colors.textSecondary},children:"Loading your reading world..."})]})}):a?e.jsx(e.Fragment,{children:u}):t||e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:s.colors.background},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(Js,{})})})},qs=()=>{const u=X(),t=[{icon:K,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:ht,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:fe,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:Ie,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:ne,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:Jt,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],a=[{icon:ve,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:$t,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:me,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen style={{backgroundColor: lightTheme.colors.background}} max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(K,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>u("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx(Je,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>u("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((o,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(o.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:a.map((o,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(o.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:o.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:o.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>u("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx(Je,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>u("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>u("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},Hs=({className:u=""})=>{const{theme:t,toggleTheme:a}=Y();return e.jsx("button",{onClick:a,className:`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 ${u}`,style:{backgroundColor:t.colors.surfaceSecondary},onMouseEnter:o=>{o.currentTarget.style.backgroundColor=t.colors.border},onMouseLeave:o=>{o.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},title:`Switch to ${t.isDark?"light":"dark"} mode`,"aria-label":`Switch to ${t.isDark?"light":"dark"} mode`,children:t.isDark?e.jsx(ft,{size:16,style:{color:t.colors.warning}}):e.jsx(gt,{size:16,style:{color:t.colors.textSecondary}})})},Ys=({greeting:u})=>{var m;const t=X(),{pet:a}=xe(),{user:o}=ce(),{theme:s}=Y(),r=(m=o==null?void 0:o.id)==null?void 0:m.startsWith("guest-"),n=()=>{const l=a.mood;return{happy:"ðŸ˜Š",excited:"ðŸ¤©",content:"ðŸ˜Œ",sad:"ðŸ˜¢",sleepy:"ðŸ˜´",hungry:"ðŸŽ"}[l]||"ðŸ˜Œ"};return e.jsx("header",{className:"p-4 transition-colors duration-200",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:u}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Hs,{}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors duration-200",style:{backgroundColor:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=s.colors.surfaceSecondary},onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:n()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.colors.textPrimary},children:a.name}),e.jsxs("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:["Lv.",a.level]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200",style:{backgroundColor:r?s.colors.wantToRead:s.colors.surfaceSecondary},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.border},onMouseLeave:l=>{l.currentTarget.style.backgroundColor=r?s.colors.wantToRead:s.colors.surfaceSecondary},onClick:()=>t("/profile"),title:r?"Guest User":"Profile",children:e.jsx(mt,{className:"w-5 h-5",style:{color:r?s.colors.wantToReadText:s.colors.textSecondary}})})]})]})})},Ws=({onContinueReading:u})=>{const{currentBook:t,sessions:a,setActiveBook:o}=ie(),{theme:s}=Y(),[r,n]=E.useState(!0);if(E.useEffect(()=>{if(t){const i=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(j=>j.key===t.key);n(i),i||o(null)}},[t,o]),!t||!r)return e.jsx("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed rounded-lg",style:{borderColor:s.colors.textSecondary},children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2",style:{color:s.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-1",style:{color:s.colors.textPrimary},children:"No book selected"}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"Search for a book to start reading"})]})})});const m=[...a].sort((N,i)=>new Date(i.startTime).getTime()-new Date(N.startTime).getTime())[0],l=(m==null?void 0:m.endPage)||(m==null?void 0:m.startPage)||1,d=t.number_of_pages_median||0,h=d>0?Math.min(Math.round(l/d*100),100):0,c=d>0,f=c&&h>0;return e.jsxs("div",{className:"p-4 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surfaceSecondary},children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:s.colors.textPrimary},children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white p-2",style:{backgroundColor:s.colors.secondary},children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium line-clamp-2 mb-1",style:{color:s.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-2",style:{color:s.colors.textSecondary},children:["by ",t.author_name[0]]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:s.colors.textSecondary},children:[e.jsxs("span",{children:[h,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 rounded-full overflow-hidden",style:{backgroundColor:s.colors.border},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${h}%`,backgroundColor:s.colors.primary}})})]}),e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",d]})]}):c?e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Page ",l," of ",d]}):e.jsxs("div",{className:"text-xs mb-4",style:{color:s.colors.textSecondary},children:["Currently on page ",l,e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:u,className:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",style:{backgroundColor:s.colors.primary,color:s.colors.textInverse},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=s.colors.primaryLight},onMouseLeave:N=>{N.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(K,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},Te=({icon:u,value:t,label:a,color:o})=>{const{theme:s}=Y();return e.jsxs("div",{className:"flex flex-col items-center p-3 rounded-xl shadow-sm",style:{backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full mb-1",style:{backgroundColor:o},children:u}),e.jsx("span",{className:"font-serif text-lg font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:a})]})},Ks=()=>{const{theme:u}=Y(),t=bt(),a=vt(),o=s=>{if(s<60)return`${s} min`;const r=Math.floor(s/60),n=s%60;return n===0?`${r} hrs`:`${r}.${Math.floor(n/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Te,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeToday),label:"Today",color:u.colors.primary}),e.jsx(Te,{icon:e.jsx(re,{className:"w-5 h-5 text-white"}),value:o(t.readingTimeThisWeek),label:"This Week",color:u.colors.primaryDark}),e.jsx(Te,{icon:e.jsx(qt,{className:"w-5 h-5 text-white"}),value:t.totalBooksRead,label:"Books Read",color:u.colors.secondary}),e.jsx(Te,{icon:e.jsx(Ht,{className:"w-5 h-5 text-white"}),value:a.currentStreak,label:"Streak",color:u.colors.primaryLight})]})},de=({icon:u,label:t,onClick:a})=>{const{theme:o}=Y();return e.jsxs("button",{onClick:a,className:"flex flex-col items-center justify-center p-4 rounded-xl shadow-sm transition-colors duration-200",style:{backgroundColor:o.colors.surface},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=o.colors.surfaceSecondary},onMouseLeave:s=>{s.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full mb-2",style:{backgroundColor:o.colors.background},children:e.jsx(u,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm",style:{color:o.colors.textPrimary},children:t})]})},zs=({type:u,title:t,timestamp:a,duration:o})=>{const{theme:s}=Y(),r=()=>{switch(u){case"reading":return e.jsx(re,{className:"w-4 h-4",style:{color:s.colors.primary}});case"note":return e.jsx($e,{className:"w-4 h-4",style:{color:s.colors.secondary}});case"completed":return e.jsx($e,{className:"w-4 h-4",style:{color:s.colors.success}})}},n=m=>{const l=new Date,d=new Date(m),h=Math.floor((l.getTime()-d.getTime())/(1e3*60));if(h<1)return"just now";if(h<60)return`${h} minute${h===1?"":"s"} ago`;const c=Math.floor(h/60);if(c<24)return`${c} hour${c===1?"":"s"} ago`;const f=Math.floor(c/24);return`${f} day${f===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b",style:{borderColor:s.colors.border},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.colors.surfaceSecondary},children:r()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:s.colors.textPrimary},children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:s.colors.textSecondary},children:[e.jsx("span",{children:n(a)}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[o," min"]})]})]})]})]})},Qs=()=>{const u=X(),{theme:t}=Y(),o=[...Le()].sort((r,n)=>new Date(n.startTime).getTime()-new Date(r.startTime).getTime()).slice(0,5),s=()=>{const r=new Date().getHours();return r<12?"Good morning":r<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",style:{backgroundColor:t.colors.background},children:[e.jsx(Ys,{greeting:s()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(Ws,{onContinueReading:()=>u("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:he,label:"Find Books",onClick:()=>u("/search")}),e.jsx(de,{icon:fe,label:"My Notes",onClick:()=>u("/notes")}),e.jsx(de,{icon:Yt,label:"My Library",onClick:()=>u("/library")}),e.jsx(de,{icon:Wt,label:"Statistics",onClick:()=>u("/stats")}),"          "]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Social"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(de,{icon:me,label:"Friends",onClick:()=>u("/friends")}),e.jsx(de,{icon:ne,label:"Leaderboard",onClick:()=>u("/leaderboard")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:t.colors.textPrimary},children:"Your Progress"}),e.jsx(Ks,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-1",style:{color:t.colors.textPrimary},children:"Recent Activity"}),o.length>0?e.jsx("div",{className:"rounded-xl shadow-sm overflow-hidden",style:{backgroundColor:t.colors.surface},children:o.map(r=>e.jsx(zs,{type:"reading",title:"Reading session completed",timestamp:r.endTime||r.startTime,duration:r.duration||0},r.id))}):e.jsx("p",{className:"text-sm p-4 rounded-xl shadow-sm",style:{color:t.colors.textSecondary,backgroundColor:t.colors.surface},children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>u("/welcome"),className:"text-sm hover:underline transition-colors underline",style:{color:t.colors.textSecondary},onMouseEnter:r=>{r.currentTarget.style.color=t.colors.textPrimary},onMouseLeave:r=>{r.currentTarget.style.color=t.colors.textSecondary},children:"Learn more about Bookish features"})})]})]})},Vs="modulepreload",Xs=function(u){return"/Bookish/"+u},nt={},lt=function(t,a,o){let s=Promise.resolve();if(a&&a.length>0){let n=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));s=n(a.map(d=>{if(d=Xs(d),d in nt)return;nt[d]=!0;const h=d.endsWith(".css"),c=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${c}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Vs,h||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((N,i)=>{f.addEventListener("load",N),f.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(n){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=n,window.dispatchEvent(m),!m.defaultPrevented)throw n}return s.then(n=>{for(const m of n||[])m.status==="rejected"&&r(m.reason);return t().catch(r)})},Pe=({children:u,className:t=""})=>{const{theme:a}=Y();return e.jsx("div",{className:`min-h-screen transition-colors duration-200 ${t}`,style:{backgroundColor:a.colors.background},children:u})},Zs=()=>{const u=X(),{theme:t}=Y(),[a,o]=E.useState(""),[s,r]=E.useState([]),[n,m]=E.useState(!1),[l,d]=E.useState("general"),[h,c]=E.useState(!1);E.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const f=async g=>{if(g.preventDefault(),!!a.trim()){m(!0);try{let b;l==="subject"?b=await ws(a):b=await xs(a),r(b)}catch(b){console.error("Error searching books:",b)}finally{m(!1)}}},N=async()=>{try{c(!0),setTimeout(()=>{j()},300)}catch(g){console.error("Error starting camera:",g),alert("Unable to access camera. Please check permissions."),c(!1)}},i=()=>{try{lt(()=>import("./quagga.min-CA_kn7cW.js").then(g=>g.q),__vite__mapDeps([0,1])).then(g=>{const b=g.default;b.stop(),b.offDetected(),b.offProcessed(),console.log("Quagga stopped successfully")}).catch(g=>{console.log("Error stopping Quagga:",g)})}catch(g){console.log("Quagga cleanup error:",g)}c(!1)},j=async()=>{try{const g=document.querySelector("#barcode-scanner");if(!g){console.error("Scanner element not found");return}const w=(await lt(()=>import("./quagga.min-CA_kn7cW.js").then(T=>T.q),__vite__mapDeps([0,1]))).default,x={inputStream:{name:"Live",type:"LiveStream",target:g,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",x),w.init(x,T=>{if(T){console.error("QuaggaJS initialization failed:",T),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),i();return}console.log("QuaggaJS initialized successfully"),w.start(),console.log("QuaggaJS started")}),w.onDetected(T=>{const B=T.codeResult.code;console.log("Barcode detected:",B);const D=C(B);console.log("Cleaned barcode:",D),p(D)?(console.log("Valid ISBN detected, searching..."),y(D),i()):console.log("Invalid ISBN format, continuing scan...")});let P=0;w.onProcessed(T=>{P++,P%30===0&&console.log("Processing frames... Count:",P),T&&T.codeResult&&T.codeResult.code&&console.log("Potential code detected:",T.codeResult.code)})}catch(g){console.error("Error loading Quagga:",g),alert("Failed to load barcode scanner. Please try again."),i()}},p=g=>{const b=g.replace(/[^0-9X]/gi,"");return b.length===10||b.length===13},C=g=>g.replace(/[^0-9X]/gi,""),y=async g=>{m(!0);try{const b=await js(g);b?(r([b]),o(g)):alert("No book found for this barcode")}catch(b){console.error("Error searching by ISBN:",b),alert("Error scanning barcode")}finally{m(!1)}},A=g=>{u(`/book?book=${encodeURIComponent(g.key)}`,{state:{bookData:g}})};return e.jsx(Pe,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-6",children:[e.jsxs("header",{className:"page-header p-4 shadow-sm",style:{backgroundColor:t.colors.surfaceSecondary},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors",style:{backgroundColor:t.colors.surface},onMouseEnter:g=>{g.currentTarget.style.backgroundColor=t.colors.surfaceSecondary},onMouseLeave:g=>{g.currentTarget.style.backgroundColor=t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsxs("form",{onSubmit:f,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:g=>o(g.target.value),placeholder:l==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 border rounded-lg focus:outline-none focus:ring-2 input-field",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.textPrimary}}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full text-white",style:{backgroundColor:t.colors.primary},children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:N,className:"w-10 h-10 flex items-center justify-center rounded-full text-white transition-colors",style:{backgroundColor:t.colors.primary},onMouseEnter:g=>{g.currentTarget.style.backgroundColor=t.colors.primaryLight},onMouseLeave:g=>{g.currentTarget.style.backgroundColor=t.colors.primary},children:e.jsx(qe,{className:"w-5 h-5"})})]}),"        ",e.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:t.colors.surface},children:[e.jsxs("button",{onClick:()=>d("general"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="general"?t.colors.primary:"transparent",color:l==="general"?"white":t.colors.textSecondary},children:[e.jsx(he,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>d("subject"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors",style:{backgroundColor:l==="subject"?t.colors.primary:"transparent",color:l==="subject"?"white":t.colors.textSecondary},children:[e.jsx(He,{className:"w-4 h-4"}),"Subject"]})]})]}),h&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded-lg p-4 m-4 max-w-sm w-full",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“·"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none",style:{border:`2px solid ${t.colors.primary}`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{borderTop:`2px solid ${t.colors.primary}`}})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm mb-2",style:{color:t.colors.textSecondary},children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs mb-2",style:{color:t.colors.textSecondary},children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs italic",style:{color:t.colors.textSecondary},children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4",style:{borderTop:`1px solid ${t.colors.border}`},children:e.jsx("button",{onClick:()=>{const g=prompt("Enter ISBN manually (if barcode scan fails):");g&&(y(g.trim()),i())},className:"text-xs underline",style:{color:t.colors.primary},children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2",style:{borderTopColor:t.colors.primary,borderBottomColor:t.colors.primary}})}):s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium",style:{color:t.colors.textPrimary},children:l==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:s.map(g=>e.jsxs("div",{onClick:()=>A(g),className:"flex gap-4 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:[g.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${g.cover_i}-M.jpg`,alt:g.title,className:"w-full h-full object-cover",onError:b=>{var x;const w=b.target;w.style.display="none",(x=w.nextElementSibling)==null||x.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${g.cover_i?"hidden":""}`,children:e.jsx(K,{className:"w-6 h-6",style:{color:t.colors.textSecondary}})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:t.colors.textPrimary},children:g.title}),g.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:t.colors.textSecondary},children:["by ",g.author_name[0]]}),g.first_publish_year&&e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:g.first_publish_year})]})]},g.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(he,{className:"w-12 h-12 mb-4 opacity-70",style:{color:t.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Find your next great read"}),e.jsx("p",{className:"text-sm max-w-xs mb-4",style:{color:t.colors.textSecondary},children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",style:{color:t.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-4 h-4"}),"Browse"]})]})]})})]})})},Se=({isOpen:u,onClose:t,onConfirm:a,title:o,message:s,type:r="confirm",confirmText:n="Confirm",cancelText:m="Cancel"})=>{const{theme:l}=Y();if(!u)return null;const d=()=>{switch(r){case"alert":return e.jsx(Ye,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(zt,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(Kt,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Ye,{className:"w-8 h-8",style:{color:l.colors.primary}})}},h=()=>{a&&a(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl shadow-xl w-full max-w-sm mx-auto",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:o})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm leading-relaxed mb-6",style:{color:l.colors.textPrimary},children:s}),e.jsxs("div",{className:"flex gap-3",children:[r==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:m}),e.jsx("button",{onClick:h,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${r==="success"?"bg-green-600 text-white hover:bg-green-700":r==="alert"?"bg-red-600 text-white hover:bg-red-700":"text-white hover:opacity-80"}`,style:r==="confirm"?{backgroundColor:l.colors.primary}:{},children:r==="confirm"?n:"OK"})]})]})})})},ke=()=>{const[u,t]=E.useState(!1),[a,o]=E.useState({title:"",message:""}),[s,r]=E.useState(null);return{isOpen:u,config:a,onConfirm:s,close:()=>{t(!1),r(null)},showConfirm:(d,h,c,f)=>{o({title:d,message:h,type:"confirm",confirmText:f==null?void 0:f.confirmText,cancelText:f==null?void 0:f.cancelText}),r(()=>c),t(!0)},showAlert:(d,h,c="info")=>{o({title:d,message:h,type:c}),r(null),t(!0)}}},er=()=>{const u=X(),[t]=ut(),a=Bt(),{books:o,setActiveBook:s,sessions:r,notes:n,addBook:m,updatePublicStatsAfterBookCompletion:l}=ie(),{refreshLeaderboard:d}=Ne(),{updatePetFromBookCompletion:h}=xe(),{theme:c}=Y(),[f,N]=E.useState(!1),[i,j]=E.useState(null),[p,C]=E.useState(!1),[y,A]=E.useState(!1),[g,b]=E.useState(!1),w=ke(),x=t.get("book");if(E.useEffect(()=>{var I;if((I=a.state)!=null&&I.bookData)j(a.state.bookData);else{const M=o.find(q=>q.key===x);if(M)j(M);else{u("/");return}}},[x,o,a.state,u]),E.useEffect(()=>{if(i){const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(H=>H.key===i.key);C(M);const q=yt(i.key);if(q&&q.description&&!i.description){j(H=>({...H,description:q.description,number_of_pages_median:q.number_of_pages_median||H.number_of_pages_median}));return}i.description||(N(!0),ps(i.key).then(H=>{if(H){const z={...i,description:H.description,number_of_pages_median:H.number_of_pages_median||i.number_of_pages_median};j(z),ot(z)}}).catch(H=>{console.error("Error fetching book details:",H),q&&j(z=>({...z,...q}))}).finally(()=>{N(!1)}))}},[i]),!i)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>u("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const P=async I=>{const M=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!M.some(q=>q.key===i.key)){const q={...i,category:I==="want-to-read"?"wishlist":"reading",dateAdded:new Date().toISOString()};await m(q),M.push(q),localStorage.setItem("bookish_books",JSON.stringify(M)),ot(q);const H=JSON.parse(localStorage.getItem("myBooks")||"[]");H.some(z=>z.key===i.key)||(H.push(q),localStorage.setItem("myBooks",JSON.stringify(H))),C(!0),A(!1),I==="currently-reading"&&(s(i),u("/reading"))}},T=()=>{w.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{var Me;const I={...i,category:"completed",completedAt:new Date().toISOString()};await m(I),await l();const q=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(pe=>pe.key===i.key?I:pe);localStorage.setItem("bookish_books",JSON.stringify(q));const z=JSON.parse(localStorage.getItem("myBooks")||"[]").map(pe=>pe.key===i.key?I:pe);localStorage.setItem("myBooks",JSON.stringify(z)),h(),setTimeout(()=>{d("week","books_read")},1e3),i.key===((Me=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:Me.key)&&s(null),w.showAlert("Congratulations!","ðŸŽ‰ You've completed the book and your pet gained experience!","success"),setTimeout(()=>{u("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},B=i.number_of_pages_median||0,D=[...r].filter(I=>I.bookId===i.key).sort((I,M)=>new Date(M.startTime).getTime()-new Date(I.startTime).getTime())[0],v=(D==null?void 0:D.endPage)||(D==null?void 0:D.startPage)||1,S=B>0?Math.min(Math.round(v/B*100),100):0,_=r.filter(I=>I.bookId===i.key).reduce((I,M)=>I+(M.duration||0),0),k=Math.floor(_/60),U=_%60,O=k>0?`${k} hr${k!==1?"s":""} ${U>0?`${U} min`:""}`:`${U} min`,J=n.filter(I=>I.bookId===i.key),F=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(I=>I.key===i.key),R=(F==null?void 0:F.category)==="completed",G=()=>{u(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:c.colors.background},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:c.colors.background},children:e.jsx("button",{onClick:G,className:"w-8 h-8 flex items-center justify-center rounded-full hover:opacity-80 transition-colors",style:{backgroundColor:c.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:c.colors.primary}})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:i.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${i.cover_i}-M.jpg`,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:c.colors.primary},children:e.jsx(K,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium mb-2 leading-tight",style:{color:c.colors.textPrimary},children:i.title}),i.author_name&&i.author_name.length>0&&e.jsxs("p",{className:"text-sm mb-3",style:{color:c.colors.textSecondary},children:["by ",i.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[i.first_publish_year&&e.jsxs("p",{className:"text-xs",style:{color:c.colors.textSecondary},children:["First published: ",i.first_publish_year]}),B>0&&e.jsxs("p",{className:"text-xs",style:{color:c.colors.textSecondary},children:[B," pages"]})]})]})]}),"        ",p&&B>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textPrimary},children:[S,"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden mb-2",style:{backgroundColor:c.colors.borderLight},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${S}%`,backgroundColor:c.colors.secondary}})}),e.jsxs("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:["Page ",v," of ",B]})]}),e.jsx("div",{className:"w-px",style:{backgroundColor:c.colors.border}}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(ht,{className:"w-5 h-5 mb-1",style:{color:c.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:c.colors.textPrimary},children:O}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),f?e.jsx("div",{className:"h-32 animate-pulse rounded-lg mb-6",style:{backgroundColor:c.colors.borderLight}}):i.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:c.colors.textPrimary},children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm leading-relaxed ${g?"":"line-clamp-4"}`,style:{color:c.colors.textPrimary},children:typeof i.description=="string"?i.description:"No description available."}),i.description&&i.description.length>200&&e.jsx("button",{onClick:()=>b(!g),className:"mt-2 flex items-center gap-1 text-sm font-medium hover:opacity-80 transition-colors",style:{color:c.colors.textSecondary},children:g?e.jsxs(e.Fragment,{children:["Show less",e.jsx(Qt,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(Vt,{className:"w-4 h-4"})]})})]})]}):null,p&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>u("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),J.length>0?e.jsx("div",{className:"space-y-2",children:J.slice(0,2).map(I=>e.jsxs("div",{className:"p-3 rounded-lg shadow-sm",style:{backgroundColor:c.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:[I.chapter?`Chapter: ${I.chapter}`:"",I.chapter&&I.page?" â€¢ ":"",I.page?`Page ${I.page}`:""]}),e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:new Date(I.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm line-clamp-2",style:{color:c.colors.textPrimary},children:I.content})]},I.id))}):e.jsx("div",{className:"p-4 rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:c.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"w-6 h-6 mx-auto mb-2",style:{color:c.colors.textSecondary}}),e.jsx("p",{className:"text-sm mb-1",style:{color:c.colors.textSecondary},children:"No notes yet"}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 border-t flex gap-4 max-w-md mx-auto",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border},children:p?e.jsx(e.Fragment,{children:R?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u("/notes/add"),className:"flex-1 py-3 px-4 border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:c.colors.surface},children:[e.jsx(fe,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(i),u("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Xt,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:T,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(ge,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("/library"),className:"flex-1 py-3 px-4 border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",style:{backgroundColor:c.colors.surface},children:"View Library"}),e.jsxs("button",{onClick:()=>A(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),"      ",y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:c.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:c.colors.textPrimary},children:"Add to Library"}),e.jsx("p",{className:"text-sm mb-6",style:{color:c.colors.textSecondary},children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>P("want-to-read"),className:"w-full p-4 rounded-lg text-left hover:opacity-80 transition-colors",style:{backgroundColor:c.colors.borderLight},children:[e.jsx("div",{className:"font-medium mb-1",style:{color:c.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:c.colors.textSecondary},children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>P("currently-reading"),className:"w-full p-4 text-white rounded-lg text-left hover:opacity-90 transition-colors",style:{backgroundColor:c.colors.primary},children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>A(!1),className:"w-full mt-4 py-2 text-sm hover:opacity-80 transition-colors",style:{color:c.colors.textSecondary},children:"Cancel"})]})}),e.jsx(Se,{isOpen:w.isOpen,onClose:w.close,onConfirm:w.onConfirm||void 0,title:w.config.title,message:w.config.message,type:w.config.type,confirmText:w.config.confirmText,cancelText:w.config.cancelText})]})},Q=[];for(let u=0;u<256;++u)Q.push((u+256).toString(16).slice(1));function tr(u,t=0){return(Q[u[t+0]]+Q[u[t+1]]+Q[u[t+2]]+Q[u[t+3]]+"-"+Q[u[t+4]]+Q[u[t+5]]+"-"+Q[u[t+6]]+Q[u[t+7]]+"-"+Q[u[t+8]]+Q[u[t+9]]+"-"+Q[u[t+10]]+Q[u[t+11]]+Q[u[t+12]]+Q[u[t+13]]+Q[u[t+14]]+Q[u[t+15]]).toLowerCase()}let De;const sr=new Uint8Array(16);function rr(){if(!De){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");De=crypto.getRandomValues.bind(crypto)}return De(sr)}const or=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),it={randomUUID:or};function we(u,t,a){var s;if(it.randomUUID&&!u)return it.randomUUID();u=u||{};const o=u.random??((s=u.rng)==null?void 0:s.call(u))??rr();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,tr(o)}const ue="bookish_active_timer",ar=({bookId:u,startPage:t})=>{const[a,o]=E.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=E.useRef();E.useEffect(()=>{const c=localStorage.getItem(ue);if(c)try{const f=JSON.parse(c);f.bookId===u?o(f.timerState):localStorage.removeItem(ue)}catch(f){console.error("Error loading timer state:",f),localStorage.removeItem(ue)}},[u]),E.useEffect(()=>{a.sessionId&&localStorage.setItem(ue,JSON.stringify({bookId:u,startPage:t,timerState:a}))},[a,u,t]),E.useEffect(()=>(a.isActive?s.current=setInterval(()=>{o(c=>({...c}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[a.isActive]);const r=()=>{if(!a.startTime)return 0;let c=a.totalElapsed;if(a.isActive&&a.lastPauseTime===null){const f=Date.now(),N=new Date(a.startTime).getTime();c+=Math.floor((f-N)/1e3)}return c},n=r(),m=()=>{const c=new Date().toISOString();a.sessionId?o(f=>({...f,startTime:c,lastPauseTime:null,isActive:!0})):o({sessionId:we(),startTime:c,totalElapsed:0,lastPauseTime:null,isActive:!0})},l=()=>{if(!a.isActive||!a.startTime)return;const c=Date.now(),f=new Date(a.startTime).getTime(),N=Math.floor((c-f)/1e3);o(i=>({...i,totalElapsed:i.totalElapsed+N,lastPauseTime:new Date().toISOString(),isActive:!1}))},d=c=>{const f=r(),N={id:a.sessionId||we(),bookId:u,startTime:a.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:c,duration:Math.floor(f/60)};return o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue),N},h=()=>{o({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(ue)};return{isActive:a.isActive,elapsedTime:n,startTimer:m,pauseTimer:l,stopTimer:d,resetTimer:h}},nr=()=>{const u=X(),{currentBook:t,addSession:a,addNote:o,addBook:s,updatePublicStatsAfterBookCompletion:r}=ie(),{refreshLeaderboard:n}=Ne(),{updatePetFromReading:m}=xe(),{theme:l}=Y(),d=ke(),[h,c]=E.useState(1),[f,N]=E.useState(1),[i,j]=E.useState(!1),[p,C]=E.useState(""),[y,A]=E.useState(""),[g,b]=E.useState(!1),[w,x]=E.useState(!1),{isActive:P,elapsedTime:T,startTimer:B,pauseTimer:D,stopTimer:v,resetTimer:S}=ar({bookId:(t==null?void 0:t.key)||"",startPage:1});if(E.useEffect(()=>{if(t&&!w){const R=localStorage.getItem("bookish_active_timer");if(R)try{const M=JSON.parse(R);if(M.bookId===t.key){c(M.startPage),N(M.startPage),x(!0);return}}catch(M){console.error("Error parsing active timer:",M)}const I=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(M=>M.bookId===t.key);if(I.length>0){I.sort((q,H)=>new Date(H.startTime).getTime()-new Date(q.startTime).getTime());const M=I[0].endPage||I[0].startPage;c(M),N(M)}x(!0)}},[t,w]),E.useEffect(()=>{const R=G=>{P&&(G.preventDefault(),G.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",R),()=>window.removeEventListener("beforeunload",R)},[P]),!t)return u("/"),null;const _=()=>{try{if(!t){d.showAlert("Error","No book selected","alert");return}if(f<h){d.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(T<=0){d.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const R=v(f);if(!R)throw new Error("Failed to create session");if(a(R),R.duration&&m(R.duration),p.trim()){const G={id:we(),bookId:t.key,page:f,chapter:y.trim()||void 0,content:p.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(G)}u("/")}catch(R){console.error("Error finishing session:",R),d.showAlert("Error","Failed to save reading session. Please try again.","alert")}},k=R=>{const G=Math.floor(R/3600),I=Math.floor(R%3600/60),M=R%60;return G>0?`${G}:${I.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`:`${I.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`},U=t.number_of_pages_median||9999,O=t.number_of_pages_median&&t.number_of_pages_median>0,J=()=>{const R=(t==null?void 0:t.number_of_pages_median)||0;return R>0&&f>=R},L=R=>{const G=Math.max(h,Math.min(R,U));N(G),t!=null&&t.number_of_pages_median&&G>=t.number_of_pages_median&&b(!0)},F=async()=>{try{const R=v(f);if(R&&(a(R),R.duration&&m(R.duration)),p.trim()){const z={id:we(),bookId:t.key,page:f,chapter:y.trim()||void 0,content:p.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(z)}const G={...t,category:"completed",completedAt:new Date().toISOString()};await s(G),await r();const M=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(z=>z.key===t.key?G:z);localStorage.setItem("bookish_books",JSON.stringify(M));const H=JSON.parse(localStorage.getItem("myBooks")||"[]").map(z=>z.key===t.key?{...z,category:"completed",completedAt:new Date().toISOString()}:z);localStorage.setItem("myBooks",JSON.stringify(H)),localStorage.removeItem("bookish_current_book"),m((R==null?void 0:R.duration)||0,!0),setTimeout(()=>{n("week","books_read")},1e3),d.showAlert("Congratulations!","ðŸŽ‰ You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{u("/library")},2e3)}catch(R){console.error("Error marking book as finished:",R),d.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",style:{backgroundColor:l.colors.background},children:[e.jsxs("header",{className:"p-4 flex items-center gap-3 shadow-sm",style:{backgroundColor:l.colors.surface},children:[e.jsx("button",{onClick:()=>{P||T>0?d.showConfirm("Leave Reading Session",P?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!P&&T>0?_():u(-1)},{confirmText:P?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):u(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:opacity-80",style:{backgroundColor:l.colors.borderLight,color:l.colors.textSecondary},children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-serif text-lg font-medium",style:{color:l.colors.textPrimary},children:"Reading Session"}),P&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center p-4",style:{borderBottom:`1px solid ${l.colors.border}`},children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:vs(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full",style:{backgroundColor:l.colors.secondary}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium line-clamp-1",style:{color:l.colors.textPrimary},children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm",style:{color:l.colors.textSecondary},children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center shadow-inner",style:{backgroundColor:l.colors.borderLight},children:e.jsx("span",{className:"font-serif text-2xl font-medium",style:{color:l.colors.textPrimary},children:k(T)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:P?D:B,className:"w-16 h-16 rounded-full text-white flex items-center justify-center shadow-md transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},children:P?e.jsx(Zt,{className:"w-8 h-8"}):e.jsx(es,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Start Page"}),e.jsx("input",{type:"number",value:h,onChange:R=>{const G=Math.max(1,Math.min(parseInt(R.target.value)||1,U));c(G),f<G&&N(G)},min:"1",max:U,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary},disabled:P||T>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"End Page"}),e.jsx("input",{type:"number",value:f,onChange:R=>L(parseInt(R.target.value)||h),min:h,max:U,className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]}),J()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:F,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!O&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"ðŸ“˜ Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>j(!i),className:"w-full py-2 text-sm mb-2",style:{color:l.colors.primary},children:i?"Hide Note Form":"+ Add a note about this session"}),i&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 rounded-lg",style:{backgroundColor:l.colors.borderLight},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:y,onChange:R=>A(R.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 rounded-md",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",style:{color:l.colors.textSecondary},children:"Note"}),e.jsx("textarea",{value:p,onChange:R=>C(R.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 rounded-md resize-none",style:{border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.surface,color:l.colors.textPrimary}})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 flex gap-4 max-w-md mx-auto",style:{backgroundColor:l.colors.surface,borderTop:`1px solid ${l.colors.border}`},children:[e.jsxs("button",{onClick:()=>{d.showConfirm("Cancel Session",P?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{S(),u(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:[e.jsx(_e,{className:"w-5 h-5"}),"Cancel"]}),J()?e.jsxs("button",{onClick:F,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-green-700 transition-colors",children:[e.jsx(ne,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:_,className:"flex-1 py-3 px-4 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors hover:opacity-90",style:{backgroundColor:l.colors.primary},disabled:T<=0||f<h,children:[e.jsx(ge,{className:"w-5 h-5"}),"Finish Session"]})]}),"      ",g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:l.colors.surface},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ne,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:l.colors.textPrimary},children:"Congratulations!"}),e.jsxs("p",{className:"text-sm mb-6",style:{color:l.colors.textSecondary},children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:F,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>b(!1),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-colors hover:opacity-80",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`,color:l.colors.textSecondary},children:"Continue Reading"})]})]})})}),e.jsx(Se,{isOpen:d.isOpen,onClose:d.close,onConfirm:d.onConfirm||void 0,title:d.config.title,message:d.config.message,type:d.config.type,confirmText:d.config.confirmText,cancelText:d.config.cancelText})]})},lr=()=>{const u=X(),{books:t,addBook:a,updatePublicStatsAfterBookCompletion:o}=ie(),{refreshLeaderboard:s}=Ne(),{updatePetFromBookCompletion:r}=xe(),{theme:n}=Y(),m=ke(),[l,d]=E.useState(null),[h,c]=E.useState(null),[f,N]=E.useState({}),[i,j]=E.useState([]);E.useEffect(()=>{(()=>{const S=JSON.parse(localStorage.getItem("bookish_books")||"[]");j(S)})()},[]),E.useEffect(()=>{const v=()=>{d(null)};if(l)return document.addEventListener("click",v),()=>document.removeEventListener("click",v)},[l]);const p=i.length>0?i:t,C=v=>{u(`/book?book=${v.key}`,{state:{bookData:v}})},y=(v,S)=>{S.stopPropagation(),m.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const k=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(F=>F.key!==v);localStorage.setItem("bookish_books",JSON.stringify(k));const O=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(F=>F.key!==v);localStorage.setItem("myBooks",JSON.stringify(O));const J=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete J[v],localStorage.setItem("bookish_cached_books",JSON.stringify(J));const L=JSON.parse(localStorage.getItem("bookish_current_book")||"null");L&&L.key===v&&localStorage.removeItem("bookish_current_book"),j(k)},{confirmText:"Remove",cancelText:"Keep Book"}),d(null)},A=async(v,S,_)=>{const k=JSON.parse(localStorage.getItem("bookish_books")||"[]"),U=k.find(R=>R.key===v);if(!U)return;const O={...U,category:S,...S==="completed"&&{completedAt:new Date().toISOString()}};await a(O);const J=k.map(R=>R.key===v?O:R);localStorage.setItem("bookish_books",JSON.stringify(J));const F=JSON.parse(localStorage.getItem("myBooks")||"[]").map(R=>R.key===v?O:R);localStorage.setItem("myBooks",JSON.stringify(F)),j(J),c(null),d(null)},g=(v,S)=>{S.stopPropagation(),m.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",async()=>{await A(v,"completed"),await o(),r(),setTimeout(()=>{s("week","books_read")},1e3),setTimeout(()=>{m.showAlert("Book Completed!","ðŸŽ‰ Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),d(null)},b=(v,S)=>{S.stopPropagation(),d(l===v?null:v)},w=v=>{const S=at(v);if(S.length===0)return 0;const _=S[S.length-1],k=t.find(U=>U.key===v);return!(k!=null&&k.number_of_pages_median)||!_.endPage?0:Math.min(100,Math.round(_.endPage/k.number_of_pages_median*100))},x=v=>at(v).reduce((_,k)=>_+(k.duration||0),0),P=v=>{const S=Math.floor(v/60),_=v%60;return S>0?`${S}h ${_}m`:`${_}m`},T=()=>{const v=[],S=[],_=[];return p.forEach(k=>{const U=w(k.key),O=x(k.key);k.category==="want-to-read"?_.push(k):k.category==="completed"||U>=100?S.push(k):k.category==="currently-reading"||U>0||O>0?v.push(k):_.push(k)}),{currentlyReading:v,completed:S,wantToRead:_}},B=v=>{const S=w(v.key),_=x(v.key),k=f[v.key]||{translateX:0,isDeleting:!1},U=R=>{const G=R.touches[0];N(I=>({...I,[v.key]:{...k,startX:G.clientX,startY:G.clientY}}))},O=R=>{const G=R.touches[0],I=f[v.key];if(!(I!=null&&I.startX)||!(I!=null&&I.startY))return;const M=G.clientX-I.startX,q=G.clientY-I.startY;Math.abs(q)>Math.abs(M)||M<-20&&N(H=>({...H,[v.key]:{...I,translateX:Math.max(M,-120)}}))},J=()=>{const R=f[v.key];R&&(R.translateX<-60?N(G=>({...G,[v.key]:{...R,translateX:-120,isDeleting:!0}})):N(G=>({...G,[v.key]:{...R,translateX:0,isDeleting:!1}})))},L=()=>{m.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const G=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(q=>q.key!==v.key);localStorage.setItem("bookish_books",JSON.stringify(G));const M=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(q=>q.key!==v.key);localStorage.setItem("myBooks",JSON.stringify(M)),j(G),N(q=>{const H={...q};return delete H[v.key],H})},{confirmText:"Remove",cancelText:"Keep Book"})},F=()=>{N(R=>({...R,[v.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{backgroundColor:n.colors.surface,transform:`translateX(${k.translateX}px)`,transition:k.isDeleting||k.translateX===0?"transform 0.3s ease":"none",overflow:k.isDeleting?"hidden":"visible"},onTouchStart:U,onTouchMove:O,onTouchEnd:J,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!k.isDeleting&&C(v),children:["          ",e.jsxs("div",{className:"w-12 h-16 rounded flex-shrink-0 flex items-center justify-center",style:{backgroundColor:n.colors.borderLight},children:[v.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${v.cover_i}-M.jpg`,alt:v.title,className:"w-full h-full object-cover rounded",onError:R=>{var I;const G=R.target;G.style.display="none",(I=G.nextElementSibling)==null||I.classList.remove("hidden")}}):null,e.jsx(K,{className:`w-6 h-6 ${v.cover_i?"hidden":""}`,style:{color:n.colors.textSecondary}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-sm leading-tight mb-1 truncate",style:{color:n.colors.textPrimary},children:v.title}),v.author_name&&e.jsxs("p",{className:"text-xs mb-2 truncate",style:{color:n.colors.textSecondary},children:["by ",v.author_name[0]]}),S>0&&S<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textSecondary},children:[S,"%"]})]}),e.jsx("div",{className:"w-full rounded-full h-1.5",style:{backgroundColor:n.colors.borderLight},children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${S}%`,backgroundColor:n.colors.secondary}})})]}),S>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(ge,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),_>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:n.colors.textSecondary},children:[e.jsx(re,{className:"w-3 h-3"}),e.jsxs("span",{children:[P(_)," read"]})]})]})]}),!k.isDeleting&&e.jsx("button",{onClick:R=>b(v.key,R),className:"absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:e.jsx(ts,{className:"w-4 h-4",style:{color:n.colors.textSecondary}})}),"        ",l===v.key&&!k.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 rounded-lg shadow-lg py-1 z-50 min-w-[180px]",style:{backgroundColor:n.colors.surface,border:`1px solid ${n.colors.border}`},children:[e.jsxs("button",{onClick:R=>{R.stopPropagation(),c(v.key),d(null)},className:"flex items-center gap-2 px-3 py-2 text-sm w-full text-left transition-colors hover:opacity-80",style:{color:n.colors.textSecondary,backgroundColor:"transparent"},onMouseEnter:R=>R.currentTarget.style.backgroundColor=n.colors.borderLight,onMouseLeave:R=>R.currentTarget.style.backgroundColor="transparent",children:[e.jsx(ss,{className:"w-4 h-4"}),"Move to category"]}),v.category!=="completed"&&e.jsxs("button",{onClick:R=>g(v.key,R),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(ge,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:R=>y(v.key,R),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(pt,{className:"w-4 h-4"}),"Remove from library"]})]}),k.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:["              ",e.jsx("button",{onClick:F,className:"px-3 py-1 text-xs text-red-500 rounded",style:{backgroundColor:n.colors.surface},children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},v.key)},D=(v,S)=>S.length===0?null:e.jsxs("div",{className:"mb-8",children:["        ",e.jsxs("h2",{className:"font-serif text-lg font-medium mb-4 flex items-center gap-2",style:{color:n.colors.textPrimary},children:[v,e.jsxs("span",{className:"text-sm font-normal",style:{color:n.colors.textSecondary},children:["(",S.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:S.map(B)})]});return e.jsx(Pe,{children:e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:n.colors.background,borderColor:n.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:n.colors.surfaceSecondary},children:e.jsx(ee,{className:"w-5 h-5",style:{color:n.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:n.colors.textPrimary},children:"My Library"})]})}),e.jsx("main",{className:"p-4",children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4",style:{color:n.colors.textSecondary}}),"            ",e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:n.colors.textPrimary},children:"No books yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>u("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:n.colors.secondary},children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:n.colors.textSecondary},children:[p.length," book",p.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:v,completed:S,wantToRead:_}=T();return e.jsxs(e.Fragment,{children:[D("Currently Reading",v),D("Want to Read",_),D("Completed",S)]})})()]})}),h&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:["          ",e.jsxs("div",{className:"rounded-xl p-6 w-full max-w-sm",style:{backgroundColor:n.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:n.colors.textPrimary},children:"Move Book"}),e.jsx("p",{className:"text-sm mb-6",style:{color:n.colors.textSecondary},children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>A(h,"want-to-read"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Want to Read"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>A(h,"currently-reading"),className:"w-full p-3 rounded-lg text-left transition-colors hover:opacity-80",style:{backgroundColor:n.colors.borderLight},children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Currently Reading"}),e.jsx("div",{className:"text-xs",style:{color:n.colors.textSecondary},children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>A(h,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.textPrimary},children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>c(null),className:"w-full mt-4 py-2 text-sm transition-colors hover:opacity-80",style:{color:n.colors.textSecondary},children:"Cancel"}),"          "]})]}),"      ",e.jsx(Se,{isOpen:m.isOpen,onClose:m.close,onConfirm:m.onConfirm||void 0,title:m.config.title,message:m.config.message,type:m.config.type,confirmText:m.config.confirmText,cancelText:m.config.cancelText})]})})},ir=()=>{const u=X(),{books:t}=ie(),{pet:a}=xe(),{theme:o}=Y(),s=bt(),r=vt(),n=Le(),m=f=>{const N=Math.floor(f/60),i=f%60;return N>0?`${N}h ${i}m`:`${i}m`},l=()=>{if(n.length===0)return 0;const f=n.reduce((N,i)=>N+(i.duration||0),0);return Math.round(f/n.length)},h=(()=>{const f=new Date,N=new Date(f.getFullYear(),f.getMonth(),1),i=n.filter(C=>new Date(C.startTime)>=N),j=i.reduce((C,y)=>C+(y.duration||0),0),p=i.reduce((C,y)=>C+((y.endPage||0)-(y.startPage||0)),0);return{time:j,pages:p,sessions:i.length}})(),c=({icon:f,title:N,value:i,subtitle:j})=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(f,{className:"w-4 h-4",style:{color:o.colors.textSecondary}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:N})]}),e.jsx("p",{className:"text-2xl font-serif font-medium mb-1",style:{color:o.colors.textPrimary},children:i}),j&&e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:j})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:o.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:o.colors.background,borderBottom:`1px solid ${o.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:o.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:o.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:o.colors.textPrimary},children:"Reading Statistics"})]})}),"      ",e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{icon:K,title:"Books Read",value:s.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(c,{icon:re,title:"Total Time",value:m(s.totalReadingTime),subtitle:"all time"}),e.jsx(c,{icon:ve,title:"Pages Read",value:s.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(c,{icon:We,title:"Current Streak",value:`${r.currentStreak} days`,subtitle:`longest: ${r.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Fe,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsx("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.sessions}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:m(h.time)}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:h.pages}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"pages"})]})]})]})})]}),"        ",e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{icon:re,title:"Today",value:m(s.readingTimeToday)}),e.jsx(c,{icon:Fe,title:"This Week",value:m(s.readingTimeThisWeek)}),e.jsx(c,{icon:ve,title:"Average Session",value:m(l())}),e.jsx(c,{icon:K,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium mb-3",style:{color:o.colors.textPrimary},children:"Reading Companion"}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(rs,{className:"w-5 h-5",style:{color:o.colors.textSecondary}}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.textPrimary},children:[a.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.level}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:[a.happiness,"%"]}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium",style:{color:o.colors.textPrimary},children:a.experience}),e.jsx("p",{className:"text-xs",style:{color:o.colors.textSecondary},children:"experience"})]})]})]})]}),n.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(We,{className:"w-16 h-16 mx-auto mb-4",style:{color:o.colors.textSecondary}}),e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:o.colors.textPrimary},children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm mb-6",style:{color:o.colors.textSecondary},children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>u("/search"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:o.colors.secondary},children:"Find a Book to Read"})]})]})]})},cr=()=>{const u=X(),{notes:t,books:a,deleteNote:o}=ie(),{theme:s}=Y(),r=ke(),n=d=>{r.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{o(d)},{confirmText:"Delete",cancelText:"Cancel"})},m=d=>{const h=a.find(c=>c.key===d);return h?h.title:"Unknown Book"},l=d=>new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:s.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:s.colors.background,borderBottom:`1px solid ${s.colors.border}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:s.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:s.colors.textPrimary},children:"My Notes"})]}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:s.colors.secondary},children:e.jsx(xt,{className:"w-5 h-5 text-white"})})]})}),"      ",e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 mx-auto mb-4",style:{color:s.colors.textSecondary}}),e.jsx("h2",{className:"font-serif text-lg font-medium mb-2",style:{color:s.colors.textPrimary},children:"No notes yet"}),e.jsx("p",{className:"text-sm mb-6",style:{color:s.colors.textSecondary},children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>u("/notes/add"),className:"px-6 py-3 rounded-xl font-medium text-white",style:{backgroundColor:s.colors.secondary},children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(d=>e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4",style:{color:s.colors.textSecondary}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:s.colors.textPrimary},children:m(d.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:s.colors.textSecondary},children:[d.chapter&&e.jsxs("span",{children:["Chapter: ",d.chapter]}),d.page&&e.jsxs("span",{children:["Page ",d.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:l(d.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>n(d.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(pt,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",style:{color:s.colors.textPrimary},children:d.content})})]},d.id))]})}),e.jsx(Se,{isOpen:r.isOpen,onClose:r.close,onConfirm:r.onConfirm||void 0,title:r.config.title,message:r.config.message,type:r.config.type,confirmText:r.config.confirmText,cancelText:r.config.cancelText})]})},dr=()=>{const u=X(),[t]=ut(),{books:a,currentBook:o,addNote:s,notes:r,updateNote:n}=ie(),{theme:m}=Y(),l=ke(),d=t.get("edit"),[h,c]=E.useState((o==null?void 0:o.key)||""),[f,N]=E.useState(""),[i,j]=E.useState(""),[p,C]=E.useState("");E.useEffect(()=>{var g;if(d){const b=r.find(w=>w.id===d);b&&(c(b.bookId),N(b.content),j(((g=b.page)==null?void 0:g.toString())||""),C(b.chapter||""))}},[d,r]);const y=()=>{var b;if(!f.trim()){l.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const g={id:d||we(),bookId:h,content:f.trim(),page:i?parseInt(i):void 0,chapter:p.trim()||void 0,createdAt:d?((b=r.find(w=>w.id===d))==null?void 0:b.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};d&&n?n(g):s(g),l.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{u("/notes")},1500)},A=()=>{f.trim()||p.trim()||i.trim()?l.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{u(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):u(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:m.colors.background},children:[e.jsx("header",{className:"p-4 border-b",style:{backgroundColor:m.colors.background,borderColor:m.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:A,className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:m.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:m.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:m.colors.textPrimary},children:d?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(os,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:h,onChange:g=>c(g.target.value),className:"w-full p-3 pr-10 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] appearance-none",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary},children:[e.jsx("option",{value:"",children:"Choose a book..."}),a.map(g=>e.jsx("option",{value:g.key,children:g.title},g.key))]}),e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:m.colors.textSecondary}})]})]}),"        ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:p,onChange:g=>C(g.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Page (optional)"}),e.jsx("input",{type:"number",value:i,onChange:g=>j(g.target.value),placeholder:"Page number",className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355]",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}})]})]}),"        ",e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:m.colors.textPrimary},children:"Your Note"}),e.jsx("textarea",{value:f,onChange:g=>N(g.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] resize-none",style:{backgroundColor:m.colors.surface,borderColor:m.colors.border,color:m.colors.textPrimary}}),e.jsxs("p",{className:"text-xs mt-2",style:{color:m.colors.textSecondary},children:[f.length,"/500 characters"]})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:m.colors.surface},children:[e.jsx("h3",{className:"font-medium mb-2",style:{color:m.colors.textPrimary},children:"ðŸ’¡ Note-taking tips:"}),e.jsxs("ul",{className:"text-sm space-y-1",style:{color:m.colors.textSecondary},children:[e.jsx("li",{children:"â€¢ Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"â€¢ Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"â€¢ Record connections to other books or personal experiences"}),e.jsx("li",{children:"â€¢ Include your emotional reactions or reflections"})]})]})]}),e.jsx(Se,{isOpen:l.isOpen,onClose:l.close,onConfirm:l.onConfirm||void 0,title:l.config.title,message:l.config.message,type:l.config.type,confirmText:l.config.confirmText,cancelText:l.config.cancelText})]})},ur=()=>{const u=X(),{theme:t}=Y(),{pet:a,petStats:o,feedPet:s,playWithPet:r,petSleep:n,getPetMood:m,getPetEvolutionRequirement:l,resetPet:d,updatePetName:h,getPetEmoji:c,canEvolve:f,evolvePet:N}=xe(),[i,j]=E.useState(!1),[p,C]=E.useState(a.name),[y,A]=E.useState(!1),g=v=>v>70?"bg-green-500":v>40?"bg-yellow-500":"bg-red-500",b=v=>`${Math.max(0,Math.min(100,v))}%`,w=()=>{p.trim()&&(h(p.trim()),j(!1))},x=()=>{d(),A(!1)},P=v=>({"first-book":"ðŸ“–","book-lover":"ðŸ“š",bookworm:"ðŸ›","speed-reader":"âš¡","night-owl":"ðŸ¦‰","early-bird":"ðŸ¦"})[v]||"ðŸ†",T=v=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[v]||"Special achievement",B=v=>{const S=Math.floor(v/60),_=v%60;return S>0?`${S}h ${_}m`:`${_}m`},D=l();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("header",{className:"p-4",style:{backgroundColor:t.colors.background,borderBottom:`1px solid ${t.colors.border}`},children:e.jsxs("div",{className:"flex items-center gap-3",children:["          ",e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.textSecondary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"My Reading Pet"})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:["        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-6 text-center",style:{backgroundColor:t.colors.surface},children:[e.jsx("div",{className:"text-8xl mb-4",children:c()}),e.jsxs("div",{className:"mb-4",children:[i?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:p,onChange:v=>C(v.target.value),className:"text-2xl font-serif font-medium rounded px-3 py-1 border text-center",style:{backgroundColor:t.colors.borderLight,color:t.colors.textPrimary,borderColor:t.colors.border},onBlur:w,onKeyPress:v=>v.key==="Enter"&&w(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["                ",e.jsx("h2",{className:"text-2xl font-serif font-medium",style:{color:t.colors.textPrimary},children:a.name}),e.jsx("button",{onClick:()=>j(!0),className:"p-1 rounded transition-colors hover:opacity-80",style:{color:t.colors.textSecondary,backgroundColor:t.colors.borderLight},children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg mb-2",style:{color:t.colors.textSecondary},children:[e.jsxs("span",{children:["Level ",a.level]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:a.evolutionStage})]}),f()&&e.jsxs("button",{onClick:N,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["âœ¨ Evolve to ",D.stage,"!"]})]}),"          ",e.jsx("p",{className:"mb-4",style:{color:t.colors.textPrimary},children:m()}),e.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold mb-1",style:{color:t.colors.primary},children:["ðŸ’° ",a.points]}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Care Points (Earned from reading)"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",style:{color:t.colors.textSecondary},children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[a.experience,"/",a.experienceToNext]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${a.experience/a.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:s,disabled:a.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ke,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"ðŸ’° 3 pts"})]}),e.jsxs("button",{onClick:r,disabled:a.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${a.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ie,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"ðŸ’° 5 pts"})]}),e.jsxs("button",{onClick:n,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(ze,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),"                ",e.jsxs("span",{children:[a.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${g(a.happiness)} rounded-full transition-all duration-300`,style:{width:b(a.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),"                ",e.jsxs("span",{children:[a.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${g(a.hunger)} rounded-full transition-all duration-300`,style:{width:b(a.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),"                ",e.jsxs("span",{children:[a.energy,"/100"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{backgroundColor:t.colors.borderLight},children:e.jsx("div",{className:`h-full ${g(a.energy)} rounded-full transition-all duration-300`,style:{width:b(a.energy)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[a.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${g(a.health)} rounded-full transition-all duration-300`,style:{width:b(a.health)}})})]})]})]}),"        ",e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:["            ",e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:a.totalBooksRead}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:B(a.totalReadingTime)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:o.booksReadToday}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:B(o.readingTimeToday)}),e.jsx("div",{className:"text-sm",style:{color:t.colors.textSecondary},children:"Today's Time"})]})]})]}),"        ",a.badges.length>0&&e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-4",style:{color:t.colors.textPrimary},children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.badges.map((v,S)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:t.colors.borderLight},children:[e.jsx("div",{className:"text-2xl",children:P(v)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize text-sm",style:{color:t.colors.textPrimary},children:v.replace("-"," ")}),e.jsx("div",{className:"text-xs",style:{color:t.colors.textSecondary},children:T(v)})]})]},S))})]}),e.jsxs("div",{className:"rounded-xl shadow-sm p-4",style:{backgroundColor:t.colors.surface},children:[e.jsx("h3",{className:"font-serif text-lg font-medium mb-2",style:{color:t.colors.textPrimary},children:"Pet Management"}),e.jsx("p",{className:"text-sm mb-4",style:{color:t.colors.textSecondary},children:"Reset your pet to start over with a new companion. This action cannot be undone."}),y?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(as,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},Tt=({message:u,type:t,onClose:a})=>{const o={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"âœ“",error:"âœ•",info:"â„¹"}[t];return dt.useEffect(()=>{const r=setTimeout(()=>{a()},3e3);return()=>clearTimeout(r)},[a]),e.jsxs("div",{className:`fixed top-4 right-4 ${o} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:u}),e.jsx("button",{onClick:a,className:"ml-2 text-white hover:text-gray-200",children:"âœ•"})]})},ct=({className:u="",showLabel:t=!0})=>{const{theme:a,toggleTheme:o}=Y();return e.jsxs("div",{className:`flex items-center gap-3 ${u}`,children:[t&&e.jsx("span",{className:"text-sm font-medium",style:{color:a.colors.textPrimary},children:"Theme"}),e.jsx("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`,color:a.colors.textPrimary},"aria-label":`Switch to ${a.isDark?"light":"dark"} mode`,children:e.jsx("div",{className:"flex items-center gap-2",children:a.isDark?e.jsxs(e.Fragment,{children:[e.jsx(ft,{size:16,style:{color:a.colors.warning}}),t&&e.jsx("span",{className:"text-sm",children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{size:16,style:{color:a.colors.textSecondary}}),t&&e.jsx("span",{className:"text-sm",children:"Dark"})]})})})]})},mr=()=>{var b;const{user:u,signOut:t,updateProfile:a}=ce(),{theme:o}=Y(),s=X(),[r,n]=E.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[m,l]=E.useState(!1),[d,h]=E.useState(!1),[c,f]=E.useState(""),[N,i]=E.useState(null),j=(b=u==null?void 0:u.id)==null?void 0:b.startsWith("guest-");E.useEffect(()=>{u&&p()},[u]),E.useEffect(()=>{u!=null&&u.profile&&!j&&n({displayName:u.profile.displayName||"",bio:u.profile.bio||"",favoriteGenres:u.profile.favoriteGenres||[],readingGoal:u.profile.readingGoal||12,joinedDate:u.profile.joinedDate||u.createdAt})},[u==null?void 0:u.profile,j]);const p=async()=>{console.log("ProfilePage: Loading profile for user:",u==null?void 0:u.id,"isGuest:",j);try{if(j){const x=ae.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",x),x){n({displayName:x.displayName||"Guest User",bio:x.bio||"Browsing as a guest",favoriteGenres:x.favoriteGenres||[],readingGoal:x.readingGoal||12,joinedDate:x.joinedDate||(u==null?void 0:u.createdAt)});return}u!=null&&u.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),n({displayName:u.profile.displayName||"Guest User",bio:u.profile.bio||"Browsing as a guest",favoriteGenres:u.profile.favoriteGenres||[],readingGoal:u.profile.readingGoal||12,joinedDate:u.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const w=await $.getProfile();if(console.log("ProfilePage: Gun service profile result:",w),w.success&&w.profile){const x={displayName:w.profile.displayName||"",bio:w.profile.bio||"",favoriteGenres:w.profile.favoriteGenres||[],readingGoal:w.profile.readingGoal||12,joinedDate:w.profile.joinedDate||w.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",x),n(x)}else console.log("ProfilePage: No profile found or error loading profile")}catch(w){console.error("Error loading profile:",w)}},C=async()=>{if(u){console.log("ProfilePage: Saving profile:",r),h(!0);try{if(j){ae.setGuestProfile(r),l(!1),console.log("Guest profile saved to localStorage:",r),i({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",r);const w=await a(r);console.log("ProfilePage: updateProfile result:",w),w.success?(l(!1),console.log("Profile saved successfully"),i({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await p()):(console.error("Error saving profile:",w.error),i({message:`Failed to save profile: ${w.error||"Unknown error"}`,type:"error"}))}catch(w){console.error("Error saving profile:",w),i({message:"Failed to save profile. Please try again.",type:"error"})}finally{h(!1)}}},y=()=>{c.trim()&&!r.favoriteGenres.includes(c.trim())&&(n(w=>({...w,favoriteGenres:[...w.favoriteGenres,c.trim()]})),f(""))},A=w=>{n(x=>({...x,favoriteGenres:x.favoriteGenres.filter(P=>P!==w)}))},g=()=>{t()};return u?e.jsxs(Pe,{children:[e.jsxs("div",{className:"min-h-screen py-8 transition-colors duration-200",style:{backgroundColor:o.colors.background},children:[j&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"border px-4 py-3 rounded-lg",style:{backgroundColor:o.colors.wantToRead,borderColor:o.colors.border,color:o.colors.wantToReadText},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl overflow-hidden transition-colors duration-200",style:{backgroundColor:o.colors.surface},children:["            ",e.jsxs("div",{className:"px-8 py-12 text-white relative",style:{background:`linear-gradient(to right, ${o.colors.primary}, ${o.colors.primaryLight})`},children:[e.jsx("button",{onClick:()=>s(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:r.displayName||(u==null?void 0:u.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:r.bio||"A passionate reader exploring new worlds through books"}),r.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(r.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>l(!m),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),m?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:g,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),m?e.jsx("input",{type:"text",value:r.displayName,onChange:w=>n(x=>({...x,displayName:w.target.value})),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent input-field",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.textPrimary},placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:r.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),m?e.jsx("textarea",{value:r.bio,onChange:w=>n(x=>({...x,bio:w.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:r.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),m?e.jsx("input",{type:"number",min:"1",max:"365",value:r.readingGoal,onChange:w=>n(x=>({...x,readingGoal:parseInt(w.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[r.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),m&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:w=>f(w.target.value),onKeyPress:w=>w.key==="Enter"&&y(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.favoriteGenres.map((w,x)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[w,m&&e.jsx("button",{onClick:()=>A(w),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},x)),"                    ",r.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:o.colors.primary},children:"App Settings"}),e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border},children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:o.colors.textPrimary},children:"Appearance"}),e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Choose your preferred theme for the app"})]}),e.jsx(ct,{})]})})})]}),"                  ",e.jsxs("div",{className:"mt-8 p-6 rounded-xl",style:{background:`linear-gradient(to right, ${o.colors.surfaceSecondary}, ${o.colors.surfaceElevated})`},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.primary},children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.primary},children:"0"}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textSecondary},children:"Pages Read"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:o.colors.textPrimary},children:"Preferences"}),e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:o.colors.surface},children:e.jsx(ct,{})})]})]})]}),m&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:C,disabled:d,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),N&&e.jsx(Tt,{message:N.message,type:N.type,onClose:()=>i(null)})]}):e.jsx(Pe,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},hr=()=>{const u=X(),{theme:t}=Y(),{friends:a,friendRequests:o,friendActivity:s,loading:r,sendFriendRequest:n,acceptFriendRequest:m,declineFriendRequest:l,removeFriend:d,refreshFriendActivity:h,searchUsers:c}=Ne(),[f,N]=E.useState("activity"),[i,j]=E.useState(""),[p,C]=E.useState([]),[y,A]=E.useState(!1),[g,b]=E.useState(null),[w,x]=E.useState(null),[P,T]=E.useState(null);E.useEffect(()=>{h()},[]),E.useEffect(()=>{i.length>2?c(i).then(C):C([])},[i,c]);const B=async k=>{b(k);try{await n(k)?(j(""),C([]),A(!1),T({message:`Friend request sent to ${k}!`,type:"success"})):T({message:"Failed to send friend request",type:"error"})}finally{b(null)}},D=async(k,U)=>{x(k);try{const O=await m(k);T(O?{message:`You're now friends with ${U}!`,type:"success"}:{message:"Failed to accept friend request",type:"error"})}finally{x(null)}},v=async k=>{const U=await l(k);T(U?{message:"Friend request declined",type:"info"}:{message:"Failed to decline friend request",type:"error"})},S=k=>{const U=new Date,O=new Date(k),J=Math.floor((U.getTime()-O.getTime())/(1e3*60));return J<60?`${J}m ago`:J<1440?`${Math.floor(J/60)}h ago`:`${Math.floor(J/1440)}d ago`},_=k=>{switch(k){case"book_completed":return e.jsx(K,{className:"w-4 h-4"});case"reading_session":return e.jsx(re,{className:"w-4 h-4"});case"achievement_unlocked":return e.jsx(ne,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Friends"})]}),e.jsx("button",{onClick:()=>A(!y),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.primary},children:e.jsx(Qe,{className:"w-5 h-5 text-white"})})]})}),y&&e.jsxs("div",{className:"p-4 border-b",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:t.colors.textSecondary}}),e.jsx("input",{type:"text",placeholder:"Search for users...",value:i,onChange:k=>j(k.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-opacity-50",style:{backgroundColor:t.colors.background,borderColor:t.colors.border,color:t.colors.textPrimary}})]}),p.length>0&&e.jsx("div",{className:"space-y-2",children:p.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg",style:{backgroundColor:t.colors.background},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:k.displayName||k.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",k.username]})]}),"                  ",e.jsx("button",{onClick:()=>B(k.username),className:"px-3 py-1 rounded-lg text-sm font-medium text-white",style:{backgroundColor:t.colors.primary},disabled:r||g===k.username,children:g===k.username?"Sending...":"Add"})]},k.id))})]}),e.jsx("div",{className:"flex border-b",style:{borderColor:t.colors.border},children:[{id:"activity",label:"Activity",count:s.length},{id:"friends",label:"Friends",count:a.length},{id:"requests",label:"Requests",count:o.length}].map(k=>e.jsxs("button",{onClick:()=>N(k.id),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${f===k.id?"border-opacity-100":"border-transparent"}`,style:{color:f===k.id?t.colors.primary:t.colors.textSecondary,borderColor:f===k.id?t.colors.primary:"transparent"},children:[k.label,k.count>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:k.count})]},k.id))}),e.jsxs("div",{className:"p-4",children:[f==="activity"&&e.jsx("div",{className:"space-y-3",children:s.length>0?s.map(k=>e.jsx("div",{className:"p-3 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:_(k.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",style:{color:t.colors.textPrimary},children:k.displayName||k.username}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textSecondary},children:S(k.timestamp)})]}),e.jsx("p",{className:"text-sm mb-1",style:{color:t.colors.textPrimary},children:k.description}),k.metadata&&e.jsxs("div",{className:"flex gap-4 text-xs",style:{color:t.colors.textSecondary},children:[k.metadata.pagesRead&&e.jsxs("span",{children:[k.metadata.pagesRead," pages"]}),k.metadata.duration&&e.jsxs("span",{children:[k.metadata.duration," min"]})]})]})]})},k.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend activity yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Friend activity will appear here when your friends complete books or reading sessions"})]})}),f==="friends"&&e.jsx("div",{className:"space-y-3",children:a.length>0?a.map(k=>e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:k.displayName||k.username}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",k.username]})]})]}),e.jsx("button",{onClick:()=>d(k.id),className:"px-3 py-1 rounded-lg text-sm",style:{backgroundColor:t.colors.borderLight,color:t.colors.textSecondary},children:"Remove"})]}),k.stats&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:k.stats.totalBooksRead}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Books Read"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:t.colors.primary},children:k.stats.currentStreak}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Day Streak"})]})]})]},k.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friends yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Start by searching for users to add as friends!"})]})}),f==="requests"&&e.jsx("div",{className:"space-y-3",children:o.length>0?o.map(k=>e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.borderLight},children:e.jsx(me,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:k.fromDisplayName||k.fromUsername}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",k.fromUsername]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(k.id,k.fromUsername),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:w===k.id?"#6B7280":"#10B981"},disabled:r||w===k.id,children:w===k.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ge,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>v(k.id),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#EF4444"},disabled:r||w===k.id,children:e.jsx(_e,{className:"w-4 h-4 text-white"})})]})]})},k.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No friend requests"}),"              "]})})]}),P&&e.jsx(Tt,{message:P.message,type:P.type,onClose:()=>T(null)})]})},fr=()=>{const u=X(),{theme:t}=Y(),{user:a}=ce(),{leaderboard:o,loading:s,refreshLeaderboard:r}=Ne(),[n,m]=E.useState("week"),[l,d]=E.useState("books_read");E.useEffect(()=>{r(n,l)},[n,l,r]);const h=p=>{switch(p){case 1:return e.jsx(ns,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(Ve,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Ve,{className:"w-5 h-5 text-yellow-600"});default:return e.jsxs("span",{className:"font-bold text-lg",style:{color:t.colors.textSecondary},children:["#",p]})}},c=p=>{switch(p){case"books_read":return e.jsx(K,{className:"w-4 h-4"});case"pages_read":return e.jsx(ve,{className:"w-4 h-4"});case"reading_time":return e.jsx(re,{className:"w-4 h-4"});case"streak":return e.jsx(Ue,{className:"w-4 h-4"});default:return e.jsx(K,{className:"w-4 h-4"})}},f=(p,C)=>{switch(C){case"books_read":return`${p} books`;case"pages_read":return`${p.toLocaleString()} pages`;case"reading_time":const y=Math.floor(p/60),A=p%60;return y>0?`${y}h ${A}m`:`${A}m`;case"streak":return`${p} days`;default:return p.toString()}},N=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"year",label:"This Year"},{id:"alltime",label:"All Time"}],i=[{id:"books_read",label:"Books Read",icon:K},{id:"pages_read",label:"Pages Read",icon:ve},{id:"reading_time",label:"Reading Time",icon:re},{id:"streak",label:"Reading Streak",icon:Ue}],j=o.find(p=>p.userId===(a==null?void 0:a.id));return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen",style:{backgroundColor:t.colors.background},children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/"),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:t.colors.surface},children:e.jsx(ee,{className:"w-5 h-5",style:{color:t.colors.primary}})}),e.jsx("h1",{className:"font-serif text-xl font-medium",style:{color:t.colors.textPrimary},children:"Leaderboard"})]})}),j&&e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"p-4 rounded-xl",style:{backgroundColor:t.colors.primary+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(j.rank)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:"Your Rank"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:f(j.score,l)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",style:{color:t.colors.primary},children:["#",j.rank]}),e.jsxs("p",{className:"text-xs",style:{color:t.colors.textSecondary},children:["out of ",o.length]})]})]})})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"flex gap-2",children:N.map(p=>e.jsx("button",{onClick:()=>m(p.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===p.id?"text-white":""}`,style:{backgroundColor:n===p.id?t.colors.primary:t.colors.surface,color:n===p.id?"white":t.colors.textSecondary},children:p.label},p.id))})}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(p=>{const C=p.icon;return e.jsxs("button",{onClick:()=>d(p.id),className:`p-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l===p.id?"text-white":""}`,style:{backgroundColor:l===p.id?t.colors.primary:t.colors.surface,color:l===p.id?"white":t.colors.textSecondary},children:[e.jsx(C,{className:"w-4 h-4"}),p.label]},p.id)})})}),e.jsxs("div",{className:"p-4",children:[s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((p,C)=>e.jsx("div",{className:"p-4 rounded-xl animate-pulse",style:{backgroundColor:t.colors.surface},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:t.colors.borderLight}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:t.colors.borderLight}}),e.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:t.colors.borderLight}})]})]})},C))}):e.jsxs("div",{className:"space-y-3",children:["            ",o.map(p=>e.jsx("div",{className:`p-4 rounded-xl transition-all ${p.userId===(a==null?void 0:a.id)?"ring-2":""}`,style:{backgroundColor:t.colors.surface,...p.userId===(a==null?void 0:a.id)&&{boxShadow:`0 0 0 2px ${t.colors.primary}`}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10",children:h(p.rank)}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:t.colors.textPrimary},children:[p.displayName||p.username,p.userId===(a==null?void 0:a.id)&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.primary+"20",color:t.colors.primary},children:"You"})]}),e.jsxs("p",{className:"text-sm",style:{color:t.colors.textSecondary},children:["@",p.username]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[c(l),e.jsx("span",{className:"font-bold",style:{color:t.colors.primary},children:f(p.score,l)})]}),p.details&&e.jsxs("div",{className:"text-xs mt-1",style:{color:t.colors.textSecondary},children:[l!=="books_read"&&p.details.booksRead&&e.jsxs("span",{children:[p.details.booksRead," books â€¢ "]}),l!=="streak"&&p.details.currentStreak&&e.jsxs("span",{children:[p.details.currentStreak," day streak"]})]})]})]})},p.userId))]}),!s&&o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.colors.textSecondary}}),e.jsx("p",{style:{color:t.colors.textSecondary},children:"No leaderboard data yet"}),e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.textSecondary},children:"Add friends to compete on the leaderboard!"})]})]})]})},gr=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"ðŸ“š"}),e.jsx("span",{children:"Bookish"})]})}),"      ",e.jsx(Us,{children:e.jsx(Ls,{children:e.jsx(Ms,{children:e.jsx(Ds,{children:e.jsx(As,{children:e.jsx(Dt,{basename:"/Bookish",children:e.jsxs($s,{children:[e.jsxs(It,{children:[e.jsx(Z,{path:"/",element:e.jsx(Qs,{})}),e.jsx(Z,{path:"/welcome",element:e.jsx(qs,{})}),e.jsx(Z,{path:"/search",element:e.jsx(Zs,{})}),e.jsx(Z,{path:"/library",element:e.jsx(lr,{})}),e.jsx(Z,{path:"/book",element:e.jsx(er,{})}),e.jsx(Z,{path:"/reading",element:e.jsx(nr,{})}),e.jsx(Z,{path:"/notes",element:e.jsx(cr,{})}),e.jsx(Z,{path:"/notes/add",element:e.jsx(dr,{})}),e.jsx(Z,{path:"/pet",element:e.jsx(ur,{})}),e.jsx(Z,{path:"/stats",element:e.jsx(ir,{})}),e.jsx(Z,{path:"/profile",element:e.jsx(mr,{})}),e.jsx(Z,{path:"/friends",element:e.jsx(hr,{})}),e.jsx(Z,{path:"/leaderboard",element:e.jsx(fr,{})})]}),"                  "]})})})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});ds.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(gr,{})}));
