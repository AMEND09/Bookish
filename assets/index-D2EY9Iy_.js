const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CA_kn7cW.js","assets/vendor-CGGxujwj.js"])))=>i.map(i=>d[i]);
var dt=Object.defineProperty;var ut=(i,t,m)=>t in i?dt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):i[t]=m;var oe=(i,t,m)=>ut(i,typeof t!="symbol"?t+"":t,m);import{a as mt,b as ht,g as xt,c as we,r as B,u as K,d as Qe,e as ft,R as gt,B as pt,f as yt,h as q}from"./vendor-CGGxujwj.js";import{r as bt,c as vt,a as wt}from"./gun-CJ6ok8hl.js";import{B as Y,U as Ze,L as jt,E as Nt,a as St,A as _e,T as et,P as re,H as Se,b as pe,S as kt,c as ke,d as At,e as Et,C as ne,f as Bt,F as Ct,g as Pe,h as le,i as Dt,j as Tt,k as V,l as Fe,m as Ie,X as De,n as Oe,I as _t,o as Pt,p as Ft,q as It,r as ce,s as Ot,t as tt,u as Rt,v as Ut,M as Gt,w as Mt,x as st,y as Re,z as Ae,D as Lt,G as Jt,J as Ue,K as Ge,Z as $t,R as Ht}from"./icons-CrPhkWQG.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function m(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=m(s);fetch(s.href,r)}})();var je={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Me;function Yt(){if(Me)return ie;Me=1;var i=mt(),t=Symbol.for("react.element"),m=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(f,l,d){var a,c={},x=null,y=null;d!==void 0&&(x=""+d),l.key!==void 0&&(x=""+l.key),l.ref!==void 0&&(y=l.ref);for(a in l)n.call(l,a)&&!r.hasOwnProperty(a)&&(c[a]=l[a]);if(f&&f.defaultProps)for(a in l=f.defaultProps,l)c[a]===void 0&&(c[a]=l[a]);return{$$typeof:t,type:f,key:x,ref:y,props:c,_owner:s.current}}return ie.Fragment=m,ie.jsx=o,ie.jsxs=o,ie}var Le;function Kt(){return Le||(Le=1,je.exports=Yt()),je.exports}var e=Kt(),xe={},Je;function qt(){if(Je)return xe;Je=1;var i=ht();return xe.createRoot=i.createRoot,xe.hydrateRoot=i.hydrateRoot,xe}var Wt=qt(),zt=bt();const W=xt(zt);var ye={exports:{}};ye.exports;var $e;function Vt(){return $e||($e=1,function(i){(function(){function t(n,s){return s?vt(n):n.slice?t[r(n)]:function(o,f){n(o={exports:{}}),t[r(f)]=o.exports};function r(o){return o.split("/").slice(-1).toString().replace(".js","")}}var m=i;t(function(n){typeof self<"u"&&(n.window=self),typeof window<"u"&&(n.window=window);var s=n.window||n,r,o=s.SEA||{};(o.window=n.window)&&(o.window.SEA=o);try{r+""!=typeof m&&(m.exports=o)}catch{}n.exports=o})(t,"./root"),t(function(n){var s=t("./root");try{s.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(n){var s;if(s+""==typeof btoa){if(s+""==typeof Buffer)try{we.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}we.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},we.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(t,"./base64"),t(function(n){t("./base64");function s(){}Object.assign(s,{from:Array.from}),s.prototype=Object.create(Array.prototype),s.prototype.toString=function(r,o,f){r=r||"utf8",o=o||0;const l=this.length;if(r==="hex"){const d=new Uint8Array(this);return[...Array((f&&f+1||l)-o).keys()].map(a=>d[a+o].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(f||l)-o},(d,a)=>String.fromCharCode(this[a+o])).join("");if(r==="base64")return btoa(this)},n.exports=s})(t,"./array"),t(function(n){t("./base64");var s=t("./array");function r(...o){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...o)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const o=arguments[0];let f;if(typeof o=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const a=o.match(/([\da-fA-F]{2})/g).map(c=>parseInt(c,16));if(!a||!a.length)throw new TypeError("Invalid first argument for type 'hex'.");f=s.from(a)}else if(d==="utf8"||d==="binary"){const a=o.length,c=new Uint16Array(a);Array.from({length:a},(x,y)=>c[y]=o.charCodeAt(y)),f=s.from(c)}else if(d==="base64"){const a=atob(o),c=a.length,x=new Uint8Array(c);Array.from({length:c},(y,u)=>x[u]=a.charCodeAt(u)),f=s.from(x)}else d==="binary"?f=s.from(o):console.info("SafeBuffer.from unknown encoding: "+d);return f}if(o.byteLength,o.byteLength?o.byteLength:o.length){let d;return o instanceof ArrayBuffer&&(d=new Uint8Array(o)),s.from(d||o)}},alloc(o,f=0){return s.from(new Uint8Array(Array.from({length:o},()=>f)))},allocUnsafe(o){return s.from(new Uint8Array(Array.from({length:o})))},concat(o){if(!Array.isArray(o))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(o.reduce((f,l)=>f.concat(Array.from(l)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,n.exports=r})(t,"./buffer"),t(function(n){const s=t("./root"),r={Buffer:t("./buffer")};var o={},f;if(JSON.parseAsync=JSON.parseAsync||function(d,a,c){var x;try{a(x,JSON.parse(d,c))}catch(y){a(y)}},JSON.stringifyAsync=JSON.stringifyAsync||function(d,a,c,x){var y;try{a(y,JSON.stringify(d,c,x))}catch(u){a(u)}},r.parse=function(d,a){return new Promise(function(c,x){JSON.parseAsync(d,function(y,u){y?x(y):c(u)},a)})},r.stringify=function(d,a,c){return new Promise(function(x,y){JSON.stringifyAsync(d,function(u,w){u?y(u):x(w)},a,c)})},s.window&&(r.crypto=s.window.crypto||s.window.msCrypto,r.subtle=(r.crypto||o).subtle||(r.crypto||o).webkitSubtle,r.TextEncoder=s.window.TextEncoder,r.TextDecoder=s.window.TextDecoder,r.random=d=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(d))))),!r.TextDecoder){const{TextEncoder:d,TextDecoder:a}=t((f+""==typeof m?".":"")+"./lib/text-encoding",1);r.TextDecoder=a,r.TextEncoder=d}if(!r.crypto)try{var l=t("crypto",1);Object.assign(r,{crypto:l,random:a=>r.Buffer.from(l.randomBytes(a))});const{Crypto:d}=t("@peculiar/webcrypto",1);r.ossl=r.subtle=new d({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}n.exports=r})(t,"./shim"),t(function(n){var s=t("./root"),r=t("./shim"),o={};o.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},o.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},o.ecdh={name:"ECDH",namedCurve:"P-256"},o.jwk=function(f,l){f=f.split(".");var d=f[0],a=f[1],c={kty:"EC",crv:"P-256",x:d,y:a,ext:!0};return c.key_ops=l?["sign"]:["verify"],l&&(c.d=l),c},o.keyToJwk=function(f){return{kty:"oct",k:f.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},o.recall={validity:12*60*60,hook:function(f){return f}},o.check=function(f){return typeof f=="string"&&f.slice(0,4)==="SEA{"},o.parse=async function(l){try{var d=typeof l=="string";return d&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),d?await r.parse(l):l}catch{}return l},s.opt=o,n.exports=o})(t,"./settings"),t(function(n){var s=t("./shim");n.exports=async function(r,o){var f=typeof r=="string"?r:await s.stringify(r),l=await s.subtle.digest({name:o||"SHA-256"},new s.TextEncoder().encode(f));return s.Buffer.from(l)}})(t,"./sha256"),t(function(n){const s=t("./shim"),r=s.subtle,o=s.ossl?s.ossl:r,f=l=>o.digest({name:"SHA-1"},new ArrayBuffer(l));n.exports=f})(t,"./sha1"),t(function(n){var s=t("./root"),r=t("./shim"),o=t("./settings"),f=t("./sha256"),l;s.work=s.work||(async(d,a,c,x)=>{try{var y=(a||{}).epub||a;if(x=x||{},y instanceof Function&&(c=y,y=l),d=typeof d=="string"?d:await r.stringify(d),(x.name||"").toLowerCase().slice(0,3)==="sha"){var u=r.Buffer.from(await f(d,x.name),"binary").toString(x.encode||"base64");if(c)try{c(u)}catch(h){console.log(h)}return u}y=y||r.random(9);var w=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(d),{name:x.name||"PBKDF2"},!1,["deriveBits"]),b=await(r.ossl||r.subtle).deriveBits({name:x.name||"PBKDF2",iterations:x.iterations||o.pbkdf2.iter,salt:new r.TextEncoder().encode(x.salt||y),hash:x.hash||o.pbkdf2.hash},w,x.length||o.pbkdf2.ks*8);d=r.random(d.length);var S=r.Buffer.from(b,"binary").toString(x.encode||"base64");if(c)try{c(S)}catch(h){console.log(h)}return S}catch(h){if(console.log(h),s.err=h,s.throw)throw h;c&&c();return}}),n.exports=s.work})(t,"./work"),t(function(n){var s=t("./root"),r=t("./shim");t("./settings"),s.name=s.name||(async(o,f)=>{try{if(o)try{o()}catch(l){console.log(l)}return}catch(l){if(console.log(l),s.err=l,s.throw)throw l;o&&o();return}}),s.pair=s.pair||(async(o,f)=>{try{var l=r.ossl||r.subtle,d=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async x=>{var y={};y.priv=(await r.subtle.exportKey("jwk",x.privateKey)).d;var u=await r.subtle.exportKey("jwk",x.publicKey);return y.pub=u.x+"."+u.y,y});try{var a=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async x=>{var y={};y.epriv=(await l.exportKey("jwk",x.privateKey)).d;var u=await l.exportKey("jwk",x.publicKey);return y.epub=u.x+"."+u.y,y})}catch(x){if(s.window)throw x;if(x=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw x}a=a||{};var c={pub:d.pub,priv:d.priv,epub:a.epub,epriv:a.epriv};if(o)try{o(c)}catch(x){console.log(x)}return c}catch(x){if(console.log(x),s.err=x,s.throw)throw x;o&&o();return}}),n.exports=s.pair})(t,"./pair"),t(function(n){var s=t("./root"),r=t("./shim"),o=t("./settings"),f=t("./sha256"),l;s.sign=s.sign||(async(d,a,c,x)=>{try{if(x=x||{},!(a||x).priv){if(!s.I)throw"No signing key.";a=await s.I(null,{what:d,how:"sign",why:x.why})}if(l===d)throw"`undefined` not allowed.";var y=await o.parse(d),u=x.check=x.check||y;if(s.verify&&(s.opt.check(u)||u&&u.s&&u.m)&&l!==await s.verify(u,a)){var j=await o.parse(u);if(x.raw||(j="SEA"+await r.stringify(j)),c)try{c(j)}catch(k){console.log(k)}return j}var w=a.pub,b=a.priv,S=o.jwk(w,b),h=await f(y),g=await(r.ossl||r.subtle).importKey("jwk",S,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(h))),j={m:y,s:r.Buffer.from(g,"binary").toString(x.encode||"base64")};if(x.raw||(j="SEA"+await r.stringify(j)),c)try{c(j)}catch(p){console.log(p)}return j}catch(p){if(console.log(p),s.err=p,s.throw)throw p;c&&c();return}}),n.exports=s.sign})(t,"./sign"),t(function(n){var s=t("./root"),r=t("./shim"),o=t("./settings"),f=t("./sha256"),l;s.verify=s.verify||(async(c,x,y,u)=>{try{var w=await o.parse(c);if(x===!1){var b=await o.parse(w.m);if(y)try{y(b)}catch(A){console.log(A)}return b}u=u||{};var S=x.pub||x,h=s.opt.slow_leak?await s.opt.slow_leak(S):await(r.ossl||r.subtle).importKey("jwk",o.jwk(S),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),g=await f(w.m),j,p,k,v;try{if(j=r.Buffer.from(w.s,u.encode||"base64"),p=new Uint8Array(j),k=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},h,p,new Uint8Array(g)),!k)throw"Signature did not match."}catch{if(s.opt.fallback)return await s.opt.fall_verify(c,x,y,u)}var N=k?await o.parse(w.m):l;if(y)try{y(N)}catch(A){console.log(A)}return N}catch(A){if(console.log(A),s.err=A,s.throw)throw A;y&&y();return}}),n.exports=s.verify;var d={};s.opt.slow_leak=c=>{if(d[c])return d[c];var x=o.jwk(c);return d[c]=(r.ossl||r.subtle).importKey("jwk",x,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),d[c]};var a=s.opt;s.opt.fall_verify=async function(c,x,y,u,w){if(w===s.opt.fallback)throw"Signature did not match";w=w||1;var b=c||"";c=s.opt.unpack(c)||c;var S=await o.parse(c),h=x.pub||x,g=await s.opt.slow_leak(h),j=w<=s.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await o.parse(S.m)))):await f(S.m),p,k,v;try{if(p=r.Buffer.from(S.s,u.encode||"base64"),k=new Uint8Array(p),v=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,k,new Uint8Array(j)),!v)throw"Signature did not match."}catch{try{p=r.Buffer.from(S.s,"utf8"),k=new Uint8Array(p),v=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,k,new Uint8Array(j))}catch{if(!v)throw"Signature did not match."}}var N=v?await o.parse(S.m):l;if(a.fall_soul=b["#"],a.fall_key=b["."],a.fall_val=c,a.fall_state=b[">"],y)try{y(N)}catch(A){console.log(A)}return N},s.opt.fallback=2})(t,"./verify"),t(function(n){var s=t("./shim"),r=t("./settings"),o=t("./sha256");const f=async(l,d,a)=>{const c=l+(d||s.random(8)).toString("utf8"),x=s.Buffer.from(await o(c),"binary"),y=r.keyToJwk(x);return await s.subtle.importKey("jwk",y,{name:"AES-GCM"},!1,["encrypt","decrypt"])};n.exports=f})(t,"./aeskey"),t(function(n){var s=t("./root"),r=t("./shim");t("./settings");var o=t("./aeskey"),f;s.encrypt=s.encrypt||(async(l,d,a,c)=>{try{c=c||{};var x=(d||c).epriv||d;if(f===l)throw"`undefined` not allowed.";if(!x){if(!s.I)throw"No encryption key.";d=await s.I(null,{what:l,how:"encrypt",why:c.why}),x=d.epriv||d}var y=typeof l=="string"?l:await r.stringify(l),u={s:r.random(9),iv:r.random(15)},w=await o(x,u.s,c).then(S=>r.subtle.encrypt({name:c.name||"AES-GCM",iv:new Uint8Array(u.iv)},S,new r.TextEncoder().encode(y))),b={ct:r.Buffer.from(w,"binary").toString(c.encode||"base64"),iv:u.iv.toString(c.encode||"base64"),s:u.s.toString(c.encode||"base64")};if(c.raw||(b="SEA"+await r.stringify(b)),a)try{a(b)}catch(S){console.log(S)}return b}catch(S){if(console.log(S),s.err=S,s.throw)throw S;a&&a();return}}),n.exports=s.encrypt})(t,"./encrypt"),t(function(n){var s=t("./root"),r=t("./shim"),o=t("./settings"),f=t("./aeskey");s.decrypt=s.decrypt||(async(l,d,a,c)=>{try{c=c||{};var x=(d||c).epriv||d;if(!x){if(!s.I)throw"No decryption key.";d=await s.I(null,{what:l,how:"decrypt",why:c.why}),x=d.epriv||d}var y=await o.parse(l),u,w,b;try{u=r.Buffer.from(y.s,c.encode||"base64"),w=r.Buffer.from(y.iv,c.encode||"base64"),b=r.Buffer.from(y.ct,c.encode||"base64");var S=await f(x,u,c).then(g=>r.subtle.decrypt({name:c.name||"AES-GCM",iv:new Uint8Array(w),tagLength:128},g,new Uint8Array(b)))}catch{if(c.encode==="utf8")throw"Could not decrypt";if(s.opt.fallback)return c.encode="utf8",await s.decrypt(l,d,a,c)}var h=await o.parse(new r.TextDecoder("utf8").decode(S));if(a)try{a(h)}catch(g){console.log(g)}return h}catch(g){if(console.log(g),s.err=g,s.throw)throw g;a&&a();return}}),n.exports=s.decrypt})(t,"./decrypt"),t(function(n){var s=t("./root"),r=t("./shim");t("./settings"),s.secret=s.secret||(async(f,l,d,a)=>{try{if(a=a||{},!l||!l.epriv||!l.epub){if(!s.I)throw"No secret mix.";l=await s.I(null,{what:f,how:"secret",why:a.why})}var c=f.epub||f,x=l.epub,y=l.epriv,u=r.ossl||r.subtle,w=o(c),b=Object.assign({public:await u.importKey(...w,!0,[])},{name:"ECDH",namedCurve:"P-256"}),S=o(x,y),h=await u.importKey(...S,!1,["deriveBits"]).then(async j=>{var p=await u.deriveBits(b,j,256),k=new Uint8Array(p),v=await u.importKey("raw",k,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return u.exportKey("jwk",v).then(({k:N})=>N)}),g=h;if(d)try{d(g)}catch(j){console.log(j)}return g}catch(j){if(console.log(j),s.err=j,s.throw)throw j;d&&d();return}});var o=(f,l)=>{var[d,a]=f.split("."),c=l?{d:l}:{};return["jwk",Object.assign(c,{x:d,y:a,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};n.exports=s.secret})(t,"./secret"),t(function(n){var s=t("./root");s.certify=s.certify||(async(r,o={},f,l,d={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),r=(()=>{var g=[];if(r){if((typeof r=="string"||Array.isArray(r))&&r.indexOf("*")>-1)return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(j=>{typeof j=="string"?g.push(j):typeof j=="object"&&j.pub&&g.push(j.pub)})}return typeof r=="object"&&r.pub?r.pub:g.length>0?g:null}})(),!r)return console.log("No certificant found.");const c=d.expiry&&(typeof d.expiry=="number"||typeof d.expiry=="string")?parseFloat(d.expiry):null,x=(o||{}).read?o.read:null,y=(o||{}).write?o.write:typeof o=="string"||Array.isArray(o)||o["+"]||o["#"]||o["."]||o["="]||o["*"]||o[">"]||o["<"]?o:null,u=(d||{}).block||(d||{}).blacklist||(d||{}).ban||{},w=u.read&&(typeof u.read=="string"||(u.read||{})["#"])?u.read:null,b=typeof u=="string"?u:u.write&&(typeof u.write=="string"||u.write["#"])?u.write:null;if(!x&&!y)return console.log("No policy found.");const S=JSON.stringify({c:r,...c?{e:c}:{},...x?{r:x}:{},...y?{w:y}:{},...w?{rb:w}:{},...b?{wb:b}:{}});var a=await s.sign(S,f,null,{raw:1});if(d.raw||(a="SEA"+JSON.stringify(a)),l)try{l(a)}catch(g){console.log(g)}return a}catch(c){if(s.err=c,s.throw)throw c;l&&l();return}}),n.exports=s.certify})(t,"./certify"),t(function(n){var s=t("./shim"),r=t("./root");r.work=t("./work"),r.sign=t("./sign"),r.verify=t("./verify"),r.encrypt=t("./encrypt"),r.decrypt=t("./decrypt"),r.certify=t("./certify"),r.random=r.random||s.random,r.Buffer=r.Buffer||t("./buffer"),r.keyid=r.keyid||(async o=>{try{const f=s.Buffer.concat(o.replace(/-/g,"+").replace(/_/g,"/").split(".").map(c=>s.Buffer.from(c,"base64"))),l=s.Buffer.concat([s.Buffer.from([153,f.length/256,f.length%256]),f]),d=await sha1hash(l),a=s.Buffer.from(d,"binary");return a.toString("hex",a.length-8)}catch(f){throw console.log(f),f}}),((r.window||{}).GUN||{}).SEA=r,n.exports=r})(t,"./sea"),t(function(n){var s=t("./sea"),r,o;s.window?r=s.window.GUN||{chain:{}}:r=t((o+""==typeof m?".":"")+"./gun",1),s.GUN=r;function f(d){this._={$:this}}f.prototype=function(){function d(){}return d.prototype=r.chain,new d}(),f.prototype.constructor=f,r.chain.user=function(d){var a=this,x=a.back(-1),c;if(d)return d=s.opt.pub((d._||"")["#"])||d,x.get("~"+d);if(c=x.back("user"))return c;var x=x._,y=x,u=y.opt.uuid||l;return(y=(c=y.user=a.chain(new f))._).opt={},y.opt.uuid=function(w){var b=u(),S=x.user;return!S||!(S=S.is)||!(S=S.pub)||(b="~"+S+"/"+b,w&&w.call&&w(null,b)),b},c};function l(){return r.state().toString(36).replace(".","")}r.User=f,f.GUN=r,f.SEA=r.SEA=s,n.exports=f})(t,"./user"),t(function(n){var s,r=""+s!=typeof GUN?GUN||{chain:{}}:t((""+s==typeof m?".":"")+"./gun",1);r.chain.then=function(o,f){var l=this,d=new Promise(function(a,c){l.once(a,f)});return o?d.then(o):d}})(t,"./then"),t(function(n){var s=t("./user"),r=s.SEA,o=s.GUN,f=function(){};s.prototype.create=function(...l){var d=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,a=d&&(d.pub||d.epub)?d.pub:typeof l[0]=="string"?l[0]:null,c=d&&(d.pub||d.epub)?d:a&&typeof l[1]=="string"?l[1]:null,x=l.filter(g=>typeof g=="function")[0]||null,y=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},u=this,w=u._,b=u.back(-1);if(x=x||f,y=y||{},y.check!==!1){var S;if(a||(S="No user."),(c||"").length<8&&(S="Password too short!"),S)return x({err:o.log(S)}),u}if(w.ing)return(x||f)({err:o.log("User is already being created or authenticated!"),wait:!0}),u;w.ing=!0;var h={};return h.a=function(g){if(h.pubs=g,g&&!y.already){var j={err:o.log("User already created!")};w.ing=!1,(x||f)(j),u.leave();return}h.salt=String.random(64),r.work(c,h.salt,h.b)},h.b=function(g){h.proof=g,d?h.c(d):r.pair(h.c)},h.c=function(g){var j;h.pair=g||{},(j=w.root.user)&&(j._.sea=g,j.is={pub:g.pub,epub:g.epub,alias:a}),h.data={pub:g.pub},h.d()},h.d=function(){h.data.alias=a,h.e()},h.e=function(){h.data.epub=h.pair.epub,r.encrypt({priv:h.pair.priv,epriv:h.pair.epriv},h.proof,h.f,{raw:1})},h.f=function(g){h.data.auth=JSON.stringify({ek:g,s:h.salt}),h.g(h.data.auth)},h.g=function(g){var j;h.data.auth=h.data.auth||g,b.get(j="~"+h.pair.pub).put(h.data).on(h.h);var p={};p[j]={"#":j},b.get("~@"+a).put(p).get(j).on(h.i)},h.h=function(g,j,p,k){k.off(),h.h.ok=1,h.i()},h.i=function(g,j,p,k){k&&(h.i.ok=1,k.off()),!(!h.h.ok||!h.i.ok)&&(w.ing=!1,x({ok:0,pub:h.pair.pub}),f===x&&(d?u.auth(d):u.auth(a,c)))},b.get("~@"+a).once(h.a),u},s.prototype.leave=function(l,d){var a=this,c=a.back(-1)._.user;if(c&&(delete c.is,delete c._.is,delete c._.sea),r.window)try{var x={};x=r.window.sessionStorage,delete x.recall,delete x.pair}catch{}return a}})(t,"./create"),t(function(n){var s=t("./user"),r=s.SEA,o=s.GUN,f=function(){};s.prototype.auth=function(...d){var a=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,c=!a&&typeof d[0]=="string"?d[0]:null,x=(c||a&&!(a.priv&&a.epriv))&&typeof d[1]=="string"?d[1]:null,y=d.filter(p=>typeof p=="function")[0]||null,u=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},w=this,b=w._,S=w.back(-1);if(b.ing)return(y||f)({err:o.log("User is already being created or authenticated!"),wait:!0}),w;b.ing=!0;var h={},g,j=9;return h.a=function(p){if(!p)return h.b();if(!p.pub){var k=[];return Object.keys(p).forEach(function(v){v!="_"&&k.push(p[v])}),h.b(k)}if(h.name)return h.f(p);h.c((h.data=p).auth)},h.b=function(p){var k=(h.list=(h.list||[]).concat(p||[])).shift();if(g===k){if(h.name)return h.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(c&&j--){S.get("~@"+c).once(h.a);return}return h.err("Wrong user or password.")}S.get(k).once(h.a)},h.c=function(p){if(g===p)return h.b();if(typeof p=="string")return h.c(l(p));r.work(x,(h.auth=p).s,h.d,h.enc)},h.d=function(p){r.decrypt(h.auth.ek,p,h.e,h.enc)},h.e=function(p){if(g===p)return h.enc?(h.enc=null,h.b()):(h.enc={encode:"utf8"},h.c(h.auth));h.half=p,h.f(h.data)},h.f=function(p){var k=h.half||{},v=h.data||{};h.g(h.lol={pub:p.pub||v.pub,epub:p.epub||v.epub,priv:p.priv||k.priv,epriv:p.epriv||k.epriv})},h.g=function(p){if(!p||!p.pub||!p.epub)return h.b();h.pair=p;var k=S._.user,v=k._;v.tag;var N=v.opt;v=k._=S.get("~"+p.pub)._,v.opt=N,k.is={pub:p.pub,epub:p.epub,alias:c||p.pub},v.sea=h.pair,b.ing=!1;try{x&&g==(l(b.root.graph["~"+p.pub].auth)||"")[":"]&&(u.shuffle=u.change=x)}catch{}if(u.change?h.z():(y||f)(v),r.window&&(w.back("user")._.opt||u).remember)try{var A={};A=r.window.sessionStorage,A.recall=!0,A.pair=JSON.stringify(p)}catch{}try{S._.tag.auth?S._.on("auth",v):setTimeout(function(){S._.on("auth",v)},1)}catch(D){o.log("Your 'auth' callback crashed with:",D)}},h.h=function(p){if(!p)return h.b();if(c=p.alias,c||(c=p.alias="~"+a.pub),!p.auth)return h.g(a);a=null,h.c((h.data=p).auth)},h.z=function(){h.salt=String.random(64),r.work(u.change,h.salt,h.y)},h.y=function(p){r.encrypt({priv:h.pair.priv,epriv:h.pair.epriv},p,h.x,{raw:1})},h.x=function(p){h.w(JSON.stringify({ek:p,s:h.salt}))},h.w=function(p){if(u.shuffle){console.log("migrate core account from UTF8 & shuffle");var k={};Object.keys(h.data).forEach(function(v){k[v]=h.data[v]}),delete k._,k.auth=p,S.get("~"+h.pair.pub).put(k)}S.get("~"+h.pair.pub).get("auth").put(p,y||f)},h.err=function(p){var k={err:o.log(p||"User cannot be found!")};b.ing=!1,(y||f)(k)},h.plugin=function(p){if(!(h.name=p))return h.err();var k=[p];p[0]!=="~"&&(k[1]="~"+p,k[2]="~@"+p),h.b(k)},a?a.priv&&a.epriv?h.g(a):S.get("~"+a.pub).once(h.h):c?S.get("~@"+c).once(h.a):!c&&!x&&r.name(h.plugin),w};function l(d){if(typeof d!="string")return d;try{d=JSON.parse(d)}catch{d={}}return d}})(t,"./auth"),t(function(n){var s=t("./user"),r=s.SEA;s.GUN,s.prototype.recall=function(o,f){var l=this,d=l.back(-1);if(o=o||{},o&&o.sessionStorage){if(r.window)try{var a={};a=r.window.sessionStorage,a&&(d._.opt.remember=!0,(l.back("user")._.opt||o).remember=!0,(a.recall||a.pair)&&d.user().auth(JSON.parse(a.pair),f))}catch{}return l}return l}})(t,"./recall"),t(function(n){var s=t("./user"),r=s.SEA,o=s.GUN,f=function(){};s.prototype.pair=function(){var l=this,d;try{d=new Proxy({DANGER:"☠"},{get:function(a,c,x){if(!(!l.is||!(l._||"").sea))return l._.sea[c]}})}catch{}return d},s.prototype.delete=async function(l,d,a){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var c=this;c.back(-1);var x=c.back("user");try{x.auth(l,d,function(y){var u=(x.is||{}).pub;x.map().once(function(){this.put(null)}),x.leave(),(a||f)({ok:0})})}catch(y){o.log("User.delete failed! Error:",y)}return c},s.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const a="No session!";throw o.log(a),{err:a}}},s.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),o.is(l)&&l.get("pub").get((d,a)=>{console.log(d,a)}),l.get("trust").get(path).put(theirPubkey)},s.prototype.grant=function(l,d){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var a=this,c=a.back(-1).user(),x=c._.sea,y="";return a.back(function(u){u.is||(y+=u.get||"")}),async function(){var u,w=await c.get("grant").get(x.pub).get(y).then();w=await r.decrypt(w,x),w||(w=r.random(16).toString(),u=await r.encrypt(w,x),c.get("grant").get(x.pub).get(y).put(u));var b=l.get("pub").then(),S=l.get("epub").then();b=await b,S=await S;var h=await r.secret(S,x);u=await r.encrypt(w,h),c.get("grant").get(b).get(y).put(u,d)}(),a},s.prototype.secret=function(l,d){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var a=this,c=a.back(-1).user(),x=c.pair(),y="";return a.back(function(u){u.is||(y+=u.get||"")}),async function(){var u,w=await c.get("trust").get(x.pub).get(y).then();w=await r.decrypt(w,x),w||(w=r.random(16).toString(),u=await r.encrypt(w,x),c.get("trust").get(x.pub).get(y).put(u)),u=await r.encrypt(l,w),a.put(u,d)}(),a},n.exports=s})(t,"./share"),t(function(n){var s=t("./sea"),r=t("./settings"),o,f=(s.window||"").GUN||t((""+o==typeof m?".":"")+"./gun",1);f.on("opt",function(u){u.sea||(u.sea={own:{}},u.on("put",l,u)),this.to.next(u)});function l(u){var w=this,b=w.as,S=u.put,h=S["#"],g=S["."],j=S[":"],p=S[">"],k=u["#"],v;if(!(!h||!g)){if((u._||"").faith&&(b.opt||"").faith&&typeof u._=="function"){s.opt.pack(S,function(A){s.verify(A,!1,function(D){S["="]=s.opt.unpack(D),w.to.next(u)})});return}var N=function(A){b.on("in",{"@":k,err:u.err=A})};if((u._||"").DBG&&((u._||"").DBG.c=+new Date),0<=h.indexOf("<?")&&(v=parseFloat(h.split("<?")[1]||""),v&&p<f.state()-v*1e3)){(v=u._)&&v.stun&&v.stun--;return}if(h==="~@"){l.alias(w,u,j,g,h,b,N);return}if(h.slice(0,2)==="~@"){l.pubs(w,u,j,g,h,b,N);return}if(v=s.opt.pub(h)){l.pub(w,u,j,g,h,b,N,b.user||"",v);return}if(0<=h.indexOf("#")){l.hash(w,u,j,g,h,b,N);return}l.any(w,u,j,g,h,b,N,b.user||"")}}l.hash=function(u,w,b,S,h,g,j){s.work(b,null,function(p){function k(v){let N="";for(let A=0;A<v.length;A++)N+=A-1&1?"":String.fromCharCode(parseInt(v.substring(A-1,A+1),16));return btoa(N)}if(p&&p===S.split("#").slice(-1)[0])return u.to.next(w);if(p&&p===k(S.split("#").slice(-1)[0]))return u.to.next(w);j("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(u,w,b,S,h,g,j){if(!b)return j("Data must exist!");if("~@"+S===a(b))return u.to.next(w);j("Alias not same!")},l.pubs=function(u,w,b,S,h,g,j){if(!b)return j("Alias must exist!");if(S===a(b))return u.to.next(w);j("Alias not same!")},l.pub=async function(u,w,b,S,h,g,j,p,k){var v;const N=await r.parse(b)||{},A=(D,E,T)=>{if(D.m&&D.s&&E&&k)return s.verify(D,k,P=>{if(o!==P&&o!==P.e&&w.put[">"]&&w.put[">"]>parseFloat(P.e))return j("Certificate expired.");if(o!==P&&P.c&&P.w&&(P.c===E||P.c.indexOf("*")>-1)){let U=h.indexOf("/")>-1?h.replace(h.substring(0,h.indexOf("/")+1),""):"";String.match=String.match||f.text.match;const L=Array.isArray(P.w)?P.w:typeof P.w=="object"||typeof P.w=="string"?[P.w]:[];for(const C of L)if(String.match(U,C["#"])&&String.match(S,C["."])||!C["."]&&String.match(U,C["#"])||!C["#"]&&String.match(S,C["."])||String.match(U?U+"/"+S:S,C["#"]||C)){if(C["+"]&&C["+"].indexOf("*")>-1&&U&&U.indexOf(E)==-1&&S.indexOf(E)==-1)return j(`Path "${U}" or key "${S}" must contain string "${E}".`);if(P.wb&&(typeof P.wb=="string"||(P.wb||{})["#"])){var I=u.as.root.$.back(-1);return typeof P.wb=="string"&&P.wb.slice(0,1)!=="~"&&(I=I.get("~"+k)),I.get(P.wb).get(E).once(F=>F&&(F===1||F===!0)?j(`Certificant ${E} blocked.`):T(P))}return T(P)}return j("Certificate verification fail.")}})};if(S==="pub"&&"~"+k===h)return b===k?u.to.next(w):j("Account not same!");if((v=p.is)&&v.pub&&!N["*"]&&!N["+"]&&(k===v.pub||k!==v.pub&&((w._.msg||{}).opt||{}).cert)){s.opt.pack(w.put,D=>{s.sign(D,p._.sea,async function(E){if(o===E)return j(s.err||"Signature fail.");if(w.put[":"]={":":v=s.opt.unpack(E.m),"~":E.s},w.put["="]=v,k===p.is.pub){(v=a(b))&&((g.sea.own[v]=g.sea.own[v]||{})[k]=1),JSON.stringifyAsync(w.put[":"],function(T,P){return T?j(T||"Stringify error."):(w.put[":"]=P,u.to.next(w))});return}if(k!==p.is.pub&&((w._.msg||{}).opt||{}).cert){const T=await r.parse(w._.msg.opt.cert);T&&T.m&&T.s&&A(T,p.is.pub,P=>{w.put[":"]["+"]=T,w.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(w.put[":"],function(I,U){return I?j(I||"Stringify error."):(w.put[":"]=U,u.to.next(w))})})}},{raw:1})});return}s.opt.pack(w.put,D=>{s.verify(D,N["*"]||k,function(E){var T;if(E=s.opt.unpack(E),o===E)return j("Unverified data.");if((T=a(E))&&k===s.opt.pub(T)&&((g.sea.own[T]=g.sea.own[T]||{})[k]=1),N["+"]&&N["+"].m&&N["+"].s&&N["*"])A(N["+"],N["*"],P=>(w.put["="]=E,u.to.next(w)));else return w.put["="]=E,u.to.next(w)})})},l.any=function(u,w,b,S,h,g,j,p){if(g.opt.secure)return j("Soul missing public key at '"+S+"'.");g.on("secure",function(k){if(this.off(),!g.opt.secure)return u.to.next(k);j("Data cannot be changed.")}).on.on("secure",w)};var d=f.valid,a=function(u,w){return typeof(w=d(u))=="string"&&w};(f.state||"").ify;var c=/[^\w_-]/;s.opt.pub=function(u){if(u&&(u=u.split("~"),!(!u||!(u=u[1]))&&(u=u.split(c).slice(0,2),!(!u||u.length!=2)&&(u[0]||"")[0]!=="@")))return u=u.slice(0,2).join("."),u},s.opt.stringy=function(u){},s.opt.pack=function(u,w,b,S,h){var g,j;if(s.opt.check(u))return w(u);u&&u["#"]&&u["."]&&u[">"]&&(g=u[":"],j=1),JSON.parseAsync(j?g:u,function(p,k){var v=o!==(k||"")[":"]&&(k||"")["~"];if(!v){w(u);return}w({m:{"#":h||u["#"],".":b||u["."],":":(k||"")[":"],">":u[">"]||f.state.is(S,b)},s:v})})};var x=s.opt;s.opt.unpack=function(u,w,b){var S;if(o!==u){if(u&&o!==(S=u[":"]))return S;if(w=w||x.fall_key,!b&&x.fall_val&&(b={},b[w]=x.fall_val),!(!w||!b)){if(u===b[w]||!s.opt.check(b[w]))return u;var h=b&&b._&&b._["#"]||x.fall_soul,g=f.state.is(b,w)||x.fall_state;if(u&&u.length===4&&h===u[0]&&w===u[1]&&y(g)===y(u[3]))return u[2];if(g<s.opt.shuffle_attack)return u}}},s.opt.shuffle_attack=15463296e5;var y=Math.floor})(t,"./index")})()}(ye)),ye.exports}Vt();var He={},Ye;function Xt(){if(Ye)return He;Ye=1;var i=typeof window<"u"?window.Gun:wt();return i.chain.promise=function(n){var m=this,n=n||function(s){return s};return new Promise(function(s,r){m.once(function(o,f){s({put:o,get:f,gun:this})})}).then(n)},i.chain.then=function(t){var m=this,n=new Promise((s,r)=>{m.once(function(o,f){s(o,f)})});return t?n.then(t):n},He}Xt();console.log("🔫 GunJS service file loading...");console.log("🔫 Imported Gun:",typeof W);console.log("🔫 After importing gun/sea and gun/lib/then");console.log("🔫 Gun.SEA is available:",!!W.SEA);W.SEA?(console.log("🔫 ✅ Gun.SEA is properly initialized"),console.log("🔫 Gun.SEA methods:",W.SEA?Object.keys(W.SEA):"undefined")):(console.error("🔫 CRITICAL ERROR: Gun.SEA is NOT DEFINED after import. Trying alternative method..."),console.log("🔫 Will check SEA availability after Gun instance creation..."));console.log("🔫 About to initialize Gun instance...");const H=W({peers:["https://gun-manhattan.herokuapp.com/gun"]});console.log("🔫 GunJS initialized with Manhattan peer");console.log("🔫 Gun instance created:",typeof H);console.log("🔫 Gun instance properties:",Object.keys(H));console.log("🔫 Checking Gun.SEA after instance creation:",!!W.SEA);H.SEA&&(console.log("🔫 Found SEA on gun instance:",!!H.SEA),W.SEA=H.SEA);console.log("🔫 Testing gun.user() method availability...");typeof H.user=="function"?console.log("🔫 ✅ gun.user() method is available"):(console.error("🔫 ❌ gun.user() method is NOT available"),console.error("🔫 Available gun methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(H))));H.on("hi",i=>{console.log("🔫 GunJS: Connected to peer",i)});H.on("bye",i=>{console.log("🔫 GunJS: Disconnected from peer",i)});H.on("out",i=>{i&&i.err&&console.warn("🔫 GunJS: Connection error:",i.err)});setTimeout(()=>{console.log("🔫 GunJS connection test - gun object:",H),console.log("🔫 GunJS internal state:",H._),H.get("test").put({hello:"world",timestamp:Date.now()}),console.log("🔫 GunJS: Test data written")},2e3);console.log("🔫 Creating user instance...");let Z;try{Z=H.user(),console.log("🔫 ✅ User instance created successfully:",typeof Z),console.log("🔫 User instance properties:",Object.keys(Z)),typeof Z.create=="function"?console.log("🔫 ✅ user.create() method is available"):console.error("🔫 ❌ user.create() method is NOT available"),typeof Z.auth=="function"?console.log("🔫 ✅ user.auth() method is available"):console.error("🔫 ❌ user.auth() method is NOT available")}catch(i){console.error("🔫 ❌ FAILED to create user instance:",i),console.error("🔫 This confirms that SEA is not properly loaded"),Z={create:()=>console.error("SEA not loaded - user.create() unavailable"),auth:()=>console.error("SEA not loaded - user.auth() unavailable"),is:null}}const be=W.SEA;console.log("🔫 SEA reference:",typeof be);be&&typeof be.encrypt=="function"?console.log("🔫 ✅ SEA.encrypt() method is available"):(console.error("🔫 ❌ SEA.encrypt() method is NOT available"),console.error("🔫 Final Gun.SEA status:",W.SEA));class Qt{constructor(){oe(this,"gun");oe(this,"user");oe(this,"SEA");console.log("GunJS: GunService constructor called"),this.gun=H,this.user=Z,this.SEA=be,console.log("GunJS: GunService initialized")}async signUp(t,m){return console.log("🔫 GunJS: Attempting to sign up user:",t),new Promise(n=>{if(m.length<8){console.log("🔫 GunJS: Password too short"),n({success:!1,error:"Password must be at least 8 characters"});return}const s=setTimeout(()=>{console.log("🔫 GunJS: Sign up timed out"),n({success:!1,error:"Sign up request timed out. Please check your connection."})},1e4);this.user.create(t,m,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign up response:",r),r.err){console.log("🔫 GunJS: Sign up error:",r.err),n({success:!1,error:r.err});return}this.user.auth(t,m,o=>{if(!o.err){const f={originalUsername:t,displayName:t,bio:"",favoriteGenres:JSON.stringify([]),readingGoal:12,joinedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};this.user.get("profile").put(f,()=>{console.log("🔫 GunJS: Initial profile created with original username"),this.user.leave()})}}),console.log("🔫 GunJS: Sign up successful"),n({success:!0})})})}async signIn(t,m){return console.log("🔫 GunJS: Attempting to sign in user:",t),new Promise(n=>{const s=setTimeout(()=>{console.log("🔫 GunJS: Sign in timed out"),n({success:!1,error:"Sign in request timed out. Please check your connection."})},1e4);this.user.auth(t,m,r=>{if(clearTimeout(s),console.log("🔫 GunJS: Sign in response:",r),r.err){console.log("🔫 GunJS: Sign in error:",r.err),n({success:!1,error:r.err});return}console.log("🔫 GunJS: Sign in successful, user:",this.user.is),this.user.get("profile").once(o=>{if(!(o!=null&&o.originalUsername)){console.log("🔫 GunJS: Storing original username in profile");const f={...o,originalUsername:t,favoriteGenres:(o==null?void 0:o.favoriteGenres)||JSON.stringify([]),lastUpdated:new Date().toISOString()};this.user.get("profile").put(f)}}),n({success:!0,user:{id:this.user.is.pub,username:t,email:"",createdAt:new Date().toISOString()}})})})}signOut(){this.user.leave()}isAuthenticated(){return!!this.user.is}getCurrentUser(){return this.user.is?{id:this.user.is.pub,username:this.user.is.alias||"Unknown User"}:null}async recallUser(){return new Promise(t=>{const m=setTimeout(()=>{console.log("🔫 GunJS: recallUser timed out"),t({success:!1})},3e3);this.user.recall({sessionStorage:!0},()=>{clearTimeout(m),this.user.is?(console.log("🔫 GunJS: User recalled successfully:",this.user.is.alias),this.user.get("profile").once(n=>{const s=(n==null?void 0:n.originalUsername)||this.user.is.alias||"Unknown User";t({success:!0,user:{id:this.user.is.pub,username:s,email:"",createdAt:new Date().toISOString()}})})):(console.log("🔫 GunJS: No user to recall"),t({success:!1}))})})}async updateProfile(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}const n=setTimeout(()=>{console.log("🔫 GunJS: updateProfile timed out"),m({success:!1,error:"Profile update request timed out"})},5e3);this.user.get("profile").once(s=>{console.log("🔫 GunJS: Existing profile:",s);const r=(s==null?void 0:s.originalUsername)||this.user.is.alias,o={displayName:t.displayName||"",bio:t.bio||"",favoriteGenres:JSON.stringify(t.favoriteGenres||[]),readingGoal:t.readingGoal||12,joinedDate:t.joinedDate||new Date().toISOString(),lastUpdated:new Date().toISOString(),originalUsername:r};console.log("🔫 GunJS: Updating profile with Gun-compatible data:",o),this.user.get("profile").put(o,f=>{if(clearTimeout(n),console.log("🔫 GunJS: Profile update response:",f),f.err){console.log("🔫 GunJS: Profile update error:",f.err),m({success:!1,error:f.err});return}console.log("🔫 GunJS: Profile updated successfully"),this.user.get("profile").once(l=>{console.log("🔫 GunJS: Profile after update:",l),m({success:!0})})})})})}async getProfile(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}const m=setTimeout(()=>{console.log("🔫 GunJS: getProfile timed out"),t({success:!1,error:"Profile request timed out"})},3e3);this.user.get("profile").once(n=>{if(clearTimeout(m),console.log("🔫 GunJS: Raw profile loaded:",n),n){const s={displayName:n.displayName||"",bio:n.bio||"",favoriteGenres:n.favoriteGenres?JSON.parse(n.favoriteGenres):[],readingGoal:n.readingGoal||12,joinedDate:n.joinedDate,lastUpdated:n.lastUpdated,originalUsername:n.originalUsername};console.log("🔫 GunJS: Cleaned profile:",s),t({success:!0,profile:s})}else t({success:!0,profile:{}})})})}async syncUserBooks(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}this.user.get("books").put(t,n=>{if(n.err){m({success:!1,error:n.err});return}m({success:!0})})})}async getUserBooks(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("books").once(m=>{t({success:!0,books:m||[]})})})}async syncUserNotes(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}this.user.get("notes").put(t,n=>{if(n.err){m({success:!1,error:n.err});return}m({success:!0})})})}async getUserNotes(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("notes").once(m=>{t({success:!0,notes:m||[]})})})}async syncUserSessions(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}this.user.get("sessions").put(t,n=>{if(n.err){m({success:!1,error:n.err});return}m({success:!0})})})}async getUserSessions(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("sessions").once(m=>{t({success:!0,sessions:m||[]})})})}async syncPetData(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}this.user.get("pet").put(t,n=>{if(n.err){m({success:!1,error:n.err});return}m({success:!0})})})}async getUserPetData(){return new Promise(t=>{if(!this.user.is){t({success:!1,error:"User not authenticated"});return}this.user.get("pet").once(m=>{t({success:!0,petData:m||null})})})}async syncUserData(t,m){return new Promise(n=>{if(!this.user.is){n({success:!1,error:"User not authenticated"});return}this.user.get(t).put(m,s=>{if(s.err){n({success:!1,error:s.err});return}n({success:!0})})})}async getUserData(t){return new Promise(m=>{if(!this.user.is){m({success:!1,error:"User not authenticated"});return}this.user.get(t).once(n=>{m({success:!0,data:n||{}})})})}subscribeToUserData(t,m){this.user.is&&this.user.get(t).on(m)}unsubscribeFromUserData(t){this.user.is&&this.user.get(t).off()}}const $=new Qt;class Zt{constructor(){oe(this,"isOnline",!0);window.addEventListener("online",()=>{this.isOnline=!0,this.syncPendingChanges()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async syncData(t,m){if($.isAuthenticated()&&this.isOnline)try{await $.syncUserData(t,m)}catch(n){console.warn("Failed to sync data to server:",n)}}async getData(t,m){if($.isAuthenticated()&&this.isOnline)try{const s=await $.getUserData(t);if(s.success&&s.data&&Object.keys(s.data).length>0)return s.data}catch(s){console.warn("Failed to get data from server:",s)}const n=localStorage.getItem(`bookish_${t}`);return n?JSON.parse(n):m}setLocalStorage(t,m){localStorage.setItem(`bookish_${t}`,JSON.stringify(m))}async syncPendingChanges(){if(!$.isAuthenticated())return;const t=["books","current_book","reading_sessions","notes","pet","stats","settings","streak"];for(const m of t)try{const n=localStorage.getItem(`bookish_${m}`);n&&await $.syncUserData(m,JSON.parse(n))}catch(n){console.warn(`Failed to sync ${m}:`,n)}}async getBooks(){return this.getData("books",[])}async saveBooks(t){this.setLocalStorage("books",t),await this.syncData("books",t)}async getCurrentBook(){return this.getData("current_book",null)}async setCurrentBook(t){this.setLocalStorage("current_book",t),await this.syncData("current_book",t)}async getReadingSessions(){return this.getData("reading_sessions",[])}async saveReadingSessions(t){this.setLocalStorage("reading_sessions",t),await this.syncData("reading_sessions",t)}async getNotes(){return this.getData("notes",[])}async saveNotes(t){this.setLocalStorage("notes",t),await this.syncData("notes",t)}async getPet(){const t={name:"Bookworm",level:1,experience:0,experienceToNextLevel:100,happiness:80,lastFed:new Date().toISOString()};return this.getData("pet",t)}async savePet(t){this.setLocalStorage("pet",t),await this.syncData("pet",t)}async getStats(){const t={totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0};return this.getData("stats",t)}async saveStats(t){this.setLocalStorage("stats",t),await this.syncData("stats",t)}async getSettings(){const t={reminders:[],theme:"light",petName:"Bookworm"};return this.getData("settings",t)}async saveSettings(t){this.setLocalStorage("settings",t),await this.syncData("settings",t)}async getStreak(){const t={currentStreak:0,longestStreak:0,lastReadDate:null};return this.getData("streak",t)}async saveStreak(t){this.setLocalStorage("streak",t),await this.syncData("streak",t)}async migrateLocalDataToServer(){if(!$.isAuthenticated())return;const t=[{key:"books",getter:()=>JSON.parse(localStorage.getItem("bookish_books")||"[]")},{key:"current_book",getter:()=>JSON.parse(localStorage.getItem("bookish_current_book")||"null")},{key:"reading_sessions",getter:()=>JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]")},{key:"notes",getter:()=>JSON.parse(localStorage.getItem("bookish_notes")||"[]")},{key:"pet",getter:()=>JSON.parse(localStorage.getItem("bookish_pet")||"null")},{key:"stats",getter:()=>JSON.parse(localStorage.getItem("bookish_stats")||"null")},{key:"settings",getter:()=>JSON.parse(localStorage.getItem("bookish_settings")||"null")},{key:"streak",getter:()=>JSON.parse(localStorage.getItem("bookish_streak")||"null")}];for(const m of t)try{const n=m.getter();n!==null&&(Array.isArray(n)?n.length>0:Object.keys(n).length>0)&&await $.syncUserData(m.key,n)}catch(n){console.warn(`Failed to migrate ${m.key}:`,n)}}}const M=new Zt,ee="https://openlibrary.org",es=async i=>{try{return(await(await fetch(`${ee}/search.json?q=${encodeURIComponent(i)}&limit=10`)).json()).docs.map(n=>({key:n.key,title:n.title,author_name:n.author_name,cover_i:n.cover_i,first_publish_year:n.first_publish_year,number_of_pages_median:n.number_of_pages_median}))}catch(t){return console.error("Error searching books:",t),[]}},ts=async i=>{var t,m;try{const n=i.replace("/works/",""),r=await(await fetch(`${ee}/works/${n}.json`)).json();let o=r.number_of_pages_median;!o&&r.editions&&(o=await ss(r.editions)),o||(o=await rs(n));let f=[];if(r.authors&&r.authors.length>0){const l=r.authors.slice(0,3).map(async a=>{try{return(await(await fetch(`${ee}${a.author.key}.json`)).json()).name}catch{return null}});f=(await Promise.all(l)).filter(a=>a!==null)}return{key:r.key,title:r.title,author_name:f,cover_i:(t=r.covers)==null?void 0:t[0],first_publish_year:r.first_publish_year,description:((m=r.description)==null?void 0:m.value)||r.description||"",number_of_pages_median:o}}catch(n){return console.error("Error fetching book details:",n),null}},ss=async i=>{try{if(!i||!i.entries||i.entries.length===0)return;for(const t of i.entries.slice(0,3))try{const n=await(await fetch(`${ee}${t.key}.json`)).json();if(n.number_of_pages)return n.number_of_pages}catch(m){console.error("Error fetching edition:",m);continue}return}catch(t){console.error("Error getting page count from editions:",t);return}},rs=async i=>{try{const m=await(await fetch(`${ee}/works/${i}/editions.json?limit=5`)).json();if(m.entries&&m.entries.length>0){for(const n of m.entries)if(n.number_of_pages)return n.number_of_pages}return}catch(t){console.error("Error fetching editions for page count:",t);return}},ns=(i,t="M")=>i?`https://covers.openlibrary.org/b/id/${i}-${{S:"small",M:"medium",L:"large"}[t]}.jpg`:"/placeholder-cover.jpg",as=async i=>{var t;try{return((t=(await(await fetch(`${ee}/subjects/${encodeURIComponent(i.toLowerCase())}.json?limit=10`)).json()).works)==null?void 0:t.map(s=>{var r;return{key:s.key,title:s.title,author_name:((r=s.authors)==null?void 0:r.map(o=>o.name))||[],cover_i:s.cover_id,first_publish_year:s.first_publish_year,number_of_pages_median:s.number_of_pages_median}}))||[]}catch(m){return console.error("Error searching books by subject:",m),[]}},os=async i=>{var t,m;try{const n=i.replace(/[-\s]/g,""),s=await fetch(`${ee}/isbn/${n}.json`);if(!s.ok)return null;const r=await s.json();return{key:r.key,title:r.title,author_name:((t=r.authors)==null?void 0:t.map(o=>o.name))||[],cover_i:(m=r.covers)==null?void 0:m[0],first_publish_year:r.publish_date?new Date(r.publish_date).getFullYear():void 0,number_of_pages_median:r.number_of_pages}}catch(n){return console.error("Error searching book by ISBN:",n),null}},is="bookish_reading_sessions",ls="bookish_stats",cs="bookish_streak",Ee="bookish_cached_books",ue=(i,t)=>{const m=localStorage.getItem(i);return m?JSON.parse(m):t},ds=(i,t)=>{localStorage.setItem(i,JSON.stringify(t))},rt=i=>ue(Ee,{})[i]||null,Ke=i=>{const t=ue(Ee,{});t[i.key]={...i,cached_at:new Date().toISOString()},ds(Ee,t)},Te=()=>ue(is,[]),qe=i=>Te().filter(t=>t.bookId===i),us=()=>({totalBooksRead:0,totalPagesRead:0,totalReadingTime:0,readingTimeToday:0,readingTimeThisWeek:0,booksFinishedThisYear:0}),nt=()=>ue(ls,us()),ms=()=>({currentStreak:0,longestStreak:0,lastReadDate:null}),at=()=>ue(cs,ms()),ot=B.createContext(void 0),te=()=>{const i=B.useContext(ot);if(!i)throw new Error("useBooks must be used within a BookProvider");return i},hs=({children:i})=>{const[t,m]=B.useState([]),[n,s]=B.useState(null),[r,o]=B.useState([]),[f,l]=B.useState([]);B.useEffect(()=>{(async()=>{const h=(await M.getBooks()).map(j=>{const p=rt(j.key);return p?{...j,...p}:j});m(h);const g=await M.getCurrentBook();s(g)})()},[]),B.useEffect(()=>{(async()=>{if(n){const S=await M.getReadingSessions(),h=await M.getNotes();o(S.filter(g=>g.bookId===n.key)),l(h.filter(g=>g.bookId===n.key))}else o([]),l([])})()},[n]);const d=async b=>{const S=[...t],h=S.findIndex(g=>g.key===b.key);h>=0?S[h]=b:S.push(b),m(S),await M.saveBooks(S)},a=async b=>{const S=t.filter(k=>k.key!==b);m(S),await M.saveBooks(S);const h=await M.getReadingSessions(),g=await M.getNotes(),j=h.filter(k=>k.bookId!==b),p=g.filter(k=>k.bookId!==b);await M.saveReadingSessions(j),await M.saveNotes(p),n&&n.key===b&&(s(null),await M.setCurrentBook(null))},c=async b=>{s(b),await M.setCurrentBook(b)},x=async b=>{const S=await M.getReadingSessions(),h=S.findIndex(g=>g.id===b.id);h>=0?S[h]=b:S.push(b),await M.saveReadingSessions(S),n&&b.bookId===n.key&&o(S.filter(g=>g.bookId===n.key))},y=async b=>{const h=[...await M.getNotes(),b];await M.saveNotes(h),n&&b.bookId===n.key&&l(h.filter(g=>g.bookId===n.key))},u=async b=>{const h=(await M.getNotes()).map(g=>g.id===b.id?b:g);await M.saveNotes(h),n&&b.bookId===n.key&&l(h.filter(g=>g.bookId===n.key))},w=async b=>{const h=(await M.getNotes()).filter(g=>g.id!==b);await M.saveNotes(h),n&&l(h.filter(g=>g.bookId===n.key))};return e.jsx(ot.Provider,{value:{books:t,currentBook:n,sessions:r,notes:f,addBook:d,removeBook:a,setActiveBook:c,addSession:x,addNote:y,updateNote:u,deleteNote:w},children:i})},it=B.createContext(void 0),ae=()=>{const i=B.useContext(it);if(!i)throw new Error("usePet must be used within a PetProvider");return i},Be=()=>({name:"Bookworm",level:1,experience:0,experienceToNext:100,happiness:100,hunger:50,energy:100,health:100,points:10,lastFed:new Date().toISOString(),lastPlayed:new Date().toISOString(),lastSlept:new Date().toISOString(),createdAt:new Date().toISOString(),totalBooksRead:0,totalReadingTime:0,evolutionStage:"egg",badges:[],mood:"content"}),lt=()=>({booksReadToday:0,readingTimeToday:0,streakDays:0,lastActiveDate:new Date().toISOString()}),xs=()=>{try{const i=localStorage.getItem("bookish_pet");if(i){const t=JSON.parse(i);return{...Be(),...t}}}catch(i){console.error("Error loading pet from storage:",i)}return Be()},fs=()=>{try{const i=localStorage.getItem("bookish_pet_stats");if(i)return JSON.parse(i)}catch(i){console.error("Error loading pet stats from storage:",i)}return lt()},gs=i=>{localStorage.setItem("bookish_pet",JSON.stringify(i))},ps=i=>{localStorage.setItem("bookish_pet_stats",JSON.stringify(i))},ys=({children:i})=>{const[t,m]=B.useState(xs),[n,s]=B.useState(fs);B.useEffect(()=>{gs(t)},[t]),B.useEffect(()=>{ps(n)},[n]),B.useEffect(()=>{const v=setInterval(()=>{const N=new Date,A=new Date(t.lastFed),D=(N.getTime()-A.getTime())/(1e3*60*60);D>1&&m(P=>{const I=Math.floor(D);return{...P,hunger:Math.max(0,P.hunger-I*2),energy:Math.max(0,P.energy-I),happiness:Math.max(0,P.happiness-I),mood:r(Math.max(0,P.happiness-I),Math.max(0,P.hunger-I*2),Math.max(0,P.energy-I))}});const E=N.toDateString(),T=new Date(n.lastActiveDate).toDateString();E!==T&&s(P=>({...P,booksReadToday:0,readingTimeToday:0,lastActiveDate:N.toISOString()}))},3e4);return()=>clearInterval(v)},[t.lastFed,n.lastActiveDate]);const r=(v,N,A)=>N<20?"hungry":A<20?"sleepy":v>80?"happy":v>60?"excited":v<30?"sad":"content",o=v=>100+v*50,f=(v,N)=>{let A=N,D=o(A);for(;v>=D;)A++,D=o(A);return{newLevel:A,newExpToNext:D}},l=v=>v<3?"egg":v<8?"baby":v<15?"child":v<25?"teen":v<40?"adult":"elder",d=()=>{const v=t.evolutionStage,N=t.mood,A={egg:{happy:"🥚",content:"🥚",sad:"💔",excited:"✨",sleepy:"😴",hungry:"🥚"},baby:{happy:"😊",content:"🐛",sad:"😢",excited:"🤩",sleepy:"😴",hungry:"😋"},child:{happy:"😄",content:"🐯",sad:"😭",excited:"🤗",sleepy:"💤",hungry:"🍎"},teen:{happy:"😎",content:"🦊",sad:"😔",excited:"🚀",sleepy:"😪",hungry:"🍕"},adult:{happy:"🌟",content:"🦉",sad:"😞",excited:"🎉",sleepy:"😌",hungry:"🍽️"},elder:{happy:"👑",content:"🐉",sad:"😟",excited:"🎊",sleepy:"🧘",hungry:"🍱"}};return A[v][N]||A[v].content},a=()=>{m(v=>{if(v.points<3)return v;const N=Math.min(100,v.hunger+30),A=Math.min(100,v.happiness+10),D=v.experience+5,{newLevel:E,newExpToNext:T}=f(D,v.level);return{...v,hunger:N,happiness:A,experience:D,level:E,experienceToNext:T,points:v.points-3,lastFed:new Date().toISOString(),evolutionStage:l(E),mood:r(A,N,v.energy)}})},c=()=>{m(v=>{if(v.points<5)return v;const N=Math.min(100,v.happiness+20),A=Math.max(0,v.energy-15),D=v.experience+10,{newLevel:E,newExpToNext:T}=f(D,v.level);return{...v,happiness:N,energy:A,experience:D,level:E,experienceToNext:T,points:v.points-5,lastPlayed:new Date().toISOString(),evolutionStage:l(E),mood:r(N,v.hunger,A)}})},x=()=>{m(v=>{const N=Math.min(100,v.energy+40),A=Math.min(100,v.health+10);return{...v,energy:N,health:A,lastSlept:new Date().toISOString(),mood:r(v.happiness,v.hunger,N)}})},y=(v,N=!1)=>{const E=Math.floor(v/5)+(N?50:0);E>0&&(m(T=>{const P=T.experience+E,I=Math.min(100,T.happiness+Math.floor(v/10)),U=T.totalReadingTime+v,{newLevel:L,newExpToNext:C}=f(P,T.level);return{...T,experience:P,level:L,experienceToNext:C,happiness:I,totalReadingTime:U,evolutionStage:l(L),mood:r(I,T.hunger,T.energy)}}),s(T=>({...T,readingTimeToday:T.readingTimeToday+v,lastActiveDate:new Date().toISOString()})))},u=()=>{m(v=>{const N=v.experience+50,A=Math.min(100,v.happiness+25),D=v.totalBooksRead+1,E=20,{newLevel:T,newExpToNext:P}=f(N,v.level),I=[...v.badges];return D===1&&!I.includes("first-book")&&I.push("first-book"),D===10&&!I.includes("book-lover")&&I.push("book-lover"),D===50&&!I.includes("bookworm")&&I.push("bookworm"),{...v,experience:N,level:T,experienceToNext:P,happiness:A,points:v.points+E,totalBooksRead:D,badges:I,evolutionStage:l(T),mood:r(A,v.hunger,v.energy)}}),s(v=>({...v,booksReadToday:v.booksReadToday+1,lastActiveDate:new Date().toISOString()}))},w=()=>({happy:"Your pet is very happy! Keep up the great reading!",excited:"Your pet is excited about your reading progress!",content:"Your pet is content and enjoying your company.",sad:"Your pet seems sad. Try feeding or playing with them!",sleepy:"Your pet is tired. Maybe they need some rest?",hungry:"Your pet is hungry! Don't forget to feed them."})[t.mood],b=()=>{const v=l(t.level+1),N=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return{current:t.level,required:N,stage:v}},S=()=>{const v=t.level<3?3:t.level<8?8:t.level<15?15:t.level<25?25:40;return t.level>=v&&t.evolutionStage!==l(t.level)},h=()=>{m(v=>({...v,evolutionStage:l(v.level),happiness:100,health:100}))},g=()=>{const v=Be();m(v),s(lt())},j=v=>{m(N=>({...N,name:v}))},p=()=>t.happiness<30?"sad":t.happiness<70?"neutral":"happy",k=()=>t.experience/t.experienceToNext*100;return e.jsx(it.Provider,{value:{pet:t,petStats:n,feedPet:a,playWithPet:c,petSleep:x,updatePetFromReading:y,updatePetFromBookCompletion:u,getPetMood:w,getPetEvolutionRequirement:b,resetPet:g,updatePetName:j,getPetEmoji:d,canEvolve:S,evolvePet:h,getPetHappinessLevel:p,getLevelProgress:k},children:i})},Q={GUEST_PROFILE:"bookish-guest-profile",GUEST_BOOKS:"bookish-guest-books",GUEST_READING_SESSIONS:"bookish-guest-reading-sessions",GUEST_NOTES:"bookish-guest-notes",GUEST_PET:"bookish-guest-pet"};class Ce{static get(t){try{const m=localStorage.getItem(t);return m?JSON.parse(m):null}catch(m){return console.error("Error reading from localStorage:",m),null}}static set(t,m){try{return localStorage.setItem(t,JSON.stringify(m)),!0}catch(n){return console.error("Error writing to localStorage:",n),!1}}static remove(t){try{return localStorage.removeItem(t),!0}catch(m){return console.error("Error removing from localStorage:",m),!1}}static clear(){try{return Object.values(Q).forEach(t=>{localStorage.removeItem(t)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}static getGuestProfile(){return this.get(Q.GUEST_PROFILE)}static setGuestProfile(t){return this.set(Q.GUEST_PROFILE,{...t,lastUpdated:new Date().toISOString()})}static getGuestBooks(){return this.get(Q.GUEST_BOOKS)||[]}static setGuestBooks(t){return this.set(Q.GUEST_BOOKS,{books:t,lastUpdated:new Date().toISOString()})}static getGuestPet(){return this.get(Q.GUEST_PET)}static setGuestPet(t){return this.set(Q.GUEST_PET,{...t,lastUpdated:new Date().toISOString()})}}const ct=B.createContext(void 0),bs={isAuthenticated:!1,user:null,isLoading:!0,error:null},vs=(i,t)=>{switch(t.type){case"AUTH_START":return{...i,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...i,isAuthenticated:!0,user:t.payload,isLoading:!1,error:null};case"AUTH_FAILURE":return{...i,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"SIGN_OUT":return{...i,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...i,error:null};case"UPDATE_USER":return{...i,user:i.user?{...i.user,...t.payload}:null};default:return i}},ws=({children:i})=>{const[t,m]=B.useReducer(vs,bs);B.useEffect(()=>{(async()=>{var c;try{const x=new Promise((w,b)=>setTimeout(()=>b(new Error("Authentication check timeout")),5e3)),y=$.recallUser(),u=await Promise.race([y,x]);if(u&&u.success&&u.user){const w=new Promise((b,S)=>setTimeout(()=>S(new Error("Profile load timeout")),3e3));try{const b=await Promise.race([$.getProfile(),w]),S={...u.user,username:b!=null&&b.success&&((c=b==null?void 0:b.profile)!=null&&c.originalUsername)?b.profile.originalUsername:u.user.username||"Unknown User",profile:b&&b.success?b.profile:void 0};m({type:"AUTH_SUCCESS",payload:S})}catch{const S={...u.user,username:u.user.username||"Unknown User",profile:void 0};m({type:"AUTH_SUCCESS",payload:S})}}else m({type:"AUTH_FAILURE",payload:""})}catch(x){console.log("GunJS auth check failed (servers may be down):",x),m({type:"AUTH_FAILURE",payload:""})}})()},[]);const d={...t,signIn:async(a,c)=>{m({type:"AUTH_START"});try{const x=await $.signIn(a,c);if(x.success&&x.user){const y=await $.getProfile(),u={...x.user,username:a,profile:y.success?y.profile:void 0};return m({type:"AUTH_SUCCESS",payload:u}),{success:!0}}else return m({type:"AUTH_FAILURE",payload:x.error||"Sign in failed"}),{success:!1,error:x.error}}catch{const y="An unexpected error occurred";return m({type:"AUTH_FAILURE",payload:y}),{success:!1,error:y}}},signUp:async(a,c)=>{m({type:"AUTH_START"});try{const x=await $.signUp(a,c);return x.success?(m({type:"AUTH_FAILURE",payload:""}),{success:!0}):(m({type:"AUTH_FAILURE",payload:x.error||"Sign up failed"}),{success:!1,error:x.error})}catch{const y="An unexpected error occurred";return m({type:"AUTH_FAILURE",payload:y}),{success:!1,error:y}}},signOut:()=>{$.signOut(),m({type:"SIGN_OUT"})},updateProfile:async a=>{console.log("AuthContext: updateProfile called with:",a);try{const c=await $.updateProfile(a);return console.log("AuthContext: gunService.updateProfile result:",c),c.success?(console.log("AuthContext: Updating user state with profile:",a),m({type:"UPDATE_USER",payload:{profile:a}}),{success:!0}):(console.log("AuthContext: Profile update failed:",c.error),{success:!1,error:c.error})}catch(c){return console.error("AuthContext: Profile update error:",c),{success:!1,error:"Failed to update profile"}}},clearError:()=>{m({type:"CLEAR_ERROR"})},continueAsGuest:()=>{let a={displayName:"Guest User",bio:"Browsing as a guest",favoriteGenres:[],readingGoal:0};const c=Ce.getGuestProfile();c&&(a={displayName:c.displayName||"Guest User",bio:c.bio||"Browsing as a guest",favoriteGenres:c.favoriteGenres||[],readingGoal:c.readingGoal||0});const x={id:"guest-"+Date.now(),username:"Guest User",email:"",createdAt:new Date().toISOString(),profile:a};m({type:"AUTH_SUCCESS",payload:x})}};return e.jsx(ct.Provider,{value:d,children:i})},ve=()=>{const i=B.useContext(ct);if(i===void 0)throw new Error("useAuth must be used within an AuthProvider");return i},js=({onClose:i})=>{const[t,m]=B.useState(!1),[n,s]=B.useState(""),[r,o]=B.useState(""),[f,l]=B.useState(!1),[d,a]=B.useState(!1),{signIn:c,signUp:x,error:y,clearError:u,continueAsGuest:w}=ve(),b=async g=>{if(g.preventDefault(),!(!n.trim()||!r.trim())){a(!0),u();try{let j;t?(j=await x(n.trim(),r),j.success&&(m(!1),o(""),alert("Account created successfully! Please sign in."))):(j=await c(n.trim(),r),j.success&&i&&i())}finally{a(!1)}}},S=()=>{m(!t),o(""),u()},h=()=>{w(),i&&i()};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-auto border border-[#F0EDE8]",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"bg-[#F0EDE8] rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(Y,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h2",{className:"font-serif text-2xl font-medium text-[#3A3A3A] mb-2",children:t?"Join Bookish":"Welcome Back"}),e.jsx("p",{className:"text-[#8B7355]",children:t?"Start your reading journey with your virtual pet companion":"Continue your reading adventure with your book buddy"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:["        ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-[#8B7355]"}),e.jsx("input",{id:"username",type:"text",value:n,onChange:g=>s(g.target.value),className:"pl-10 pr-4 py-3 w-full border-2 border-[#F0EDE8] rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors bg-[#F7F5F3] text-[#3A3A3A]",placeholder:"Enter your username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-[#8B7355]"}),"            ",e.jsx("input",{id:"password",type:f?"text":"password",value:r,onChange:g=>o(g.target.value),className:"pl-10 pr-12 py-3 w-full border-2 border-[#F0EDE8] rounded-xl focus:ring-2 focus:ring-[#8B7355] focus:border-[#8B7355] transition-colors bg-[#F7F5F3] text-[#3A3A3A]",placeholder:t?"Create a strong password":"Enter your password",minLength:t?8:void 0,required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:f?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(St,{className:"w-5 h-5"})})]}),t&&e.jsx("p",{className:"text-sm text-[#8B7355] mt-1",children:"Password must be at least 8 characters long"})]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:y}),"        ",e.jsx("button",{type:"submit",disabled:d,className:"w-full bg-[#8B7355] text-white py-3 px-4 rounded-xl font-medium hover:bg-[#6B5B45] focus:ring-2 focus:ring-[#8B7355] focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),"        ",e.jsx("button",{type:"button",onClick:h,className:"w-full bg-gray-100 text-[#8B7355] py-3 px-4 rounded-xl font-medium hover:bg-gray-200 focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-all duration-200 border border-gray-200",children:"Continue as Guest"}),e.jsx("p",{className:"text-sm text-center text-[#8B7355] mt-2",children:"Guest mode: Explore the app with local storage (data saved on this device only)"})]}),"      ",e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-[#8B7355]",children:[t?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:S,className:"text-[#3A3A3A] hover:text-[#8B7355] font-medium transition-colors underline",children:t?"Sign In":"Sign Up"})]})}),"      ",i&&e.jsx("button",{onClick:i,className:"absolute top-4 right-4 text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},Ns=({children:i,fallback:t})=>{const{isAuthenticated:m,isLoading:n}=ve();return n?e.jsx("div",{className:"min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center border border-[#F0EDE8]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#8B7355] mx-auto mb-4"}),e.jsx("p",{className:"text-[#8B7355] font-medium",children:"Loading your reading world..."})]})}):m?e.jsx(e.Fragment,{children:i}):t||e.jsx("div",{className:"min-h-screen bg-[#F7F5F3] flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(js,{})})})},Ss=()=>{const i=K(),t=[{icon:Y,title:"Track Your Reading",description:"Organize your books into 'Want to Read', 'Currently Reading', and 'Completed' categories with beautiful progress tracking."},{icon:et,title:"Reading Sessions",description:"Time your reading sessions and watch your progress grow. See exactly how much time you've invested in each book."},{icon:re,title:"Take Notes",description:"Capture your thoughts, favorite quotes, and insights as you read. Never lose track of those brilliant moments."},{icon:Se,title:"Virtual Pet Companion",description:"Care for your adorable reading companion that grows and evolves as you complete books and reading sessions."},{icon:pe,title:"Achievement System",description:"Unlock achievements and watch your reading streaks grow. Gamify your reading journey and stay motivated."},{icon:kt,title:"Beautiful Interface",description:"Enjoy a warm, book-inspired design that makes reading tracking a delightful experience every day."}],m=[{icon:ke,title:"Build Better Habits",description:"Turn reading into a consistent, rewarding habit with gentle gamification and progress tracking."},{icon:At,title:"Stay Motivated",description:"Your virtual pet and achievement system keep you engaged and excited about your reading journey."},{icon:Et,title:"Mindful Reading",description:"Take notes and track your thoughts to engage more deeply with every book you read."}];return e.jsxs("div",{className:"min-h-screen bg-[#F7F5F3] max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-[#8B7355] rounded-2xl flex items-center justify-center",children:e.jsx(Y,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"font-serif text-4xl lg:text-6xl font-bold text-[#3A3A3A] mb-2",children:"Bookish"}),e.jsx("p",{className:"text-lg lg:text-xl text-[#8B7355] font-medium",children:"Your Reading Companion"})]}),e.jsxs("div",{className:"text-center mb-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-4 leading-tight",children:"Transform Your Reading Journey with a Delightful Digital Companion"}),e.jsx("p",{className:"text-[#8B7355] leading-relaxed mb-6 text-base lg:text-lg",children:"Track your books, time your sessions, take meaningful notes, and care for your virtual pet as you build the reading habit you've always wanted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>i("/"),className:"bg-[#8B7355] text-white px-8 py-4 rounded-xl font-medium text-lg flex items-center gap-2 justify-center hover:bg-[#7A6349] transition-colors shadow-lg",children:["Start Reading Today",e.jsx(_e,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:()=>i("/search"),className:"bg-transparent border-2 border-[#8B7355] text-[#8B7355] px-8 py-4 rounded-xl font-medium text-lg hover:bg-[#8B7355] hover:text-white transition-colors",children:"Browse Books"})]})]}),e.jsx("div",{className:"relative mb-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border-4 border-[#F0EDE8]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-[#F0EDE8] rounded w-3/4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#8B7355] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-16 bg-[#D2691E] rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded w-full"}),e.jsx("div",{className:"h-2 bg-[#F0EDE8] rounded w-2/3"}),e.jsx("div",{className:"h-2 bg-[#E59554] rounded w-3/4"})]})]})]})]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Everything You Need"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Powerful features designed to enhance your reading experience"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((n,s)=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#F0EDE8] rounded-xl flex items-center justify-center mb-4",children:e.jsx(n.icon,{className:"w-8 h-8 text-[#8B7355]"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:n.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:n.description})]})},s))})]}),e.jsx("div",{className:"bg-[#F0EDE8] py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-[#3A3A3A] mb-3",children:"Why Choose Bookish?"}),e.jsx("p",{className:"text-[#8B7355] text-base lg:text-lg",children:"Join thousands of readers who've transformed their reading habits"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:m.map((n,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-[#8B7355] rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(n.icon,{className:"w-10 h-10 text-white"})}),e.jsx("h4",{className:"font-serif font-medium text-[#3A3A3A] mb-3 text-lg",children:n.title}),e.jsx("p",{className:"text-sm text-[#8B7355] leading-relaxed",children:n.description})]},s))})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-16 lg:px-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#8B7355] to-[#D2691E] rounded-2xl p-8 lg:p-12 text-white text-center",children:[e.jsx("h3",{className:"font-serif text-xl lg:text-2xl font-medium mb-8",children:"Join the Reading Revolution"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"10K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Books Tracked"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"5K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Happy Readers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"50K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Reading Hours"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl lg:text-4xl font-bold mb-1",children:"25K+"}),e.jsx("div",{className:"text-sm opacity-90",children:"Notes Written"})]})]}),e.jsxs("button",{onClick:()=>i("/"),className:"bg-white text-[#8B7355] px-8 py-4 rounded-xl font-medium flex items-center gap-2 mx-auto hover:bg-gray-50 transition-colors text-lg",children:["Get Started Free",e.jsx(_e,{className:"w-5 h-5"})]})]})}),e.jsx("div",{className:"bg-[#3A3A3A] py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center lg:px-8",children:[e.jsx("h3",{className:"font-serif text-2xl lg:text-3xl font-medium text-white mb-4",children:"Ready to Begin?"}),e.jsx("p",{className:"text-gray-300 mb-8 leading-relaxed text-base lg:text-lg max-w-2xl mx-auto",children:"Start your reading journey today. Search for your first book, meet your virtual companion, and begin building the reading habit that will last a lifetime."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>i("/"),className:"flex-1 bg-[#D2691E] text-white px-6 py-4 rounded-xl font-medium hover:bg-[#B8541A] transition-colors",children:"Start Your Journey"}),e.jsx("button",{onClick:()=>i("/library"),className:"flex-1 bg-transparent border-2 border-gray-500 text-gray-300 px-6 py-4 rounded-xl font-medium hover:border-gray-400 hover:text-gray-200 transition-colors",children:"View Library"})]})]})})]})},ks=({greeting:i})=>{var o;const t=K(),{pet:m}=ae(),{user:n}=ve(),s=(o=n==null?void 0:n.id)==null?void 0:o.startsWith("guest-"),r=()=>{const f=m.mood;return{happy:"😊",excited:"🤩",content:"😌",sad:"😢",sleepy:"😴",hungry:"🍎"}[f]||"😌"};return e.jsx("header",{className:"p-4 bg-[#F7F5F3]",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:i}),e.jsx("p",{className:"text-sm text-[#8B7355]",children:"Ready to dive into a story?"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-[#F0EDE8] rounded-lg px-3 py-2 cursor-pointer hover:bg-[#E8E3DD] transition-colors",onClick:()=>t("/pet"),children:[e.jsx("span",{className:"text-lg",children:r()}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium text-[#3A3A3A]",children:m.name}),e.jsxs("p",{className:"text-xs text-[#8B7355]",children:["Lv.",m.level]})]})]}),"          ",e.jsx("button",{className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s?"bg-orange-100 hover:bg-orange-200":"bg-[#F0EDE8] hover:bg-[#E8E3DD]"}`,onClick:()=>t("/profile"),title:s?"Guest User":"Profile",children:e.jsx(Ze,{className:`w-5 h-5 ${s?"text-orange-600":"text-[#8B7355]"}`})})]})]})})},As=({onContinueReading:i})=>{const{currentBook:t,sessions:m,setActiveBook:n}=te(),[s,r]=B.useState(!0);if(B.useEffect(()=>{if(t){const y=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(u=>u.key===t.key);r(y),y||n(null)}},[t,n]),!t||!s)return e.jsx("div",{className:"p-4 bg-[#F0EDE8] rounded-xl shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center p-6 border-2 border-dashed border-[#8B7355] rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"w-8 h-8 mx-auto text-[#8B7355] mb-2"}),e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-1",children:"No book selected"}),e.jsx("p",{className:"text-sm text-[#8B7355]",children:"Search for a book to start reading"})]})})});const o=[...m].sort((x,y)=>new Date(y.startTime).getTime()-new Date(x.startTime).getTime())[0],f=(o==null?void 0:o.endPage)||(o==null?void 0:o.startPage)||1,l=t.number_of_pages_median||0,d=l>0?Math.min(Math.round(f/l*100),100):0,a=l>0,c=a&&d>0;return e.jsxs("div",{className:"p-4 bg-[#F0EDE8] rounded-xl shadow-sm",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Currently Reading"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-36 rounded-md overflow-hidden shadow-md flex-shrink-0",children:t.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${t.cover_i}-M.jpg`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-[#8B7355] flex items-center justify-center text-white p-2",children:e.jsx("span",{className:"text-xs text-center font-serif",children:t.title})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif text-base font-medium text-[#3A3A3A] line-clamp-2 mb-1",children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm text-[#8B7355] mb-2",children:["by ",t.author_name[0]]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#8B7355] mb-2",children:[e.jsxs("span",{children:[d,"%"]}),e.jsx("div",{className:"flex-1 h-1.5 bg-[#F7F5F3] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#E59554] rounded-full transition-all duration-300 ease-out",style:{width:`${d}%`}})})]}),e.jsxs("div",{className:"text-xs text-[#8B7355] mb-4",children:["Page ",f," of ",l]})]}):a?e.jsxs("div",{className:"text-xs text-[#8B7355] mb-4",children:["Page ",f," of ",l]}):e.jsxs("div",{className:"text-xs text-[#8B7355] mb-4",children:["Currently on page ",f,e.jsx("div",{className:"text-xs text-[#8B7355] opacity-75 mt-1",children:"Page count unavailable"})]}),e.jsxs("button",{onClick:i,className:"w-full py-2 px-4 bg-[#D2691E] text-white rounded-lg text-sm font-medium hover:bg-[#A0522D] transition-colors flex items-center justify-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Continue Reading"]})]})]})]})},fe=({icon:i,value:t,label:m,color:n})=>e.jsxs("div",{className:"flex flex-col items-center p-3 bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full ${n} mb-1`,children:i}),e.jsx("span",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:t}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:m})]}),Es=()=>{const i=nt(),t=at(),m=n=>{if(n<60)return`${n} min`;const s=Math.floor(n/60),r=n%60;return r===0?`${s} hrs`:`${s}.${Math.floor(r/6)}`};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(fe,{icon:e.jsx(ne,{className:"w-5 h-5 text-white"}),value:m(i.readingTimeToday),label:"Today",color:"bg-[#E59554]"}),e.jsx(fe,{icon:e.jsx(ne,{className:"w-5 h-5 text-white"}),value:m(i.readingTimeThisWeek),label:"This Week",color:"bg-[#CD853F]"}),e.jsx(fe,{icon:e.jsx(Bt,{className:"w-5 h-5 text-white"}),value:i.totalBooksRead,label:"Books Read",color:"bg-[#8B7355]"}),e.jsx(fe,{icon:e.jsx(Ct,{className:"w-5 h-5 text-white"}),value:t.currentStreak,label:"Streak",color:"bg-[#D2691E]"})]})},ge=({icon:i,label:t,onClick:m})=>e.jsxs("button",{onClick:m,className:"flex flex-col items-center justify-center p-4 bg-white rounded-xl shadow-sm hover:bg-[#F0EDE8] transition-colors",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-[#F7F5F3] mb-2",children:e.jsx(i,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("span",{className:"text-sm text-[#3A3A3A]",children:t})]}),Bs=({type:i,title:t,timestamp:m,duration:n})=>{const s=()=>{switch(i){case"reading":return e.jsx(ne,{className:"w-4 h-4 text-[#E59554]"});case"note":return e.jsx(Pe,{className:"w-4 h-4 text-[#8B7355]"});case"completed":return e.jsx(Pe,{className:"w-4 h-4 text-[#D2691E]"})}},r=o=>{const f=new Date,l=new Date(o),d=Math.floor((f.getTime()-l.getTime())/(1e3*60));if(d<1)return"just now";if(d<60)return`${d} minute${d===1?"":"s"} ago`;const a=Math.floor(d/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const c=Math.floor(a/24);return`${c} day${c===1?"":"s"} ago`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-[#F0EDE8]",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#F7F5F3] flex items-center justify-center flex-shrink-0",children:s()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-[#3A3A3A]",children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#8B7355]",children:[e.jsx("span",{children:r(m)}),n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n," min"]})]})]})]})]})},Cs=()=>{const i=K(),m=[...Te()].sort((s,r)=>new Date(r.startTime).getTime()-new Date(s.startTime).getTime()).slice(0,5),n=()=>{const s=new Date().getHours();return s<12?"Good morning":s<18?"Good afternoon":"Good evening"};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] pb-6",children:[e.jsx(ks,{greeting:n()}),e.jsxs("main",{className:"px-4 py-2 space-y-6",children:[e.jsx(As,{onContinueReading:()=>i("/reading")}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ge,{icon:le,label:"Find Books",onClick:()=>i("/search")}),e.jsx(ge,{icon:re,label:"My Notes",onClick:()=>i("/notes")}),e.jsx(ge,{icon:Dt,label:"My Library",onClick:()=>i("/library")}),e.jsx(ge,{icon:Tt,label:"Statistics",onClick:()=>i("/stats")})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Your Progress"}),e.jsx(Es,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-1",children:"Recent Activity"}),m.length>0?e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:m.map(s=>e.jsx(Bs,{type:"reading",title:"Reading session completed",timestamp:s.endTime||s.startTime,duration:s.duration||0},s.id))}):e.jsx("p",{className:"text-sm text-[#8B7355] p-4 bg-white rounded-xl shadow-sm",children:"No recent activity. Start reading to track your progress!"})]}),e.jsx("section",{className:"text-center py-4",children:e.jsx("button",{onClick:()=>i("/welcome"),className:"text-sm text-[#8B7355] hover:text-[#3A3A3A] transition-colors underline",children:"Learn more about Bookish features"})})]})]})},Ds="modulepreload",Ts=function(i){return"/Bookish/"+i},We={},ze=function(t,m,n){let s=Promise.resolve();if(m&&m.length>0){let o=function(d){return Promise.all(d.map(a=>Promise.resolve(a).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),l=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=o(m.map(d=>{if(d=Ts(d),d in We)return;We[d]=!0;const a=d.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${c}`))return;const x=document.createElement("link");if(x.rel=a?"stylesheet":Ds,a||(x.as="script"),x.crossOrigin="",x.href=d,l&&x.setAttribute("nonce",l),document.head.appendChild(x),a)return new Promise((y,u)=>{x.addEventListener("load",y),x.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=o,window.dispatchEvent(f),!f.defaultPrevented)throw o}return s.then(o=>{for(const f of o||[])f.status==="rejected"&&r(f.reason);return t().catch(r)})},_s=()=>{const i=K(),[t,m]=B.useState(""),[n,s]=B.useState([]),[r,o]=B.useState(!1),[f,l]=B.useState("general"),[d,a]=B.useState(!1);B.useEffect(()=>()=>{if(typeof window<"u"&&window.Quagga)try{window.Quagga.stop()}catch{}},[]);const c=async g=>{if(g.preventDefault(),!!t.trim()){o(!0);try{let j;f==="subject"?j=await as(t):j=await es(t),s(j)}catch(j){console.error("Error searching books:",j)}finally{o(!1)}}},x=async()=>{try{a(!0),setTimeout(()=>{u()},300)}catch(g){console.error("Error starting camera:",g),alert("Unable to access camera. Please check permissions."),a(!1)}},y=()=>{try{ze(()=>import("./quagga.min-CA_kn7cW.js").then(g=>g.q),__vite__mapDeps([0,1])).then(g=>{const j=g.default;j.stop(),j.offDetected(),j.offProcessed(),console.log("Quagga stopped successfully")}).catch(g=>{console.log("Error stopping Quagga:",g)})}catch(g){console.log("Quagga cleanup error:",g)}a(!1)},u=async()=>{try{const g=document.querySelector("#barcode-scanner");if(!g){console.error("Scanner element not found");return}const p=(await ze(()=>import("./quagga.min-CA_kn7cW.js").then(N=>N.q),__vite__mapDeps([0,1]))).default,k={inputStream:{name:"Live",type:"LiveStream",target:g,constraints:{width:480,height:320,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:1,frequency:5,decoder:{readers:["ean_reader","ean_8_reader"]},locate:!0};console.log("Initializing Quagga with config:",k),p.init(k,N=>{if(N){console.error("QuaggaJS initialization failed:",N),alert("Camera access failed. Please ensure you have granted camera permissions and are using HTTPS."),y();return}console.log("QuaggaJS initialized successfully"),p.start(),console.log("QuaggaJS started")}),p.onDetected(N=>{const A=N.codeResult.code;console.log("Barcode detected:",A);const D=b(A);console.log("Cleaned barcode:",D),w(D)?(console.log("Valid ISBN detected, searching..."),S(D),y()):console.log("Invalid ISBN format, continuing scan...")});let v=0;p.onProcessed(N=>{v++,v%30===0&&console.log("Processing frames... Count:",v),N&&N.codeResult&&N.codeResult.code&&console.log("Potential code detected:",N.codeResult.code)})}catch(g){console.error("Error loading Quagga:",g),alert("Failed to load barcode scanner. Please try again."),y()}},w=g=>{const j=g.replace(/[^0-9X]/gi,"");return j.length===10||j.length===13},b=g=>g.replace(/[^0-9X]/gi,""),S=async g=>{o(!0);try{const j=await os(g);j?(s([j]),m(g)):alert("No book found for this barcode")}catch(j){console.error("Error searching by ISBN:",j),alert("Error scanning barcode")}finally{o(!1)}},h=g=>{i(`/book?book=${encodeURIComponent(g.key)}`,{state:{bookData:g}})};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] pb-6",children:[e.jsxs("header",{className:"page-header p-4 bg-[#F0EDE8] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>i(-1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#F7F5F3] transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsxs("form",{onSubmit:c,className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t,onChange:g=>m(g.target.value),placeholder:f==="subject"?"Search by subject (e.g. science, fiction)...":"Search for books...",className:"w-full py-2 px-4 pr-10 bg-white border border-[#E5E5E5] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#E59554] text-[#3A3A3A]"}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-[#E59554] text-white",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:x,className:"w-10 h-10 flex items-center justify-center rounded-full bg-[#E59554] text-white hover:bg-[#D2691E] transition-colors",children:e.jsx(Fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex bg-white rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>l("general"),className:`flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors ${f==="general"?"bg-[#E59554] text-white":"text-[#8B7355] hover:bg-[#F7F5F3]"}`,children:[e.jsx(le,{className:"w-4 h-4"}),"General"]}),e.jsxs("button",{onClick:()=>l("subject"),className:`flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md text-sm font-medium transition-colors ${f==="subject"?"bg-[#E59554] text-white":"text-[#8B7355] hover:bg-[#F7F5F3]"}`,children:[e.jsx(Ie,{className:"w-4 h-4"}),"Subject"]})]})]}),d&&e.jsx("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 m-4 max-w-sm w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"Scan ISBN Barcode"}),e.jsx("button",{onClick:y,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#F7F5F3] transition-colors",children:e.jsx(De,{className:"w-5 h-5 text-[#8B7355]"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{id:"barcode-scanner",className:"w-full h-48 bg-black rounded-lg overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"📷"}),e.jsx("div",{children:"Initializing camera..."}),e.jsx("div",{className:"text-xs mt-1",children:"Make sure to allow camera access"})]})})}),e.jsx("div",{className:"absolute inset-0 border-2 border-[#E59554] rounded-lg pointer-events-none",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-16 border-2 border-white rounded",children:e.jsx("div",{className:"absolute inset-0 border-t-2 border-[#E59554] animate-pulse"})})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm text-[#8B7355] mb-2",children:"Point camera at book's barcode"}),e.jsx("p",{className:"text-xs text-[#8B7355] mb-2",children:"Hold steady and ensure good lighting"}),e.jsx("p",{className:"text-xs text-[#8B7355] italic",children:"Looking for ISBN-13 barcodes (978...)"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{const g=prompt("Enter ISBN manually (if barcode scan fails):");g&&(S(g.trim()),y())},className:"text-xs text-[#E59554] underline",children:"Enter ISBN manually"})})]})]})}),e.jsx("main",{className:"px-4 py-4",children:r?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#E59554]"})}):n.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:f==="subject"?"Books in Subject":"Search Results"}),e.jsx("div",{className:"space-y-3",children:n.map(g=>e.jsxs("div",{onClick:()=>h(g),className:"flex gap-4 p-4 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"w-12 h-16 bg-[#F0EDE8] rounded flex-shrink-0 overflow-hidden",children:[g.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${g.cover_i}-M.jpg`,alt:g.title,className:"w-full h-full object-cover",onError:j=>{var k;const p=j.target;p.style.display="none",(k=p.nextElementSibling)==null||k.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-full flex items-center justify-center ${g.cover_i?"hidden":""}`,children:e.jsx(Y,{className:"w-6 h-6 text-[#8B7355]"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-[#3A3A3A] text-sm leading-tight mb-1 truncate",children:g.title}),g.author_name&&e.jsxs("p",{className:"text-xs text-[#8B7355] mb-2 truncate",children:["by ",g.author_name[0]]}),g.first_publish_year&&e.jsx("p",{className:"text-xs text-[#8B7355]",children:g.first_publish_year})]})]},g.key))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[e.jsx(le,{className:"w-12 h-12 text-[#8B7355] mb-4 opacity-70"}),e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"Find your next great read"}),e.jsx("p",{className:"text-sm text-[#8B7355] max-w-xs mb-4",children:"Search for books by title, author, ISBN, or browse by subject. You can also scan a barcode!"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-[#8B7355]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Scan"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Search"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Browse"]})]})]})})]})},me=({isOpen:i,onClose:t,onConfirm:m,title:n,message:s,type:r="confirm",confirmText:o="Confirm",cancelText:f="Cancel"})=>{if(!i)return null;const l=()=>{switch(r){case"alert":return e.jsx(Oe,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(Pt,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(_t,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Oe,{className:"w-8 h-8 text-[#D2691E]"})}},d=()=>{m&&m(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-sm mx-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l(),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:n})}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#F0EDE8] transition-colors",children:e.jsx(De,{className:"w-5 h-5 text-[#8B7355]"})})]}),e.jsx("p",{className:"text-sm text-[#3A3A3A] leading-relaxed mb-6",children:s}),e.jsxs("div",{className:"flex gap-3",children:[r==="confirm"&&e.jsx("button",{onClick:t,className:"flex-1 py-3 px-4 bg-[#F0EDE8] text-[#8B7355] rounded-lg font-medium text-sm hover:bg-[#E8E3DD] transition-colors",children:f}),e.jsx("button",{onClick:d,className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-colors ${r==="success"?"bg-green-600 text-white hover:bg-green-700":r==="alert"?"bg-red-600 text-white hover:bg-red-700":"bg-[#D2691E] text-white hover:bg-[#B8541A]"}`,children:r==="confirm"?o:"OK"})]})]})})})},he=()=>{const[i,t]=B.useState(!1),[m,n]=B.useState({title:"",message:""}),[s,r]=B.useState(null);return{isOpen:i,config:m,onConfirm:s,close:()=>{t(!1),r(null)},showConfirm:(d,a,c,x)=>{n({title:d,message:a,type:"confirm",confirmText:x==null?void 0:x.confirmText,cancelText:x==null?void 0:x.cancelText}),r(()=>c),t(!0)},showAlert:(d,a,c="info")=>{n({title:d,message:a,type:c}),r(null),t(!0)}}},Ps=()=>{const i=K(),[t]=Qe(),m=ft(),{books:n,setActiveBook:s,sessions:r,notes:o}=te(),{updatePetFromBookCompletion:f}=ae(),[l,d]=B.useState(!1),[a,c]=B.useState(null),[x,y]=B.useState(!1),[u,w]=B.useState(!1),[b,S]=B.useState(!1),h=he(),g=t.get("book");if(B.useEffect(()=>{var _;if((_=m.state)!=null&&_.bookData)c(m.state.bookData);else{const O=n.find(G=>G.key===g);if(O)c(O);else{i("/");return}}},[g,n,m.state,i]),B.useEffect(()=>{if(a){const O=JSON.parse(localStorage.getItem("bookish_books")||"[]").some(R=>R.key===a.key);y(O);const G=rt(a.key);if(G&&G.description&&!a.description){c(R=>({...R,description:G.description,number_of_pages_median:G.number_of_pages_median||R.number_of_pages_median}));return}a.description||(d(!0),ts(a.key).then(R=>{if(R){const z={...a,description:R.description,number_of_pages_median:R.number_of_pages_median||a.number_of_pages_median};c(z),Ke(z)}}).catch(R=>{console.error("Error fetching book details:",R),G&&c(z=>({...z,...G}))}).finally(()=>{d(!1)}))}},[a]),!a)return e.jsx("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#8B7355] mb-4",children:"Book not found"}),e.jsx("button",{onClick:()=>i("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Back to Search"})]})});const j=_=>{const O=JSON.parse(localStorage.getItem("bookish_books")||"[]");if(!O.some(G=>G.key===a.key)){const G={...a,category:_,dateAdded:new Date().toISOString()};O.push(G),localStorage.setItem("bookish_books",JSON.stringify(O)),Ke(G);const R=JSON.parse(localStorage.getItem("myBooks")||"[]");R.some(z=>z.key===a.key)||(R.push(G),localStorage.setItem("myBooks",JSON.stringify(R))),y(!0),w(!1),_==="currently-reading"&&(s(a),i("/reading"))}},p=()=>{h.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",()=>{var z;const O=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(X=>X.key===a.key?{...X,category:"completed",completedAt:new Date().toISOString()}:X);localStorage.setItem("bookish_books",JSON.stringify(O));const R=JSON.parse(localStorage.getItem("myBooks")||"[]").map(X=>X.key===a.key?{...X,category:"completed",completedAt:new Date().toISOString()}:X);localStorage.setItem("myBooks",JSON.stringify(R)),f(),a.key===((z=JSON.parse(localStorage.getItem("bookish_current_book")||"null"))==null?void 0:z.key)&&s(null),h.showAlert("Congratulations!","🎉 You've completed the book and your pet gained experience!","success"),setTimeout(()=>{i("/library")},1500)},{confirmText:"Mark Complete",cancelText:"Cancel"})},k=a.number_of_pages_median||0,v=[...r].filter(_=>_.bookId===a.key).sort((_,O)=>new Date(O.startTime).getTime()-new Date(_.startTime).getTime())[0],N=(v==null?void 0:v.endPage)||(v==null?void 0:v.startPage)||1,A=k>0?Math.min(Math.round(N/k*100),100):0,D=r.filter(_=>_.bookId===a.key).reduce((_,O)=>_+(O.duration||0),0),E=Math.floor(D/60),T=D%60,P=E>0?`${E} hr${E!==1?"s":""} ${T>0?`${T} min`:""}`:`${T} min`,I=o.filter(_=>_.bookId===a.key),L=JSON.parse(localStorage.getItem("bookish_books")||"[]").find(_=>_.key===a.key),C=(L==null?void 0:L.category)==="completed",F=()=>{i(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("div",{className:"p-4 bg-[#F7F5F3]",children:e.jsx("button",{onClick:F,className:"w-8 h-8 flex items-center justify-center bg-[#F0EDE8] rounded-full hover:bg-[#E8E3DD] transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-32 rounded-lg overflow-hidden shadow-lg flex-shrink-0",children:a.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${a.cover_i}-M.jpg`,alt:a.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-[#8B7355] flex items-center justify-center",children:e.jsx(Y,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A] mb-2 leading-tight",children:a.title}),a.author_name&&a.author_name.length>0&&e.jsxs("p",{className:"text-sm text-[#8B7355] mb-3",children:["by ",a.author_name[0]]}),e.jsxs("div",{className:"space-y-1",children:[a.first_publish_year&&e.jsxs("p",{className:"text-xs text-[#8B7355]",children:["First published: ",a.first_publish_year]}),k>0&&e.jsxs("p",{className:"text-xs text-[#8B7355]",children:[k," pages"]})]})]})]}),x&&k>0&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Progress"}),e.jsxs("span",{className:"text-xs font-medium text-[#3A3A3A]",children:[A,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-[#F0EDE8] rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-[#E59554] rounded-full transition-all duration-300 ease-out",style:{width:`${A}%`}})}),e.jsxs("span",{className:"text-xs text-[#8B7355]",children:["Page ",N," of ",k]})]}),e.jsx("div",{className:"w-px bg-[#F0EDE8]"}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-24",children:[e.jsx(et,{className:"w-5 h-5 text-[#8B7355] mb-1"}),e.jsx("span",{className:"text-sm font-medium text-[#3A3A3A]",children:P}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Total Time"})]})]}),l?e.jsx("div",{className:"h-32 bg-[#F0EDE8] animate-pulse rounded-lg mb-6"}):a.description?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"About this book"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:`text-sm text-[#3A3A3A] leading-relaxed ${b?"":"line-clamp-4"}`,children:typeof a.description=="string"?a.description:"No description available."}),a.description&&a.description.length>200&&e.jsx("button",{onClick:()=>S(!b),className:"mt-2 flex items-center gap-1 text-sm font-medium text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:b?e.jsxs(e.Fragment,{children:["Show less",e.jsx(Ft,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Read more",e.jsx(It,{className:"w-4 h-4"})]})})]})]}):null,x&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"My Notes"}),e.jsx("button",{onClick:()=>i("/notes"),className:"text-xs font-medium text-[#D2691E]",children:"View All"})]}),I.length>0?e.jsx("div",{className:"space-y-2",children:I.slice(0,2).map(_=>e.jsxs("div",{className:"p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs text-[#8B7355]",children:[_.chapter?`Chapter: ${_.chapter}`:"",_.chapter&&_.page?" • ":"",_.page?`Page ${_.page}`:""]}),e.jsx("span",{className:"text-xs text-[#8B7355]",children:new Date(_.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-[#3A3A3A] line-clamp-2",children:_.content})]},_.id))}):e.jsx("div",{className:"p-4 bg-white rounded-lg shadow-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"w-6 h-6 text-[#8B7355] mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-1",children:"No notes yet"}),e.jsx("button",{onClick:()=>i("/notes/add"),className:"text-xs font-medium text-[#D2691E]",children:"Add Your First Note"})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-[#F0EDE8] flex gap-4 max-w-md mx-auto",children:x?e.jsx(e.Fragment,{children:C?e.jsxs("div",{className:"flex-1 py-3 px-4 bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i("/notes/add"),className:"flex-1 py-3 px-4 bg-white border border-[#D2691E] text-[#D2691E] rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Add Note"]}),e.jsxs("button",{onClick:()=>{s(a),i("/reading")},className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5"}),"Start Reading"]}),e.jsx("button",{onClick:p,className:"py-3 px-3 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center",title:"Mark as Completed",children:e.jsx(ce,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i("/library"),className:"flex-1 py-3 px-4 bg-white border border-[#8B7355] text-[#8B7355] rounded-lg font-medium text-sm",children:"View Library"}),e.jsxs("button",{onClick:()=>w(!0),className:"flex-1 py-3 px-4 bg-[#8B7355] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),"Add to Library"]})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4",children:"Add to Library"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-6",children:"Choose where to add this book:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("want-to-read"),className:"w-full p-4 bg-[#F0EDE8] rounded-lg text-left hover:bg-[#E8E3DD] transition-colors",children:[e.jsx("div",{className:"font-medium text-[#3A3A3A] mb-1",children:"Want to Read"}),e.jsx("div",{className:"text-xs text-[#8B7355]",children:"Save for later reading"})]}),e.jsxs("button",{onClick:()=>j("currently-reading"),className:"w-full p-4 bg-[#8B7355] text-white rounded-lg text-left hover:bg-[#7A6349] transition-colors",children:[e.jsx("div",{className:"font-medium mb-1",children:"Start Reading Now"}),e.jsx("div",{className:"text-xs opacity-90",children:"Add to library and begin reading session"})]})]}),e.jsx("button",{onClick:()=>w(!1),className:"w-full mt-4 py-2 text-sm text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:"Cancel"})]})}),e.jsx(me,{isOpen:h.isOpen,onClose:h.close,onConfirm:h.onConfirm||void 0,title:h.config.title,message:h.config.message,type:h.config.type,confirmText:h.config.confirmText,cancelText:h.config.cancelText})]})},J=[];for(let i=0;i<256;++i)J.push((i+256).toString(16).slice(1));function Fs(i,t=0){return(J[i[t+0]]+J[i[t+1]]+J[i[t+2]]+J[i[t+3]]+"-"+J[i[t+4]]+J[i[t+5]]+"-"+J[i[t+6]]+J[i[t+7]]+"-"+J[i[t+8]]+J[i[t+9]]+"-"+J[i[t+10]]+J[i[t+11]]+J[i[t+12]]+J[i[t+13]]+J[i[t+14]]+J[i[t+15]]).toLowerCase()}let Ne;const Is=new Uint8Array(16);function Os(){if(!Ne){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ne=crypto.getRandomValues.bind(crypto)}return Ne(Is)}const Rs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ve={randomUUID:Rs};function de(i,t,m){var s;if(Ve.randomUUID&&!i)return Ve.randomUUID();i=i||{};const n=i.random??((s=i.rng)==null?void 0:s.call(i))??Os();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Fs(n)}const se="bookish_active_timer",Us=({bookId:i,startPage:t})=>{const[m,n]=B.useState({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),s=B.useRef();B.useEffect(()=>{const c=localStorage.getItem(se);if(c)try{const x=JSON.parse(c);x.bookId===i?n(x.timerState):localStorage.removeItem(se)}catch(x){console.error("Error loading timer state:",x),localStorage.removeItem(se)}},[i]),B.useEffect(()=>{m.sessionId&&localStorage.setItem(se,JSON.stringify({bookId:i,startPage:t,timerState:m}))},[m,i,t]),B.useEffect(()=>(m.isActive?s.current=setInterval(()=>{n(c=>({...c}))},1e3):s.current&&clearInterval(s.current),()=>{s.current&&clearInterval(s.current)}),[m.isActive]);const r=()=>{if(!m.startTime)return 0;let c=m.totalElapsed;if(m.isActive&&m.lastPauseTime===null){const x=Date.now(),y=new Date(m.startTime).getTime();c+=Math.floor((x-y)/1e3)}return c},o=r(),f=()=>{const c=new Date().toISOString();m.sessionId?n(x=>({...x,startTime:c,lastPauseTime:null,isActive:!0})):n({sessionId:de(),startTime:c,totalElapsed:0,lastPauseTime:null,isActive:!0})},l=()=>{if(!m.isActive||!m.startTime)return;const c=Date.now(),x=new Date(m.startTime).getTime(),y=Math.floor((c-x)/1e3);n(u=>({...u,totalElapsed:u.totalElapsed+y,lastPauseTime:new Date().toISOString(),isActive:!1}))},d=c=>{const x=r(),y={id:m.sessionId||de(),bookId:i,startTime:m.startTime||new Date().toISOString(),endTime:new Date().toISOString(),startPage:t,endPage:c,duration:Math.floor(x/60)};return n({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(se),y},a=()=>{n({sessionId:null,startTime:null,totalElapsed:0,lastPauseTime:null,isActive:!1}),localStorage.removeItem(se)};return{isActive:m.isActive,elapsedTime:o,startTimer:f,pauseTimer:l,stopTimer:d,resetTimer:a}},Gs=()=>{const i=K(),{currentBook:t,addSession:m,addNote:n}=te(),{updatePetFromReading:s}=ae(),r=he(),[o,f]=B.useState(1),[l,d]=B.useState(1),[a,c]=B.useState(!1),[x,y]=B.useState(""),[u,w]=B.useState(""),[b,S]=B.useState(!1),[h,g]=B.useState(!1),{isActive:j,elapsedTime:p,startTimer:k,pauseTimer:v,stopTimer:N,resetTimer:A}=Us({bookId:(t==null?void 0:t.key)||"",startPage:1});if(B.useEffect(()=>{if(t&&!h){const C=localStorage.getItem("bookish_active_timer");if(C)try{const O=JSON.parse(C);if(O.bookId===t.key){f(O.startPage),d(O.startPage),g(!0);return}}catch(O){console.error("Error parsing active timer:",O)}const _=JSON.parse(localStorage.getItem("bookish_reading_sessions")||"[]").filter(O=>O.bookId===t.key);if(_.length>0){_.sort((G,R)=>new Date(R.startTime).getTime()-new Date(G.startTime).getTime());const O=_[0].endPage||_[0].startPage;f(O),d(O)}g(!0)}},[t,h]),B.useEffect(()=>{const C=F=>{j&&(F.preventDefault(),F.returnValue="You have an active reading session. Are you sure you want to leave?")};return window.addEventListener("beforeunload",C),()=>window.removeEventListener("beforeunload",C)},[j]),!t)return i("/"),null;const D=()=>{try{if(!t){r.showAlert("Error","No book selected","alert");return}if(l<o){r.showAlert("Invalid Page Range","End page cannot be less than start page","alert");return}if(p<=0){r.showAlert("No Time Recorded","Please start the timer to record reading time","alert");return}const C=N(l);if(!C)throw new Error("Failed to create session");if(m(C),C.duration&&s(C.duration),x.trim()){const F={id:de(),bookId:t.key,page:l,chapter:u.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n(F)}i("/")}catch(C){console.error("Error finishing session:",C),r.showAlert("Error","Failed to save reading session. Please try again.","alert")}},E=C=>{const F=Math.floor(C/3600),_=Math.floor(C%3600/60),O=C%60;return F>0?`${F}:${_.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`:`${_.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`},T=t.number_of_pages_median||9999,P=t.number_of_pages_median&&t.number_of_pages_median>0,I=()=>{const C=(t==null?void 0:t.number_of_pages_median)||0;return C>0&&l>=C},U=C=>{const F=Math.max(o,Math.min(C,T));d(F),t!=null&&t.number_of_pages_median&&F>=t.number_of_pages_median&&S(!0)},L=()=>{try{const C=N(l);if(C&&(m(C),C.duration&&s(C.duration)),x.trim()){const R={id:de(),bookId:t.key,page:l,chapter:u.trim()||void 0,content:x.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n(R)}const _=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(R=>R.key===t.key?{...R,category:"completed",completedAt:new Date().toISOString()}:R);localStorage.setItem("bookish_books",JSON.stringify(_));const G=JSON.parse(localStorage.getItem("myBooks")||"[]").map(R=>R.key===t.key?{...R,category:"completed",completedAt:new Date().toISOString()}:R);localStorage.setItem("myBooks",JSON.stringify(G)),localStorage.removeItem("bookish_current_book"),s((C==null?void 0:C.duration)||0,!0),r.showAlert("Congratulations!","🎉 You've completed the book and your pet gained bonus experience!","success"),setTimeout(()=>{i("/library")},2e3)}catch(C){console.error("Error marking book as finished:",C),r.showAlert("Error","Failed to mark book as completed. Please try again.","alert")}};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3] pb-20",children:[e.jsxs("header",{className:"p-4 bg-[#F0EDE8] flex items-center gap-3 shadow-sm",children:[e.jsx("button",{onClick:()=>{j||p>0?r.showConfirm("Leave Reading Session",j?"Your timer is still running. The session will continue in the background if you leave.":"You have an unsaved reading session. Do you want to save it or discard it?",()=>{!j&&p>0?D():i(-1)},{confirmText:j?"Leave (Keep Timer)":"Save & Leave",cancelText:"Stay"}):i(-1)},className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#F7F5F3] transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-lg font-medium text-[#3A3A3A]",children:"Reading Session"}),j&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"})})]}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden mb-6",children:[e.jsxs("div",{className:"flex items-center p-4 border-b border-[#F0EDE8]",children:[e.jsx("div",{className:"w-12 h-16 rounded overflow-hidden mr-3",children:t.cover_i?e.jsx("img",{src:ns(t.cover_i,"S"),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-[#8B7355]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-serif text-base font-medium text-[#3A3A3A] line-clamp-1",children:t.title}),t.author_name&&t.author_name.length>0&&e.jsxs("p",{className:"text-sm text-[#8B7355]",children:["by ",t.author_name[0]]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-[#F7F5F3] flex items-center justify-center shadow-inner",children:e.jsx("span",{className:"font-serif text-2xl font-medium text-[#3A3A3A]",children:E(p)})})}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("button",{onClick:j?v:k,className:"w-16 h-16 rounded-full bg-[#D2691E] text-white flex items-center justify-center shadow-md hover:bg-[#A0522D] transition-colors",children:j?e.jsx(Rt,{className:"w-8 h-8"}):e.jsx(Ut,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-[#8B7355] mb-2",children:"Start Page"}),e.jsx("input",{type:"number",value:o,onChange:C=>{const F=Math.max(1,Math.min(parseInt(C.target.value)||1,T));f(F),l<F&&d(F)},min:"1",max:T,className:"w-full p-2 border border-[#E5E5E5] rounded-md text-[#3A3A3A]",disabled:j||p>0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-[#8B7355] mb-2",children:"End Page"}),e.jsx("input",{type:"number",value:l,onChange:C=>U(parseInt(C.target.value)||o),min:o,max:T,className:"w-full p-2 border border-[#E5E5E5] rounded-md text-[#3A3A3A]"})]})]}),I()&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Congratulations!"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"You've reached the last page! Would you like to mark this book as completed?"}),e.jsx("button",{onClick:L,className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Mark as Finished"})]}),!P&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700",children:"📘 Page count unavailable for this book. You can still track your reading progress by entering the pages you read."})}),e.jsx("button",{onClick:()=>c(!a),className:"w-full py-2 text-sm text-[#D2691E] mb-2",children:a?"Hide Note Form":"+ Add a note about this session"}),a&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 bg-[#F7F5F3] rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8B7355] mb-2",children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:u,onChange:C=>w(C.target.value),placeholder:"e.g. Chapter 5",className:"w-full p-2 border border-[#E5E5E5] rounded-md text-[#3A3A3A]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8B7355] mb-2",children:"Note"}),e.jsx("textarea",{value:x,onChange:C=>y(C.target.value),placeholder:"Write your thoughts about this reading session...",rows:4,className:"w-full p-2 border border-[#E5E5E5] rounded-md text-[#3A3A3A] resize-none"})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-[#F0EDE8] flex gap-4 max-w-md mx-auto",children:[e.jsxs("button",{onClick:()=>{r.showConfirm("Cancel Session",j?"This will stop your timer and discard the session. Are you sure?":"Are you sure you want to cancel this session? All progress will be lost.",()=>{A(),i(-1)},{confirmText:"Yes, Cancel",cancelText:"Keep Reading"})},className:"flex-1 py-3 px-4 bg-white border border-[#E5E5E5] text-[#8B7355] rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"Cancel"]}),I()?e.jsxs("button",{onClick:L,className:"flex-1 py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Mark as Finished"]}):e.jsxs("button",{onClick:D,className:"flex-1 py-3 px-4 bg-[#D2691E] text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:p<=0||l<o,children:[e.jsx(ce,{className:"w-5 h-5"}),"Finish Session"]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"Congratulations!"}),e.jsxs("p",{className:"text-sm text-[#8B7355] mb-6",children:[`You've reached the last page of "`,t.title,'". Would you like to mark it as completed?']}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:L,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors",children:"Yes, Mark as Completed"}),e.jsx("button",{onClick:()=>S(!1),className:"w-full py-2 px-4 bg-white border border-[#E5E5E5] text-[#8B7355] rounded-lg font-medium text-sm hover:bg-[#F7F5F3] transition-colors",children:"Continue Reading"})]})]})})}),e.jsx(me,{isOpen:r.isOpen,onClose:r.close,onConfirm:r.onConfirm||void 0,title:r.config.title,message:r.config.message,type:r.config.type,confirmText:r.config.confirmText,cancelText:r.config.cancelText})]})},Ms=()=>{const i=K(),{books:t}=te(),{updatePetFromBookCompletion:m}=ae(),n=he(),[s,r]=B.useState(null),[o,f]=B.useState(null),[l,d]=B.useState({}),[a,c]=B.useState([]);B.useEffect(()=>{(()=>{const A=JSON.parse(localStorage.getItem("bookish_books")||"[]");c(A)})()},[]),B.useEffect(()=>{const N=()=>{r(null)};if(s)return document.addEventListener("click",N),()=>document.removeEventListener("click",N)},[s]);const x=a.length>0?a:t,y=N=>{i(`/book?book=${N.key}`,{state:{bookData:N}})},u=(N,A)=>{A.stopPropagation(),n.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const E=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(L=>L.key!==N);localStorage.setItem("bookish_books",JSON.stringify(E));const P=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(L=>L.key!==N);localStorage.setItem("myBooks",JSON.stringify(P));const I=JSON.parse(localStorage.getItem("bookish_cached_books")||"{}");delete I[N],localStorage.setItem("bookish_cached_books",JSON.stringify(I));const U=JSON.parse(localStorage.getItem("bookish_current_book")||"null");U&&U.key===N&&localStorage.removeItem("bookish_current_book"),c(E)},{confirmText:"Remove",cancelText:"Keep Book"}),r(null)},w=(N,A,D)=>{const T=JSON.parse(localStorage.getItem("bookish_books")||"[]").map(U=>U.key===N?{...U,category:A}:U);localStorage.setItem("bookish_books",JSON.stringify(T));const I=JSON.parse(localStorage.getItem("myBooks")||"[]").map(U=>U.key===N?{...U,category:A}:U);localStorage.setItem("myBooks",JSON.stringify(I)),c(T),f(null),r(null)},b=(N,A)=>{A.stopPropagation(),n.showConfirm("Mark as Completed","Mark this book as completed? This will give your pet a big experience boost!",()=>{w(N,"completed"),m(),setTimeout(()=>{n.showAlert("Book Completed!","🎉 Book marked as completed! Check your pet for an experience boost!","success")},100)},{confirmText:"Mark Complete",cancelText:"Cancel"}),r(null)},S=(N,A)=>{A.stopPropagation(),r(s===N?null:N)},h=N=>{const A=qe(N);if(A.length===0)return 0;const D=A[A.length-1],E=t.find(T=>T.key===N);return!(E!=null&&E.number_of_pages_median)||!D.endPage?0:Math.min(100,Math.round(D.endPage/E.number_of_pages_median*100))},g=N=>qe(N).reduce((D,E)=>D+(E.duration||0),0),j=N=>{const A=Math.floor(N/60),D=N%60;return A>0?`${A}h ${D}m`:`${D}m`},p=()=>{const N=[],A=[],D=[];return x.forEach(E=>{const T=h(E.key),P=g(E.key);E.category==="want-to-read"?D.push(E):E.category==="completed"||T>=100?A.push(E):E.category==="currently-reading"||T>0||P>0?N.push(E):D.push(E)}),{currentlyReading:N,completed:A,wantToRead:D}},k=N=>{const A=h(N.key),D=g(N.key),E=l[N.key]||{translateX:0,isDeleting:!1},T=C=>{const F=C.touches[0];d(_=>({..._,[N.key]:{...E,startX:F.clientX,startY:F.clientY}}))},P=C=>{const F=C.touches[0],_=l[N.key];if(!(_!=null&&_.startX)||!(_!=null&&_.startY))return;const O=F.clientX-_.startX,G=F.clientY-_.startY;Math.abs(G)>Math.abs(O)||O<-20&&d(R=>({...R,[N.key]:{..._,translateX:Math.max(O,-120)}}))},I=()=>{const C=l[N.key];C&&(C.translateX<-60?d(F=>({...F,[N.key]:{...C,translateX:-120,isDeleting:!0}})):d(F=>({...F,[N.key]:{...C,translateX:0,isDeleting:!1}})))},U=()=>{n.showConfirm("Remove Book","Are you sure you want to remove this book from your library?",()=>{const F=JSON.parse(localStorage.getItem("bookish_books")||"[]").filter(G=>G.key!==N.key);localStorage.setItem("bookish_books",JSON.stringify(F));const O=JSON.parse(localStorage.getItem("myBooks")||"[]").filter(G=>G.key!==N.key);localStorage.setItem("myBooks",JSON.stringify(O)),c(F),d(G=>{const R={...G};return delete R[N.key],R})},{confirmText:"Remove",cancelText:"Keep Book"})},L=()=>{d(C=>({...C,[N.key]:{translateX:0,isDeleting:!1}}))};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",style:{transform:`translateX(${E.translateX}px)`,transition:E.isDeleting||E.translateX===0?"transform 0.3s ease":"none",overflow:E.isDeleting?"hidden":"visible"},onTouchStart:T,onTouchMove:P,onTouchEnd:I,children:[e.jsxs("div",{className:"flex gap-3 p-4",onClick:()=>!E.isDeleting&&y(N),children:[e.jsxs("div",{className:"w-12 h-16 bg-[#F0EDE8] rounded flex-shrink-0 flex items-center justify-center",children:[N.cover_i?e.jsx("img",{src:`https://covers.openlibrary.org/b/id/${N.cover_i}-M.jpg`,alt:N.title,className:"w-full h-full object-cover rounded",onError:C=>{var _;const F=C.target;F.style.display="none",(_=F.nextElementSibling)==null||_.classList.remove("hidden")}}):null,e.jsx(Y,{className:`w-6 h-6 text-[#8B7355] ${N.cover_i?"hidden":""}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-medium text-[#3A3A3A] text-sm leading-tight mb-1 truncate",children:N.title}),N.author_name&&e.jsxs("p",{className:"text-xs text-[#8B7355] mb-2 truncate",children:["by ",N.author_name[0]]}),A>0&&A<100&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-[#8B7355]",children:"Progress"}),e.jsxs("span",{className:"text-xs text-[#8B7355]",children:[A,"%"]})]}),e.jsx("div",{className:"w-full bg-[#F0EDE8] rounded-full h-1.5",children:e.jsx("div",{className:"bg-[#8B7355] h-1.5 rounded-full transition-all duration-300",style:{width:`${A}%`}})})]}),A>=100&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mb-2",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),D>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-[#8B7355]",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{children:[j(D)," read"]})]})]})]}),!E.isDeleting&&e.jsx("button",{onClick:C=>S(N.key,C),className:"absolute top-3 right-3 w-6 h-6 rounded-full bg-[#F0EDE8] flex items-center justify-center hover:bg-[#E8E3DD] transition-colors",children:e.jsx(Gt,{className:"w-4 h-4 text-[#8B7355]"})}),"        ",s===N.key&&!E.isDeleting&&e.jsxs("div",{className:"absolute top-10 right-3 bg-white rounded-lg shadow-lg border border-[#E8E3DD] py-1 z-50 min-w-[180px]",children:[e.jsxs("button",{onClick:C=>{C.stopPropagation(),f(N.key),r(null)},className:"flex items-center gap-2 px-3 py-2 text-sm text-[#8B7355] hover:bg-[#F0EDE8] w-full text-left",children:[e.jsx(Mt,{className:"w-4 h-4"}),"Move to category"]}),N.category!=="completed"&&e.jsxs("button",{onClick:C=>b(N.key,C),className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 w-full text-left",children:[e.jsx(ce,{className:"w-4 h-4"}),"Mark as completed"]}),e.jsxs("button",{onClick:C=>u(N.key,C),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[e.jsx(st,{className:"w-4 h-4"}),"Remove from library"]})]}),E.isDeleting&&e.jsx("div",{className:"absolute inset-0 bg-red-500 flex items-center justify-end pr-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:L,className:"px-3 py-1 text-xs bg-white text-red-500 rounded",children:"Cancel"}),e.jsx("button",{onClick:U,className:"px-3 py-1 text-xs bg-red-700 text-white rounded",children:"Delete"})]})})]},N.key)},v=(N,A)=>A.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4 flex items-center gap-2",children:[N,e.jsxs("span",{className:"text-sm text-[#8B7355] font-normal",children:["(",A.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:A.map(k)})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("header",{className:"p-4 bg-[#F7F5F3] border-b border-[#E8E3DD]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i("/"),className:"w-8 h-8 rounded-full bg-[#F0EDE8] flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:"My Library"})]})}),"      ",e.jsx("main",{className:"p-4",children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-[#8B7355] mx-auto mb-4"}),e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"No books yet"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-6",children:"Start building your library by searching for books to read"}),e.jsx("button",{onClick:()=>i("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Find Books"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm text-[#8B7355]",children:[x.length," book",x.length!==1?"s":""," in your library"]})}),(()=>{const{currentlyReading:N,completed:A,wantToRead:D}=p();return e.jsxs(e.Fragment,{children:[v("Currently Reading",N),v("Want to Read",D),v("Completed",A)]})})()]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4",children:"Move Book"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-6",children:"Choose a new category:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>w(o,"want-to-read"),className:"w-full p-3 bg-[#F0EDE8] rounded-lg text-left hover:bg-[#E8E3DD] transition-colors",children:[e.jsx("div",{className:"font-medium text-[#3A3A3A]",children:"Want to Read"}),e.jsx("div",{className:"text-xs text-[#8B7355]",children:"Books you plan to read"})]}),e.jsxs("button",{onClick:()=>w(o,"currently-reading"),className:"w-full p-3 bg-[#E8E3DD] rounded-lg text-left hover:bg-[#DDD8CE] transition-colors",children:[e.jsx("div",{className:"font-medium text-[#3A3A3A]",children:"Currently Reading"}),e.jsx("div",{className:"text-xs text-[#8B7355]",children:"Books you're actively reading"})]}),e.jsxs("button",{onClick:()=>w(o,"completed"),className:"w-full p-3 bg-green-50 rounded-lg text-left hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"font-medium text-[#3A3A3A]",children:"Completed"}),e.jsx("div",{className:"text-xs text-green-600",children:"Books you've finished"})]})]}),e.jsx("button",{onClick:()=>f(null),className:"w-full mt-4 py-2 text-sm text-[#8B7355] hover:text-[#3A3A3A] transition-colors",children:"Cancel"}),"          "]})}),e.jsx(me,{isOpen:n.isOpen,onClose:n.close,onConfirm:n.onConfirm||void 0,title:n.config.title,message:n.config.message,type:n.config.type,confirmText:n.config.confirmText,cancelText:n.config.cancelText})]})},Ls=()=>{const i=K(),{books:t}=te(),{pet:m}=ae(),n=nt(),s=at(),r=Te(),o=c=>{const x=Math.floor(c/60),y=c%60;return x>0?`${x}h ${y}m`:`${y}m`},f=()=>{if(r.length===0)return 0;const c=r.reduce((x,y)=>x+(y.duration||0),0);return Math.round(c/r.length)},d=(()=>{const c=new Date,x=new Date(c.getFullYear(),c.getMonth(),1),y=r.filter(b=>new Date(b.startTime)>=x),u=y.reduce((b,S)=>b+(S.duration||0),0),w=y.reduce((b,S)=>b+((S.endPage||0)-(S.startPage||0)),0);return{time:u,pages:w,sessions:y.length}})(),a=({icon:c,title:x,value:y,subtitle:u})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-[#F0EDE8] rounded-lg flex items-center justify-center",children:e.jsx(c,{className:"w-4 h-4 text-[#8B7355]"})}),e.jsx("span",{className:"text-sm text-[#8B7355] font-medium",children:x})]}),e.jsx("p",{className:"text-2xl font-serif font-medium text-[#3A3A3A] mb-1",children:y}),u&&e.jsx("p",{className:"text-xs text-[#8B7355]",children:u})]});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("header",{className:"p-4 bg-[#F7F5F3] border-b border-[#E8E3DD]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i("/"),className:"w-8 h-8 rounded-full bg-[#F0EDE8] flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:"Reading Statistics"})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(a,{icon:Y,title:"Books Read",value:n.totalBooksRead.toString(),subtitle:"this year"}),e.jsx(a,{icon:ne,title:"Total Time",value:o(n.totalReadingTime),subtitle:"all time"}),e.jsx(a,{icon:ke,title:"Pages Read",value:n.totalPagesRead.toString(),subtitle:"all time"}),e.jsx(a,{icon:Re,title:"Current Streak",value:`${s.currentStreak} days`,subtitle:`longest: ${s.longestStreak} days`})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"This Month"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-[#8B7355]"}),e.jsx("span",{className:"font-medium text-[#3A3A3A]",children:"Monthly Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:d.sessions}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"sessions"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:o(d.time)}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"reading time"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:d.pages}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"pages"})]})]})]})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Recent Activity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(a,{icon:ne,title:"Today",value:o(n.readingTimeToday)}),e.jsx(a,{icon:Ae,title:"This Week",value:o(n.readingTimeThisWeek)}),e.jsx(a,{icon:ke,title:"Average Session",value:o(f())}),e.jsx(a,{icon:Y,title:"Books in Library",value:t.length.toString()})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-3",children:"Reading Companion"}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Lt,{className:"w-5 h-5 text-[#8B7355]"}),e.jsxs("span",{className:"font-medium text-[#3A3A3A]",children:[m.name,"'s Progress"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:m.level}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"level"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:[m.happiness,"%"]}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"happiness"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-serif font-medium text-[#3A3A3A]",children:m.experience}),e.jsx("p",{className:"text-xs text-[#8B7355]",children:"experience"})]})]})]})]}),r.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Re,{className:"w-16 h-16 text-[#8B7355] mx-auto mb-4"}),e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"Start tracking your reading"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-6",children:"Begin a reading session to see your statistics here"}),e.jsx("button",{onClick:()=>i("/search"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Find a Book to Read"})]})]})]})},Js=()=>{const i=K(),{notes:t,books:m,deleteNote:n}=te(),s=he(),r=l=>{s.showConfirm("Delete Note","Are you sure you want to delete this note? This action cannot be undone.",()=>{n(l)},{confirmText:"Delete",cancelText:"Cancel"})},o=l=>{const d=m.find(a=>a.key===l);return d?d.title:"Unknown Book"},f=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("header",{className:"p-4 bg-[#F7F5F3] border-b border-[#E8E3DD]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i(-1),className:"w-8 h-8 rounded-full bg-[#F0EDE8] flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:"My Notes"})]}),e.jsx("button",{onClick:()=>i("/notes/add"),className:"w-8 h-8 rounded-full bg-[#8B7355] flex items-center justify-center",children:e.jsx(tt,{className:"w-5 h-5 text-white"})})]})}),e.jsx("main",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-16 h-16 text-[#8B7355] mx-auto mb-4"}),e.jsx("h2",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"No notes yet"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-6",children:"Start taking notes while reading to remember important thoughts and insights"}),e.jsx("button",{onClick:()=>i("/notes/add"),className:"bg-[#8B7355] text-white px-6 py-3 rounded-xl font-medium",children:"Add Your First Note"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm text-[#8B7355]",children:[t.length," note",t.length!==1?"s":""]})}),"            ",t.map(l=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Y,{className:"w-4 h-4 text-[#8B7355]"}),e.jsx("span",{className:"text-sm font-medium text-[#3A3A3A] truncate",children:o(l.bookId)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-[#8B7355]",children:[l.chapter&&e.jsxs("span",{children:["Chapter: ",l.chapter]}),l.page&&e.jsxs("span",{children:["Page ",l.page]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),e.jsx("span",{children:f(l.createdAt)})]})]})]}),e.jsx("button",{onClick:()=>r(l.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(st,{className:"w-4 h-4"})})]}),"                ",e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-[#3A3A3A] leading-relaxed whitespace-pre-wrap",children:l.content})})]},l.id))]})}),e.jsx(me,{isOpen:s.isOpen,onClose:s.close,onConfirm:s.onConfirm||void 0,title:s.config.title,message:s.config.message,type:s.config.type,confirmText:s.config.confirmText,cancelText:s.config.cancelText})]})},$s=()=>{const i=K(),[t]=Qe(),{books:m,currentBook:n,addNote:s,notes:r,updateNote:o}=te(),f=he(),l=t.get("edit"),[d,a]=B.useState((n==null?void 0:n.key)||""),[c,x]=B.useState(""),[y,u]=B.useState(""),[w,b]=B.useState("");B.useEffect(()=>{var g;if(l){const j=r.find(p=>p.id===l);j&&(a(j.bookId),x(j.content),u(((g=j.page)==null?void 0:g.toString())||""),b(j.chapter||""))}},[l,r]);const S=()=>{var j;if(!c.trim()){f.showAlert("Content Required","Please add some content to your note before saving.","alert");return}const g={id:l||de(),bookId:d,content:c.trim(),page:y?parseInt(y):void 0,chapter:w.trim()||void 0,createdAt:l?((j=r.find(p=>p.id===l))==null?void 0:j.createdAt)||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};l&&o?o(g):s(g),f.showAlert("Note Saved","Your note has been saved successfully!","success"),setTimeout(()=>{i("/notes")},1500)},h=()=>{c.trim()||w.trim()||y.trim()?f.showConfirm("Discard Note","You have unsaved changes. Are you sure you want to go back?",()=>{i(-1)},{confirmText:"Discard",cancelText:"Keep Editing"}):i(-1)};return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("header",{className:"p-4 bg-[#F7F5F3] border-b border-[#E8E3DD]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:h,className:"w-8 h-8 rounded-full bg-[#F0EDE8] flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:l?"Edit Note":"Add Note"})]}),e.jsxs("button",{onClick:S,className:"flex items-center gap-2 bg-[#8B7355] text-white px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(Jt,{className:"w-4 h-4"}),"Save"]})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Select Book"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:g=>a(g.target.value),className:"w-full p-3 pr-10 bg-white border border-[#E8E3DD] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] text-[#3A3A3A] appearance-none",children:[e.jsx("option",{value:"",children:"Choose a book..."}),m.map(g=>e.jsx("option",{value:g.key,children:g.title},g.key))]}),e.jsx(Y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-[#8B7355] pointer-events-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Chapter (optional)"}),e.jsx("input",{type:"text",value:w,onChange:g=>b(g.target.value),placeholder:"e.g., Chapter 5",className:"w-full p-3 bg-white border border-[#E8E3DD] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] text-[#3A3A3A]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Page (optional)"}),e.jsx("input",{type:"number",value:y,onChange:g=>u(g.target.value),placeholder:"Page number",className:"w-full p-3 bg-white border border-[#E8E3DD] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] text-[#3A3A3A]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#3A3A3A] mb-2",children:"Your Note"}),e.jsx("textarea",{value:c,onChange:g=>x(g.target.value),placeholder:"Write your thoughts, insights, or reflections about this part of the book...",rows:8,className:"w-full p-3 bg-white border border-[#E8E3DD] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#8B7355] text-[#3A3A3A] resize-none"}),e.jsxs("p",{className:"text-xs text-[#8B7355] mt-2",children:[c.length,"/500 characters"]})]}),e.jsxs("div",{className:"bg-[#F0EDE8] rounded-xl p-4",children:[e.jsx("h3",{className:"font-medium text-[#3A3A3A] mb-2",children:"💡 Note-taking tips:"}),e.jsxs("ul",{className:"text-sm text-[#8B7355] space-y-1",children:[e.jsx("li",{children:"• Write down key insights or quotes that resonate with you"}),e.jsx("li",{children:"• Note questions or thoughts the reading sparked"}),e.jsx("li",{children:"• Record connections to other books or personal experiences"}),e.jsx("li",{children:"• Include your emotional reactions or reflections"})]})]})]}),e.jsx(me,{isOpen:f.isOpen,onClose:f.close,onConfirm:f.onConfirm||void 0,title:f.config.title,message:f.config.message,type:f.config.type,confirmText:f.config.confirmText,cancelText:f.config.cancelText})]})},Hs=()=>{const i=K(),{pet:t,petStats:m,feedPet:n,playWithPet:s,petSleep:r,getPetMood:o,getPetEvolutionRequirement:f,resetPet:l,updatePetName:d,getPetEmoji:a,canEvolve:c,evolvePet:x}=ae(),[y,u]=B.useState(!1),[w,b]=B.useState(t.name),[S,h]=B.useState(!1),g=E=>E>70?"bg-green-500":E>40?"bg-yellow-500":"bg-red-500",j=E=>`${Math.max(0,Math.min(100,E))}%`,p=()=>{w.trim()&&(d(w.trim()),u(!1))},k=()=>{l(),h(!1)},v=E=>({"first-book":"📖","book-lover":"📚",bookworm:"🐛","speed-reader":"⚡","night-owl":"🦉","early-bird":"🐦"})[E]||"🏆",N=E=>({"first-book":"Read your first book","book-lover":"Read 10 books",bookworm:"Read 50 books","speed-reader":"Read for 100+ minutes in a day","night-owl":"Read after midnight","early-bird":"Read before 6 AM"})[E]||"Special achievement",A=E=>{const T=Math.floor(E/60),P=E%60;return T>0?`${T}h ${P}m`:`${P}m`},D=f();return e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-[#F7F5F3]",children:[e.jsx("header",{className:"p-4 bg-[#F7F5F3] border-b border-[#E8E3DD]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i(-1),className:"w-8 h-8 rounded-full bg-[#F0EDE8] flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-[#8B7355]"})}),e.jsx("h1",{className:"font-serif text-xl font-medium text-[#3A3A3A]",children:"My Reading Pet"})]})}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 text-center",children:[e.jsx("div",{className:"text-8xl mb-4",children:a()}),e.jsxs("div",{className:"mb-4",children:[y?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("input",{type:"text",value:w,onChange:E=>b(E.target.value),className:"text-2xl font-serif font-medium bg-[#F0EDE8] rounded px-3 py-1 border text-center",onBlur:p,onKeyPress:E=>E.key==="Enter"&&p(),autoFocus:!0})}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-serif font-medium text-[#3A3A3A]",children:t.name}),e.jsx("button",{onClick:()=>u(!0),className:"p-1 text-[#8B7355] hover:bg-[#F0EDE8] rounded",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg text-[#8B7355] mb-2",children:[e.jsxs("span",{children:["Level ",t.level]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:t.evolutionStage})]}),c()&&e.jsxs("button",{onClick:x,className:"bg-gradient-to-r from-[#D2691E] to-[#FF8C00] text-white px-6 py-2 rounded-full font-medium mb-2",children:["✨ Evolve to ",D.stage,"!"]})]}),e.jsx("p",{className:"text-[#3A3A3A] mb-4",children:o()}),e.jsx("div",{className:"mb-4 p-3 bg-[#F0EDE8] rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[#D2691E] mb-1",children:["💰 ",t.points]}),e.jsx("p",{className:"text-sm text-[#8B7355]",children:"Care Points (Earned from reading)"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-[#8B7355] mb-2",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[t.experience,"/",t.experienceToNext]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#D2691E] to-[#FF8C00] rounded-full transition-all duration-300",style:{width:`${t.experience/t.experienceToNext*100}%`}})})]}),"          ",e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:n,disabled:t.points<3,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${t.points>=3?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ue,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Feed"}),e.jsx("span",{className:"text-xs",children:"💰 3 pts"})]}),e.jsxs("button",{onClick:s,disabled:t.points<5,className:`py-3 px-4 rounded-xl font-medium transition-colors flex flex-col items-center gap-1 ${t.points>=5?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Se,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Play"}),e.jsx("span",{className:"text-xs",children:"💰 5 pts"})]}),e.jsxs("button",{onClick:r,className:"py-3 px-4 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors flex flex-col items-center gap-1",children:[e.jsx(Ge,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Sleep"}),e.jsx("span",{className:"text-xs",children:"Free"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4",children:"Pet Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Happiness"})]}),e.jsxs("span",{children:[t.happiness,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${g(t.happiness)} rounded-full transition-all duration-300`,style:{width:j(t.happiness)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Hunger"})]}),e.jsxs("span",{children:[t.hunger,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${g(t.hunger)} rounded-full transition-all duration-300`,style:{width:j(t.hunger)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Energy"})]}),e.jsxs("span",{children:[t.energy,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${g(t.energy)} rounded-full transition-all duration-300`,style:{width:j(t.energy)}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Health"})]}),e.jsxs("span",{children:[t.health,"/100"]})]}),e.jsx("div",{className:"h-3 bg-[#F0EDE8] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${g(t.health)} rounded-full transition-all duration-300`,style:{width:j(t.health)}})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4",children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#D2691E]",children:t.totalBooksRead}),e.jsx("div",{className:"text-sm text-[#8B7355]",children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#D2691E]",children:A(t.totalReadingTime)}),e.jsx("div",{className:"text-sm text-[#8B7355]",children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#D2691E]",children:m.booksReadToday}),e.jsx("div",{className:"text-sm text-[#8B7355]",children:"Today's Books"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#D2691E]",children:A(m.readingTimeToday)}),e.jsx("div",{className:"text-sm text-[#8B7355]",children:"Today's Time"})]})]})]}),t.badges.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-4",children:"Achievements"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:t.badges.map((E,T)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[#F0EDE8] rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:v(E)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-[#3A3A3A] capitalize text-sm",children:E.replace("-"," ")}),e.jsx("div",{className:"text-xs text-[#8B7355]",children:N(E)})]})]},T))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsx("h3",{className:"font-serif text-lg font-medium text-[#3A3A3A] mb-2",children:"Pet Management"}),e.jsx("p",{className:"text-sm text-[#8B7355] mb-4",children:"Reset your pet to start over with a new companion. This action cannot be undone."}),S?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Are you sure you want to reset your pet?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium",children:"Yes, Reset"}),e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Reset Pet"]})]})]})]})},Xe=({children:i,className:t=""})=>e.jsx("div",{className:`min-h-screen bg-[#F7F5F3] ${t}`,children:i}),Ys=({message:i,type:t,onClose:m})=>{const n={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[t],s={success:"✓",error:"✕",info:"ℹ"}[t];return gt.useEffect(()=>{const r=setTimeout(()=>{m()},3e3);return()=>clearTimeout(r)},[m]),e.jsxs("div",{className:`fixed top-4 right-4 ${n} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in`,children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{children:i}),e.jsx("button",{onClick:m,className:"ml-2 text-white hover:text-gray-200",children:"✕"})]})},Ks=()=>{var j;const{user:i,signOut:t,updateProfile:m}=ve(),n=K(),[s,r]=B.useState({displayName:"",bio:"",favoriteGenres:[],readingGoal:12}),[o,f]=B.useState(!1),[l,d]=B.useState(!1),[a,c]=B.useState(""),[x,y]=B.useState(null),u=(j=i==null?void 0:i.id)==null?void 0:j.startsWith("guest-");B.useEffect(()=>{i&&w()},[i]),B.useEffect(()=>{i!=null&&i.profile&&!u&&r({displayName:i.profile.displayName||"",bio:i.profile.bio||"",favoriteGenres:i.profile.favoriteGenres||[],readingGoal:i.profile.readingGoal||12,joinedDate:i.profile.joinedDate||i.createdAt})},[i==null?void 0:i.profile,u]);const w=async()=>{console.log("ProfilePage: Loading profile for user:",i==null?void 0:i.id,"isGuest:",u);try{if(u){const k=Ce.getGuestProfile();if(console.log("ProfilePage: Loaded guest profile from localStorage:",k),k){r({displayName:k.displayName||"Guest User",bio:k.bio||"Browsing as a guest",favoriteGenres:k.favoriteGenres||[],readingGoal:k.readingGoal||12,joinedDate:k.joinedDate||(i==null?void 0:i.createdAt)});return}i!=null&&i.profile&&(console.log("ProfilePage: Using fallback guest profile from user object"),r({displayName:i.profile.displayName||"Guest User",bio:i.profile.bio||"Browsing as a guest",favoriteGenres:i.profile.favoriteGenres||[],readingGoal:i.profile.readingGoal||12,joinedDate:i.createdAt}));return}console.log("ProfilePage: Loading profile from Gun service");const p=await $.getProfile();if(console.log("ProfilePage: Gun service profile result:",p),p.success&&p.profile){const k={displayName:p.profile.displayName||"",bio:p.profile.bio||"",favoriteGenres:p.profile.favoriteGenres||[],readingGoal:p.profile.readingGoal||12,joinedDate:p.profile.joinedDate||p.profile.lastUpdated};console.log("ProfilePage: Setting profile to:",k),r(k)}else console.log("ProfilePage: No profile found or error loading profile")}catch(p){console.error("Error loading profile:",p)}},b=async()=>{if(i){console.log("ProfilePage: Saving profile:",s),d(!0);try{if(u){Ce.setGuestProfile(s),f(!1),console.log("Guest profile saved to localStorage:",s),y({message:"Profile saved successfully!",type:"success"});return}console.log("ProfilePage: Calling updateProfile with:",s);const p=await m(s);console.log("ProfilePage: updateProfile result:",p),p.success?(f(!1),console.log("Profile saved successfully"),y({message:"Profile saved successfully!",type:"success"}),console.log("ProfilePage: Reloading profile after save"),await w()):(console.error("Error saving profile:",p.error),y({message:`Failed to save profile: ${p.error||"Unknown error"}`,type:"error"}))}catch(p){console.error("Error saving profile:",p),y({message:"Failed to save profile. Please try again.",type:"error"})}finally{d(!1)}}},S=()=>{a.trim()&&!s.favoriteGenres.includes(a.trim())&&(r(p=>({...p,favoriteGenres:[...p.favoriteGenres,a.trim()]})),c(""))},h=p=>{r(k=>({...k,favoriteGenres:k.favoriteGenres.filter(v=>v!==p)}))},g=()=>{t()};return i?e.jsxs(Xe,{children:[e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 py-8",children:[u&&e.jsx("div",{className:"max-w-4xl mx-auto px-4 mb-4",children:e.jsx("div",{className:"bg-orange-100 border border-orange-200 text-orange-800 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"                ",e.jsx("span",{className:"font-medium",children:"Guest Mode"}),e.jsx("span",{className:"ml-2",children:"- Profile changes saved locally. Create an account to sync across devices!"})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:["            ",e.jsxs("div",{className:"bg-gradient-to-r from-amber-600 to-orange-600 px-8 py-12 text-white relative",children:[e.jsx("button",{onClick:()=>n(-1),className:"absolute top-4 left-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",title:"Go back",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),"                ",e.jsxs("div",{className:"text-center md:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.displayName||(i==null?void 0:i.username)||"Book Lover"}),e.jsx("p",{className:"text-amber-100 text-lg",children:s.bio||"A passionate reader exploring new worlds through books"}),s.joinedDate&&e.jsxs("p",{className:"text-amber-200 text-sm mt-2",children:["Member since ",new Date(s.joinedDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>f(!o),className:"px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),o?"Cancel":"Edit Profile"]}),e.jsxs("button",{onClick:g,className:"px-6 py-2 bg-red-500/80 hover:bg-red-600/80 rounded-lg transition-colors duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Personal Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),o?e.jsx("input",{type:"text",value:s.displayName,onChange:p=>r(k=>({...k,displayName:p.target.value})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"Your display name"}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:s.displayName||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),o?e.jsx("textarea",{value:s.bio,onChange:p=>r(k=>({...k,bio:p.target.value})),rows:4,className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",placeholder:"Tell us about yourself and your reading interests..."}):e.jsx("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg min-h-[100px] whitespace-pre-wrap",children:s.bio||"No bio added yet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reading Goal (books per year)"}),o?e.jsx("input",{type:"number",min:"1",max:"365",value:s.readingGoal,onChange:p=>r(k=>({...k,readingGoal:parseInt(p.target.value)||12})),className:"w-full px-4 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}):e.jsxs("p",{className:"text-gray-900 px-4 py-3 bg-amber-50 rounded-lg",children:[s.readingGoal," books per year"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Favorite Genres"}),o&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:p=>c(p.target.value),onKeyPress:p=>p.key==="Enter"&&S(),placeholder:"Add a genre...",className:"flex-1 px-4 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors duration-200",children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.favoriteGenres.map((p,k)=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium",children:[p,o&&e.jsx("button",{onClick:()=>h(p),className:"text-amber-600 hover:text-amber-800 transition-colors duration-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},k)),s.favoriteGenres.length===0&&e.jsx("p",{className:"text-gray-500 italic",children:"No favorite genres added yet"})]}),e.jsxs("div",{className:"mt-8 p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-800 mb-4",children:"Reading Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Books Read"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pages Read"})]})]})]})]})]}),o&&e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:b,disabled:l,className:"px-8 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Changes"]})})})]})]})})]}),x&&e.jsx(Ys,{message:x.message,type:x.type,onClose:()=>y(null)})]}):e.jsx(Xe,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-amber-800 mb-4",children:"Please sign in to view your profile"})})})})},qs=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"app-titlebar hidden",children:e.jsxs("div",{className:"app-titlebar-content",children:[e.jsx("div",{className:"app-titlebar-icon",children:"📚"}),e.jsx("span",{children:"Bookish"})]})}),e.jsx(ws,{children:e.jsx(ys,{children:e.jsx(hs,{children:e.jsx(pt,{basename:"/Bookish",children:e.jsx(Ns,{children:e.jsxs(yt,{children:[e.jsx(q,{path:"/",element:e.jsx(Cs,{})}),e.jsx(q,{path:"/welcome",element:e.jsx(Ss,{})}),e.jsx(q,{path:"/search",element:e.jsx(_s,{})}),e.jsx(q,{path:"/library",element:e.jsx(Ms,{})}),e.jsx(q,{path:"/book",element:e.jsx(Ps,{})}),e.jsx(q,{path:"/reading",element:e.jsx(Gs,{})}),e.jsx(q,{path:"/notes",element:e.jsx(Js,{})}),e.jsx(q,{path:"/notes/add",element:e.jsx($s,{})}),e.jsx(q,{path:"/pet",element:e.jsx(Hs,{})}),e.jsx(q,{path:"/stats",element:e.jsx(Ls,{})}),e.jsx(q,{path:"/profile",element:e.jsx(Ks,{})})]})})})})})})]});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});Wt.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(qs,{})}));
